module.exports = {

"[project]/node_modules/better-auth/dist/index.js [app-rsc] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, z: __turbopack_require_stub__ } = __turbopack_context__;
{
__turbopack_esm__({
    "BetterAuthError": (()=>B),
    "HIDE_METADATA": (()=>se),
    "MissingDependencyError": (()=>tt),
    "betterAuth": (()=>au),
    "capitalizeFirstLetter": (()=>Yi),
    "createCookieGetter": (()=>Ne),
    "createLogger": (()=>Ue),
    "deleteSessionCookie": (()=>M),
    "generateId": (()=>H),
    "generateState": (()=>ve),
    "getCookies": (()=>it),
    "levels": (()=>je),
    "logger": (()=>C),
    "parseCookies": (()=>vo),
    "parseSetCookieHeader": (()=>ho),
    "parseState": (()=>At),
    "setCookieCache": (()=>Be),
    "setSessionCookie": (()=>D),
    "shouldPublishLog": (()=>mn)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/better-call/dist/index.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$base64$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/@better-auth/utils/dist/base64.mjs [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hmac$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/@better-auth/utils/dist/hmac.mjs [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hash$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/@better-auth/utils/dist/hash.mjs [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hex$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/@better-auth/utils/dist/hex.mjs [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$random$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/@better-auth/utils/dist/random.mjs [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$binary$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/@better-auth/utils/dist/binary.mjs [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$defu$2f$dist$2f$defu$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/defu/dist/defu.mjs [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$noble$2f$hashes$2f$esm$2f$scrypt$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/@noble/hashes/esm/scrypt.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$uncrypto$2f$dist$2f$crypto$2e$node$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/uncrypto/dist/crypto.node.mjs [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/zod/lib/index.mjs [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$node$2f$esm$2f$util$2f$decode_protected_header$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/jose/dist/node/esm/util/decode_protected_header.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$node$2f$esm$2f$jwt$2f$verify$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/jose/dist/node/esm/jwt/verify.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$node$2f$esm$2f$util$2f$decode_jwt$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/jose/dist/node/esm/util/decode_jwt.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$node$2f$esm$2f$key$2f$import$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/jose/dist/node/esm/key/import.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$node$2f$esm$2f$jwt$2f$sign$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/jose/dist/node/esm/jwt/sign.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$kysely$2f$dist$2f$esm$2f$dialect$2f$sqlite$2f$sqlite$2d$dialect$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/kysely/dist/esm/dialect/sqlite/sqlite-dialect.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$kysely$2f$dist$2f$esm$2f$dialect$2f$mysql$2f$mysql$2d$dialect$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/kysely/dist/esm/dialect/mysql/mysql-dialect.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$kysely$2f$dist$2f$esm$2f$dialect$2f$postgres$2f$postgres$2d$dialect$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/kysely/dist/esm/dialect/postgres/postgres-dialect.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$kysely$2f$dist$2f$esm$2f$dialect$2f$mssql$2f$mssql$2d$dialect$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/kysely/dist/esm/dialect/mssql/mssql-dialect.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$kysely$2f$dist$2f$esm$2f$kysely$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/kysely/dist/esm/kysely.js [app-rsc] (ecmascript)");
;
;
;
var Ye = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["createMiddleware"])(async ()=>({})), ce = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["createMiddlewareCreator"])({
    use: [
        Ye,
        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["createMiddleware"])(async ()=>({}))
    ]
}), E = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["createEndpointCreator"])({
    use: [
        Ye
    ]
});
function De(e) {
    return e === "-" || e === "^" || e === "$" || e === "+" || e === "." || e === "(" || e === ")" || e === "|" || e === "[" || e === "]" || e === "{" || e === "}" || e === "*" || e === "?" || e === "\\" ? `\\${e}` : e;
}
function Sr(e) {
    let t = "";
    for(let r = 0; r < e.length; r++)t += De(e[r]);
    return t;
}
function Xe(e, t = !0) {
    if (Array.isArray(e)) return `(?:${e.map((c)=>`^${Xe(c, t)}$`).join("|")})`;
    let r = "", n = "", o = ".";
    t === !0 ? (r = "/", n = "[/\\\\]", o = "[^/\\\\]") : t && (r = t, n = Sr(r), n.length > 1 ? (n = `(?:${n})`, o = `((?!${n}).)`) : o = `[^${n}]`);
    let i = t ? `${n}+?` : "", d = t ? `${n}*?` : "", l = t ? e.split(r) : [
        e
    ], s = "";
    for(let a = 0; a < l.length; a++){
        let c = l[a], p = l[a + 1], m = "";
        if (!(!c && a > 0)) {
            if (t && (a === l.length - 1 ? m = d : p !== "**" ? m = i : m = ""), t && c === "**") {
                m && (s += a === 0 ? "" : m, s += `(?:${o}*?${m})*?`);
                continue;
            }
            for(let u = 0; u < c.length; u++){
                let f = c[u];
                f === "\\" ? u < c.length - 1 && (s += De(c[u + 1]), u++) : f === "?" ? s += o : f === "*" ? s += `${o}*?` : s += De(f);
            }
            s += m;
        }
    }
    return s;
}
function _r(e, t) {
    if (typeof t != "string") throw new TypeError(`Sample must be a string, but ${typeof t} given`);
    return e.test(t);
}
function Ae(e, t) {
    if (typeof e != "string" && !Array.isArray(e)) throw new TypeError(`The first argument must be a single pattern string or an array of patterns, but ${typeof e} given`);
    if ((typeof t == "string" || typeof t == "boolean") && (t = {
        separator: t
    }), arguments.length === 2 && !(typeof t > "u" || typeof t == "object" && t !== null && !Array.isArray(t))) throw new TypeError(`The second argument must be an options object or a string/boolean separator, but ${typeof t} given`);
    if (t = t || {}, t.separator === "\\") throw new Error("\\ is not a valid separator because it is used for escaping. Try setting the separator to `true` instead");
    let r = Xe(e, t.separator), n = new RegExp(`^${r}$`, t.flags), o = _r.bind(null, n);
    return o.options = t, o.pattern = e, o.regexp = n, o;
}
var Re = Object.create(null), le = (e)=>globalThis.process?.env || globalThis.Deno?.env.toObject() || globalThis.__env__ || (e ? Re : globalThis), N = new Proxy(Re, {
    get (e, t) {
        return le()[t] ?? Re[t];
    },
    has (e, t) {
        let r = le();
        return t in r || t in Re;
    },
    set (e, t, r) {
        let n = le(!0);
        return n[t] = r, !0;
    },
    deleteProperty (e, t) {
        if (!t) return !1;
        let r = le(!0);
        return delete r[t], !0;
    },
    ownKeys () {
        let e = le(!0);
        return Object.keys(e);
    }
});
function Ir(e) {
    return e ? e !== "false" : !1;
}
var ke = typeof process < "u" && process.env && ("TURBOPACK compile-time value", "development") || "", ue = ke === "production", Te = ke === "dev" || ke === "development", et = ke === "test" || Ir(N.TEST);
var B = class extends Error {
    constructor(t, r){
        super(t), this.name = "BetterAuthError", this.message = t, this.cause = r, this.stack = "";
    }
}, tt = class extends B {
    constructor(t){
        super(`The package "${t}" is required. Make sure it is installed.`, t);
    }
};
function Pr(e) {
    try {
        return new URL(e).pathname !== "/";
    } catch  {
        throw new B(`Invalid base URL: ${e}. Please provide a valid base URL.`);
    }
}
function Ce(e, t = "/api/auth") {
    return Pr(e) ? e : (t = t.startsWith("/") ? t : `/${t}`, `${e}${t}`);
}
function pe(e, t) {
    if (e) return Ce(e, t);
    let r = N.BETTER_AUTH_URL || N.NEXT_PUBLIC_BETTER_AUTH_URL || N.PUBLIC_BETTER_AUTH_URL || N.NUXT_PUBLIC_BETTER_AUTH_URL || N.NUXT_PUBLIC_AUTH_URL || (N.BASE_URL !== "/" ? N.BASE_URL : void 0);
    if (r) return Ce(r, t);
    if ("undefined" < "u" && window.location) return Ce(window.location.origin, t);
}
function rt(e) {
    try {
        return new URL(e).origin;
    } catch  {
        return null;
    }
}
function nt(e) {
    return e.includes("://") ? new URL(e).host : e;
}
var ot = ce(async (e)=>{
    if (e.request?.method !== "POST") return;
    let { body: t, query: r, context: n } = e, o = e.headers?.get("origin") || e.headers?.get("referer") || "", i = t?.callbackURL || r?.callbackURL, d = t?.redirectTo, l = r?.currentURL, s = t?.errorCallbackURL, a = t?.newUserCallbackURL, c = n.trustedOrigins, p = e.headers?.has("cookie"), m = (f, g)=>f.startsWith("/") ? !1 : g.includes("*") ? Ae(g)(nt(f)) : f.startsWith(g), u = (f, g)=>{
        if (!f) return;
        if (!c.some((A)=>m(f, A) || f?.startsWith("/") && g !== "origin" && !f.includes(":"))) throw e.context.logger.error(`Invalid ${g}: ${f}`), e.context.logger.info(`If it's a valid URL, please add ${f} to trustedOrigins in your auth config
`, `Current list of trustedOrigins: ${c}`), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
            message: `Invalid ${g}`
        });
    };
    p && !e.context.options.advanced?.disableCSRFCheck && u(o, "origin"), i && u(i, "callbackURL"), d && u(d, "redirectURL"), l && u(l, "currentURL"), s && u(s, "errorCallbackURL"), a && u(d, "newUserCallbackURL");
});
;
;
var V = (e, t = "ms")=>new Date(Date.now() + (t === "sec" ? e * 1e3 : e));
;
var ee = (e, t)=>{
    let r = ()=>{
        switch(t){
            case "ms":
                return e;
            case "s":
                return e * 1e3;
            case "m":
                return e * 1e3 * 60;
            case "h":
                return e * 1e3 * 60 * 60;
            case "d":
                return e * 1e3 * 60 * 60 * 24;
            case "w":
                return e * 1e3 * 60 * 60 * 24 * 7;
            case "y":
                return e * 1e3 * 60 * 60 * 24 * 365;
        }
    }, n = {
        t: `${e}${t}`,
        value: e,
        tFormat: t,
        toMilliseconds: r,
        toSeconds: ()=>n.toMilliseconds() / 1e3,
        toMinutes: ()=>n.toSeconds() / 60,
        toHours: ()=>n.toMinutes() / 60,
        toDays: ()=>n.toHours() / 24,
        toWeeks: ()=>n.toDays() / 7,
        toYears: ()=>n.toDays() / 365,
        getDate: ()=>new Date(Date.now() + n.toMilliseconds()),
        add: (o)=>{
            let i = typeof o == "string" ? fe(o).toMilliseconds() : o.toMilliseconds();
            return ee(n.toMilliseconds() + i, "ms");
        },
        subtract: (o)=>{
            let i = typeof o == "string" ? fe(o).toMilliseconds() : o.toMilliseconds();
            return ee(n.toMilliseconds() - i, "ms");
        },
        multiply: (o)=>ee(n.toMilliseconds() * o, "ms"),
        divide: (o)=>ee(n.toMilliseconds() / o, "ms"),
        equals: (o)=>{
            let i = typeof o == "string" ? fe(o).toMilliseconds() : o.toMilliseconds();
            return n.toMilliseconds() === i;
        },
        lessThan: (o)=>{
            let i = typeof o == "string" ? fe(o).toMilliseconds() : o.toMilliseconds();
            return n.toMilliseconds() < i;
        },
        greaterThan: (o)=>{
            let i = typeof o == "string" ? fe(o).toMilliseconds() : o.toMilliseconds();
            return n.toMilliseconds() > i;
        },
        format: (o)=>{
            let i = n.getDate();
            return o.replace(/YYYY|MM|DD|HH|mm|ss/g, (d)=>{
                switch(d){
                    case "YYYY":
                        return i.getFullYear().toString();
                    case "MM":
                        return (i.getMonth() + 1).toString().padStart(2, "0");
                    case "DD":
                        return i.getDate().toString().padStart(2, "0");
                    case "HH":
                        return i.getHours().toString().padStart(2, "0");
                    case "mm":
                        return i.getMinutes().toString().padStart(2, "0");
                    case "ss":
                        return i.getSeconds().toString().padStart(2, "0");
                    default:
                        return d;
                }
            });
        },
        fromNow: ()=>{
            let o = n.toMilliseconds();
            return o < 0 ? n.ago() : o < 1e3 ? "in a few seconds" : o < 6e4 ? `in ${Math.round(o / 1e3)} seconds` : o < 36e5 ? `in ${Math.round(o / 6e4)} minutes` : o < 864e5 ? `in ${Math.round(o / 36e5)} hours` : o < 6048e5 ? `in ${Math.round(o / 864e5)} days` : o < 26298e5 ? `in ${Math.round(o / 6048e5)} weeks` : o < 315576e5 ? `in ${Math.round(o / 26298e5)} months` : `in ${Math.round(o / 315576e5)} years`;
        },
        ago: ()=>{
            let o = -n.toMilliseconds();
            return o < 0 ? n.fromNow() : o < 1e3 ? "a few seconds ago" : o < 6e4 ? `${Math.round(o / 1e3)} seconds ago` : o < 36e5 ? `${Math.round(o / 6e4)} minutes ago` : o < 864e5 ? `${Math.round(o / 36e5)} hours ago` : o < 6048e5 ? `${Math.round(o / 864e5)} days ago` : o < 26298e5 ? `${Math.round(o / 6048e5)} weeks ago` : o < 315576e5 ? `${Math.round(o / 26298e5)} months ago` : `${Math.round(o / 315576e5)} years ago`;
        }
    };
    return n;
}, fe = (e)=>{
    let t = e.match(/^(\d+)(ms|s|m|h|d|w|y)$/);
    if (!t) throw new Error("Invalid time format");
    return ee(parseInt(t[1]), t[2]);
};
;
function ho(e) {
    let t = new Map;
    return e.split(", ").forEach((n)=>{
        let o = n.split(";").map((p)=>p.trim()), [i, ...d] = o, [l, ...s] = i.split("="), a = s.join("=");
        if (!l || a === void 0) return;
        let c = {
            value: a
        };
        d.forEach((p)=>{
            let [m, ...u] = p.split("="), f = u.join("="), g = m.trim().toLowerCase();
            switch(g){
                case "max-age":
                    c["max-age"] = f ? parseInt(f.trim(), 10) : void 0;
                    break;
                case "expires":
                    c.expires = f ? new Date(f.trim()) : void 0;
                    break;
                case "domain":
                    c.domain = f ? f.trim() : void 0;
                    break;
                case "path":
                    c.path = f ? f.trim() : void 0;
                    break;
                case "secure":
                    c.secure = !0;
                    break;
                case "httponly":
                    c.httponly = !0;
                    break;
                case "samesite":
                    c.samesite = f ? f.trim().toLowerCase() : void 0;
                    break;
                default:
                    c[g] = f ? f.trim() : !0;
                    break;
            }
        }), t.set(l, c);
    }), t;
}
function Ne(e) {
    let r = (e.advanced?.useSecureCookies !== void 0 ? e.advanced?.useSecureCookies : e.baseURL !== void 0 ? !!e.baseURL.startsWith("https://") : ue) ? "__Secure-" : "", n = !!e.advanced?.crossSubDomainCookies?.enabled, o = n ? e.advanced?.crossSubDomainCookies?.domain || (e.baseURL ? new URL(e.baseURL).hostname : void 0) : void 0;
    if (n && !o) throw new B("baseURL is required when crossSubdomainCookies are enabled");
    function i(d, l = {}) {
        let s = e.advanced?.cookiePrefix || "better-auth", a = e.advanced?.cookies?.[d]?.name || `${s}.${d}`, c = e.advanced?.cookies?.[d]?.attributes;
        return {
            name: `${r}${a}`,
            attributes: {
                secure: !!r,
                sameSite: "lax",
                path: "/",
                httpOnly: !0,
                ...n ? {
                    domain: o
                } : {},
                ...e.advanced?.defaultCookieAttributes,
                ...l,
                ...c
            }
        };
    }
    return i;
}
function it(e) {
    let t = Ne(e), r = e.session?.expiresIn || ee(7, "d").toSeconds(), n = t("session_token", {
        maxAge: r
    }), o = t("session_data", {
        maxAge: e.session?.cookieCache?.maxAge || 60 * 5
    }), i = t("dont_remember");
    return {
        sessionToken: {
            name: n.name,
            options: n.attributes
        },
        sessionData: {
            name: o.name,
            options: o.attributes
        },
        dontRememberToken: {
            name: i.name,
            options: i.attributes
        }
    };
}
async function Be(e, t) {
    if (e.context.options.session?.cookieCache?.enabled) {
        let n = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$base64$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["base64Url"].encode(JSON.stringify({
            session: t,
            expiresAt: V(e.context.authCookies.sessionData.options.maxAge || 60, "sec").getTime(),
            signature: await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hmac$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["createHMAC"])("SHA-256", "base64urlnopad").sign(e.context.secret, JSON.stringify(t))
        }), {
            padding: !1
        });
        if (n.length > 4093) throw new B("Session data is too large to store in the cookie. Please disable session cookie caching or reduce the size of the session data");
        e.setCookie(e.context.authCookies.sessionData.name, n, e.context.authCookies.sessionData.options);
    }
}
async function D(e, t, r, n) {
    let o = e.context.authCookies.sessionToken.options, i = r ? void 0 : e.context.sessionConfig.expiresIn;
    await e.setSignedCookie(e.context.authCookies.sessionToken.name, t.session.token, e.context.secret, {
        ...o,
        maxAge: i,
        ...n
    }), r && await e.setSignedCookie(e.context.authCookies.dontRememberToken.name, "true", e.context.secret, e.context.authCookies.dontRememberToken.options), await Be(e, t), e.context.setNewSession(t), e.context.options.secondaryStorage && await e.context.secondaryStorage?.set(t.session.token, JSON.stringify({
        user: t.user,
        session: t.session
    }), Math.floor((new Date(t.session.expiresAt).getTime() - Date.now()) / 1e3));
}
function M(e) {
    e.setCookie(e.context.authCookies.sessionToken.name, "", {
        ...e.context.authCookies.sessionToken.options,
        maxAge: 0
    }), e.setCookie(e.context.authCookies.sessionData.name, "", {
        ...e.context.authCookies.sessionData.options,
        maxAge: 0
    }), e.setCookie(e.context.authCookies.dontRememberToken.name, "", {
        ...e.context.authCookies.dontRememberToken.options,
        maxAge: 0
    });
}
function vo(e) {
    let t = e.split("; "), r = new Map;
    return t.forEach((n)=>{
        let [o, i] = n.split("=");
        r.set(o, i);
    }), r;
}
var Nr = Object.defineProperty, Br = Object.defineProperties, jr = Object.getOwnPropertyDescriptors, st = Object.getOwnPropertySymbols, Fr = Object.prototype.hasOwnProperty, qr = Object.prototype.propertyIsEnumerable, at = (e, t, r)=>t in e ? Nr(e, t, {
        enumerable: !0,
        configurable: !0,
        writable: !0,
        value: r
    }) : e[t] = r, te = (e, t)=>{
    for(var r in t || (t = {}))Fr.call(t, r) && at(e, r, t[r]);
    if (st) for (var r of st(t))qr.call(t, r) && at(e, r, t[r]);
    return e;
}, re = (e, t)=>Br(e, jr(t)), Vr = class extends Error {
    constructor(e, t, r){
        super(t || e.toString(), {
            cause: r
        }), this.status = e, this.statusText = t, this.error = r;
    }
}, $r = async (e, t)=>{
    var r, n, o, i, d, l;
    let s = t || {}, a = {
        onRequest: [
            t?.onRequest
        ],
        onResponse: [
            t?.onResponse
        ],
        onSuccess: [
            t?.onSuccess
        ],
        onError: [
            t?.onError
        ],
        onRetry: [
            t?.onRetry
        ]
    };
    if (!t || !t?.plugins) return {
        url: e,
        options: s,
        hooks: a
    };
    for (let c of t?.plugins || []){
        if (c.init) {
            let p = await ((r = c.init) == null ? void 0 : r.call(c, e.toString(), t));
            s = p.options || s, e = p.url;
        }
        a.onRequest.push((n = c.hooks) == null ? void 0 : n.onRequest), a.onResponse.push((o = c.hooks) == null ? void 0 : o.onResponse), a.onSuccess.push((i = c.hooks) == null ? void 0 : i.onSuccess), a.onError.push((d = c.hooks) == null ? void 0 : d.onError), a.onRetry.push((l = c.hooks) == null ? void 0 : l.onRetry);
    }
    return {
        url: e,
        options: s,
        hooks: a
    };
}, dt = class {
    constructor(e){
        this.options = e;
    }
    shouldAttemptRetry(e, t) {
        return this.options.shouldRetry ? Promise.resolve(e < this.options.attempts && this.options.shouldRetry(t)) : Promise.resolve(e < this.options.attempts);
    }
    getDelay() {
        return this.options.delay;
    }
}, Mr = class {
    constructor(e){
        this.options = e;
    }
    shouldAttemptRetry(e, t) {
        return this.options.shouldRetry ? Promise.resolve(e < this.options.attempts && this.options.shouldRetry(t)) : Promise.resolve(e < this.options.attempts);
    }
    getDelay(e) {
        return Math.min(this.options.maxDelay, this.options.baseDelay * 2 ** e);
    }
};
function zr(e) {
    if (typeof e == "number") return new dt({
        type: "linear",
        attempts: e,
        delay: 1e3
    });
    switch(e.type){
        case "linear":
            return new dt(e);
        case "exponential":
            return new Mr(e);
        default:
            throw new Error("Invalid retry strategy");
    }
}
var Hr = (e)=>{
    let t = {}, r = (n)=>typeof n == "function" ? n() : n;
    if (e?.auth) {
        if (e.auth.type === "Bearer") {
            let n = r(e.auth.token);
            if (!n) return t;
            t.authorization = `Bearer ${n}`;
        } else if (e.auth.type === "Basic") {
            let n = r(e.auth.username), o = r(e.auth.password);
            if (!n || !o) return t;
            t.authorization = `Basic ${btoa(`${n}:${o}`)}`;
        } else if (e.auth.type === "Custom") {
            let n = r(e.auth.value);
            if (!n) return t;
            t.authorization = `${r(e.auth.prefix)} ${n}`;
        }
    }
    return t;
}, ut = [
    "get",
    "post",
    "put",
    "patch",
    "delete"
];
var Wr = /^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;
function Gr(e) {
    let t = e.headers.get("content-type"), r = new Set([
        "image/svg",
        "application/xml",
        "application/xhtml",
        "application/html"
    ]);
    if (!t) return "json";
    let n = t.split(";").shift() || "";
    return Wr.test(n) ? "json" : r.has(n) || n.startsWith("text/") ? "text" : "blob";
}
function Kr(e) {
    try {
        return JSON.parse(e), !0;
    } catch  {
        return !1;
    }
}
function pt(e) {
    if (e === void 0) return !1;
    let t = typeof e;
    return t === "string" || t === "number" || t === "boolean" || t === null ? !0 : t !== "object" ? !1 : Array.isArray(e) ? !0 : e.buffer ? !1 : e.constructor && e.constructor.name === "Object" || typeof e.toJSON == "function";
}
function ct(e) {
    try {
        return JSON.parse(e);
    } catch  {
        return e;
    }
}
function lt(e) {
    return typeof e == "function";
}
function Qr(e) {
    if (e?.customFetchImpl) return e.customFetchImpl;
    if (typeof globalThis < "u" && lt(globalThis.fetch)) return globalThis.fetch;
    if ("undefined" < "u" && lt(window.fetch)) return window.fetch;
    throw new Error("No fetch implementation found");
}
function Jr(e) {
    let t = new Headers(e?.headers), r = Hr(e);
    for (let [n, o] of Object.entries(r || {}))t.set(n, o);
    if (!t.has("content-type")) {
        let n = Zr(e?.body);
        n && t.set("content-type", n);
    }
    return t;
}
function Zr(e) {
    return pt(e) ? "application/json" : null;
}
function Yr(e) {
    if (!e?.body) return null;
    let t = new Headers(e?.headers);
    return pt(e.body) && !t.has("content-type") ? JSON.stringify(e.body) : e.body;
}
function Xr(e, t) {
    var r;
    if (t?.method) return t.method.toUpperCase();
    if (e.startsWith("@")) {
        let n = (r = e.split("@")[1]) == null ? void 0 : r.split("/")[0];
        return ut.includes(n) ? n.toUpperCase() : t?.body ? "POST" : "GET";
    }
    return t?.body ? "POST" : "GET";
}
function en(e, t) {
    let r;
    return !e?.signal && e?.timeout && (r = setTimeout(()=>t?.abort(), e?.timeout)), {
        abortTimeout: r,
        clearTimeout: ()=>{
            r && clearTimeout(r);
        }
    };
}
function tn(e, t) {
    let { baseURL: r, params: n, query: o } = t || {
        query: {},
        params: {},
        baseURL: ""
    }, i = e.startsWith("http") ? e.split("/").slice(0, 3).join("/") : r;
    if (!i) throw new TypeError(`Invalid URL ${e}. Are you passing in a relative URL but not setting the baseURL?`);
    if (e.startsWith("@")) {
        let p = e.toString().split("@")[1].split("/")[0];
        ut.includes(p) && (e = e.replace(`@${p}/`, "/"));
    }
    i.endsWith("/") || (i += "/");
    let [d, l] = e.replace(i, "").split("?"), s = new URLSearchParams(l);
    for (let [p, m] of Object.entries(o || {}))s.set(p, String(m));
    if (n) if (Array.isArray(n)) {
        let p = d.split("/").filter((m)=>m.startsWith(":"));
        for (let [m, u] of p.entries()){
            let f = n[m];
            d = d.replace(u, f);
        }
    } else for (let [p, m] of Object.entries(n))d = d.replace(`:${p}`, String(m));
    d = d.split("/").map(encodeURIComponent).join("/"), d.startsWith("/") && (d = d.slice(1));
    let a = s.size > 0 ? `?${s}`.replace(/\+/g, "%20") : "";
    return new URL(`${d}${a}`, i);
}
var v = async (e, t)=>{
    var r, n, o, i, d, l, s, a;
    let { hooks: c, url: p, options: m } = await $r(e, t), u = Qr(m), f = new AbortController, g = (r = m.signal) != null ? r : f.signal, b = tn(p, m), A = Yr(m), R = Jr(m), h = Xr(p, m), y = re(te({}, m), {
        url: b,
        headers: R,
        body: A,
        method: h,
        signal: g
    });
    for (let F of c.onRequest)if (F) {
        let P = await F(y);
        P instanceof Object && (y = P);
    }
    ("pipeTo" in y && typeof y.pipeTo == "function" || typeof ((n = t?.body) == null ? void 0 : n.pipe) == "function") && ("duplex" in y || (y.duplex = "half"));
    let { clearTimeout: x } = en(m, f), k = await u(y.url, y);
    x();
    let be = {
        response: k,
        request: y
    };
    for (let F of c.onResponse)if (F) {
        let P = await F(re(te({}, be), {
            response: (o = t?.hookOptions) != null && o.cloneResponse ? k.clone() : k
        }));
        P instanceof Response ? k = P : P instanceof Object && (k = P.response);
    }
    if (k.ok) {
        if (!(y.method !== "HEAD")) return {
            data: "",
            error: null
        };
        let P = Gr(k), G = {
            data: "",
            response: k,
            request: y
        };
        if (P === "json" || P === "text") {
            let K = await k.text(), Ur = await ((i = y.jsonParser) != null ? i : ct)(K);
            G.data = Ur;
        } else G.data = await k[P]();
        y?.output && y.output && !y.disableValidation && (G.data = y.output.parse(G.data));
        for (let K of c.onSuccess)K && await K(re(te({}, G), {
            response: (d = t?.hookOptions) != null && d.cloneResponse ? k.clone() : k
        }));
        return t?.throw ? G.data : {
            data: G.data,
            error: null
        };
    }
    let Er = (l = t?.jsonParser) != null ? l : ct, Je = await k.text(), Le = Kr(Je) ? await Er(Je) : {}, vr = {
        response: k,
        request: y,
        error: re(te({}, Le), {
            status: k.status,
            statusText: k.statusText
        })
    };
    for (let F of c.onError)F && await F(re(te({}, vr), {
        response: (s = t?.hookOptions) != null && s.cloneResponse ? k.clone() : k
    }));
    if (t?.retry) {
        let F = zr(t.retry), P = (a = t.retryAttempt) != null ? a : 0;
        if (await F.shouldAttemptRetry(P, k)) {
            for (let K of c.onRetry)K && await K(be);
            let G = F.getDelay(P);
            return await new Promise((K)=>setTimeout(K, G)), await v(e, re(te({}, t), {
                retryAttempt: P + 1
            }));
        }
    }
    if (t?.throw) throw new Vr(k.status, k.statusText, Le);
    return {
        data: null,
        error: re(te({}, Le), {
            status: k.status,
            statusText: k.statusText
        })
    };
};
;
;
;
;
async function ft(e) {
    let t = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hash$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["createHash"])("SHA-256").digest(e);
    return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$base64$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["base64Url"].encode(new Uint8Array(t), {
        padding: !1
    });
}
function Ee(e) {
    return {
        tokenType: e.token_type,
        accessToken: e.access_token,
        refreshToken: e.refresh_token,
        accessTokenExpiresAt: e.expires_in ? V(e.expires_in, "sec") : void 0,
        scopes: e?.scope ? typeof e.scope == "string" ? e.scope.split(" ") : e.scope : [],
        idToken: e.id_token
    };
}
async function O({ id: e, options: t, authorizationEndpoint: r, state: n, codeVerifier: o, scopes: i, claims: d, redirectURI: l, duration: s }) {
    let a = new URL(r);
    if (a.searchParams.set("response_type", "code"), a.searchParams.set("client_id", t.clientId), a.searchParams.set("state", n), a.searchParams.set("scope", i.join(" ")), a.searchParams.set("redirect_uri", t.redirectURI || l), o) {
        let c = await ft(o);
        a.searchParams.set("code_challenge_method", "S256"), a.searchParams.set("code_challenge", c);
    }
    if (d) {
        let c = d.reduce((p, m)=>(p[m] = null, p), {});
        a.searchParams.set("claims", JSON.stringify({
            id_token: {
                email: null,
                email_verified: null,
                ...c
            }
        }));
    }
    return s && a.searchParams.set("duration", s), a;
}
;
async function U({ code: e, codeVerifier: t, redirectURI: r, options: n, tokenEndpoint: o, authentication: i }) {
    let d = new URLSearchParams, l = {
        "content-type": "application/x-www-form-urlencoded",
        accept: "application/json",
        "user-agent": "better-auth"
    };
    if (d.set("grant_type", "authorization_code"), d.set("code", e), t && d.set("code_verifier", t), d.set("redirect_uri", r), i === "basic") {
        let p = btoa(`${n.clientId}:${n.clientSecret}`);
        l.authorization = `Basic ${p}`;
    } else d.set("client_id", n.clientId), d.set("client_secret", n.clientSecret);
    let { data: s, error: a } = await v(o, {
        method: "POST",
        body: d,
        headers: l
    });
    if (a) throw a;
    return Ee(s);
}
;
;
;
;
;
;
function mt(e, t) {
    let r = new Uint8Array(e), n = new Uint8Array(t);
    if (r.length !== n.length) return !1;
    let o = 0;
    for(let i = 0; i < r.length; i++)o |= r[i] ^ n[i];
    return o === 0;
}
;
;
;
var ie = {
    N: 16384,
    r: 16,
    p: 1,
    dkLen: 64
};
async function ht(e, t) {
    return await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$noble$2f$hashes$2f$esm$2f$scrypt$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["scryptAsync"])(e.normalize("NFKC"), t, {
        N: ie.N,
        p: ie.p,
        r: ie.r,
        dkLen: ie.dkLen,
        maxmem: 128 * ie.N * ie.r * 2
    });
}
var yt = async (e)=>{
    let t = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hex$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["hex"].encode((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$uncrypto$2f$dist$2f$crypto$2e$node$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getRandomValues"])(new Uint8Array(16))), r = await ht(e, t);
    return `${t}:${__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hex$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["hex"].encode(r)}`;
}, wt = async ({ hash: e, password: t })=>{
    let [r, n] = e.split(":"), o = await ht(t, r);
    return mt(o, new Uint8Array(Buffer.from(n, "hex")));
};
;
var me = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$random$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["createRandomStringGenerator"])("a-z", "0-9", "A-Z", "-_");
async function ve(e, t) {
    let r = e.body?.callbackURL || (e.query?.currentURL ? rt(e.query?.currentURL) : "") || e.context.options.baseURL;
    if (!r) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: "callbackURL is required"
    });
    let n = me(128), o = me(32), i = JSON.stringify({
        callbackURL: r,
        codeVerifier: n,
        errorURL: e.body?.errorCallbackURL || e.query?.currentURL,
        newUserURL: e.body?.newUserCallbackURL,
        link: t,
        expiresAt: Date.now() + 10 * 60 * 1e3
    }), d = new Date;
    d.setMinutes(d.getMinutes() + 10);
    let l = await e.context.internalAdapter.createVerificationValue({
        value: i,
        identifier: o,
        expiresAt: d
    });
    if (!l) throw e.context.logger.error("Unable to create verification. Make sure the database adapter is properly working and there is a verification table in the database"), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("INTERNAL_SERVER_ERROR", {
        message: "Unable to create verification"
    });
    return {
        state: l.identifier,
        codeVerifier: n
    };
}
async function At(e) {
    let t = e.query.state || e.body.state, r = await e.context.internalAdapter.findVerificationValue(t);
    if (!r) throw e.context.logger.error("State Mismatch. Verification not found", {
        state: t
    }), e.redirect(`${e.context.baseURL}/error?error=please_restart_the_process`);
    let n = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        callbackURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
        codeVerifier: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
        errorURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional(),
        newUserURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional(),
        expiresAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].number(),
        link: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
            email: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
            userId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string()
        }).optional()
    }).parse(JSON.parse(r.value));
    if (n.errorURL || (n.errorURL = `${e.context.baseURL}/error`), n.expiresAt < Date.now()) throw await e.context.internalAdapter.deleteVerificationValue(r.id), e.context.logger.error("State expired.", {
        state: t
    }), e.redirect(`${e.context.baseURL}/error?error=please_restart_the_process`);
    return await e.context.internalAdapter.deleteVerificationValue(r.id), n;
}
var Rt = (e)=>{
    let t = "https://appleid.apple.com/auth/token";
    return {
        id: "apple",
        name: "Apple",
        createAuthorizationURL ({ state: r, scopes: n, redirectURI: o }) {
            let i = n || [
                "email",
                "name"
            ];
            return e.scope && i.push(...e.scope), new URL(`https://appleid.apple.com/auth/authorize?client_id=${e.clientId}&response_type=code&redirect_uri=${e.redirectURI || o}&scope=${i.join(" ")}&state=${r}&response_mode=form_post`);
        },
        validateAuthorizationCode: async ({ code: r, codeVerifier: n, redirectURI: o })=>U({
                code: r,
                codeVerifier: n,
                redirectURI: e.redirectURI || o,
                options: e,
                tokenEndpoint: t
            }),
        async verifyIdToken (r, n) {
            if (e.disableIdTokenSignIn) return !1;
            if (e.verifyIdToken) return e.verifyIdToken(r, n);
            let o = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$node$2f$esm$2f$util$2f$decode_protected_header$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["decodeProtectedHeader"])(r), { kid: i, alg: d } = o;
            if (!i || !d) return !1;
            let l = await fn(i), { payload: s } = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$node$2f$esm$2f$jwt$2f$verify$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["jwtVerify"])(r, l, {
                algorithms: [
                    d
                ],
                issuer: "https://appleid.apple.com",
                audience: e.appBundleIdentifier || e.clientId,
                maxTokenAge: "1h"
            });
            return [
                "email_verified",
                "is_private_email"
            ].forEach((a)=>{
                s[a] !== void 0 && (s[a] = !!s[a]);
            }), n && s.nonce !== n ? !1 : !!s;
        },
        async getUserInfo (r) {
            if (e.getUserInfo) return e.getUserInfo(r);
            if (!r.idToken) return null;
            let n = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$node$2f$esm$2f$util$2f$decode_jwt$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["decodeJwt"])(r.idToken);
            if (!n) return null;
            let o = n.user ? `${n.user.name.firstName} ${n.user.name.lastName}` : n.email, i = await e.mapProfileToUser?.(n);
            return {
                user: {
                    id: n.sub,
                    name: o,
                    emailVerified: !1,
                    email: n.email,
                    ...i
                },
                data: n
            };
        }
    };
}, fn = async (e)=>{
    let t = "https://appleid.apple.com", r = "/auth/keys", { data: n } = await v(`${t}${r}`);
    if (!n?.keys) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: "Keys not found"
    });
    let o = n.keys.find((i)=>i.kid === e);
    if (!o) throw new Error(`JWK with kid ${e} not found`);
    return await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$node$2f$esm$2f$key$2f$import$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["importJWK"])(o, o.alg);
};
var kt = (e)=>({
        id: "discord",
        name: "Discord",
        createAuthorizationURL ({ state: t, scopes: r, redirectURI: n }) {
            let o = r || [
                "identify",
                "email"
            ];
            return e.scope && o.push(...e.scope), new URL(`https://discord.com/api/oauth2/authorize?scope=${o.join("+")}&response_type=code&client_id=${e.clientId}&redirect_uri=${encodeURIComponent(e.redirectURI || n)}&state=${t}&prompt=${e.prompt || "none"}`);
        },
        validateAuthorizationCode: async ({ code: t, redirectURI: r })=>U({
                code: t,
                redirectURI: e.redirectURI || r,
                options: e,
                tokenEndpoint: "https://discord.com/api/oauth2/token"
            }),
        async getUserInfo (t) {
            if (e.getUserInfo) return e.getUserInfo(t);
            let { data: r, error: n } = await v("https://discord.com/api/users/@me", {
                headers: {
                    authorization: `Bearer ${t.accessToken}`
                }
            });
            if (n) return null;
            if (r.avatar === null) {
                let i = r.discriminator === "0" ? Number(BigInt(r.id) >> BigInt(22)) % 6 : parseInt(r.discriminator) % 5;
                r.image_url = `https://cdn.discordapp.com/embed/avatars/${i}.png`;
            } else {
                let i = r.avatar.startsWith("a_") ? "gif" : "png";
                r.image_url = `https://cdn.discordapp.com/avatars/${r.id}/${r.avatar}.${i}`;
            }
            let o = await e.mapProfileToUser?.(r);
            return {
                user: {
                    id: r.id,
                    name: r.display_name || r.username || "",
                    email: r.email,
                    emailVerified: r.verified,
                    image: r.image_url,
                    ...o
                },
                data: r
            };
        }
    });
var Tt = (e)=>({
        id: "facebook",
        name: "Facebook",
        async createAuthorizationURL ({ state: t, scopes: r, redirectURI: n }) {
            let o = r || [
                "email",
                "public_profile"
            ];
            return e.scope && o.push(...e.scope), await O({
                id: "facebook",
                options: e,
                authorizationEndpoint: "https://www.facebook.com/v21.0/dialog/oauth",
                scopes: o,
                state: t,
                redirectURI: n
            });
        },
        validateAuthorizationCode: async ({ code: t, redirectURI: r })=>U({
                code: t,
                redirectURI: e.redirectURI || r,
                options: e,
                tokenEndpoint: "https://graph.facebook.com/oauth/access_token"
            }),
        async getUserInfo (t) {
            if (e.getUserInfo) return e.getUserInfo(t);
            let { data: r, error: n } = await v("https://graph.facebook.com/me?fields=id,name,email,picture", {
                auth: {
                    type: "Bearer",
                    token: t.accessToken
                }
            });
            if (n) return null;
            let o = await e.mapProfileToUser?.(r);
            return {
                user: {
                    id: r.id,
                    name: r.name,
                    email: r.email,
                    image: r.picture.data.url,
                    emailVerified: r.email_verified,
                    ...o
                },
                data: r
            };
        }
    });
var Et = (e)=>{
    let t = "https://github.com/login/oauth/access_token";
    return {
        id: "github",
        name: "GitHub",
        createAuthorizationURL ({ state: r, scopes: n, codeVerifier: o, redirectURI: i }) {
            let d = n || [
                "user:email"
            ];
            return e.scope && d.push(...e.scope), O({
                id: "github",
                options: e,
                authorizationEndpoint: "https://github.com/login/oauth/authorize",
                scopes: d,
                state: r,
                redirectURI: i
            });
        },
        validateAuthorizationCode: async ({ code: r, redirectURI: n })=>U({
                code: r,
                redirectURI: e.redirectURI || n,
                options: e,
                tokenEndpoint: t
            }),
        async getUserInfo (r) {
            if (e.getUserInfo) return e.getUserInfo(r);
            let { data: n, error: o } = await v("https://api.github.com/user", {
                headers: {
                    "User-Agent": "better-auth",
                    authorization: `Bearer ${r.accessToken}`
                }
            });
            if (o) return null;
            let i = !1, { data: d } = await v("https://api.github.com/user/emails", {
                headers: {
                    authorization: `Bearer ${r.accessToken}`,
                    "User-Agent": "better-auth"
                }
            });
            d && (n.email = (d.find((s)=>s.primary) ?? d[0])?.email, i = d.find((s)=>s.email === n.email)?.verified ?? !1);
            let l = await e.mapProfileToUser?.(n);
            return {
                user: {
                    id: n.id.toString(),
                    name: n.name || n.login,
                    email: n.email,
                    image: n.avatar_url,
                    emailVerified: i,
                    ...l
                },
                data: n
            };
        }
    };
};
var je = [
    "info",
    "success",
    "warn",
    "error",
    "debug"
];
function mn(e, t) {
    return je.indexOf(t) <= je.indexOf(e);
}
var z = {
    reset: "\x1B[0m",
    bright: "\x1B[1m",
    dim: "\x1B[2m",
    underscore: "\x1B[4m",
    blink: "\x1B[5m",
    reverse: "\x1B[7m",
    hidden: "\x1B[8m",
    fg: {
        black: "\x1B[30m",
        red: "\x1B[31m",
        green: "\x1B[32m",
        yellow: "\x1B[33m",
        blue: "\x1B[34m",
        magenta: "\x1B[35m",
        cyan: "\x1B[36m",
        white: "\x1B[37m"
    },
    bg: {
        black: "\x1B[40m",
        red: "\x1B[41m",
        green: "\x1B[42m",
        yellow: "\x1B[43m",
        blue: "\x1B[44m",
        magenta: "\x1B[45m",
        cyan: "\x1B[46m",
        white: "\x1B[47m"
    }
}, gn = {
    info: z.fg.blue,
    success: z.fg.green,
    warn: z.fg.yellow,
    error: z.fg.red,
    debug: z.fg.magenta
}, hn = (e, t)=>{
    let r = new Date().toISOString();
    return `${z.dim}${r}${z.reset} ${gn[e]}${e.toUpperCase()}${z.reset} ${z.bright}[Better Auth]:${z.reset} ${t}`;
}, Ue = (e)=>{
    let t = e?.disabled !== !0, r = e?.level ?? "error", n = (o, i, d = [])=>{
        if (!t || !mn(r, o)) return;
        let l = hn(o, i);
        if (!e || typeof e.log != "function") {
            o === "error" ? console.error(l, ...d) : o === "warn" ? console.warn(l, ...d) : console.log(l, ...d);
            return;
        }
        e.log(o === "success" ? "info" : o, l, ...d);
    };
    return Object.fromEntries(je.map((o)=>[
            o,
            (...[i, ...d])=>n(o, i, d)
        ]));
}, C = Ue();
;
var vt = (e)=>({
        id: "google",
        name: "Google",
        async createAuthorizationURL ({ state: t, scopes: r, codeVerifier: n, redirectURI: o }) {
            if (!e.clientId || !e.clientSecret) throw C.error("Client Id and Client Secret is required for Google. Make sure to provide them in the options."), new B("CLIENT_ID_AND_SECRET_REQUIRED");
            if (!n) throw new B("codeVerifier is required for Google");
            let i = r || [
                "email",
                "profile",
                "openid"
            ];
            e.scope && i.push(...e.scope);
            let d = await O({
                id: "google",
                options: e,
                authorizationEndpoint: "https://accounts.google.com/o/oauth2/auth",
                scopes: i,
                state: t,
                codeVerifier: n,
                redirectURI: o
            });
            return e.accessType && d.searchParams.set("access_type", e.accessType), e.prompt && d.searchParams.set("prompt", e.prompt), d;
        },
        validateAuthorizationCode: async ({ code: t, codeVerifier: r, redirectURI: n })=>U({
                code: t,
                codeVerifier: r,
                redirectURI: e.redirectURI || n,
                options: e,
                tokenEndpoint: "https://oauth2.googleapis.com/token"
            }),
        async verifyIdToken (t, r) {
            if (e.disableIdTokenSignIn) return !1;
            if (e.verifyIdToken) return e.verifyIdToken(t, r);
            let n = `https://www.googleapis.com/oauth2/v3/tokeninfo?id_token=${t}`, { data: o } = await v(n);
            return o ? o.aud === e.clientId && o.iss === "https://accounts.google.com" : !1;
        },
        async getUserInfo (t) {
            if (e.getUserInfo) return e.getUserInfo(t);
            if (!t.idToken) return null;
            let r = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$node$2f$esm$2f$util$2f$decode_jwt$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["decodeJwt"])(t.idToken), n = await e.mapProfileToUser?.(r);
            return {
                user: {
                    id: r.sub,
                    name: r.name,
                    email: r.email,
                    image: r.picture,
                    emailVerified: r.email_verified,
                    ...n
                },
                data: r
            };
        }
    });
;
var Ut = (e)=>{
    let t = e.tenantId || "common", r = `https://login.microsoftonline.com/${t}/oauth2/v2.0/authorize`, n = `https://login.microsoftonline.com/${t}/oauth2/v2.0/token`;
    return {
        id: "microsoft",
        name: "Microsoft EntraID",
        createAuthorizationURL (o) {
            let i = o.scopes || [
                "openid",
                "profile",
                "email",
                "User.Read"
            ];
            return e.scope && i.push(...e.scope), O({
                id: "microsoft",
                options: e,
                authorizationEndpoint: r,
                state: o.state,
                codeVerifier: o.codeVerifier,
                scopes: i,
                redirectURI: o.redirectURI
            });
        },
        validateAuthorizationCode ({ code: o, codeVerifier: i, redirectURI: d }) {
            return U({
                code: o,
                codeVerifier: i,
                redirectURI: e.redirectURI || d,
                options: e,
                tokenEndpoint: n
            });
        },
        async getUserInfo (o) {
            if (e.getUserInfo) return e.getUserInfo(o);
            if (!o.idToken) return null;
            let i = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$node$2f$esm$2f$util$2f$decode_jwt$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["decodeJwt"])(o.idToken), d = e.profilePhotoSize || 48;
            await v(`https://graph.microsoft.com/v1.0/me/photos/${d}x${d}/$value`, {
                headers: {
                    Authorization: `Bearer ${o.accessToken}`
                },
                async onResponse (s) {
                    if (!(e.disableProfilePhoto || !s.response.ok)) try {
                        let c = await s.response.clone().arrayBuffer(), p = Buffer.from(c).toString("base64");
                        i.picture = `data:image/jpeg;base64, ${p}`;
                    } catch (a) {
                        C.error(a && typeof a == "object" && "name" in a ? a.name : "", a);
                    }
                }
            });
            let l = await e.mapProfileToUser?.(i);
            return {
                user: {
                    id: i.sub,
                    name: i.name,
                    email: i.email,
                    image: i.picture,
                    emailVerified: !0,
                    ...l
                },
                data: i
            };
        }
    };
};
var Ot = (e)=>({
        id: "spotify",
        name: "Spotify",
        createAuthorizationURL ({ state: t, scopes: r, codeVerifier: n, redirectURI: o }) {
            let i = r || [
                "user-read-email"
            ];
            return e.scope && i.push(...e.scope), O({
                id: "spotify",
                options: e,
                authorizationEndpoint: "https://accounts.spotify.com/authorize",
                scopes: i,
                state: t,
                codeVerifier: n,
                redirectURI: o
            });
        },
        validateAuthorizationCode: async ({ code: t, codeVerifier: r, redirectURI: n })=>U({
                code: t,
                codeVerifier: r,
                redirectURI: e.redirectURI || n,
                options: e,
                tokenEndpoint: "https://accounts.spotify.com/api/token"
            }),
        async getUserInfo (t) {
            if (e.getUserInfo) return e.getUserInfo(t);
            let { data: r, error: n } = await v("https://api.spotify.com/v1/me", {
                method: "GET",
                headers: {
                    Authorization: `Bearer ${t.accessToken}`
                }
            });
            if (n) return null;
            let o = await e.mapProfileToUser?.(r);
            return {
                user: {
                    id: r.id,
                    name: r.display_name,
                    email: r.email,
                    image: r.images[0]?.url,
                    emailVerified: !1,
                    ...o
                },
                data: r
            };
        }
    });
function Yi(e) {
    return e.charAt(0).toUpperCase() + e.slice(1);
}
var se = {
    isAction: !1
};
;
var H = (e)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$random$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["createRandomStringGenerator"])("a-z", "A-Z", "0-9")(e || 32);
;
var xt = (e)=>({
        id: "twitch",
        name: "Twitch",
        createAuthorizationURL ({ state: t, scopes: r, redirectURI: n }) {
            let o = r || [
                "user:read:email",
                "openid"
            ];
            return e.scope && o.push(...e.scope), O({
                id: "twitch",
                redirectURI: n,
                options: e,
                authorizationEndpoint: "https://id.twitch.tv/oauth2/authorize",
                scopes: o,
                state: t,
                claims: e.claims || [
                    "email",
                    "email_verified",
                    "preferred_username",
                    "picture"
                ]
            });
        },
        validateAuthorizationCode: async ({ code: t, redirectURI: r })=>U({
                code: t,
                redirectURI: e.redirectURI || r,
                options: e,
                tokenEndpoint: "https://id.twitch.tv/oauth2/token"
            }),
        async getUserInfo (t) {
            if (e.getUserInfo) return e.getUserInfo(t);
            let r = t.idToken;
            if (!r) return C.error("No idToken found in token"), null;
            let n = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$node$2f$esm$2f$util$2f$decode_jwt$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["decodeJwt"])(r), o = await e.mapProfileToUser?.(n);
            return {
                user: {
                    id: n.sub,
                    name: n.preferred_username,
                    email: n.email,
                    image: n.picture,
                    emailVerified: !1,
                    ...o
                },
                data: n
            };
        }
    });
var St = (e)=>({
        id: "twitter",
        name: "Twitter",
        createAuthorizationURL (t) {
            let r = t.scopes || [
                "users.read",
                "tweet.read",
                "offline.access"
            ];
            return e.scope && r.push(...e.scope), O({
                id: "twitter",
                options: e,
                authorizationEndpoint: "https://x.com/i/oauth2/authorize",
                scopes: r,
                state: t.state,
                codeVerifier: t.codeVerifier,
                redirectURI: t.redirectURI
            });
        },
        validateAuthorizationCode: async ({ code: t, codeVerifier: r, redirectURI: n })=>U({
                code: t,
                codeVerifier: r,
                authentication: "basic",
                redirectURI: e.redirectURI || n,
                options: e,
                tokenEndpoint: "https://api.x.com/2/oauth2/token"
            }),
        async getUserInfo (t) {
            if (e.getUserInfo) return e.getUserInfo(t);
            let { data: r, error: n } = await v("https://api.x.com/2/users/me?user.fields=profile_image_url", {
                method: "GET",
                headers: {
                    Authorization: `Bearer ${t.accessToken}`
                }
            });
            if (n) return null;
            let o = await e.mapProfileToUser?.(r);
            return {
                user: {
                    id: r.data.id,
                    name: r.data.name,
                    email: r.data.username || null,
                    image: r.data.profile_image_url,
                    emailVerified: r.data.verified || !1,
                    ...o
                },
                data: r
            };
        }
    });
var _t = (e)=>{
    let t = "https://api.dropboxapi.com/oauth2/token";
    return {
        id: "dropbox",
        name: "Dropbox",
        createAuthorizationURL: async ({ state: r, scopes: n, codeVerifier: o, redirectURI: i })=>{
            let d = n || [
                "account_info.read"
            ];
            return e.scope && d.push(...e.scope), await O({
                id: "dropbox",
                options: e,
                authorizationEndpoint: "https://www.dropbox.com/oauth2/authorize",
                scopes: d,
                state: r,
                redirectURI: i,
                codeVerifier: o
            });
        },
        validateAuthorizationCode: async ({ code: r, codeVerifier: n, redirectURI: o })=>await U({
                code: r,
                codeVerifier: n,
                redirectURI: e.redirectURI || o,
                options: e,
                tokenEndpoint: t
            }),
        async getUserInfo (r) {
            if (e.getUserInfo) return e.getUserInfo(r);
            let { data: n, error: o } = await v("https://api.dropboxapi.com/2/users/get_current_account", {
                method: "POST",
                headers: {
                    Authorization: `Bearer ${r.accessToken}`
                }
            });
            if (o) return null;
            let i = await e.mapProfileToUser?.(n);
            return {
                user: {
                    id: n.account_id,
                    name: n.name?.display_name,
                    email: n.email,
                    emailVerified: n.email_verified || !1,
                    image: n.profile_photo_url,
                    ...i
                },
                data: n
            };
        }
    };
};
var It = (e)=>{
    let t = "https://www.linkedin.com/oauth/v2/authorization", r = "https://www.linkedin.com/oauth/v2/accessToken";
    return {
        id: "linkedin",
        name: "Linkedin",
        createAuthorizationURL: async ({ state: n, scopes: o, redirectURI: i })=>{
            let d = o || [
                "profile",
                "email",
                "openid"
            ];
            return e.scope && d.push(...e.scope), await O({
                id: "linkedin",
                options: e,
                authorizationEndpoint: t,
                scopes: d,
                state: n,
                redirectURI: i
            });
        },
        validateAuthorizationCode: async ({ code: n, redirectURI: o })=>await U({
                code: n,
                redirectURI: e.redirectURI || o,
                options: e,
                tokenEndpoint: r
            }),
        async getUserInfo (n) {
            let { data: o, error: i } = await v("https://api.linkedin.com/v2/userinfo", {
                method: "GET",
                headers: {
                    Authorization: `Bearer ${n.accessToken}`
                }
            });
            if (i) return null;
            let d = await e.mapProfileToUser?.(o);
            return {
                user: {
                    id: o.sub,
                    name: o.name,
                    email: o.email,
                    emailVerified: o.email_verified || !1,
                    image: o.picture,
                    ...d
                },
                data: o
            };
        }
    };
};
var Fe = (e = "")=>e.split("://").map((t)=>t.replace(/\/{2,}/g, "/")).join("://"), Rn = (e)=>{
    let t = e || "https://gitlab.com";
    return {
        authorizationEndpoint: Fe(`${t}/oauth/authorize`),
        tokenEndpoint: Fe(`${t}/oauth/token`),
        userinfoEndpoint: Fe(`${t}/api/v4/user`)
    };
}, Pt = (e)=>{
    let { authorizationEndpoint: t, tokenEndpoint: r, userinfoEndpoint: n } = Rn(e.issuer), o = "gitlab";
    return {
        id: o,
        name: "Gitlab",
        createAuthorizationURL: async ({ state: d, scopes: l, codeVerifier: s, redirectURI: a })=>{
            let c = l || [
                "read_user"
            ];
            return e.scope && c.push(...e.scope), await O({
                id: o,
                options: e,
                authorizationEndpoint: t,
                scopes: c,
                state: d,
                redirectURI: a,
                codeVerifier: s
            });
        },
        validateAuthorizationCode: async ({ code: d, redirectURI: l, codeVerifier: s })=>U({
                code: d,
                redirectURI: e.redirectURI || l,
                options: e,
                codeVerifier: s,
                tokenEndpoint: r
            }),
        async getUserInfo (d) {
            if (e.getUserInfo) return e.getUserInfo(d);
            let { data: l, error: s } = await v(n, {
                headers: {
                    authorization: `Bearer ${d.accessToken}`
                }
            });
            if (s || l.state !== "active" || l.locked) return null;
            let a = await e.mapProfileToUser?.(l);
            return {
                user: {
                    id: l.id.toString(),
                    name: l.name ?? l.username,
                    email: l.email,
                    image: l.avatar_url,
                    emailVerified: !0,
                    ...a
                },
                data: l
            };
        }
    };
};
var Lt = (e)=>({
        id: "reddit",
        name: "Reddit",
        createAuthorizationURL ({ state: t, scopes: r, redirectURI: n }) {
            let o = r || [
                "identity"
            ];
            return e.scope && o.push(...e.scope), O({
                id: "reddit",
                options: e,
                authorizationEndpoint: "https://www.reddit.com/api/v1/authorize",
                scopes: o,
                state: t,
                redirectURI: n,
                duration: e.duration
            });
        },
        validateAuthorizationCode: async ({ code: t, redirectURI: r })=>{
            let n = new URLSearchParams({
                grant_type: "authorization_code",
                code: t,
                redirect_uri: e.redirectURI || r
            }), o = {
                "content-type": "application/x-www-form-urlencoded",
                accept: "text/plain",
                "user-agent": "better-auth",
                Authorization: `Basic ${Buffer.from(`${e.clientId}:${e.clientSecret}`).toString("base64")}`
            }, { data: i, error: d } = await v("https://www.reddit.com/api/v1/access_token", {
                method: "POST",
                headers: o,
                body: n.toString()
            });
            if (d) throw d;
            return Ee(i);
        },
        async getUserInfo (t) {
            if (e.getUserInfo) return e.getUserInfo(t);
            let { data: r, error: n } = await v("https://oauth.reddit.com/api/v1/me", {
                headers: {
                    Authorization: `Bearer ${t.accessToken}`,
                    "User-Agent": "better-auth"
                }
            });
            if (n) return null;
            let o = await e.mapProfileToUser?.(r);
            return {
                user: {
                    id: r.id,
                    name: r.name,
                    email: r.oauth_client_id,
                    emailVerified: r.has_verified_email,
                    image: r.icon_img?.split("?")[0],
                    ...o
                },
                data: r
            };
        }
    });
;
var qe = {
    apple: Rt,
    discord: kt,
    facebook: Tt,
    github: Et,
    microsoft: Ut,
    google: vt,
    spotify: Ot,
    twitch: xt,
    twitter: St,
    dropbox: _t,
    linkedin: It,
    gitlab: Pt,
    reddit: Lt
}, Ve = Object.keys(qe), Dt = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].enum(Ve, {
    description: "OAuth2 provider to use"
});
;
;
;
;
function ae(e) {
    try {
        return JSON.parse(e);
    } catch  {
        return null;
    }
}
var w = {
    USER_NOT_FOUND: "User not found",
    FAILED_TO_CREATE_USER: "Failed to create user",
    FAILED_TO_CREATE_SESSION: "Failed to create session",
    FAILED_TO_UPDATE_USER: "Failed to update user",
    FAILED_TO_GET_SESSION: "Failed to get session",
    INVALID_PASSWORD: "Invalid password",
    INVALID_EMAIL: "Invalid email",
    INVALID_EMAIL_OR_PASSWORD: "Invalid email or password",
    SOCIAL_ACCOUNT_ALREADY_LINKED: "Social account already linked",
    PROVIDER_NOT_FOUND: "Provider not found",
    INVALID_TOKEN: "invalid token",
    ID_TOKEN_NOT_SUPPORTED: "id_token not supported",
    FAILED_TO_GET_USER_INFO: "Failed to get user info",
    USER_EMAIL_NOT_FOUND: "User email not found",
    EMAIL_NOT_VERIFIED: "Email not verified",
    PASSWORD_TOO_SHORT: "Password too short",
    PASSWORD_TOO_LONG: "Password too long",
    USER_ALREADY_EXISTS: "User already exists",
    EMAIL_CAN_NOT_BE_UPDATED: "Email can not be updated",
    CREDENTIAL_ACCOUNT_NOT_FOUND: "Credential account not found",
    SESSION_EXPIRED: "Session expired. Re-authenticate to perform this action."
};
;
;
;
var $e = ()=>E("/get-session", {
        method: "GET",
        query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].optional(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
            disableCookieCache: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].boolean({
                description: "Disable cookie cache and fetch session from database"
            }).or(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().transform((e)=>e === "true")).optional(),
            disableRefresh: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].boolean({
                description: "Disable session refresh. Useful for checking session status, without updating the session"
            }).optional()
        })),
        requireHeaders: !0,
        metadata: {
            openapi: {
                description: "Get the current session",
                responses: {
                    200: {
                        description: "Success",
                        content: {
                            "application/json": {
                                schema: {
                                    type: "object",
                                    properties: {
                                        session: {
                                            type: "object",
                                            properties: {
                                                token: {
                                                    type: "string"
                                                },
                                                userId: {
                                                    type: "string"
                                                },
                                                expiresAt: {
                                                    type: "string"
                                                }
                                            }
                                        },
                                        user: {
                                            type: "object",
                                            $ref: "#/components/schemas/User"
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }, async (e)=>{
        try {
            let t = await e.getSignedCookie(e.context.authCookies.sessionToken.name, e.context.secret);
            if (!t) return e.json(null);
            let r = e.getCookie(e.context.authCookies.sessionData.name), n = r ? ae(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$binary$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["binary"].decode(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$base64$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["base64"].decode(r))) : null;
            if (n && !await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hmac$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["createHMAC"])("SHA-256", "base64urlnopad").verify(e.context.secret, JSON.stringify(n.session), n.signature)) return M(e), e.json(null);
            let o = await e.getSignedCookie(e.context.authCookies.dontRememberToken.name, e.context.secret);
            if (n?.session && e.context.options.session?.cookieCache?.enabled && !e.query?.disableCookieCache) {
                let c = n.session;
                if (n.expiresAt < Date.now() || c.session.expiresAt < new Date) {
                    let m = e.context.authCookies.sessionData.name;
                    e.setCookie(m, "", {
                        maxAge: 0
                    });
                } else return e.json(c);
            }
            let i = await e.context.internalAdapter.findSession(t);
            if (e.context.session = i, !i || i.session.expiresAt < new Date) return M(e), i && await e.context.internalAdapter.deleteSession(i.session.token), e.json(null);
            if (o || e.query?.disableRefresh) return e.json(i);
            let d = e.context.sessionConfig.expiresIn, l = e.context.sessionConfig.updateAge;
            if (i.session.expiresAt.valueOf() - d * 1e3 + l * 1e3 <= Date.now()) {
                let c = await e.context.internalAdapter.updateSession(i.session.token, {
                    expiresAt: V(e.context.sessionConfig.expiresIn, "sec")
                });
                if (!c) return M(e), e.json(null, {
                    status: 401
                });
                let p = (c.expiresAt.valueOf() - Date.now()) / 1e3;
                return await D(e, {
                    session: c,
                    user: i.user
                }, !1, {
                    maxAge: p
                }), e.json({
                    session: c,
                    user: i.user
                });
            }
            return await Be(e, i), e.json(i);
        } catch (t) {
            throw e.context.logger.error("INTERNAL_SERVER_ERROR", t), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("INTERNAL_SERVER_ERROR", {
                message: w.FAILED_TO_GET_SESSION
            });
        }
    }), oe = async (e, t)=>{
    if (e.context.session) return e.context.session;
    let r = await $e()({
        ...e,
        _flag: "json",
        headers: e.headers,
        query: t
    }).catch((n)=>null);
    return e.context.session = r, r;
}, j = ce(async (e)=>{
    let t = await oe(e);
    if (!t?.session) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED");
    return {
        session: t
    };
}), ha = ce(async (e)=>{
    let t = await oe(e);
    if (!t?.session) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED");
    if (e.context.sessionConfig.freshAge === 0) return {
        session: t
    };
    let r = e.context.sessionConfig.freshAge, n = t.session.updatedAt?.valueOf() || t.session.createdAt.valueOf();
    if (!(Date.now() - n < r * 1e3)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
        message: "Session is not fresh"
    });
    return {
        session: t
    };
}), Ct = ()=>E("/list-sessions", {
        method: "GET",
        use: [
            j
        ],
        requireHeaders: !0,
        metadata: {
            openapi: {
                description: "List all active sessions for the user",
                responses: {
                    200: {
                        description: "Success",
                        content: {
                            "application/json": {
                                schema: {
                                    type: "array",
                                    items: {
                                        type: "object",
                                        properties: {
                                            token: {
                                                type: "string"
                                            },
                                            userId: {
                                                type: "string"
                                            },
                                            expiresAt: {
                                                type: "string"
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }, async (e)=>{
        let r = (await e.context.internalAdapter.listSessions(e.context.session.user.id)).filter((n)=>n.expiresAt > new Date);
        return e.json(r);
    }), Nt = E("/revoke-session", {
    method: "POST",
    body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        token: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "The token to revoke"
        })
    }),
    use: [
        j
    ],
    requireHeaders: !0,
    metadata: {
        openapi: {
            description: "Revoke a single session",
            requestBody: {
                content: {
                    "application/json": {
                        schema: {
                            type: "object",
                            properties: {
                                token: {
                                    type: "string"
                                }
                            },
                            required: [
                                "token"
                            ]
                        }
                    }
                }
            }
        }
    }
}, async (e)=>{
    let t = e.body.token, r = await e.context.internalAdapter.findSession(t);
    if (!r) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: "Session not found"
    });
    if (r.session.userId !== e.context.session.user.id) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED");
    try {
        await e.context.internalAdapter.deleteSession(t);
    } catch (n) {
        throw e.context.logger.error(n && typeof n == "object" && "name" in n ? n.name : "", n), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("INTERNAL_SERVER_ERROR");
    }
    return e.json({
        status: !0
    });
}), Bt = E("/revoke-sessions", {
    method: "POST",
    use: [
        j
    ],
    requireHeaders: !0,
    metadata: {
        openapi: {
            description: "Revoke all sessions for the user",
            responses: {
                200: {
                    description: "Success",
                    content: {
                        "application/json": {
                            schema: {
                                type: "object",
                                properties: {
                                    status: {
                                        type: "boolean"
                                    }
                                },
                                required: [
                                    "status"
                                ]
                            }
                        }
                    }
                }
            }
        }
    }
}, async (e)=>{
    try {
        await e.context.internalAdapter.deleteSessions(e.context.session.user.id);
    } catch (t) {
        throw e.context.logger.error(t && typeof t == "object" && "name" in t ? t.name : "", t), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("INTERNAL_SERVER_ERROR");
    }
    return e.json({
        status: !0
    });
}), jt = E("/revoke-other-sessions", {
    method: "POST",
    requireHeaders: !0,
    use: [
        j
    ],
    metadata: {
        openapi: {
            description: "Revoke all other sessions for the user except the current one",
            responses: {
                200: {
                    description: "Success",
                    content: {
                        "application/json": {
                            schema: {
                                type: "object",
                                properties: {
                                    status: {
                                        type: "boolean"
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}, async (e)=>{
    let t = e.context.session;
    if (!t.user) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED");
    let o = (await e.context.internalAdapter.listSessions(t.user.id)).filter((i)=>i.expiresAt > new Date).filter((i)=>i.token !== e.context.session.session.token);
    return await Promise.all(o.map((i)=>e.context.internalAdapter.deleteSession(i.token))), e.json({
        status: !0
    });
});
;
;
async function Ft(e, t, r = 3600) {
    return await new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$node$2f$esm$2f$jwt$2f$sign$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["SignJWT"](e).setProtectedHeader({
        alg: "HS256"
    }).setIssuedAt().setExpirationTime(Math.floor(Date.now() / 1e3) + r).sign(new TextEncoder().encode(t));
}
async function W(e, t, r) {
    return await Ft({
        email: t.toLowerCase(),
        updateTo: r
    }, e);
}
async function xn(e, t) {
    if (!e.context.options.emailVerification?.sendVerificationEmail) throw e.context.logger.error("Verification email isn't enabled."), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: "Verification email isn't enabled"
    });
    let r = await W(e.context.secret, t.email), n = `${e.context.baseURL}/verify-email?token=${r}&callbackURL=${e.body.callbackURL || e.query?.currentURL || "/"}`;
    await e.context.options.emailVerification.sendVerificationEmail({
        user: t,
        url: n,
        token: r
    }, e.request);
}
var qt = E("/send-verification-email", {
    method: "POST",
    query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        currentURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "The URL to use for email verification callback"
        }).optional()
    }).optional(),
    body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        email: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "The email to send the verification email to"
        }).email(),
        callbackURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "The URL to use for email verification callback"
        }).optional()
    }),
    metadata: {
        openapi: {
            description: "Send a verification email to the user",
            requestBody: {
                content: {
                    "application/json": {
                        schema: {
                            type: "object",
                            properties: {
                                email: {
                                    type: "string",
                                    description: "The email to send the verification email to"
                                },
                                callbackURL: {
                                    type: "string",
                                    description: "The URL to use for email verification callback"
                                }
                            },
                            required: [
                                "email"
                            ]
                        }
                    }
                }
            },
            responses: {
                200: {
                    description: "Success",
                    content: {
                        "application/json": {
                            schema: {
                                type: "object",
                                properties: {
                                    status: {
                                        type: "boolean"
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}, async (e)=>{
    if (!e.context.options.emailVerification?.sendVerificationEmail) throw e.context.logger.error("Verification email isn't enabled."), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: "Verification email isn't enabled"
    });
    let { email: t } = e.body, r = await e.context.internalAdapter.findUserByEmail(t);
    if (!r) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: w.USER_NOT_FOUND
    });
    return await xn(e, r.user), e.json({
        status: !0
    });
}), Vt = E("/verify-email", {
    method: "GET",
    query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        token: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "The token to verify the email"
        }),
        callbackURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "The URL to redirect to after email verification"
        }).optional()
    }),
    metadata: {
        openapi: {
            description: "Verify the email of the user",
            responses: {
                200: {
                    description: "Success",
                    content: {
                        "application/json": {
                            schema: {
                                type: "object",
                                properties: {
                                    user: {
                                        type: "object"
                                    },
                                    status: {
                                        type: "boolean"
                                    }
                                },
                                required: [
                                    "user",
                                    "status"
                                ]
                            }
                        }
                    }
                }
            }
        }
    }
}, async (e)=>{
    function t(l) {
        throw e.query.callbackURL ? e.query.callbackURL.includes("?") ? e.redirect(`${e.query.callbackURL}&error=${l}`) : e.redirect(`${e.query.callbackURL}?error=${l}`) : new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
            message: l
        });
    }
    let { token: r } = e.query, n;
    try {
        n = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$node$2f$esm$2f$jwt$2f$verify$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["jwtVerify"])(r, new TextEncoder().encode(e.context.secret), {
            algorithms: [
                "HS256"
            ]
        });
    } catch (l) {
        return e.context.logger.error("Failed to verify email", l), t("invalid_token");
    }
    let i = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        email: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().email(),
        updateTo: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional()
    }).parse(n.payload), d = await e.context.internalAdapter.findUserByEmail(i.email);
    if (!d) return t("user_not_found");
    if (i.updateTo) {
        let l = await oe(e);
        if (!l) {
            if (e.query.callbackURL) throw e.redirect(`${e.query.callbackURL}?error=unauthorized`);
            return t("unauthorized");
        }
        if (l.user.email !== i.email) {
            if (e.query.callbackURL) throw e.redirect(`${e.query.callbackURL}?error=unauthorized`);
            return t("unauthorized");
        }
        let s = await e.context.internalAdapter.updateUserByEmail(i.email, {
            email: i.updateTo,
            emailVerified: !1
        }), a = await W(e.context.secret, i.updateTo);
        if (await e.context.options.emailVerification?.sendVerificationEmail?.({
            user: s,
            url: `${e.context.baseURL}/verify-email?token=${a}`,
            token: a
        }, e.request), e.query.callbackURL) throw e.redirect(e.query.callbackURL);
        return e.json({
            status: !0
        });
    }
    if (await e.context.internalAdapter.updateUserByEmail(i.email, {
        emailVerified: !0
    }), e.context.options.emailVerification?.autoSignInAfterVerification) {
        let l = await oe(e);
        if (!l || l.user.email !== i.email) {
            let s = await e.context.internalAdapter.createSession(d.user.id, e.request);
            if (!s) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("INTERNAL_SERVER_ERROR", {
                message: "Failed to create session"
            });
            await D(e, {
                session: s,
                user: d.user
            });
        }
    }
    if (e.query.callbackURL) throw e.redirect(e.query.callbackURL);
    return e.json({
        status: !0
    });
});
async function Oe(e, { userInfo: t, account: r, callbackURL: n }) {
    let o = await e.context.internalAdapter.findOAuthUser(t.email.toLowerCase(), r.accountId, r.providerId).catch((s)=>{
        throw C.error(`Better auth was unable to query your database.
Error: `, s), e.redirect(`${e.context.baseURL}/error?error=internal_server_error`);
    }), i = o?.user, d = !i;
    if (o) {
        let s = o.accounts.find((a)=>a.providerId === r.providerId);
        if (s) {
            let a = Object.fromEntries(Object.entries({
                accessToken: r.accessToken,
                idToken: r.idToken,
                refreshToken: r.refreshToken,
                accessTokenExpiresAt: r.accessTokenExpiresAt,
                refreshTokenExpiresAt: r.refreshTokenExpiresAt
            }).filter(([c, p])=>p !== void 0));
            Object.keys(a).length > 0 && await e.context.internalAdapter.updateAccount(s.id, a);
        } else {
            if (!e.context.options.account?.accountLinking?.trustedProviders?.includes(r.providerId) && !t.emailVerified || e.context.options.account?.accountLinking?.enabled === !1) return Te && C.warn(`User already exist but account isn't linked to ${r.providerId}. To read more about how account linking works in Better Auth see https://www.better-auth.com/docs/concepts/users-accounts#account-linking.`), {
                error: "account not linked",
                data: null
            };
            try {
                await e.context.internalAdapter.linkAccount({
                    providerId: r.providerId,
                    accountId: t.id.toString(),
                    userId: o.user.id,
                    accessToken: r.accessToken,
                    idToken: r.idToken,
                    refreshToken: r.refreshToken,
                    accessTokenExpiresAt: r.accessTokenExpiresAt,
                    refreshTokenExpiresAt: r.refreshTokenExpiresAt,
                    scope: r.scope
                });
            } catch (p) {
                return C.error("Unable to link account", p), {
                    error: "unable to link account",
                    data: null
                };
            }
        }
    } else try {
        if (i = await e.context.internalAdapter.createOAuthUser({
            ...t,
            email: t.email.toLowerCase(),
            id: void 0
        }, {
            accessToken: r.accessToken,
            idToken: r.idToken,
            refreshToken: r.refreshToken,
            accessTokenExpiresAt: r.accessTokenExpiresAt,
            refreshTokenExpiresAt: r.refreshTokenExpiresAt,
            scope: r.scope,
            providerId: r.providerId,
            accountId: t.id.toString()
        }).then((s)=>s?.user), !t.emailVerified && i && e.context.options.emailVerification?.sendOnSignUp) {
            let s = await W(e.context.secret, i.email), a = `${e.context.baseURL}/verify-email?token=${s}&callbackURL=${n}`;
            await e.context.options.emailVerification?.sendVerificationEmail?.({
                user: i,
                url: a,
                token: s
            }, e.request);
        }
    } catch (s) {
        return s instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"] ? {
            error: s.message,
            data: null,
            isRegister: !1
        } : {
            error: "unable to create user",
            data: null,
            isRegister: !1
        };
    }
    if (!i) return {
        error: "unable to create user",
        data: null,
        isRegister: !1
    };
    let l = await e.context.internalAdapter.createSession(i.id, e.request);
    return l ? {
        data: {
            session: l,
            user: i
        },
        error: null,
        isRegister: d
    } : {
        error: "unable to create session",
        data: null,
        isRegister: !1
    };
}
var Mt = E("/sign-in/social", {
    method: "POST",
    query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        currentURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional()
    }).optional(),
    body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        callbackURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "Callback URL to redirect to after the user has signed in"
        }).optional(),
        newUserCallbackURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional(),
        errorCallbackURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "Callback URL to redirect to if an error happens"
        }).optional(),
        provider: Dt,
        disableRedirect: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].boolean({
            description: "Disable automatic redirection to the provider. Useful for handling the redirection yourself"
        }).optional(),
        idToken: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].optional(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
            token: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                description: "ID token from the provider"
            }),
            nonce: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                description: "Nonce used to generate the token"
            }).optional(),
            accessToken: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                description: "Access token from the provider"
            }).optional(),
            refreshToken: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                description: "Refresh token from the provider"
            }).optional(),
            expiresAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].number({
                description: "Expiry date of the token"
            }).optional()
        }), {
            description: "ID token from the provider to sign in the user with id token"
        })
    }),
    metadata: {
        openapi: {
            description: "Sign in with a social provider",
            responses: {
                200: {
                    description: "Success",
                    content: {
                        "application/json": {
                            schema: {
                                type: "object",
                                properties: {
                                    session: {
                                        type: "string"
                                    },
                                    user: {
                                        type: "object"
                                    },
                                    url: {
                                        type: "string"
                                    },
                                    redirect: {
                                        type: "boolean"
                                    }
                                },
                                required: [
                                    "session",
                                    "user",
                                    "url",
                                    "redirect"
                                ]
                            }
                        }
                    }
                }
            }
        }
    }
}, async (e)=>{
    let t = e.context.socialProviders.find((i)=>i.id === e.body.provider);
    if (!t) throw e.context.logger.error("Provider not found. Make sure to add the provider in your auth config", {
        provider: e.body.provider
    }), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("NOT_FOUND", {
        message: w.PROVIDER_NOT_FOUND
    });
    if (e.body.idToken) {
        if (!t.verifyIdToken) throw e.context.logger.error("Provider does not support id token verification", {
            provider: e.body.provider
        }), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("NOT_FOUND", {
            message: w.ID_TOKEN_NOT_SUPPORTED
        });
        let { token: i, nonce: d } = e.body.idToken;
        if (!await t.verifyIdToken(i, d)) throw e.context.logger.error("Invalid id token", {
            provider: e.body.provider
        }), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
            message: w.INVALID_TOKEN
        });
        let s = await t.getUserInfo({
            idToken: i,
            accessToken: e.body.idToken.accessToken,
            refreshToken: e.body.idToken.refreshToken
        });
        if (!s || !s?.user) throw e.context.logger.error("Failed to get user info", {
            provider: e.body.provider
        }), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
            message: w.FAILED_TO_GET_USER_INFO
        });
        if (!s.user.email) throw e.context.logger.error("User email not found", {
            provider: e.body.provider
        }), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
            message: w.USER_EMAIL_NOT_FOUND
        });
        let a = await Oe(e, {
            userInfo: {
                email: s.user.email,
                id: s.user.id,
                name: s.user.name || "",
                image: s.user.image,
                emailVerified: s.user.emailVerified || !1
            },
            account: {
                providerId: t.id,
                accountId: s.user.id,
                accessToken: e.body.idToken.accessToken
            }
        });
        if (a.error) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
            message: a.error
        });
        return await D(e, a.data), e.json({
            token: a.data.session.token,
            url: void 0,
            redirect: !1
        });
    }
    let { codeVerifier: r, state: n } = await ve(e), o = await t.createAuthorizationURL({
        state: n,
        codeVerifier: r,
        redirectURI: `${e.context.baseURL}/callback/${t.id}`
    });
    return e.json({
        url: o.toString(),
        redirect: !e.body.disableRedirect
    });
}), zt = E("/sign-in/email", {
    method: "POST",
    body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        email: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "Email of the user"
        }),
        password: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "Password of the user"
        }),
        callbackURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "Callback URL to use as a redirect for email verification"
        }).optional(),
        rememberMe: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].boolean({
            description: "If this is false, the session will not be remembered. Default is `true`."
        }).default(!0).optional()
    }),
    metadata: {
        openapi: {
            description: "Sign in with email and password",
            responses: {
                200: {
                    description: "Success",
                    content: {
                        "application/json": {
                            schema: {
                                type: "object",
                                properties: {
                                    user: {
                                        type: "object"
                                    },
                                    url: {
                                        type: "string"
                                    },
                                    redirect: {
                                        type: "boolean"
                                    }
                                },
                                required: [
                                    "session",
                                    "user",
                                    "url",
                                    "redirect"
                                ]
                            }
                        }
                    }
                }
            }
        }
    }
}, async (e)=>{
    if (!e.context.options?.emailAndPassword?.enabled) throw e.context.logger.error("Email and password is not enabled. Make sure to enable it in the options on you `auth.ts` file. Check `https://better-auth.com/docs/authentication/email-password` for more!"), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: "Email and password is not enabled"
    });
    let { email: t, password: r } = e.body;
    if (!__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().email().safeParse(t).success) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: w.INVALID_EMAIL
    });
    let o = await e.context.internalAdapter.findUserByEmail(t, {
        includeAccounts: !0
    });
    if (!o) throw await e.context.password.hash(r), e.context.logger.error("User not found", {
        email: t
    }), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
        message: w.INVALID_EMAIL_OR_PASSWORD
    });
    let i = o.accounts.find((a)=>a.providerId === "credential");
    if (!i) throw e.context.logger.error("Credential account not found", {
        email: t
    }), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
        message: w.INVALID_EMAIL_OR_PASSWORD
    });
    let d = i?.password;
    if (!d) throw e.context.logger.error("Password not found", {
        email: t
    }), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
        message: w.INVALID_EMAIL_OR_PASSWORD
    });
    if (!await e.context.password.verify({
        hash: d,
        password: r
    })) throw e.context.logger.error("Invalid password"), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
        message: w.INVALID_EMAIL_OR_PASSWORD
    });
    if (e.context.options?.emailAndPassword?.requireEmailVerification && !o.user.emailVerified) {
        if (!e.context.options?.emailVerification?.sendVerificationEmail) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
            message: w.EMAIL_NOT_VERIFIED
        });
        let a = await W(e.context.secret, o.user.email), c = `${e.context.baseURL}/verify-email?token=${a}&callbackURL=${e.body.callbackURL || "/"}`;
        throw await e.context.options.emailVerification.sendVerificationEmail({
            user: o.user,
            url: c,
            token: a
        }, e.request), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
            message: w.EMAIL_NOT_VERIFIED
        });
    }
    let s = await e.context.internalAdapter.createSession(o.user.id, e.headers, e.body.rememberMe === !1);
    if (!s) throw e.context.logger.error("Failed to create session"), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
        message: w.FAILED_TO_CREATE_SESSION
    });
    return await D(e, {
        session: s,
        user: o.user
    }, e.body.rememberMe === !1), e.json({
        user: {
            id: o.user.id,
            email: o.user.email,
            name: o.user.name,
            image: o.user.image,
            emailVerified: o.user.emailVerified,
            createdAt: o.user.createdAt,
            updatedAt: o.user.updatedAt
        },
        redirect: !!e.body.callbackURL,
        url: e.body.callbackURL
    });
});
;
var xe = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
    code: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional(),
    error: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional(),
    error_description: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional(),
    state: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional()
}), Ht = E("/callback/:id", {
    method: [
        "GET",
        "POST"
    ],
    body: xe.optional(),
    query: xe.optional(),
    metadata: se
}, async (e)=>{
    let t;
    try {
        if (e.method === "GET") t = xe.parse(e.query);
        else if (e.method === "POST") t = xe.parse(e.body);
        else throw new Error("Unsupported method");
    } catch (h) {
        throw e.context.logger.error("INVALID_CALLBACK_REQUEST", h), e.redirect(`${e.context.baseURL}/error?error=invalid_callback_request`);
    }
    let { code: r, error: n, state: o, error_description: i } = t;
    if (!o) throw e.context.logger.error("State not found", n), e.redirect(`${e.context.baseURL}/error?error=state_not_found`);
    if (!r) throw e.context.logger.error("Code not found"), e.redirect(`${e.context.baseURL}/error?error=${n || "no_code"}&error_description=${i}`);
    let d = e.context.socialProviders.find((h)=>h.id === e.params.id);
    if (!d) throw e.context.logger.error("Oauth provider with id", e.params.id, "not found"), e.redirect(`${e.context.baseURL}/error?error=oauth_provider_not_found`);
    let { codeVerifier: l, callbackURL: s, link: a, errorURL: c, newUserURL: p } = await At(e), m;
    try {
        m = await d.validateAuthorizationCode({
            code: r,
            codeVerifier: l,
            redirectURI: `${e.context.baseURL}/callback/${d.id}`
        });
    } catch (h) {
        throw e.context.logger.error("", h), e.redirect(`${e.context.baseURL}/error?error=please_restart_the_process`);
    }
    let u = await d.getUserInfo(m).then((h)=>h?.user);
    function f(h) {
        let y = c || s || `${e.context.baseURL}/error`;
        throw y.includes("?") ? y = `${y}&error=${h}` : y = `${y}?error=${h}`, e.redirect(y);
    }
    if (!u) return e.context.logger.error("Unable to get user info"), f("unable_to_get_user_info");
    if (!u.email) return e.context.logger.error("Provider did not return email. This could be due to misconfiguration in the provider settings."), f("email_not_found");
    if (!s) throw e.context.logger.error("No callback URL found"), e.redirect(`${e.context.baseURL}/error?error=please_restart_the_process`);
    if (a) {
        if (a.email !== u.email.toLowerCase()) return f("email_doesn't_match");
        if (!await e.context.internalAdapter.createAccount({
            userId: a.userId,
            providerId: d.id,
            accountId: u.id
        })) return f("unable_to_link_account");
        let y;
        try {
            y = s.toString();
        } catch  {
            y = s;
        }
        throw e.redirect(y);
    }
    let g = await Oe(e, {
        userInfo: {
            ...u,
            email: u.email,
            name: u.name || u.email
        },
        account: {
            providerId: d.id,
            accountId: u.id,
            ...m,
            scope: m.scopes?.join(",")
        },
        callbackURL: s
    });
    if (g.error) return e.context.logger.error(g.error.split(" ").join("_")), f(g.error.split(" ").join("_"));
    let { session: b, user: A } = g.data;
    await D(e, {
        session: b,
        user: A
    });
    let R;
    try {
        R = (g.isRegister && p || s).toString();
    } catch  {
        R = g.isRegister && p || s;
    }
    throw e.redirect(R);
});
;
;
var Wt = E("/sign-out", {
    method: "POST",
    requireHeaders: !0,
    metadata: {
        openapi: {
            description: "Sign out the current user",
            responses: {
                200: {
                    description: "Success",
                    content: {
                        "application/json": {
                            schema: {
                                type: "object",
                                properties: {
                                    success: {
                                        type: "boolean"
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}, async (e)=>{
    let t = await e.getSignedCookie(e.context.authCookies.sessionToken.name, e.context.secret);
    if (!t) throw M(e), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: w.FAILED_TO_GET_SESSION
    });
    return await e.context.internalAdapter.deleteSession(t), M(e), e.json({
        success: !0
    });
});
;
;
function Gt(e, t, r) {
    let n = t ? new URL(t, e.baseURL) : new URL(`${e.baseURL}/error`);
    return r && Object.entries(r).forEach(([o, i])=>n.searchParams.set(o, i)), n.href;
}
function _n(e, t, r) {
    let n = new URL(t, e.baseURL);
    return r && Object.entries(r).forEach(([o, i])=>n.searchParams.set(o, i)), n.href;
}
var Kt = E("/forget-password", {
    method: "POST",
    body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        email: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "The email address of the user to send a password reset email to"
        }).email(),
        redirectTo: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "The URL to redirect the user to reset their password. If the token isn't valid or expired, it'll be redirected with a query parameter `?error=INVALID_TOKEN`. If the token is valid, it'll be redirected with a query parameter `?token=VALID_TOKEN"
        }).optional()
    }),
    metadata: {
        openapi: {
            description: "Send a password reset email to the user",
            responses: {
                200: {
                    description: "Success",
                    content: {
                        "application/json": {
                            schema: {
                                type: "object",
                                properties: {
                                    status: {
                                        type: "boolean"
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}, async (e)=>{
    if (!e.context.options.emailAndPassword?.sendResetPassword) throw e.context.logger.error("Reset password isn't enabled.Please pass an emailAndPassword.sendResetPasswordToken function in your auth config!"), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: "Reset password isn't enabled"
    });
    let { email: t, redirectTo: r } = e.body, n = await e.context.internalAdapter.findUserByEmail(t, {
        includeAccounts: !0
    });
    if (!n) return e.context.logger.error("Reset Password: User not found", {
        email: t
    }), e.json({
        status: !1
    }, {
        body: {
            status: !0
        }
    });
    let o = 60 * 60 * 1, i = V(e.context.options.emailAndPassword.resetPasswordTokenExpiresIn || o, "sec"), d = H(24);
    await e.context.internalAdapter.createVerificationValue({
        value: n.user.id.toString(),
        identifier: `reset-password:${d}`,
        expiresAt: i
    });
    let l = `${e.context.baseURL}/reset-password/${d}?callbackURL=${r}`;
    return await e.context.options.emailAndPassword.sendResetPassword({
        user: n.user,
        url: l,
        token: d
    }, e.request), e.json({
        status: !0
    });
}), Qt = E("/reset-password/:token", {
    method: "GET",
    query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        callbackURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "The URL to redirect the user to reset their password"
        })
    }),
    metadata: {
        openapi: {
            description: "Redirects the user to the callback URL with the token",
            responses: {
                200: {
                    description: "Success",
                    content: {
                        "application/json": {
                            schema: {
                                type: "object",
                                properties: {
                                    token: {
                                        type: "string"
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}, async (e)=>{
    let { token: t } = e.params, { callbackURL: r } = e.query;
    if (!t || !r) throw e.redirect(Gt(e.context, r, {
        error: "INVALID_TOKEN"
    }));
    let n = await e.context.internalAdapter.findVerificationValue(`reset-password:${t}`);
    throw !n || n.expiresAt < new Date ? e.redirect(Gt(e.context, r, {
        error: "INVALID_TOKEN"
    })) : e.redirect(_n(e.context, r, {
        token: t
    }));
}), Jt = E("/reset-password", {
    query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].optional(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        token: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional(),
        currentURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional()
    })),
    method: "POST",
    body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        newPassword: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "The new password to set"
        }),
        token: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "The token to reset the password"
        }).optional()
    }),
    metadata: {
        openapi: {
            description: "Reset the password for a user",
            responses: {
                200: {
                    description: "Success",
                    content: {
                        "application/json": {
                            schema: {
                                type: "object",
                                properties: {
                                    status: {
                                        type: "boolean"
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}, async (e)=>{
    let t = e.body.token || e.query?.token || (e.query?.currentURL ? new URL(e.query.currentURL).searchParams.get("token") : "");
    if (!t) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: w.INVALID_TOKEN
    });
    let { newPassword: r } = e.body, n = e.context.password?.config.minPasswordLength, o = e.context.password?.config.maxPasswordLength;
    if (r.length < n) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: w.PASSWORD_TOO_SHORT
    });
    if (r.length > o) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: w.PASSWORD_TOO_LONG
    });
    let i = `reset-password:${t}`, d = await e.context.internalAdapter.findVerificationValue(i);
    if (!d || d.expiresAt < new Date) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: w.INVALID_TOKEN
    });
    await e.context.internalAdapter.deleteVerificationValue(d.id);
    let l = d.value, s = await e.context.password.hash(r);
    return (await e.context.internalAdapter.findAccounts(l)).find((p)=>p.providerId === "credential") ? (await e.context.internalAdapter.updatePassword(l, s), e.json({
        status: !0
    })) : (await e.context.internalAdapter.createAccount({
        userId: l,
        providerId: "credential",
        password: s,
        accountId: l
    }), e.json({
        status: !0
    }));
});
;
;
;
;
var pd = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
    id: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    providerId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    accountId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    userId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    accessToken: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().nullish(),
    refreshToken: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().nullish(),
    idToken: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().nullish(),
    accessTokenExpiresAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].date().nullish(),
    refreshTokenExpiresAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].date().nullish(),
    scope: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().nullish(),
    password: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().nullish(),
    createdAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].date().default(()=>new Date),
    updatedAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].date().default(()=>new Date)
}), fd = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
    id: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    email: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().transform((e)=>e.toLowerCase()),
    emailVerified: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].boolean().default(!1),
    name: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    image: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().nullish(),
    createdAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].date().default(()=>new Date),
    updatedAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].date().default(()=>new Date)
}), md = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
    id: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    userId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    expiresAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].date(),
    createdAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].date().default(()=>new Date),
    updatedAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].date().default(()=>new Date),
    token: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    ipAddress: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().nullish(),
    userAgent: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().nullish()
}), gd = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
    id: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    value: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    createdAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].date().default(()=>new Date),
    updatedAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].date().default(()=>new Date),
    expiresAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].date(),
    identifier: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string()
});
function Zt(e, t) {
    let r = t.fields, n = {};
    for(let o in e){
        let i = r[o];
        if (!i) {
            n[o] = e[o];
            continue;
        }
        i.returned !== !1 && (n[o] = e[o]);
    }
    return n;
}
function Me(e, t) {
    let r = {
        ...t === "user" ? e.user?.additionalFields : {},
        ...t === "session" ? e.session?.additionalFields : {}
    };
    for (let n of e.plugins || [])n.schema && n.schema[t] && (r = {
        ...r,
        ...n.schema[t].fields
    });
    return r;
}
function ze(e, t) {
    let r = Me(e, "user");
    return Zt(t, {
        fields: r
    });
}
function Se(e, t) {
    let r = Me(e, "session");
    return Zt(t, {
        fields: r
    });
}
function Pn(e, t) {
    let r = t.action || "create", n = t.fields, o = {};
    for(let i in n){
        if (i in e) {
            if (n[i].input === !1) {
                if (n[i].defaultValue) {
                    o[i] = n[i].defaultValue;
                    continue;
                }
                continue;
            }
            if (n[i].validator?.input && e[i] !== void 0) {
                o[i] = n[i].validator.input.parse(e[i]);
                continue;
            }
            if (n[i].transform?.input && e[i] !== void 0) {
                o[i] = n[i].transform?.input(e[i]);
                continue;
            }
            o[i] = e[i];
            continue;
        }
        if (n[i].defaultValue && r === "create") {
            o[i] = n[i].defaultValue;
            continue;
        }
        if (n[i].required && r === "create") throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: `${i} is required`
        });
    }
    return o;
}
function _e(e, t, r) {
    let n = Me(e, "user");
    return Pn(t || {}, {
        fields: n,
        action: r
    });
}
var Yt = ()=>E("/update-user", {
        method: "POST",
        body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].record(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(), __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].any()),
        use: [
            j
        ],
        metadata: {
            openapi: {
                description: "Update the current user",
                requestBody: {
                    content: {
                        "application/json": {
                            schema: {
                                type: "object",
                                properties: {
                                    name: {
                                        type: "string",
                                        description: "The name of the user"
                                    },
                                    image: {
                                        type: "string",
                                        description: "The image of the user"
                                    }
                                }
                            }
                        }
                    }
                },
                responses: {
                    200: {
                        description: "Success",
                        content: {
                            "application/json": {
                                schema: {
                                    type: "object",
                                    properties: {
                                        user: {
                                            type: "object"
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }, async (e)=>{
        let t = e.body;
        if (t.email) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: w.EMAIL_CAN_NOT_BE_UPDATED
        });
        let { name: r, image: n, ...o } = t, i = e.context.session;
        if (n === void 0 && r === void 0 && Object.keys(o).length === 0) return e.json({
            status: !0
        });
        let d = _e(e.context.options, o, "update"), l = await e.context.internalAdapter.updateUserByEmail(i.user.email, {
            name: r,
            image: n,
            ...d
        });
        return await D(e, {
            session: i.session,
            user: l
        }), e.json({
            status: !0
        });
    }), Xt = E("/change-password", {
    method: "POST",
    body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        newPassword: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "The new password to set"
        }),
        currentPassword: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "The current password"
        }),
        revokeOtherSessions: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].boolean({
            description: "Revoke all other sessions"
        }).optional()
    }),
    use: [
        j
    ],
    metadata: {
        openapi: {
            description: "Change the password of the user",
            responses: {
                200: {
                    description: "Success",
                    content: {
                        "application/json": {
                            schema: {
                                type: "object",
                                properties: {
                                    user: {
                                        description: "The user object",
                                        $ref: "#/components/schemas/User"
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}, async (e)=>{
    let { newPassword: t, currentPassword: r, revokeOtherSessions: n } = e.body, o = e.context.session, i = e.context.password.config.minPasswordLength;
    if (t.length < i) throw e.context.logger.error("Password is too short"), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: w.PASSWORD_TOO_SHORT
    });
    let d = e.context.password.config.maxPasswordLength;
    if (t.length > d) throw e.context.logger.error("Password is too long"), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: w.PASSWORD_TOO_LONG
    });
    let s = (await e.context.internalAdapter.findAccounts(o.user.id)).find((m)=>m.providerId === "credential" && m.password);
    if (!s || !s.password) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: w.CREDENTIAL_ACCOUNT_NOT_FOUND
    });
    let a = await e.context.password.hash(t);
    if (!await e.context.password.verify({
        hash: s.password,
        password: r
    })) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: w.INVALID_PASSWORD
    });
    await e.context.internalAdapter.updateAccount(s.id, {
        password: a
    });
    let p = null;
    if (n) {
        await e.context.internalAdapter.deleteSessions(o.user.id);
        let m = await e.context.internalAdapter.createSession(o.user.id, e.headers);
        if (!m) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("INTERNAL_SERVER_ERROR", {
            message: w.FAILED_TO_GET_SESSION
        });
        await D(e, {
            session: m,
            user: o.user
        }), p = m.token;
    }
    return e.json({
        token: p
    });
}), er = E("/set-password", {
    method: "POST",
    body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        newPassword: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string()
    }),
    metadata: {
        SERVER_ONLY: !0
    },
    use: [
        j
    ]
}, async (e)=>{
    let { newPassword: t } = e.body, r = e.context.session, n = e.context.password.config.minPasswordLength;
    if (t.length < n) throw e.context.logger.error("Password is too short"), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: w.PASSWORD_TOO_SHORT
    });
    let o = e.context.password.config.maxPasswordLength;
    if (t.length > o) throw e.context.logger.error("Password is too long"), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: w.PASSWORD_TOO_LONG
    });
    let d = (await e.context.internalAdapter.findAccounts(r.user.id)).find((s)=>s.providerId === "credential" && s.password), l = await e.context.password.hash(t);
    if (!d) return await e.context.internalAdapter.linkAccount({
        userId: r.user.id,
        providerId: "credential",
        accountId: r.user.id,
        password: l
    }), e.json({
        status: !0
    });
    throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: "user already has a password"
    });
}), tr = E("/delete-user", {
    method: "POST",
    use: [
        j
    ],
    body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        callbackURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional(),
        password: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional(),
        token: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional()
    }),
    metadata: {
        openapi: {
            description: "Delete the user",
            responses: {
                200: {
                    description: "Success",
                    content: {
                        "application/json": {
                            schema: {
                                type: "object"
                            }
                        }
                    }
                }
            }
        }
    }
}, async (e)=>{
    if (!e.context.options.user?.deleteUser?.enabled) throw e.context.logger.error("Delete user is disabled. Enable it in the options", {
        session: e.context.session
    }), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("NOT_FOUND");
    let t = e.context.session;
    if (e.body.password) {
        let i = (await e.context.internalAdapter.findAccounts(t.user.id)).find((l)=>l.providerId === "credential" && l.password);
        if (!i || !i.password) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: w.CREDENTIAL_ACCOUNT_NOT_FOUND
        });
        if (!await e.context.password.verify({
            hash: i.password,
            password: e.body.password
        })) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: w.INVALID_PASSWORD
        });
    } else if (e.context.options.session?.freshAge) {
        let o = t.session.createdAt.getTime(), i = e.context.options.session.freshAge;
        if (Date.now() - o > i) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: w.SESSION_EXPIRED
        });
    }
    if (e.body.token) return await He({
        ...e,
        query: {
            token: e.body.token
        }
    }), e.json({
        success: !0,
        message: "User deleted"
    });
    if (e.context.options.user.deleteUser?.sendDeleteAccountVerification) {
        let o = me(32, "0-9", "a-z");
        await e.context.internalAdapter.createVerificationValue({
            value: t.user.id,
            identifier: `delete-account-${o}`,
            expiresAt: new Date(Date.now() + 1e3 * 60 * 60 * 24)
        });
        let i = `${e.context.baseURL}/delete-user/callback?token=${o}&callbackURL=${e.body.callbackURL || "/"}`;
        return await e.context.options.user.deleteUser.sendDeleteAccountVerification({
            user: t.user,
            url: i,
            token: o
        }, e.request), e.json({
            success: !0,
            message: "Verification email sent"
        });
    }
    let r = e.context.options.user.deleteUser?.beforeDelete;
    r && await r(t.user, e.request), await e.context.internalAdapter.deleteUser(t.user.id), await e.context.internalAdapter.deleteSessions(t.user.id), await e.context.internalAdapter.deleteAccounts(t.user.id), M(e);
    let n = e.context.options.user.deleteUser?.afterDelete;
    return n && await n(t.user, e.request), e.json({
        success: !0,
        message: "User deleted"
    });
}), He = E("/delete-user/callback", {
    method: "GET",
    query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        token: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
        callbackURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional()
    })
}, async (e)=>{
    if (!e.context.options.user?.deleteUser?.enabled) throw e.context.logger.error("Delete user is disabled. Enable it in the options"), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("NOT_FOUND");
    let t = await oe(e);
    if (!t) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("NOT_FOUND", {
        message: w.FAILED_TO_GET_USER_INFO
    });
    let r = await e.context.internalAdapter.findVerificationValue(`delete-account-${e.query.token}`);
    if (!r || r.expiresAt < new Date) throw r && await e.context.internalAdapter.deleteVerificationValue(r.id), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("NOT_FOUND", {
        message: w.INVALID_TOKEN
    });
    if (r.value !== t.user.id) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("NOT_FOUND", {
        message: w.INVALID_TOKEN
    });
    let n = e.context.options.user.deleteUser?.beforeDelete;
    n && await n(t.user, e.request), await e.context.internalAdapter.deleteUser(t.user.id), await e.context.internalAdapter.deleteSessions(t.user.id), await e.context.internalAdapter.deleteAccounts(t.user.id), await e.context.internalAdapter.deleteVerificationValue(r.id), M(e);
    let o = e.context.options.user.deleteUser?.afterDelete;
    if (o && await o(t.user, e.request), e.query.callbackURL) throw e.redirect(e.query.callbackURL || "/");
    return e.json({
        success: !0,
        message: "User deleted"
    });
}), rr = E("/change-email", {
    method: "POST",
    query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        currentURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional()
    }).optional(),
    body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        newEmail: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "The new email to set"
        }).email(),
        callbackURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "The URL to redirect to after email verification"
        }).optional()
    }),
    use: [
        j
    ],
    metadata: {
        openapi: {
            responses: {
                200: {
                    description: "Success",
                    content: {
                        "application/json": {
                            schema: {
                                type: "object",
                                properties: {
                                    user: {
                                        type: "object"
                                    },
                                    status: {
                                        type: "boolean"
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}, async (e)=>{
    if (!e.context.options.user?.changeEmail?.enabled) throw e.context.logger.error("Change email is disabled."), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: "Change email is disabled"
    });
    if (e.body.newEmail === e.context.session.user.email) throw e.context.logger.error("Email is the same"), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: "Email is the same"
    });
    if (await e.context.internalAdapter.findUserByEmail(e.body.newEmail)) throw e.context.logger.error("Email already exists"), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: "Couldn't update your email"
    });
    if (e.context.session.user.emailVerified !== !0) {
        let o = await e.context.internalAdapter.updateUserByEmail(e.context.session.user.email, {
            email: e.body.newEmail
        });
        return e.json({
            status: !0
        });
    }
    if (!e.context.options.user.changeEmail.sendChangeEmailVerification) throw e.context.logger.error("Verification email isn't enabled."), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: "Verification email isn't enabled"
    });
    let r = await W(e.context.secret, e.context.session.user.email, e.body.newEmail), n = `${e.context.baseURL}/verify-email?token=${r}&callbackURL=${e.body.callbackURL || e.query?.currentURL || "/"}`;
    return await e.context.options.user.changeEmail.sendChangeEmailVerification({
        user: e.context.session.user,
        newEmail: e.body.newEmail,
        url: n,
        token: r
    }, e.request), e.json({
        status: !0
    });
});
var Ln = (e = "Unknown")=>`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authentication Error</title>
    <style>
        :root {
            --bg-color: #f8f9fa;
            --text-color: #212529;
            --accent-color: #000000;
            --error-color: #dc3545;
            --border-color: #e9ecef;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            line-height: 1.5;
        }
        .error-container {
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            padding: 2.5rem;
            text-align: center;
            max-width: 90%;
            width: 400px;
        }
        h1 {
            color: var(--error-color);
            font-size: 1.75rem;
            margin-bottom: 1rem;
            font-weight: 600;
        }
        p {
            margin-bottom: 1.5rem;
            color: #495057;
        }
        .btn {
            background-color: var(--accent-color);
            color: #ffffff;
            text-decoration: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            transition: all 0.3s ease;
            display: inline-block;
            font-weight: 500;
            border: 2px solid var(--accent-color);
        }
        .btn:hover {
            background-color: #131721;
        }
        .error-code {
            font-size: 0.875rem;
            color: #6c757d;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border-color);
        }
        .icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <div class="error-container">
        <div class="icon">\u26A0\uFE0F</div>
        <h1>Better Auth Error</h1>
        <p>We encountered an issue while processing your request. Please try again or contact the application owner if the problem persists.</p>
        <a href="/" id="returnLink" class="btn">Return to Application</a>
        <div class="error-code">Error Code: <span id="errorCode">${e}</span></div>
    </div>
</body>
</html>`, nr = E("/error", {
    method: "GET",
    metadata: {
        ...se,
        openapi: {
            description: "Displays an error page",
            responses: {
                200: {
                    description: "Success",
                    content: {
                        "text/html": {
                            schema: {
                                type: "string"
                            }
                        }
                    }
                }
            }
        }
    }
}, async (e)=>{
    let t = new URL(e.request?.url || "").searchParams.get("error") || "Unknown";
    return new Response(Ln(t), {
        headers: {
            "Content-Type": "text/html"
        }
    });
});
var or = E("/ok", {
    method: "GET",
    metadata: {
        ...se,
        openapi: {
            description: "Check if the API is working",
            responses: {
                200: {
                    description: "Success",
                    content: {
                        "application/json": {
                            schema: {
                                type: "object",
                                properties: {
                                    ok: {
                                        type: "boolean"
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}, async (e)=>e.json({
        ok: !0
    }));
;
;
var ir = ()=>E("/sign-up/email", {
        method: "POST",
        query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
            currentURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional()
        }).optional(),
        body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].record(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(), __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].any()),
        metadata: {
            openapi: {
                description: "Sign up a user using email and password",
                requestBody: {
                    content: {
                        "application/json": {
                            schema: {
                                type: "object",
                                properties: {
                                    name: {
                                        type: "string",
                                        description: "The name of the user"
                                    },
                                    email: {
                                        type: "string",
                                        description: "The email of the user"
                                    },
                                    password: {
                                        type: "string",
                                        description: "The password of the user"
                                    },
                                    callbackURL: {
                                        type: "string",
                                        description: "The URL to use for email verification callback"
                                    }
                                },
                                required: [
                                    "name",
                                    "email",
                                    "password"
                                ]
                            }
                        }
                    }
                },
                responses: {
                    200: {
                        description: "Success",
                        content: {
                            "application/json": {
                                schema: {
                                    type: "object",
                                    properties: {
                                        id: {
                                            type: "string",
                                            description: "The id of the user"
                                        },
                                        email: {
                                            type: "string",
                                            description: "The email of the user"
                                        },
                                        name: {
                                            type: "string",
                                            description: "The name of the user"
                                        },
                                        image: {
                                            type: "string",
                                            description: "The image of the user"
                                        },
                                        emailVerified: {
                                            type: "boolean",
                                            description: "If the email is verified"
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }, async (e)=>{
        if (!e.context.options.emailAndPassword?.enabled) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: "Email and password sign up is not enabled"
        });
        let t = e.body, { name: r, email: n, password: o, image: i, callbackURL: d, ...l } = t;
        if (!__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().email().safeParse(n).success) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: w.INVALID_EMAIL
        });
        let a = e.context.password.config.minPasswordLength;
        if (o.length < a) throw e.context.logger.error("Password is too short"), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: w.PASSWORD_TOO_SHORT
        });
        let c = e.context.password.config.maxPasswordLength;
        if (o.length > c) throw e.context.logger.error("Password is too long"), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: w.PASSWORD_TOO_LONG
        });
        if ((await e.context.internalAdapter.findUserByEmail(n))?.user) throw e.context.logger.info(`Sign-up attempt for existing email: ${n}`), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNPROCESSABLE_ENTITY", {
            message: w.USER_ALREADY_EXISTS
        });
        let m = _e(e.context.options, l), u;
        try {
            if (u = await e.context.internalAdapter.createUser({
                email: n.toLowerCase(),
                name: r,
                image: i,
                ...m,
                emailVerified: !1
            }), !u) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                message: w.FAILED_TO_CREATE_USER
            });
        } catch (b) {
            throw Te && e.context.logger.error("Failed to create user", b), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNPROCESSABLE_ENTITY", {
                message: w.FAILED_TO_CREATE_USER,
                details: b
            });
        }
        if (!u) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNPROCESSABLE_ENTITY", {
            message: w.FAILED_TO_CREATE_USER
        });
        let f = await e.context.password.hash(o);
        if (await e.context.internalAdapter.linkAccount({
            userId: u.id,
            providerId: "credential",
            accountId: u.id,
            password: f
        }), e.context.options.emailVerification?.sendOnSignUp || e.context.options.emailAndPassword.requireEmailVerification) {
            let b = await W(e.context.secret, u.email), A = `${e.context.baseURL}/verify-email?token=${b}&callbackURL=${t.callbackURL || e.query?.currentURL || "/"}`;
            await e.context.options.emailVerification?.sendVerificationEmail?.({
                user: u,
                url: A,
                token: b
            }, e.request);
        }
        if (!e.context.options.emailAndPassword.autoSignIn || e.context.options.emailAndPassword.requireEmailVerification) return e.json({
            token: null
        });
        let g = await e.context.internalAdapter.createSession(u.id, e.request);
        if (!g) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: w.FAILED_TO_CREATE_SESSION
        });
        return await D(e, {
            session: g,
            user: u
        }), e.json({
            token: g.token
        });
    });
;
;
var ar = E("/list-accounts", {
    method: "GET",
    use: [
        j
    ],
    metadata: {
        openapi: {
            description: "List all accounts linked to the user",
            responses: {
                200: {
                    description: "Success",
                    content: {
                        "application/json": {
                            schema: {
                                type: "array",
                                items: {
                                    type: "object",
                                    properties: {
                                        id: {
                                            type: "string"
                                        },
                                        provider: {
                                            type: "string"
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}, async (e)=>{
    let t = e.context.session, r = await e.context.internalAdapter.findAccounts(t.user.id);
    return e.json(r.map((n)=>({
            id: n.id,
            provider: n.providerId
        })));
}), dr = E("/link-social", {
    method: "POST",
    requireHeaders: !0,
    query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        currentURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional()
    }).optional(),
    body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        callbackURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "The URL to redirect to after the user has signed in"
        }).optional(),
        provider: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].enum(Ve, {
            description: "The OAuth2 provider to use"
        })
    }),
    use: [
        j
    ],
    metadata: {
        openapi: {
            description: "Link a social account to the user",
            responses: {
                200: {
                    description: "Success",
                    content: {
                        "application/json": {
                            schema: {
                                type: "object",
                                properties: {
                                    url: {
                                        type: "string"
                                    },
                                    redirect: {
                                        type: "boolean"
                                    }
                                },
                                required: [
                                    "url",
                                    "redirect"
                                ]
                            }
                        }
                    }
                }
            }
        }
    }
}, async (e)=>{
    let t = e.context.session;
    if ((await e.context.internalAdapter.findAccounts(t.user.id)).find((l)=>l.providerId === e.body.provider)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: w.SOCIAL_ACCOUNT_ALREADY_LINKED
    });
    let o = e.context.socialProviders.find((l)=>l.id === e.body.provider);
    if (!o) throw e.context.logger.error("Provider not found. Make sure to add the provider in your auth config", {
        provider: e.body.provider
    }), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("NOT_FOUND", {
        message: w.PROVIDER_NOT_FOUND
    });
    let i = await ve(e, {
        userId: t.user.id,
        email: t.user.email
    }), d = await o.createAuthorizationURL({
        state: i.state,
        codeVerifier: i.codeVerifier,
        redirectURI: `${e.context.baseURL}/callback/${o.id}`
    });
    return e.json({
        url: d.toString(),
        redirect: !0
    });
});
function Ie(e, t) {
    if (t.advanced?.ipAddress?.disableIpTracking) return null;
    let r = "127.0.0.1";
    if (et) return r;
    let o = t.advanced?.ipAddress?.ipAddressHeaders || [
        "x-client-ip",
        "x-forwarded-for",
        "cf-connecting-ip",
        "fastly-client-ip",
        "x-real-ip",
        "x-cluster-client-ip",
        "x-forwarded",
        "forwarded-for",
        "forwarded"
    ], i = e instanceof Request ? e.headers : e;
    for (let d of o){
        let l = i.get(d);
        if (typeof l == "string") {
            let s = l.split(",")[0].trim();
            if (s) return s;
        }
    }
    return null;
}
function Dn(e, t, r) {
    let n = Date.now(), o = t * 1e3;
    return n - r.lastRequest < o && r.count >= e;
}
function Cn(e) {
    return new Response(JSON.stringify({
        message: "Too many requests. Please try again later."
    }), {
        status: 429,
        statusText: "Too Many Requests",
        headers: {
            "X-Retry-After": e.toString()
        }
    });
}
function Nn(e, t) {
    let r = Date.now(), n = t * 1e3;
    return Math.ceil((e + n - r) / 1e3);
}
function Bn(e, t) {
    let r = "rateLimit", n = e.adapter;
    return {
        get: async (o)=>(await n.findMany({
                model: r,
                where: [
                    {
                        field: "key",
                        value: o
                    }
                ]
            }))[0],
        set: async (o, i, d)=>{
            try {
                d ? await n.updateMany({
                    model: t ?? "rateLimit",
                    where: [
                        {
                            field: "key",
                            value: o
                        }
                    ],
                    update: {
                        count: i.count,
                        lastRequest: i.lastRequest
                    }
                }) : await n.create({
                    model: t ?? "rateLimit",
                    data: {
                        key: o,
                        count: i.count,
                        lastRequest: i.lastRequest
                    }
                });
            } catch (l) {
                e.logger.error("Error setting rate limit", l);
            }
        }
    };
}
var cr = new Map;
function jn(e) {
    return e.options.rateLimit?.customStorage ? e.options.rateLimit.customStorage : e.rateLimit.storage === "secondary-storage" ? {
        get: async (r)=>{
            let n = await e.options.secondaryStorage?.get(r);
            return n ? JSON.parse(n) : void 0;
        },
        set: async (r, n)=>{
            await e.options.secondaryStorage?.set?.(r, JSON.stringify(n));
        }
    } : e.rateLimit.storage === "memory" ? {
        async get (r) {
            return cr.get(r);
        },
        async set (r, n, o) {
            cr.set(r, n);
        }
    } : Bn(e, e.rateLimit.modelName);
}
async function lr(e, t) {
    if (!t.rateLimit.enabled) return;
    let r = t.baseURL, n = e.url.replace(r, "").split("?")[0], o = t.rateLimit.window, i = t.rateLimit.max, d = Ie(e, t.options) + n, s = Fn().find((m)=>m.pathMatcher(n));
    s && (o = s.window, i = s.max);
    for (let m of t.options.plugins || [])if (m.rateLimit) {
        let u = m.rateLimit.find((f)=>f.pathMatcher(n));
        if (u) {
            o = u.window, i = u.max;
            break;
        }
    }
    if (t.rateLimit.customRules) {
        let m = Object.keys(t.rateLimit.customRules).find((u)=>u.includes("*") ? Ae(u)(n) : u === n);
        if (m) {
            let u = t.rateLimit.customRules[m], f = typeof u == "function" ? await u(e) : u;
            f && (o = f.window, i = f.max);
        }
    }
    let a = jn(t), c = await a.get(d), p = Date.now();
    if (!c) await a.set(d, {
        key: d,
        count: 1,
        lastRequest: p
    });
    else {
        let m = p - c.lastRequest;
        if (Dn(i, o, c)) {
            let u = Nn(c.lastRequest, o);
            return Cn(u);
        } else m > o * 1e3 ? await a.set(d, {
            ...c,
            count: 1,
            lastRequest: p
        }, !0) : await a.set(d, {
            ...c,
            count: c.count + 1,
            lastRequest: p
        }, !0);
    }
}
function Fn() {
    return [
        {
            pathMatcher (t) {
                return t.startsWith("/sign-in") || t.startsWith("/sign-up") || t.startsWith("/change-password") || t.startsWith("/change-email");
            },
            window: 10,
            max: 3
        }
    ];
}
;
;
function We(e, t) {
    let r = t.plugins?.reduce((l, s)=>({
            ...l,
            ...s.endpoints
        }), {}), n = t.plugins?.map((l)=>l.middlewares?.map((s)=>{
            let a = async (c)=>s.middleware({
                    ...c,
                    context: {
                        ...e,
                        ...c.context
                    }
                });
            return a.path = s.path, a.options = s.middleware.options, a.headers = s.middleware.headers, {
                path: s.path,
                middleware: a
            };
        })).filter((l)=>l !== void 0).flat() || [], i = {
        ...{
            signInSocial: Mt,
            callbackOAuth: Ht,
            getSession: $e(),
            signOut: Wt,
            signUpEmail: ir(),
            signInEmail: zt,
            forgetPassword: Kt,
            resetPassword: Jt,
            verifyEmail: Vt,
            sendVerificationEmail: qt,
            changeEmail: rr,
            changePassword: Xt,
            setPassword: er,
            updateUser: Yt(),
            deleteUser: tr,
            forgetPasswordCallback: Qt,
            listSessions: Ct(),
            revokeSession: Nt,
            revokeSessions: Bt,
            revokeOtherSessions: jt,
            linkSocialAccount: dr,
            listUserAccounts: ar,
            deleteUserCallback: He
        },
        ...r,
        ok: or,
        error: nr
    }, d = {};
    for (let [l, s] of Object.entries(i))d[l] = async (a = {})=>{
        s.headers = new Headers;
        let c = {
            setHeader (h, y) {
                s.headers.set(h, y);
            },
            setCookie (h, y, x) {
                (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["setCookie"])(s.headers, h, y, x);
            },
            getCookie (h, y) {
                let k = a.headers?.get("cookie");
                return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getCookie"])(k || "", h, y);
            },
            getSignedCookie (h, y, x) {
                let k = a.headers;
                return k ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getSignedCookie"])(k, y, h, x) : null;
            },
            async setSignedCookie (h, y, x, k) {
                await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["setSignedCookie"])(s.headers, h, y, x, k);
            },
            redirect (h) {
                return s.headers.set("Location", h), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("FOUND");
            },
            responseHeader: s.headers
        }, p = await e, m = null, u = {
            ...c,
            ...a,
            path: s.path,
            context: {
                ...p,
                ...a.context,
                session: null,
                setNewSession: function(h) {
                    this.newSession = h, m = h;
                }
            }
        }, f = t.plugins || [], g = f.map((h)=>{
            if (h.hooks?.before) return h.hooks.before;
        }).filter((h)=>h !== void 0).flat(), b = f.map((h)=>{
            if (h.hooks?.after) return h.hooks.after;
        }).filter((h)=>h !== void 0).flat();
        t.hooks?.before && g.push({
            matcher: ()=>!0,
            handler: t.hooks.before
        }), t.hooks?.after && b.push({
            matcher: ()=>!0,
            handler: t.hooks.after
        });
        for (let h of g){
            if (!h.matcher(u)) continue;
            let y = await h.handler(u);
            if (y && "context" in y) {
                u = {
                    ...u,
                    ...y.context
                };
                continue;
            }
            if (y) return y;
        }
        let A;
        try {
            A = await s(u), m && (u.context.newSession = m);
        } catch (h) {
            if (m && (u.context.newSession = m), h instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]) {
                if (!b?.length) throw h.headers = s.headers, h;
                u.context.returned = h, u.context.returned.headers = s.headers;
                for (let y of b || [])if (y.matcher(u)) try {
                    let k = await y.handler(u);
                    k && "response" in k && (u.context.returned = k.response);
                } catch (k) {
                    if (k instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]) {
                        u.context.returned = k;
                        continue;
                    }
                    throw k;
                }
                if (u.context.returned instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]) throw u.context.returned.headers = s.headers, u.context.returned;
                return u.context.returned;
            }
            throw h;
        }
        u.context.returned = A, u.responseHeader = s.headers;
        for (let h of b)if (h.matcher(u)) try {
            let x = await h.handler(u);
            if (x) if ("responseHeader" in x) {
                let k = x.responseHeader;
                u.responseHeader = k;
            } else u.context.returned = x;
        } catch (x) {
            if (x instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]) {
                u.context.returned = x;
                continue;
            }
            throw x;
        }
        let R = u.context.returned;
        if (R instanceof Response && s.headers.forEach((h, y)=>{
            y === "set-cookie" ? R.headers.append(y, h) : R.headers.set(y, h);
        }), R instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]) throw R.headers = s.headers, R;
        return R;
    }, d[l].path = s.path, d[l].method = s.method, d[l].options = s.options, d[l].headers = s.headers;
    return {
        api: d,
        middlewares: n
    };
}
var ur = (e, t)=>{
    let { api: r, middlewares: n } = We(e, t), o = new URL(e.baseURL).pathname;
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["createRouter"])(r, {
        extraContext: e,
        basePath: o,
        routerMiddleware: [
            {
                path: "/**",
                middleware: ot
            },
            ...n
        ],
        async onRequest (i) {
            for (let d of e.options.plugins || [])if (d.onRequest) {
                let l = await d.onRequest(i, e);
                if (l && "response" in l) return l.response;
            }
            return lr(i, e);
        },
        async onResponse (i) {
            for (let d of e.options.plugins || [])if (d.onResponse) {
                let l = await d.onResponse(i, e);
                if (l) return l.response;
            }
            return i;
        },
        onError (i) {
            if (i instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"] && i.status === "FOUND") return;
            if (t.onAPIError?.throw) throw i;
            if (t.onAPIError?.onError) {
                t.onAPIError.onError(i, e);
                return;
            }
            let d = t.logger?.level, l = d === "error" || d === "warn" || d === "debug" ? C : void 0;
            if (t.logger?.disabled !== !0) {
                if (i && typeof i == "object" && "message" in i && typeof i.message == "string" && (i.message.includes("no column") || i.message.includes("column") || i.message.includes("relation") || i.message.includes("table") || i.message.includes("does not exist"))) {
                    e.logger?.error(i.message);
                    return;
                }
                i instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"] ? (i.status === "INTERNAL_SERVER_ERROR" && e.logger.error(i.status, i), l?.error(i.message)) : e.logger?.error(i && typeof i == "object" && "name" in i ? i.name : "", i);
            }
        }
    });
};
;
function pr(e, t) {
    let r = t.hooks;
    async function n(d, l, s) {
        let a = d;
        for (let m of r || []){
            let u = m[l]?.create?.before;
            if (u) {
                let f = await u(d);
                if (f === !1) return null;
                typeof f == "object" && "data" in f && (a = f.data);
            }
        }
        let c = s ? await s.fn(a) : null, p = !s || s.executeMainFn ? await e.create({
            model: l,
            data: a
        }) : c;
        for (let m of r || []){
            let u = m[l]?.create?.after;
            u && await u(p);
        }
        return p;
    }
    async function o(d, l, s, a) {
        let c = d;
        for (let u of r || []){
            let f = u[s]?.update?.before;
            if (f) {
                let g = await f(d);
                if (g === !1) return null;
                c = typeof g == "object" ? g.data : g;
            }
        }
        let p = a ? await a.fn(c) : null, m = !a || a.executeMainFn ? await e.update({
            model: s,
            update: c,
            where: l
        }) : p;
        for (let u of r || []){
            let f = u[s]?.update?.after;
            f && await f(m);
        }
        return m;
    }
    async function i(d, l, s, a) {
        let c = d;
        for (let u of r || []){
            let f = u[s]?.update?.before;
            if (f) {
                let g = await f(d);
                if (g === !1) return null;
                c = typeof g == "object" ? g.data : g;
            }
        }
        let p = a ? await a.fn(c) : null, m = !a || a.executeMainFn ? await e.updateMany({
            model: s,
            update: c,
            where: l
        }) : p;
        for (let u of r || []){
            let f = u[s]?.update?.after;
            f && await f(m);
        }
        return m;
    }
    return {
        createWithHooks: n,
        updateWithHooks: o,
        updateManyWithHooks: i
    };
}
var Ge = (e, t)=>{
    let r = t.options, n = r.secondaryStorage, o = r.session?.expiresIn || 60 * 60 * 24 * 7, { createWithHooks: i, updateWithHooks: d, updateManyWithHooks: l } = pr(e, t);
    return {
        createOAuthUser: async (s, a)=>{
            let c = await i({
                createdAt: new Date,
                updatedAt: new Date,
                ...s
            }, "user"), p = await i({
                ...a,
                userId: c.id || s.id,
                createdAt: new Date,
                updatedAt: new Date
            }, "account");
            return {
                user: c,
                account: p
            };
        },
        createUser: async (s)=>await i({
                createdAt: new Date,
                updatedAt: new Date,
                emailVerified: !1,
                ...s,
                email: s.email.toLowerCase()
            }, "user"),
        createAccount: async (s)=>await i({
                createdAt: new Date,
                updatedAt: new Date,
                ...s
            }, "account"),
        listSessions: async (s)=>{
            if (n) {
                let c = await n.get(`active-sessions-${s}`);
                if (!c) return [];
                let p = ae(c) || [], m = Date.now(), u = p.filter((g)=>g.expiresAt > m), f = [];
                for (let g of u){
                    let b = await n.get(g.token);
                    if (b) {
                        let A = JSON.parse(b), R = Se(t.options, {
                            ...A.session,
                            expiresAt: new Date(A.session.expiresAt)
                        });
                        f.push(R);
                    }
                }
                return f;
            }
            return await e.findMany({
                model: "session",
                where: [
                    {
                        field: "userId",
                        value: s
                    }
                ]
            });
        },
        listUsers: async (s, a, c, p)=>await e.findMany({
                model: "user",
                limit: s,
                offset: a,
                sortBy: c,
                where: p
            }),
        deleteUser: async (s)=>{
            await e.deleteMany({
                model: "session",
                where: [
                    {
                        field: "userId",
                        value: s
                    }
                ]
            }), await e.deleteMany({
                model: "account",
                where: [
                    {
                        field: "userId",
                        value: s
                    }
                ]
            }), await e.delete({
                model: "user",
                where: [
                    {
                        field: "id",
                        value: s
                    }
                ]
            });
        },
        createSession: async (s, a, c, p)=>{
            let m = a instanceof Request ? a.headers : a, { id: u, ...f } = p || {}, g = {
                ipAddress: a && Ie(a, t.options) || "",
                userAgent: m?.get("user-agent") || "",
                ...f,
                expiresAt: c ? V(60 * 60 * 24, "sec") : V(o, "sec"),
                userId: s,
                token: H(32),
                createdAt: new Date,
                updatedAt: new Date
            };
            return await i(g, "session", n ? {
                fn: async (A)=>{
                    let R = await n.get(`active-sessions-${s}`), h = [], y = Date.now();
                    return R && (h = ae(R) || [], h = h.filter((x)=>x.expiresAt > y)), h.push({
                        token: g.token,
                        expiresAt: y + o * 1e3
                    }), await n.set(`active-sessions-${s}`, JSON.stringify(h), o), A;
                },
                executeMainFn: r.session?.storeSessionInDatabase
            } : void 0);
        },
        findSession: async (s)=>{
            if (n) {
                let u = await n.get(s);
                if (u) {
                    let f = JSON.parse(u), g = Se(t.options, {
                        ...f.session,
                        expiresAt: new Date(f.session.expiresAt),
                        createdAt: new Date(f.session.createdAt),
                        updatedAt: new Date(f.session.updatedAt)
                    }), b = ze(t.options, {
                        ...f.user,
                        createdAt: new Date(f.user.createdAt),
                        updatedAt: new Date(f.user.updatedAt)
                    });
                    return {
                        session: g,
                        user: b
                    };
                }
            }
            let a = await e.findOne({
                model: "session",
                where: [
                    {
                        value: s,
                        field: "token"
                    }
                ]
            });
            if (!a) return null;
            let c = await e.findOne({
                model: "user",
                where: [
                    {
                        value: a.userId,
                        field: "id"
                    }
                ]
            });
            if (!c) return null;
            let p = Se(t.options, a), m = ze(t.options, c);
            return n && await n?.set(s, JSON.stringify({
                session: p,
                user: m
            }), p.expiresAt ? Math.floor(((p.expiresAt instanceof Date ? p.expiresAt.getTime() : new Date(p.expiresAt).getTime()) - Date.now()) / 1e3) : o), {
                session: p,
                user: m
            };
        },
        findSessions: async (s)=>{
            if (n) {
                let m = [];
                for (let u of s){
                    let f = await n.get(u);
                    if (f) {
                        let g = JSON.parse(f), b = {
                            session: {
                                ...g.session,
                                expiresAt: new Date(g.session.expiresAt)
                            },
                            user: {
                                ...g.user,
                                createdAt: new Date(g.user.createdAt),
                                updatedAt: new Date(g.user.updatedAt)
                            }
                        };
                        m.push(b);
                    }
                }
                return m;
            }
            let a = await e.findMany({
                model: "session",
                where: [
                    {
                        field: "token",
                        value: s,
                        operator: "in"
                    }
                ]
            }), c = a.map((m)=>m.userId);
            if (!c.length) return [];
            let p = await e.findMany({
                model: "user",
                where: [
                    {
                        field: "id",
                        value: c,
                        operator: "in"
                    }
                ]
            });
            return a.map((m)=>{
                let u = p.find((f)=>f.id === m.userId);
                return u ? {
                    session: m,
                    user: u
                } : null;
            });
        },
        updateSession: async (s, a)=>await d(a, [
                {
                    field: "token",
                    value: s
                }
            ], "session", n ? {
                async fn (p) {
                    let m = await n.get(s), u = null;
                    return m ? (u = {
                        ...JSON.parse(m).session,
                        ...p
                    }, u) : null;
                },
                executeMainFn: r.session?.storeSessionInDatabase
            } : void 0),
        deleteSession: async (s)=>{
            if (n) {
                await n.delete(s), r.session?.storeSessionInDatabase && await e.delete({
                    model: "session",
                    where: [
                        {
                            field: "token",
                            value: s
                        }
                    ]
                });
                return;
            }
            await e.delete({
                model: "session",
                where: [
                    {
                        field: "token",
                        value: s
                    }
                ]
            });
        },
        deleteAccounts: async (s)=>{
            await e.deleteMany({
                model: "account",
                where: [
                    {
                        field: "userId",
                        value: s
                    }
                ]
            });
        },
        deleteSessions: async (s)=>{
            if (n) {
                if (typeof s == "string") {
                    let a = await n.get(`active-sessions-${s}`), c = a ? ae(a) : [];
                    if (!c) return;
                    for (let p of c)await n.delete(p.token);
                } else for (let a of s)await n.get(a) && await n.delete(a);
                r.session?.storeSessionInDatabase && await e.deleteMany({
                    model: "session",
                    where: [
                        {
                            field: Array.isArray(s) ? "token" : "userId",
                            value: s,
                            operator: Array.isArray(s) ? "in" : void 0
                        }
                    ]
                });
                return;
            }
            await e.deleteMany({
                model: "session",
                where: [
                    {
                        field: Array.isArray(s) ? "token" : "userId",
                        value: s,
                        operator: Array.isArray(s) ? "in" : void 0
                    }
                ]
            });
        },
        findOAuthUser: async (s, a, c)=>{
            let p = null;
            if (p = await e.findOne({
                model: "user",
                where: [
                    {
                        value: s.toLowerCase(),
                        field: "email"
                    }
                ]
            }), !p) {
                let u = await e.findOne({
                    model: "account",
                    where: [
                        {
                            value: a,
                            field: "accountId"
                        },
                        {
                            value: c,
                            field: "providerId"
                        }
                    ]
                });
                return u ? (p = await e.findOne({
                    model: "user",
                    where: [
                        {
                            value: u.userId,
                            field: "id"
                        }
                    ]
                }), {
                    user: p,
                    accounts: [
                        u
                    ]
                }) : null;
            }
            let m = await e.findMany({
                model: "account",
                where: [
                    {
                        value: p.id,
                        field: "userId"
                    }
                ]
            });
            return {
                user: p,
                accounts: m || []
            };
        },
        findUserByEmail: async (s, a)=>{
            let c = await e.findOne({
                model: "user",
                where: [
                    {
                        value: s.toLowerCase(),
                        field: "email"
                    }
                ]
            });
            if (!c) return null;
            if (a?.includeAccounts) {
                let p = await e.findMany({
                    model: "account",
                    where: [
                        {
                            value: c.id,
                            field: "userId"
                        }
                    ]
                });
                return {
                    user: c,
                    accounts: p
                };
            }
            return {
                user: c,
                accounts: []
            };
        },
        findUserById: async (s)=>await e.findOne({
                model: "user",
                where: [
                    {
                        field: "id",
                        value: s
                    }
                ]
            }),
        linkAccount: async (s)=>await i({
                ...s,
                createdAt: new Date,
                updatedAt: new Date
            }, "account"),
        updateUser: async (s, a)=>await d(a, [
                {
                    field: "id",
                    value: s
                }
            ], "user"),
        updateUserByEmail: async (s, a)=>await d(a, [
                {
                    field: "email",
                    value: s
                }
            ], "user"),
        updatePassword: async (s, a)=>{
            await l({
                password: a
            }, [
                {
                    field: "userId",
                    value: s
                },
                {
                    field: "providerId",
                    value: "credential"
                }
            ], "account");
        },
        findAccounts: async (s)=>await e.findMany({
                model: "account",
                where: [
                    {
                        field: "userId",
                        value: s
                    }
                ]
            }),
        findAccount: async (s)=>await e.findOne({
                model: "account",
                where: [
                    {
                        field: "accountId",
                        value: s
                    }
                ]
            }),
        findAccountByUserId: async (s)=>await e.findMany({
                model: "account",
                where: [
                    {
                        field: "userId",
                        value: s
                    }
                ]
            }),
        updateAccount: async (s, a)=>await d(a, [
                {
                    field: "id",
                    value: s
                }
            ], "account"),
        createVerificationValue: async (s)=>await i({
                createdAt: new Date,
                updatedAt: new Date,
                ...s
            }, "verification"),
        findVerificationValue: async (s)=>(await e.findMany({
                model: "verification",
                where: [
                    {
                        field: "identifier",
                        value: s
                    }
                ],
                sortBy: {
                    field: "createdAt",
                    direction: "desc"
                },
                limit: 1
            }))[0],
        deleteVerificationValue: async (s)=>{
            await e.delete({
                model: "verification",
                where: [
                    {
                        field: "id",
                        value: s
                    }
                ]
            });
        },
        deleteVerificationByIdentifier: async (s)=>{
            await e.delete({
                model: "verification",
                where: [
                    {
                        field: "identifier",
                        value: s
                    }
                ]
            });
        },
        updateVerificationValue: async (s, a)=>await d(a, [
                {
                    field: "id",
                    value: s
                }
            ], "verification")
    };
};
var Y = (e)=>{
    let t = e.plugins?.reduce((s, a)=>{
        let c = a.schema;
        if (!c) return s;
        for (let [p, m] of Object.entries(c))s[p] = {
            fields: {
                ...s[p]?.fields,
                ...m.fields
            },
            modelName: m.modelName || p
        };
        return s;
    }, {}), r = e.rateLimit?.storage === "database", n = {
        rateLimit: {
            modelName: e.rateLimit?.modelName || "rateLimit",
            fields: {
                key: {
                    type: "string",
                    fieldName: e.rateLimit?.fields?.key || "key"
                },
                count: {
                    type: "number",
                    fieldName: e.rateLimit?.fields?.count || "count"
                },
                lastRequest: {
                    type: "number",
                    fieldName: e.rateLimit?.fields?.lastRequest || "lastRequest"
                }
            }
        }
    }, { user: o, session: i, account: d, ...l } = t || {};
    return {
        user: {
            modelName: e.user?.modelName || "user",
            fields: {
                name: {
                    type: "string",
                    required: !0,
                    fieldName: e.user?.fields?.name || "name"
                },
                email: {
                    type: "string",
                    unique: !0,
                    required: !0,
                    fieldName: e.user?.fields?.email || "email"
                },
                emailVerified: {
                    type: "boolean",
                    defaultValue: ()=>!1,
                    required: !0,
                    fieldName: e.user?.fields?.emailVerified || "emailVerified"
                },
                image: {
                    type: "string",
                    required: !1,
                    fieldName: e.user?.fields?.image || "image"
                },
                createdAt: {
                    type: "date",
                    defaultValue: ()=>new Date,
                    required: !0,
                    fieldName: e.user?.fields?.createdAt || "createdAt"
                },
                updatedAt: {
                    type: "date",
                    defaultValue: ()=>new Date,
                    required: !0,
                    fieldName: e.user?.fields?.updatedAt || "updatedAt"
                },
                ...o?.fields,
                ...e.user?.additionalFields
            },
            order: 1
        },
        session: {
            modelName: e.session?.modelName || "session",
            fields: {
                expiresAt: {
                    type: "date",
                    required: !0,
                    fieldName: e.session?.fields?.expiresAt || "expiresAt"
                },
                token: {
                    type: "string",
                    required: !0,
                    fieldName: e.session?.fields?.token || "token",
                    unique: !0
                },
                createdAt: {
                    type: "date",
                    required: !0,
                    fieldName: e.session?.fields?.createdAt || "createdAt"
                },
                updatedAt: {
                    type: "date",
                    required: !0,
                    fieldName: e.session?.fields?.updatedAt || "updatedAt"
                },
                ipAddress: {
                    type: "string",
                    required: !1,
                    fieldName: e.session?.fields?.ipAddress || "ipAddress"
                },
                userAgent: {
                    type: "string",
                    required: !1,
                    fieldName: e.session?.fields?.userAgent || "userAgent"
                },
                userId: {
                    type: "string",
                    fieldName: e.session?.fields?.userId || "userId",
                    references: {
                        model: e.user?.modelName || "user",
                        field: "id",
                        onDelete: "cascade"
                    },
                    required: !0
                },
                ...i?.fields,
                ...e.session?.additionalFields
            },
            order: 2
        },
        account: {
            modelName: e.account?.modelName || "account",
            fields: {
                accountId: {
                    type: "string",
                    required: !0,
                    fieldName: e.account?.fields?.accountId || "accountId"
                },
                providerId: {
                    type: "string",
                    required: !0,
                    fieldName: e.account?.fields?.providerId || "providerId"
                },
                userId: {
                    type: "string",
                    references: {
                        model: e.user?.modelName || "user",
                        field: "id",
                        onDelete: "cascade"
                    },
                    required: !0,
                    fieldName: e.account?.fields?.userId || "userId"
                },
                accessToken: {
                    type: "string",
                    required: !1,
                    fieldName: e.account?.fields?.accessToken || "accessToken"
                },
                refreshToken: {
                    type: "string",
                    required: !1,
                    fieldName: e.account?.fields?.refreshToken || "refreshToken"
                },
                idToken: {
                    type: "string",
                    required: !1,
                    fieldName: e.account?.fields?.idToken || "idToken"
                },
                accessTokenExpiresAt: {
                    type: "date",
                    required: !1,
                    fieldName: e.account?.fields?.accessTokenExpiresAt || "accessTokenExpiresAt"
                },
                refreshTokenExpiresAt: {
                    type: "date",
                    required: !1,
                    fieldName: e.account?.fields?.accessTokenExpiresAt || "refreshTokenExpiresAt"
                },
                scope: {
                    type: "string",
                    required: !1,
                    fieldName: e.account?.fields?.scope || "scope"
                },
                password: {
                    type: "string",
                    required: !1,
                    fieldName: e.account?.fields?.password || "password"
                },
                createdAt: {
                    type: "date",
                    required: !0,
                    fieldName: e.account?.fields?.createdAt || "createdAt"
                },
                updatedAt: {
                    type: "date",
                    required: !0,
                    fieldName: e.account?.fields?.updatedAt || "updatedAt"
                },
                ...d?.fields
            },
            order: 3
        },
        verification: {
            modelName: e.verification?.modelName || "verification",
            fields: {
                identifier: {
                    type: "string",
                    required: !0,
                    fieldName: e.verification?.fields?.identifier || "identifier"
                },
                value: {
                    type: "string",
                    required: !0,
                    fieldName: e.verification?.fields?.value || "value"
                },
                expiresAt: {
                    type: "date",
                    required: !0,
                    fieldName: e.verification?.fields?.expiresAt || "expiresAt"
                },
                createdAt: {
                    type: "date",
                    required: !1,
                    defaultValue: ()=>new Date,
                    fieldName: e.verification?.fields?.createdAt || "createdAt"
                },
                updatedAt: {
                    type: "date",
                    required: !1,
                    defaultValue: ()=>new Date,
                    fieldName: e.verification?.fields?.updatedAt || "updatedAt"
                }
            },
            order: 4
        },
        ...l,
        ...r ? n : {}
    };
};
;
;
;
function yr(e) {
    if (!e) return null;
    if ("dialect" in e) return yr(e.dialect);
    if ("createDriver" in e) {
        if (e instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$kysely$2f$dist$2f$esm$2f$dialect$2f$sqlite$2f$sqlite$2d$dialect$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["SqliteDialect"]) return "sqlite";
        if (e instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$kysely$2f$dist$2f$esm$2f$dialect$2f$mysql$2f$mysql$2d$dialect$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["MysqlDialect"]) return "mysql";
        if (e instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$kysely$2f$dist$2f$esm$2f$dialect$2f$postgres$2f$postgres$2d$dialect$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["PostgresDialect"]) return "postgres";
        if (e instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$kysely$2f$dist$2f$esm$2f$dialect$2f$mssql$2f$mssql$2d$dialect$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["MssqlDialect"]) return "mssql";
    }
    return "aggregate" in e ? "sqlite" : "getConnection" in e ? "mysql" : "connect" in e ? "postgres" : null;
}
var Ke = async (e)=>{
    let t = e.database;
    if (!t) return {
        kysely: null,
        databaseType: null
    };
    if ("db" in t) return {
        kysely: t.db,
        databaseType: t.type
    };
    if ("dialect" in t) return {
        kysely: new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$kysely$2f$dist$2f$esm$2f$kysely$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["Kysely"]({
            dialect: t.dialect
        }),
        databaseType: t.type
    };
    let r, n = yr(t);
    return "createDriver" in t && (r = t), "aggregate" in t && (r = new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$kysely$2f$dist$2f$esm$2f$dialect$2f$sqlite$2f$sqlite$2d$dialect$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["SqliteDialect"]({
        database: t
    })), "getConnection" in t && (r = new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$kysely$2f$dist$2f$esm$2f$dialect$2f$mysql$2f$mysql$2d$dialect$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["MysqlDialect"](t)), "connect" in t && (r = new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$kysely$2f$dist$2f$esm$2f$dialect$2f$postgres$2f$postgres$2d$dialect$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["PostgresDialect"]({
        pool: t
    })), {
        kysely: r ? new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$kysely$2f$dist$2f$esm$2f$kysely$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["Kysely"]({
            dialect: r
        }) : null,
        databaseType: n
    };
};
function Pe(e, t, r) {
    return r === "update" ? e : e == null && t.defaultValue ? typeof t.defaultValue == "function" ? t.defaultValue() : t.defaultValue : e;
}
var Wn = (e, t, r)=>{
    let n = Y(t);
    function o(a, c) {
        if (c === "id") return c;
        let p = n[a].fields[c];
        return p || console.log("Field not found", a, c), p.fieldName || c;
    }
    function i(a, c, p) {
        let { type: m = "sqlite" } = r || {}, u = n[c].fields[p];
        return u.type === "boolean" && m === "sqlite" && a !== null && a !== void 0 ? a ? 1 : 0 : u.type === "date" && a && a instanceof Date && m === "sqlite" ? a.toISOString() : a;
    }
    function d(a, c, p) {
        let { type: m = "sqlite" } = r || {}, u = n[c].fields[p];
        return u.type === "boolean" && m === "sqlite" && a !== null ? a === 1 : u.type === "date" && a ? new Date(a) : a;
    }
    function l(a) {
        return n[a].modelName;
    }
    let s = t?.advanced?.generateId === !1;
    return {
        transformInput (a, c, p) {
            let m = s || p === "update" ? {} : {
                id: t.advanced?.generateId ? t.advanced.generateId({
                    model: c
                }) : a.id || H()
            }, u = n[c].fields;
            for(let f in u){
                let g = a[f];
                m[u[f].fieldName || f] = Pe(i(g, c, f), u[f], p);
            }
            return m;
        },
        transformOutput (a, c, p = []) {
            if (!a) return null;
            let m = a.id ? p.length === 0 || p.includes("id") ? {
                id: a.id
            } : {} : {}, u = n[c].fields;
            for(let f in u){
                if (p.length && !p.includes(f)) continue;
                let g = u[f];
                g && (m[f] = d(a[g.fieldName || f], c, f));
            }
            return m;
        },
        convertWhereClause (a, c) {
            if (!c) return {
                and: null,
                or: null
            };
            let p = {
                and: [],
                or: []
            };
            return c.forEach((m)=>{
                let { field: u, value: f, operator: g = "=", connector: b = "AND" } = m, A = o(a, u), R = (h)=>g.toLowerCase() === "in" ? h(A, "in", Array.isArray(f) ? f : [
                        f
                    ]) : g === "contains" ? h(A, "like", `%${f}%`) : g === "starts_with" ? h(A, "like", `${f}%`) : g === "ends_with" ? h(A, "like", `%${f}`) : g === "eq" ? h(A, "=", f) : g === "ne" ? h(A, "<>", f) : g === "gt" ? h(A, ">", f) : g === "gte" ? h(A, ">=", f) : g === "lt" ? h(A, "<", f) : g === "lte" ? h(A, "<=", f) : h(A, g, f);
                b === "OR" ? p.or.push(R) : p.and.push(R);
            }), {
                and: p.and.length ? p.and : null,
                or: p.or.length ? p.or : null
            };
        },
        async withReturning (a, c, p, m) {
            let u;
            if (r?.type !== "mysql") u = await c.returningAll().executeTakeFirst();
            else {
                await c.execute();
                let f = a.id ? "id" : m[0].field ? m[0].field : "id", g = a[f] || m[0].value;
                u = await e.selectFrom(l(p)).selectAll().where(o(p, f), "=", g).executeTakeFirst();
            }
            return u;
        },
        getModelName: l,
        getField: o
    };
}, wr = (e, t)=>(r)=>{
        let { transformInput: n, withReturning: o, transformOutput: i, convertWhereClause: d, getModelName: l, getField: s } = Wn(e, r, t);
        return {
            id: "kysely",
            async create (a) {
                let { model: c, data: p, select: m } = a, u = n(p, c, "create"), f = e.insertInto(l(c)).values(u);
                return i(await o(u, f, c, []), c, m);
            },
            async findOne (a) {
                let { model: c, where: p, select: m } = a, { and: u, or: f } = d(c, p), g = e.selectFrom(l(c)).selectAll();
                u && (g = g.where((A)=>A.and(u.map((R)=>R(A))))), f && (g = g.where((A)=>A.or(f.map((R)=>R(A)))));
                let b = await g.executeTakeFirst();
                return b ? i(b, c, m) : null;
            },
            async findMany (a) {
                let { model: c, where: p, limit: m, offset: u, sortBy: f } = a, { and: g, or: b } = d(c, p), A = e.selectFrom(l(c));
                g && (A = A.where((h)=>h.and(g.map((y)=>y(h))))), b && (A = A.where((h)=>h.or(b.map((y)=>y(h))))), A = A.limit(m || 100), u && (A = A.offset(u)), f && (A = A.orderBy(s(c, f.field), f.direction));
                let R = await A.selectAll().execute();
                return R ? R.map((h)=>i(h, c)) : [];
            },
            async update (a) {
                let { model: c, where: p, update: m } = a, { and: u, or: f } = d(c, p), g = n(m, c, "update"), b = e.updateTable(l(c)).set(g);
                return u && (b = b.where((R)=>R.and(u.map((h)=>h(R))))), f && (b = b.where((R)=>R.or(f.map((h)=>h(R))))), await i(await o(g, b, c, p), c);
            },
            async updateMany (a) {
                let { model: c, where: p, update: m } = a, { and: u, or: f } = d(c, p), g = n(m, c, "update"), b = e.updateTable(l(c)).set(g);
                return u && (b = b.where((R)=>R.and(u.map((h)=>h(R))))), f && (b = b.where((R)=>R.or(f.map((h)=>h(R))))), (await b.execute()).length;
            },
            async delete (a) {
                let { model: c, where: p } = a, { and: m, or: u } = d(c, p), f = e.deleteFrom(l(c));
                m && (f = f.where((g)=>g.and(m.map((b)=>b(g))))), u && (f = f.where((g)=>g.or(u.map((b)=>b(g))))), await f.execute();
            },
            async deleteMany (a) {
                let { model: c, where: p } = a, { and: m, or: u } = d(c, p), f = e.deleteFrom(l(c));
                return m && (f = f.where((g)=>g.and(m.map((b)=>b(g))))), u && (f = f.where((g)=>g.or(u.map((b)=>b(g))))), (await f.execute()).length;
            },
            options: t
        };
    };
var Gn = (e)=>{
    let t = Y(e);
    function r(n, o) {
        return o === "id" ? o : t[n].fields[o].fieldName || o;
    }
    return {
        transformInput (n, o, i) {
            let d = i === "update" ? {} : {
                id: e.advanced?.generateId ? e.advanced.generateId({
                    model: o
                }) : n.id || H()
            }, l = t[o].fields;
            for(let s in l){
                let a = n[s];
                a === void 0 && !l[s].defaultValue || (d[l[s].fieldName || s] = Pe(a, l[s], i));
            }
            return d;
        },
        transformOutput (n, o, i = []) {
            if (!n) return null;
            let d = n.id || n._id ? i.length === 0 || i.includes("id") ? {
                id: n.id
            } : {} : {}, l = t[o].fields;
            for(let s in l){
                if (i.length && !i.includes(s)) continue;
                let a = l[s];
                a && (d[s] = n[a.fieldName || s]);
            }
            return d;
        },
        convertWhereClause (n, o, i) {
            return o.filter((d)=>n.every((l)=>{
                    let { field: s, value: a, operator: c } = l, p = r(i, s);
                    if (c === "in") {
                        if (!Array.isArray(a)) throw new Error("Value must be an array");
                        return a.includes(d[p]);
                    } else return c === "contains" ? d[p].includes(a) : c === "starts_with" ? d[p].startsWith(a) : c === "ends_with" ? d[p].endsWith(a) : d[p] === a;
                }));
        },
        getField: r
    };
}, br = (e)=>(t)=>{
        let { transformInput: r, transformOutput: n, convertWhereClause: o, getField: i } = Gn(t);
        return {
            id: "memory",
            create: async ({ model: d, data: l })=>{
                let s = r(l, d, "create");
                return e[d].push(s), n(s, d);
            },
            findOne: async ({ model: d, where: l, select: s })=>{
                let a = e[d], p = o(l, a, d)[0] || null;
                return n(p, d, s);
            },
            findMany: async ({ model: d, where: l, sortBy: s, limit: a, offset: c })=>{
                let p = e[d];
                return l && (p = o(l, p, d)), s && (p = p.sort((m, u)=>{
                    let f = i(d, s.field);
                    return s.direction === "asc" ? m[f] > u[f] ? 1 : -1 : m[f] < u[f] ? 1 : -1;
                })), c !== void 0 && (p = p.slice(c)), a !== void 0 && (p = p.slice(0, a)), p.map((m)=>n(m, d));
            },
            update: async ({ model: d, where: l, update: s })=>{
                let a = e[d], c = o(l, a, d);
                return c.forEach((p)=>{
                    Object.assign(p, r(s, d, "update"));
                }), n(c[0], d);
            },
            delete: async ({ model: d, where: l })=>{
                let s = e[d], a = o(l, s, d);
                e[d] = s.filter((c)=>!a.includes(c));
            },
            deleteMany: async ({ model: d, where: l })=>{
                let s = e[d], a = o(l, s, d), c = 0;
                return e[d] = s.filter((p)=>a.includes(p) ? (c++, !1) : !a.includes(p)), c;
            },
            updateMany (d) {
                let { model: l, where: s, update: a } = d, c = e[l], p = o(s, c, l);
                return p.forEach((m)=>{
                    Object.assign(m, a);
                }), p[0] || null;
            }
        };
    };
async function Ar(e) {
    if (!e.database) {
        let n = Y(e), o = Object.keys(n).reduce((i, d)=>(i[d] = [], i), {});
        return C.warn("No database configuration provided. Using memory adapter in development"), br(o)(e);
    }
    if (typeof e.database == "function") return e.database(e);
    let { kysely: t, databaseType: r } = await Ke(e);
    if (!t) throw new B("Failed to initialize database adapter");
    return wr(t, {
        type: r || "sqlite"
    })(e);
}
var Qe = "better-auth-secret-123456789";
;
async function kr(e, t) {
    let n = (await t.context.internalAdapter.findAccounts(e))?.find((d)=>d.providerId === "credential"), o = n?.password;
    if (!n || !o || !t.body.password) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: "No password credential found"
    });
    if (!await t.context.password.verify({
        hash: o,
        password: t.body.password
    })) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: "Invalid password"
    });
    return !0;
}
var Tr = async (e)=>{
    let t = await Ar(e), r = e.plugins || [], n = Jn(e), o = Ue(e.logger), i = pe(e.baseURL, e.basePath), d = e.secret || N.BETTER_AUTH_SECRET || N.AUTH_SECRET || Qe;
    d === Qe && ue && o.error("You are using the default secret. Please set `BETTER_AUTH_SECRET` in your environment variables or pass `secret` in your auth config."), e = {
        ...e,
        secret: d,
        baseURL: i ? new URL(i).origin : "",
        basePath: e.basePath || "/api/auth",
        plugins: r.concat(n),
        emailAndPassword: {
            ...e.emailAndPassword,
            enabled: e.emailAndPassword?.enabled ?? !1,
            autoSignIn: e.emailAndPassword?.autoSignIn ?? !0
        }
    };
    let l = it(e), s = Y(e), a = Object.keys(e.socialProviders || {}).map((u)=>{
        let f = e.socialProviders?.[u];
        return f.enabled === !1 ? null : (f.clientId || o.warn(`Social provider ${u} is missing clientId or clientSecret`), qe[u](f));
    }).filter((u)=>u !== null), c = ({ model: u, size: f })=>typeof e?.advanced?.generateId == "function" ? e.advanced.generateId({
            model: u,
            size: f
        }) : H(f), p = {
        appName: e.appName || "Better Auth",
        socialProviders: a,
        options: e,
        tables: s,
        trustedOrigins: Zn(e),
        baseURL: i || "",
        sessionConfig: {
            updateAge: e.session?.updateAge !== void 0 ? e.session.updateAge : 24 * 60 * 60,
            expiresIn: e.session?.expiresIn || 60 * 60 * 24 * 7,
            freshAge: e.session?.freshAge === void 0 ? 60 * 60 * 24 : e.session.freshAge
        },
        secret: d,
        rateLimit: {
            ...e.rateLimit,
            enabled: e.rateLimit?.enabled ?? ue,
            window: e.rateLimit?.window || 10,
            max: e.rateLimit?.max || 100,
            storage: e.rateLimit?.storage || (e.secondaryStorage ? "secondary-storage" : "memory")
        },
        authCookies: l,
        logger: o,
        generateId: c,
        session: null,
        secondaryStorage: e.secondaryStorage,
        password: {
            hash: e.emailAndPassword?.password?.hash || yt,
            verify: e.emailAndPassword?.password?.verify || wt,
            config: {
                minPasswordLength: e.emailAndPassword?.minPasswordLength || 8,
                maxPasswordLength: e.emailAndPassword?.maxPasswordLength || 128
            },
            checkPassword: kr
        },
        setNewSession (u) {
            this.newSession = u;
        },
        newSession: null,
        adapter: t,
        internalAdapter: Ge(t, {
            options: e,
            hooks: e.databaseHooks ? [
                e.databaseHooks
            ] : [],
            generateId: c
        }),
        createAuthCookie: Ne(e)
    }, { context: m } = Qn(p);
    return m;
};
function Qn(e) {
    let t = e.options, r = t.plugins || [], n = e, o = [];
    for (let i of r)if (i.init) {
        let d = i.init(e);
        typeof d == "object" && (d.options && (d.options.databaseHooks && o.push(d.options.databaseHooks), t = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$defu$2f$dist$2f$defu$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["defu"])(t, d.options)), d.context && (n = {
            ...n,
            ...d.context
        }));
    }
    return o.push(t.databaseHooks), n.internalAdapter = Ge(e.adapter, {
        options: t,
        hooks: o.filter((i)=>i !== void 0),
        generateId: e.generateId
    }), n.options = t, {
        context: n
    };
}
function Jn(e) {
    let t = [];
    return e.advanced?.crossSubDomainCookies?.enabled, t;
}
function Zn(e) {
    let t = pe(e.baseURL, e.basePath);
    if (!t) return [];
    let r = [
        new URL(t).origin
    ];
    e.trustedOrigins && r.push(...e.trustedOrigins);
    let n = N.BETTER_AUTH_TRUSTED_ORIGINS;
    return n && r.push(...n.split(",")), r;
}
var au = (e)=>{
    let t = Tr(e), { api: r } = We(t, e), n = e.plugins?.reduce((o, i)=>i.$ERROR_CODES ? {
            ...o,
            ...i.$ERROR_CODES
        } : o, {});
    return {
        handler: async (o)=>{
            let i = await t, d = i.options.basePath || "/api/auth", l = new URL(o.url);
            if (!i.options.baseURL) {
                let a = pe(void 0, d) || `${l.origin}${d}`;
                i.options.baseURL = a, i.baseURL = a;
            }
            i.trustedOrigins = [
                ...e.trustedOrigins || [],
                i.baseURL,
                l.origin
            ];
            let { handler: s } = ur(i, e);
            return s(o);
        },
        api: r,
        options: e,
        $context: t,
        $Infer: {},
        $ERROR_CODES: {
            ...n,
            ...w
        }
    };
};
;
}}),
"[project]/node_modules/better-auth/dist/adapters/prisma.js [app-rsc] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, z: __turbopack_require_stub__ } = __turbopack_context__;
{
__turbopack_esm__({
    "prismaAdapter": (()=>Ar)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/better-call/dist/index.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$random$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/@better-auth/utils/dist/random.mjs [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hash$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/@better-auth/utils/dist/hash.mjs [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hex$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/@better-auth/utils/dist/hex.mjs [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/zod/lib/index.mjs [app-rsc] (ecmascript)");
;
;
var W = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
    id: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    providerId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    accountId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    userId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    accessToken: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().nullish(),
    refreshToken: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().nullish(),
    idToken: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().nullish(),
    accessTokenExpiresAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].date().nullish(),
    refreshTokenExpiresAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].date().nullish(),
    scope: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().nullish(),
    password: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().nullish(),
    createdAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].date().default(()=>new Date),
    updatedAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].date().default(()=>new Date)
}), J = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
    id: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    email: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().transform((e)=>e.toLowerCase()),
    emailVerified: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].boolean().default(!1),
    name: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    image: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().nullish(),
    createdAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].date().default(()=>new Date),
    updatedAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].date().default(()=>new Date)
}), G = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
    id: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    userId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    expiresAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].date(),
    createdAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].date().default(()=>new Date),
    updatedAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].date().default(()=>new Date),
    token: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    ipAddress: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().nullish(),
    userAgent: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().nullish()
}), z = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
    id: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    value: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    createdAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].date().default(()=>new Date),
    updatedAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].date().default(()=>new Date),
    expiresAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].date(),
    identifier: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string()
});
var T = Object.create(null), b = (e)=>globalThis.process?.env || globalThis.Deno?.env.toObject() || globalThis.__env__ || (e ? T : globalThis), I = new Proxy(T, {
    get (e, i) {
        return b()[i] ?? T[i];
    },
    has (e, i) {
        let u = b();
        return i in u || i in T;
    },
    set (e, i, u) {
        let c = b(!0);
        return c[i] = u, !0;
    },
    deleteProperty (e, i) {
        if (!i) return !1;
        let u = b(!0);
        return delete u[i], !0;
    },
    ownKeys () {
        let e = b(!0);
        return Object.keys(e);
    }
});
function D(e) {
    return e ? e !== "false" : !1;
}
var N = typeof process < "u" && process.env && ("TURBOPACK compile-time value", "development") || "";
var q = N === "test" || D(I.TEST);
;
var v = (e)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$random$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["createRandomStringGenerator"])("a-z", "A-Z", "0-9")(e || 32);
;
;
var A = class extends Error {
    constructor(i, u){
        super(i), this.name = "BetterAuthError", this.message = i, this.cause = u, this.stack = "";
    }
};
;
;
;
;
;
;
;
;
var B = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$random$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["createRandomStringGenerator"])("a-z", "0-9", "A-Z", "-_");
var R = [
    "info",
    "success",
    "warn",
    "error",
    "debug"
];
function L(e, i) {
    return R.indexOf(i) <= R.indexOf(e);
}
var h = {
    reset: "\x1B[0m",
    bright: "\x1B[1m",
    dim: "\x1B[2m",
    underscore: "\x1B[4m",
    blink: "\x1B[5m",
    reverse: "\x1B[7m",
    hidden: "\x1B[8m",
    fg: {
        black: "\x1B[30m",
        red: "\x1B[31m",
        green: "\x1B[32m",
        yellow: "\x1B[33m",
        blue: "\x1B[34m",
        magenta: "\x1B[35m",
        cyan: "\x1B[36m",
        white: "\x1B[37m"
    },
    bg: {
        black: "\x1B[40m",
        red: "\x1B[41m",
        green: "\x1B[42m",
        yellow: "\x1B[43m",
        blue: "\x1B[44m",
        magenta: "\x1B[45m",
        cyan: "\x1B[46m",
        white: "\x1B[47m"
    }
}, P = {
    info: h.fg.blue,
    success: h.fg.green,
    warn: h.fg.yellow,
    error: h.fg.red,
    debug: h.fg.magenta
}, E = (e, i)=>{
    let u = new Date().toISOString();
    return `${h.dim}${u}${h.reset} ${P[e]}${e.toUpperCase()}${h.reset} ${h.bright}[Better Auth]:${h.reset} ${i}`;
}, O = (e)=>{
    let i = e?.disabled !== !0, u = e?.level ?? "error", c = (l, y, f = [])=>{
        if (!i || !L(u, l)) return;
        let a = E(l, y);
        if (!e || typeof e.log != "function") {
            l === "error" ? console.error(a, ...f) : l === "warn" ? console.warn(a, ...f) : console.log(a, ...f);
            return;
        }
        e.log(l === "success" ? "info" : l, a, ...f);
    };
    return Object.fromEntries(R.map((l)=>[
            l,
            (...[y, ...f])=>c(l, y, f)
        ]));
}, M = O();
var w = (e)=>{
    let i = e.plugins?.reduce((s, p)=>{
        let d = p.schema;
        if (!d) return s;
        for (let [t, o] of Object.entries(d))s[t] = {
            fields: {
                ...s[t]?.fields,
                ...o.fields
            },
            modelName: o.modelName || t
        };
        return s;
    }, {}), u = e.rateLimit?.storage === "database", c = {
        rateLimit: {
            modelName: e.rateLimit?.modelName || "rateLimit",
            fields: {
                key: {
                    type: "string",
                    fieldName: e.rateLimit?.fields?.key || "key"
                },
                count: {
                    type: "number",
                    fieldName: e.rateLimit?.fields?.count || "count"
                },
                lastRequest: {
                    type: "number",
                    fieldName: e.rateLimit?.fields?.lastRequest || "lastRequest"
                }
            }
        }
    }, { user: l, session: y, account: f, ...a } = i || {};
    return {
        user: {
            modelName: e.user?.modelName || "user",
            fields: {
                name: {
                    type: "string",
                    required: !0,
                    fieldName: e.user?.fields?.name || "name"
                },
                email: {
                    type: "string",
                    unique: !0,
                    required: !0,
                    fieldName: e.user?.fields?.email || "email"
                },
                emailVerified: {
                    type: "boolean",
                    defaultValue: ()=>!1,
                    required: !0,
                    fieldName: e.user?.fields?.emailVerified || "emailVerified"
                },
                image: {
                    type: "string",
                    required: !1,
                    fieldName: e.user?.fields?.image || "image"
                },
                createdAt: {
                    type: "date",
                    defaultValue: ()=>new Date,
                    required: !0,
                    fieldName: e.user?.fields?.createdAt || "createdAt"
                },
                updatedAt: {
                    type: "date",
                    defaultValue: ()=>new Date,
                    required: !0,
                    fieldName: e.user?.fields?.updatedAt || "updatedAt"
                },
                ...l?.fields,
                ...e.user?.additionalFields
            },
            order: 1
        },
        session: {
            modelName: e.session?.modelName || "session",
            fields: {
                expiresAt: {
                    type: "date",
                    required: !0,
                    fieldName: e.session?.fields?.expiresAt || "expiresAt"
                },
                token: {
                    type: "string",
                    required: !0,
                    fieldName: e.session?.fields?.token || "token",
                    unique: !0
                },
                createdAt: {
                    type: "date",
                    required: !0,
                    fieldName: e.session?.fields?.createdAt || "createdAt"
                },
                updatedAt: {
                    type: "date",
                    required: !0,
                    fieldName: e.session?.fields?.updatedAt || "updatedAt"
                },
                ipAddress: {
                    type: "string",
                    required: !1,
                    fieldName: e.session?.fields?.ipAddress || "ipAddress"
                },
                userAgent: {
                    type: "string",
                    required: !1,
                    fieldName: e.session?.fields?.userAgent || "userAgent"
                },
                userId: {
                    type: "string",
                    fieldName: e.session?.fields?.userId || "userId",
                    references: {
                        model: e.user?.modelName || "user",
                        field: "id",
                        onDelete: "cascade"
                    },
                    required: !0
                },
                ...y?.fields,
                ...e.session?.additionalFields
            },
            order: 2
        },
        account: {
            modelName: e.account?.modelName || "account",
            fields: {
                accountId: {
                    type: "string",
                    required: !0,
                    fieldName: e.account?.fields?.accountId || "accountId"
                },
                providerId: {
                    type: "string",
                    required: !0,
                    fieldName: e.account?.fields?.providerId || "providerId"
                },
                userId: {
                    type: "string",
                    references: {
                        model: e.user?.modelName || "user",
                        field: "id",
                        onDelete: "cascade"
                    },
                    required: !0,
                    fieldName: e.account?.fields?.userId || "userId"
                },
                accessToken: {
                    type: "string",
                    required: !1,
                    fieldName: e.account?.fields?.accessToken || "accessToken"
                },
                refreshToken: {
                    type: "string",
                    required: !1,
                    fieldName: e.account?.fields?.refreshToken || "refreshToken"
                },
                idToken: {
                    type: "string",
                    required: !1,
                    fieldName: e.account?.fields?.idToken || "idToken"
                },
                accessTokenExpiresAt: {
                    type: "date",
                    required: !1,
                    fieldName: e.account?.fields?.accessTokenExpiresAt || "accessTokenExpiresAt"
                },
                refreshTokenExpiresAt: {
                    type: "date",
                    required: !1,
                    fieldName: e.account?.fields?.accessTokenExpiresAt || "refreshTokenExpiresAt"
                },
                scope: {
                    type: "string",
                    required: !1,
                    fieldName: e.account?.fields?.scope || "scope"
                },
                password: {
                    type: "string",
                    required: !1,
                    fieldName: e.account?.fields?.password || "password"
                },
                createdAt: {
                    type: "date",
                    required: !0,
                    fieldName: e.account?.fields?.createdAt || "createdAt"
                },
                updatedAt: {
                    type: "date",
                    required: !0,
                    fieldName: e.account?.fields?.updatedAt || "updatedAt"
                },
                ...f?.fields
            },
            order: 3
        },
        verification: {
            modelName: e.verification?.modelName || "verification",
            fields: {
                identifier: {
                    type: "string",
                    required: !0,
                    fieldName: e.verification?.fields?.identifier || "identifier"
                },
                value: {
                    type: "string",
                    required: !0,
                    fieldName: e.verification?.fields?.value || "value"
                },
                expiresAt: {
                    type: "date",
                    required: !0,
                    fieldName: e.verification?.fields?.expiresAt || "expiresAt"
                },
                createdAt: {
                    type: "date",
                    required: !1,
                    defaultValue: ()=>new Date,
                    fieldName: e.verification?.fields?.createdAt || "createdAt"
                },
                updatedAt: {
                    type: "date",
                    required: !1,
                    defaultValue: ()=>new Date,
                    fieldName: e.verification?.fields?.updatedAt || "updatedAt"
                }
            },
            order: 4
        },
        ...a,
        ...u ? c : {}
    };
};
;
;
;
function k(e, i, u) {
    return u === "update" ? e : e == null && i.defaultValue ? typeof i.defaultValue == "function" ? i.defaultValue() : i.defaultValue : e;
}
var C = (e, i)=>{
    let u = w(i);
    function c(a, s) {
        return s === "id" ? s : u[a].fields[s].fieldName || s;
    }
    function l(a) {
        switch(a){
            case "starts_with":
                return "startsWith";
            case "ends_with":
                return "endsWith";
            default:
                return a;
        }
    }
    function y(a) {
        return u[a].modelName;
    }
    let f = i?.advanced?.generateId === !1;
    return {
        transformInput (a, s, p) {
            let d = f || p === "update" ? {} : {
                id: i.advanced?.generateId ? i.advanced.generateId({
                    model: s
                }) : a.id || v()
            }, t = u[s].fields;
            for(let o in t){
                let r = a[o];
                r === void 0 && (!t[o].defaultValue || p === "update") || (d[t[o].fieldName || o] = k(r, t[o], p));
            }
            return d;
        },
        transformOutput (a, s, p = []) {
            if (!a) return null;
            let d = a.id || a._id ? p.length === 0 || p.includes("id") ? {
                id: a.id
            } : {} : {}, t = u[s].fields;
            for(let o in t){
                if (p.length && !p.includes(o)) continue;
                let r = t[o];
                r && (d[o] = a[r.fieldName || o]);
            }
            return d;
        },
        convertWhereClause (a, s) {
            if (!s) return {};
            if (s.length === 1) {
                let r = s[0];
                return r ? {
                    [c(a, r.field)]: r.operator === "eq" || !r.operator ? r.value : {
                        [l(r.operator)]: r.value
                    }
                } : void 0;
            }
            let p = s.filter((r)=>r.connector === "AND" || !r.connector), d = s.filter((r)=>r.connector === "OR"), t = p.map((r)=>({
                    [c(a, r.field)]: r.operator === "eq" || !r.operator ? r.value : {
                        [l(r.operator)]: r.value
                    }
                })), o = d.map((r)=>({
                    [c(a, r.field)]: {
                        [r.operator || "eq"]: r.value
                    }
                }));
            return {
                ...t.length ? {
                    AND: t
                } : {},
                ...o.length ? {
                    OR: o
                } : {}
            };
        },
        convertSelect: (a, s)=>{
            if (!(!a || !s)) return a.reduce((p, d)=>({
                    ...p,
                    [c(s, d)]: !0
                }), {});
        },
        getModelName: y,
        getField: c
    };
}, Ar = (e, i)=>(u)=>{
        let c = e, { transformInput: l, transformOutput: y, convertWhereClause: f, convertSelect: a, getModelName: s, getField: p } = C(i, u);
        return {
            id: "prisma",
            async create (d) {
                let { model: t, data: o, select: r } = d, m = l(o, t, "create");
                if (!c[s(t)]) throw new A(`Model ${t} does not exist in the database. If you haven't generated the Prisma client, you need to run 'npx prisma generate'`);
                let g = await c[s(t)].create({
                    data: m,
                    select: a(r, t)
                });
                return y(g, t, r);
            },
            async findOne (d) {
                let { model: t, where: o, select: r } = d, m = f(t, o);
                if (!c[s(t)]) throw new A(`Model ${t} does not exist in the database. If you haven't generated the Prisma client, you need to run 'npx prisma generate'`);
                let g = await c[s(t)].findFirst({
                    where: m,
                    select: a(r, t)
                });
                return y(g, t, r);
            },
            async findMany (d) {
                let { model: t, where: o, limit: r, offset: m, sortBy: g } = d, x = f(t, o);
                if (!c[s(t)]) throw new A(`Model ${t} does not exist in the database. If you haven't generated the Prisma client, you need to run 'npx prisma generate'`);
                return (await c[s(t)].findMany({
                    where: x,
                    take: r || 100,
                    skip: m || 0,
                    ...g?.field ? {
                        orderBy: {
                            [p(t, g.field)]: g.direction === "desc" ? "desc" : "asc"
                        }
                    } : {}
                })).map((F)=>y(F, t));
            },
            async update (d) {
                let { model: t, where: o, update: r } = d;
                if (!c[s(t)]) throw new A(`Model ${t} does not exist in the database. If you haven't generated the Prisma client, you need to run 'npx prisma generate'`);
                let m = f(t, o), g = l(r, t, "update"), x = await c[s(t)].update({
                    where: m,
                    data: g
                });
                return y(x, t);
            },
            async updateMany (d) {
                let { model: t, where: o, update: r } = d, m = f(t, o), g = l(r, t, "update"), x = await c[s(t)].updateMany({
                    where: m,
                    data: g
                });
                return x ? x.count : 0;
            },
            async delete (d) {
                let { model: t, where: o } = d, r = f(t, o);
                try {
                    await c[s(t)].delete({
                        where: r
                    });
                } catch  {}
            },
            async deleteMany (d) {
                let { model: t, where: o } = d, r = f(t, o), m = await c[s(t)].deleteMany({
                    where: r
                });
                return m ? m.count : 0;
            },
            options: i
        };
    };
;
}}),
"[project]/node_modules/better-auth/dist/plugins.js [app-rsc] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, z: __turbopack_require_stub__ } = __turbopack_context__;
{
__turbopack_esm__({
    "HIDE_METADATA": (()=>ke),
    "admin": (()=>qK),
    "anonymous": (()=>UK),
    "bearer": (()=>nK),
    "createAuthEndpoint": (()=>u),
    "createAuthMiddleware": (()=>N),
    "customSession": (()=>qm),
    "emailOTP": (()=>Em),
    "genericOAuth": (()=>om),
    "jwt": (()=>pm),
    "magicLink": (()=>pK),
    "multiSession": (()=>hm),
    "oAuthProxy": (()=>Bm),
    "oidcProvider": (()=>Uf),
    "oneTap": (()=>Pm),
    "openAPI": (()=>lf),
    "optionsMiddleware": (()=>Zo),
    "organization": (()=>Sl),
    "phoneNumber": (()=>TK),
    "twoFactor": (()=>Vp),
    "twoFactorClient": (()=>Tp),
    "username": (()=>Et)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/better-call/dist/index.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$base64$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/@better-auth/utils/dist/base64.mjs [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hmac$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/@better-auth/utils/dist/hmac.mjs [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hash$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/@better-auth/utils/dist/hash.mjs [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hex$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/@better-auth/utils/dist/hex.mjs [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$random$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/@better-auth/utils/dist/random.mjs [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$binary$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/@better-auth/utils/dist/binary.mjs [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$defu$2f$dist$2f$defu$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/defu/dist/defu.mjs [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$otp$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/@better-auth/utils/dist/otp.mjs [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/zod/lib/index.mjs [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$node$2f$esm$2f$jwt$2f$sign$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/jose/dist/node/esm/jwt/sign.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$noble$2f$ciphers$2f$esm$2f$utils$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/@noble/ciphers/esm/utils.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$noble$2f$ciphers$2f$esm$2f$webcrypto$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/@noble/ciphers/esm/webcrypto.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$noble$2f$ciphers$2f$esm$2f$chacha$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/@noble/ciphers/esm/chacha.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$node$2f$esm$2f$util$2f$decode_protected_header$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/jose/dist/node/esm/util/decode_protected_header.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$node$2f$esm$2f$jwt$2f$verify$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/jose/dist/node/esm/jwt/verify.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$node$2f$esm$2f$util$2f$decode_jwt$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/jose/dist/node/esm/util/decode_jwt.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$node$2f$esm$2f$key$2f$import$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/jose/dist/node/esm/key/import.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$node$2f$esm$2f$key$2f$generate_key_pair$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/jose/dist/node/esm/key/generate_key_pair.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$node$2f$esm$2f$key$2f$export$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/jose/dist/node/esm/key/export.js [app-rsc] (ecmascript)");
;
;
;
var Zo = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["createMiddleware"])(async ()=>({})), N = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["createMiddlewareCreator"])({
    use: [
        Zo,
        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["createMiddleware"])(async ()=>({}))
    ]
}), u = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["createEndpointCreator"])({
    use: [
        Zo
    ]
});
;
;
var ae = class extends Error {
    constructor(o, r){
        super(o), this.name = "BetterAuthError", this.message = o, this.cause = r, this.stack = "";
    }
};
var L = (e, o = "ms")=>new Date(Date.now() + (o === "sec" ? e * 1e3 : e));
var to = Object.create(null), Ve = (e)=>globalThis.process?.env || globalThis.Deno?.env.toObject() || globalThis.__env__ || (e ? to : globalThis), fe = new Proxy(to, {
    get (e, o) {
        return Ve()[o] ?? to[o];
    },
    has (e, o) {
        let r = Ve();
        return o in r || o in to;
    },
    set (e, o, r) {
        let i = Ve(!0);
        return i[o] = r, !0;
    },
    deleteProperty (e, o) {
        if (!o) return !1;
        let r = Ve(!0);
        return delete r[o], !0;
    },
    ownKeys () {
        let e = Ve(!0);
        return Object.keys(e);
    }
});
function Ft(e) {
    return e ? e !== "false" : !1;
}
var bo = typeof process < "u" && process.env && ("TURBOPACK compile-time value", "development") || "";
var ro = bo === "dev" || bo === "development", Mt = bo === "test" || Ft(fe.TEST);
;
;
function Oe(e) {
    let o = new Map;
    return e.split(", ").forEach((i)=>{
        let t = i.split(";").map((p)=>p.trim()), [n, ...s] = t, [a, ...d] = n.split("="), A = d.join("=");
        if (!a || A === void 0) return;
        let c = {
            value: A
        };
        s.forEach((p)=>{
            let [l, ...K] = p.split("="), y = K.join("="), h = l.trim().toLowerCase();
            switch(h){
                case "max-age":
                    c["max-age"] = y ? parseInt(y.trim(), 10) : void 0;
                    break;
                case "expires":
                    c.expires = y ? new Date(y.trim()) : void 0;
                    break;
                case "domain":
                    c.domain = y ? y.trim() : void 0;
                    break;
                case "path":
                    c.path = y ? y.trim() : void 0;
                    break;
                case "secure":
                    c.secure = !0;
                    break;
                case "httponly":
                    c.httponly = !0;
                    break;
                case "samesite":
                    c.samesite = y ? y.trim().toLowerCase() : void 0;
                    break;
                default:
                    c[h] = y ? y.trim() : !0;
                    break;
            }
        }), o.set(a, c);
    }), o;
}
async function Oo(e, o) {
    if (e.context.options.session?.cookieCache?.enabled) {
        let i = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$base64$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["base64Url"].encode(JSON.stringify({
            session: o,
            expiresAt: L(e.context.authCookies.sessionData.options.maxAge || 60, "sec").getTime(),
            signature: await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hmac$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["createHMAC"])("SHA-256", "base64urlnopad").sign(e.context.secret, JSON.stringify(o))
        }), {
            padding: !1
        });
        if (i.length > 4093) throw new ae("Session data is too large to store in the cookie. Please disable session cookie caching or reduce the size of the session data");
        e.setCookie(e.context.authCookies.sessionData.name, i, e.context.authCookies.sessionData.options);
    }
}
async function b(e, o, r, i) {
    let t = e.context.authCookies.sessionToken.options, n = r ? void 0 : e.context.sessionConfig.expiresIn;
    await e.setSignedCookie(e.context.authCookies.sessionToken.name, o.session.token, e.context.secret, {
        ...t,
        maxAge: n,
        ...i
    }), r && await e.setSignedCookie(e.context.authCookies.dontRememberToken.name, "true", e.context.secret, e.context.authCookies.dontRememberToken.options), await Oo(e, o), e.context.setNewSession(o), e.context.options.secondaryStorage && await e.context.secondaryStorage?.set(o.session.token, JSON.stringify({
        user: o.user,
        session: o.session
    }), Math.floor((new Date(o.session.expiresAt).getTime() - Date.now()) / 1e3));
}
function G(e) {
    e.setCookie(e.context.authCookies.sessionToken.name, "", {
        ...e.context.authCookies.sessionToken.options,
        maxAge: 0
    }), e.setCookie(e.context.authCookies.sessionData.name, "", {
        ...e.context.authCookies.sessionData.options,
        maxAge: 0
    }), e.setCookie(e.context.authCookies.dontRememberToken.name, "", {
        ...e.context.authCookies.dontRememberToken.options,
        maxAge: 0
    });
}
function qe(e) {
    let o = e.split("; "), r = new Map;
    return o.forEach((i)=>{
        let [t, n] = i.split("=");
        r.set(t, n);
    }), r;
}
var Ht = Object.defineProperty, $t = Object.defineProperties, Zt = Object.getOwnPropertyDescriptors, Go = Object.getOwnPropertySymbols, Gt = Object.prototype.hasOwnProperty, Qt = Object.prototype.propertyIsEnumerable, Qo = (e, o, r)=>o in e ? Ht(e, o, {
        enumerable: !0,
        configurable: !0,
        writable: !0,
        value: r
    }) : e[o] = r, Ee = (e, o)=>{
    for(var r in o || (o = {}))Gt.call(o, r) && Qo(e, r, o[r]);
    if (Go) for (var r of Go(o))Qt.call(o, r) && Qo(e, r, o[r]);
    return e;
}, Re = (e, o)=>$t(e, Zt(o)), Wt = class extends Error {
    constructor(e, o, r){
        super(o || e.toString(), {
            cause: r
        }), this.status = e, this.statusText = o, this.error = r;
    }
}, Jt = async (e, o)=>{
    var r, i, t, n, s, a;
    let d = o || {}, A = {
        onRequest: [
            o?.onRequest
        ],
        onResponse: [
            o?.onResponse
        ],
        onSuccess: [
            o?.onSuccess
        ],
        onError: [
            o?.onError
        ],
        onRetry: [
            o?.onRetry
        ]
    };
    if (!o || !o?.plugins) return {
        url: e,
        options: d,
        hooks: A
    };
    for (let c of o?.plugins || []){
        if (c.init) {
            let p = await ((r = c.init) == null ? void 0 : r.call(c, e.toString(), o));
            d = p.options || d, e = p.url;
        }
        A.onRequest.push((i = c.hooks) == null ? void 0 : i.onRequest), A.onResponse.push((t = c.hooks) == null ? void 0 : t.onResponse), A.onSuccess.push((n = c.hooks) == null ? void 0 : n.onSuccess), A.onError.push((s = c.hooks) == null ? void 0 : s.onError), A.onRetry.push((a = c.hooks) == null ? void 0 : a.onRetry);
    }
    return {
        url: e,
        options: d,
        hooks: A
    };
}, Wo = class {
    constructor(e){
        this.options = e;
    }
    shouldAttemptRetry(e, o) {
        return this.options.shouldRetry ? Promise.resolve(e < this.options.attempts && this.options.shouldRetry(o)) : Promise.resolve(e < this.options.attempts);
    }
    getDelay() {
        return this.options.delay;
    }
}, Xt = class {
    constructor(e){
        this.options = e;
    }
    shouldAttemptRetry(e, o) {
        return this.options.shouldRetry ? Promise.resolve(e < this.options.attempts && this.options.shouldRetry(o)) : Promise.resolve(e < this.options.attempts);
    }
    getDelay(e) {
        return Math.min(this.options.maxDelay, this.options.baseDelay * 2 ** e);
    }
};
function Yt(e) {
    if (typeof e == "number") return new Wo({
        type: "linear",
        attempts: e,
        delay: 1e3
    });
    switch(e.type){
        case "linear":
            return new Wo(e);
        case "exponential":
            return new Xt(e);
        default:
            throw new Error("Invalid retry strategy");
    }
}
var er = (e)=>{
    let o = {}, r = (i)=>typeof i == "function" ? i() : i;
    if (e?.auth) {
        if (e.auth.type === "Bearer") {
            let i = r(e.auth.token);
            if (!i) return o;
            o.authorization = `Bearer ${i}`;
        } else if (e.auth.type === "Basic") {
            let i = r(e.auth.username), t = r(e.auth.password);
            if (!i || !t) return o;
            o.authorization = `Basic ${btoa(`${i}:${t}`)}`;
        } else if (e.auth.type === "Custom") {
            let i = r(e.auth.value);
            if (!i) return o;
            o.authorization = `${r(e.auth.prefix)} ${i}`;
        }
    }
    return o;
}, Yo = [
    "get",
    "post",
    "put",
    "patch",
    "delete"
];
var or = /^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;
function ir(e) {
    let o = e.headers.get("content-type"), r = new Set([
        "image/svg",
        "application/xml",
        "application/xhtml",
        "application/html"
    ]);
    if (!o) return "json";
    let i = o.split(";").shift() || "";
    return or.test(i) ? "json" : r.has(i) || i.startsWith("text/") ? "text" : "blob";
}
function tr(e) {
    try {
        return JSON.parse(e), !0;
    } catch  {
        return !1;
    }
}
function ei(e) {
    if (e === void 0) return !1;
    let o = typeof e;
    return o === "string" || o === "number" || o === "boolean" || o === null ? !0 : o !== "object" ? !1 : Array.isArray(e) ? !0 : e.buffer ? !1 : e.constructor && e.constructor.name === "Object" || typeof e.toJSON == "function";
}
function Jo(e) {
    try {
        return JSON.parse(e);
    } catch  {
        return e;
    }
}
function Xo(e) {
    return typeof e == "function";
}
function rr(e) {
    if (e?.customFetchImpl) return e.customFetchImpl;
    if (typeof globalThis < "u" && Xo(globalThis.fetch)) return globalThis.fetch;
    if ("undefined" < "u" && Xo(window.fetch)) return window.fetch;
    throw new Error("No fetch implementation found");
}
function nr(e) {
    let o = new Headers(e?.headers), r = er(e);
    for (let [i, t] of Object.entries(r || {}))o.set(i, t);
    if (!o.has("content-type")) {
        let i = sr(e?.body);
        i && o.set("content-type", i);
    }
    return o;
}
function sr(e) {
    return ei(e) ? "application/json" : null;
}
function ar(e) {
    if (!e?.body) return null;
    let o = new Headers(e?.headers);
    return ei(e.body) && !o.has("content-type") ? JSON.stringify(e.body) : e.body;
}
function dr(e, o) {
    var r;
    if (o?.method) return o.method.toUpperCase();
    if (e.startsWith("@")) {
        let i = (r = e.split("@")[1]) == null ? void 0 : r.split("/")[0];
        return Yo.includes(i) ? i.toUpperCase() : o?.body ? "POST" : "GET";
    }
    return o?.body ? "POST" : "GET";
}
function Ar(e, o) {
    let r;
    return !e?.signal && e?.timeout && (r = setTimeout(()=>o?.abort(), e?.timeout)), {
        abortTimeout: r,
        clearTimeout: ()=>{
            r && clearTimeout(r);
        }
    };
}
function cr(e, o) {
    let { baseURL: r, params: i, query: t } = o || {
        query: {},
        params: {},
        baseURL: ""
    }, n = e.startsWith("http") ? e.split("/").slice(0, 3).join("/") : r;
    if (!n) throw new TypeError(`Invalid URL ${e}. Are you passing in a relative URL but not setting the baseURL?`);
    if (e.startsWith("@")) {
        let p = e.toString().split("@")[1].split("/")[0];
        Yo.includes(p) && (e = e.replace(`@${p}/`, "/"));
    }
    n.endsWith("/") || (n += "/");
    let [s, a] = e.replace(n, "").split("?"), d = new URLSearchParams(a);
    for (let [p, l] of Object.entries(t || {}))d.set(p, String(l));
    if (i) if (Array.isArray(i)) {
        let p = s.split("/").filter((l)=>l.startsWith(":"));
        for (let [l, K] of p.entries()){
            let y = i[l];
            s = s.replace(K, y);
        }
    } else for (let [p, l] of Object.entries(i))s = s.replace(`:${p}`, String(l));
    s = s.split("/").map(encodeURIComponent).join("/"), s.startsWith("/") && (s = s.slice(1));
    let A = d.size > 0 ? `?${d}`.replace(/\+/g, "%20") : "";
    return new URL(`${s}${A}`, n);
}
var R = async (e, o)=>{
    var r, i, t, n, s, a, d, A;
    let { hooks: c, url: p, options: l } = await Jt(e, o), K = rr(l), y = new AbortController, h = (r = l.signal) != null ? r : y.signal, j = cr(p, l), x = ar(l), z = nr(l), g = dr(p, l), w = Re(Ee({}, l), {
        url: j,
        headers: z,
        body: x,
        method: g,
        signal: h
    });
    for (let P of c.onRequest)if (P) {
        let Z = await P(w);
        Z instanceof Object && (w = Z);
    }
    ("pipeTo" in w && typeof w.pipeTo == "function" || typeof ((i = o?.body) == null ? void 0 : i.pipe) == "function") && ("duplex" in w || (w.duplex = "half"));
    let { clearTimeout: U } = Ar(l, y), C = await K(w.url, w);
    U();
    let Te = {
        response: C,
        request: w
    };
    for (let P of c.onResponse)if (P) {
        let Z = await P(Re(Ee({}, Te), {
            response: (t = o?.hookOptions) != null && t.cloneResponse ? C.clone() : C
        }));
        Z instanceof Response ? C = Z : Z instanceof Object && (C = Z.response);
    }
    if (C.ok) {
        if (!(w.method !== "HEAD")) return {
            data: "",
            error: null
        };
        let Z = ir(C), te = {
            data: "",
            response: C,
            request: w
        };
        if (Z === "json" || Z === "text") {
            let se = await C.text(), xt = await ((n = w.jsonParser) != null ? n : Jo)(se);
            te.data = xt;
        } else te.data = await C[Z]();
        w?.output && w.output && !w.disableValidation && (te.data = w.output.parse(te.data));
        for (let se of c.onSuccess)se && await se(Re(Ee({}, te), {
            response: (s = o?.hookOptions) != null && s.cloneResponse ? C.clone() : C
        }));
        return o?.throw ? te.data : {
            data: te.data,
            error: null
        };
    }
    let wo = (a = o?.jsonParser) != null ? a : Jo, io = await C.text(), Me = tr(io) ? await wo(io) : {}, Co = {
        response: C,
        request: w,
        error: Re(Ee({}, Me), {
            status: C.status,
            statusText: C.statusText
        })
    };
    for (let P of c.onError)P && await P(Re(Ee({}, Co), {
        response: (d = o?.hookOptions) != null && d.cloneResponse ? C.clone() : C
    }));
    if (o?.retry) {
        let P = Yt(o.retry), Z = (A = o.retryAttempt) != null ? A : 0;
        if (await P.shouldAttemptRetry(Z, C)) {
            for (let se of c.onRetry)se && await se(Te);
            let te = P.getDelay(Z);
            return await new Promise((se)=>setTimeout(se, te)), await R(e, Re(Ee({}, o), {
                retryAttempt: Z + 1
            }));
        }
    }
    if (o?.throw) throw new Wt(C.status, C.statusText, Me);
    return {
        data: null,
        error: Re(Ee({}, Me), {
            status: C.status,
            statusText: C.statusText
        })
    };
};
;
;
;
;
async function oi(e) {
    let o = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hash$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["createHash"])("SHA-256").digest(e);
    return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$base64$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["base64Url"].encode(new Uint8Array(o), {
        padding: !1
    });
}
function no(e) {
    return {
        tokenType: e.token_type,
        accessToken: e.access_token,
        refreshToken: e.refresh_token,
        accessTokenExpiresAt: e.expires_in ? L(e.expires_in, "sec") : void 0,
        scopes: e?.scope ? typeof e.scope == "string" ? e.scope.split(" ") : e.scope : [],
        idToken: e.id_token
    };
}
async function D({ id: e, options: o, authorizationEndpoint: r, state: i, codeVerifier: t, scopes: n, claims: s, redirectURI: a, duration: d }) {
    let A = new URL(r);
    if (A.searchParams.set("response_type", "code"), A.searchParams.set("client_id", o.clientId), A.searchParams.set("state", i), A.searchParams.set("scope", n.join(" ")), A.searchParams.set("redirect_uri", o.redirectURI || a), t) {
        let c = await oi(t);
        A.searchParams.set("code_challenge_method", "S256"), A.searchParams.set("code_challenge", c);
    }
    if (s) {
        let c = s.reduce((p, l)=>(p[l] = null, p), {});
        A.searchParams.set("claims", JSON.stringify({
            id_token: {
                email: null,
                email_verified: null,
                ...c
            }
        }));
    }
    return d && A.searchParams.set("duration", d), A;
}
;
async function S({ code: e, codeVerifier: o, redirectURI: r, options: i, tokenEndpoint: t, authentication: n }) {
    let s = new URLSearchParams, a = {
        "content-type": "application/x-www-form-urlencoded",
        accept: "application/json",
        "user-agent": "better-auth"
    };
    if (s.set("grant_type", "authorization_code"), s.set("code", e), o && s.set("code_verifier", o), s.set("redirect_uri", r), n === "basic") {
        let p = btoa(`${i.clientId}:${i.clientSecret}`);
        a.authorization = `Basic ${p}`;
    } else s.set("client_id", i.clientId), s.set("client_secret", i.clientSecret);
    let { data: d, error: A } = await R(t, {
        method: "POST",
        body: s,
        headers: a
    });
    if (A) throw A;
    return no(d);
}
;
;
function Ue(e) {
    try {
        return new URL(e).origin;
    } catch  {
        return null;
    }
}
function ii(e) {
    return e.includes("://") ? new URL(e).host : e;
}
;
;
;
;
;
;
;
;
var _ = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$random$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["createRandomStringGenerator"])("a-z", "0-9", "A-Z", "-_");
var le = async ({ key: e, data: o })=>{
    let r = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hash$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["createHash"])("SHA-256").digest(e), i = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$noble$2f$ciphers$2f$esm$2f$utils$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["utf8ToBytes"])(o), t = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$noble$2f$ciphers$2f$esm$2f$webcrypto$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["managedNonce"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$noble$2f$ciphers$2f$esm$2f$chacha$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["xchacha20poly1305"])(new Uint8Array(r));
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$noble$2f$ciphers$2f$esm$2f$utils$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["bytesToHex"])(t.encrypt(i));
}, he = async ({ key: e, data: o })=>{
    let r = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hash$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["createHash"])("SHA-256").digest(e), i = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$noble$2f$ciphers$2f$esm$2f$utils$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["hexToBytes"])(o), t = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$noble$2f$ciphers$2f$esm$2f$webcrypto$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["managedNonce"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$noble$2f$ciphers$2f$esm$2f$chacha$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["xchacha20poly1305"])(new Uint8Array(r));
    return new TextDecoder().decode(t.decrypt(i));
};
async function Se(e, o) {
    let r = e.body?.callbackURL || (e.query?.currentURL ? Ue(e.query?.currentURL) : "") || e.context.options.baseURL;
    if (!r) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: "callbackURL is required"
    });
    let i = _(128), t = _(32), n = JSON.stringify({
        callbackURL: r,
        codeVerifier: i,
        errorURL: e.body?.errorCallbackURL || e.query?.currentURL,
        newUserURL: e.body?.newUserCallbackURL,
        link: o,
        expiresAt: Date.now() + 10 * 60 * 1e3
    }), s = new Date;
    s.setMinutes(s.getMinutes() + 10);
    let a = await e.context.internalAdapter.createVerificationValue({
        value: n,
        identifier: t,
        expiresAt: s
    });
    if (!a) throw e.context.logger.error("Unable to create verification. Make sure the database adapter is properly working and there is a verification table in the database"), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("INTERNAL_SERVER_ERROR", {
        message: "Unable to create verification"
    });
    return {
        state: a.identifier,
        codeVerifier: i
    };
}
async function so(e) {
    let o = e.query.state || e.body.state, r = await e.context.internalAdapter.findVerificationValue(o);
    if (!r) throw e.context.logger.error("State Mismatch. Verification not found", {
        state: o
    }), e.redirect(`${e.context.baseURL}/error?error=please_restart_the_process`);
    let i = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        callbackURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
        codeVerifier: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
        errorURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional(),
        newUserURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional(),
        expiresAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].number(),
        link: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
            email: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
            userId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string()
        }).optional()
    }).parse(JSON.parse(r.value));
    if (i.errorURL || (i.errorURL = `${e.context.baseURL}/error`), i.expiresAt < Date.now()) throw await e.context.internalAdapter.deleteVerificationValue(r.id), e.context.logger.error("State expired.", {
        state: o
    }), e.redirect(`${e.context.baseURL}/error?error=please_restart_the_process`);
    return await e.context.internalAdapter.deleteVerificationValue(r.id), i;
}
var ai = (e)=>{
    let o = "https://appleid.apple.com/auth/token";
    return {
        id: "apple",
        name: "Apple",
        createAuthorizationURL ({ state: r, scopes: i, redirectURI: t }) {
            let n = i || [
                "email",
                "name"
            ];
            return e.scope && n.push(...e.scope), new URL(`https://appleid.apple.com/auth/authorize?client_id=${e.clientId}&response_type=code&redirect_uri=${e.redirectURI || t}&scope=${n.join(" ")}&state=${r}&response_mode=form_post`);
        },
        validateAuthorizationCode: async ({ code: r, codeVerifier: i, redirectURI: t })=>S({
                code: r,
                codeVerifier: i,
                redirectURI: e.redirectURI || t,
                options: e,
                tokenEndpoint: o
            }),
        async verifyIdToken (r, i) {
            if (e.disableIdTokenSignIn) return !1;
            if (e.verifyIdToken) return e.verifyIdToken(r, i);
            let t = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$node$2f$esm$2f$util$2f$decode_protected_header$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["decodeProtectedHeader"])(r), { kid: n, alg: s } = t;
            if (!n || !s) return !1;
            let a = await br(n), { payload: d } = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$node$2f$esm$2f$jwt$2f$verify$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["jwtVerify"])(r, a, {
                algorithms: [
                    s
                ],
                issuer: "https://appleid.apple.com",
                audience: e.appBundleIdentifier || e.clientId,
                maxTokenAge: "1h"
            });
            return [
                "email_verified",
                "is_private_email"
            ].forEach((A)=>{
                d[A] !== void 0 && (d[A] = !!d[A]);
            }), i && d.nonce !== i ? !1 : !!d;
        },
        async getUserInfo (r) {
            if (e.getUserInfo) return e.getUserInfo(r);
            if (!r.idToken) return null;
            let i = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$node$2f$esm$2f$util$2f$decode_jwt$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["decodeJwt"])(r.idToken);
            if (!i) return null;
            let t = i.user ? `${i.user.name.firstName} ${i.user.name.lastName}` : i.email, n = await e.mapProfileToUser?.(i);
            return {
                user: {
                    id: i.sub,
                    name: t,
                    emailVerified: !1,
                    email: i.email,
                    ...n
                },
                data: i
            };
        }
    };
}, br = async (e)=>{
    let o = "https://appleid.apple.com", r = "/auth/keys", { data: i } = await R(`${o}${r}`);
    if (!i?.keys) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: "Keys not found"
    });
    let t = i.keys.find((n)=>n.kid === e);
    if (!t) throw new Error(`JWK with kid ${e} not found`);
    return await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$node$2f$esm$2f$key$2f$import$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["importJWK"])(t, t.alg);
};
var di = (e)=>({
        id: "discord",
        name: "Discord",
        createAuthorizationURL ({ state: o, scopes: r, redirectURI: i }) {
            let t = r || [
                "identify",
                "email"
            ];
            return e.scope && t.push(...e.scope), new URL(`https://discord.com/api/oauth2/authorize?scope=${t.join("+")}&response_type=code&client_id=${e.clientId}&redirect_uri=${encodeURIComponent(e.redirectURI || i)}&state=${o}&prompt=${e.prompt || "none"}`);
        },
        validateAuthorizationCode: async ({ code: o, redirectURI: r })=>S({
                code: o,
                redirectURI: e.redirectURI || r,
                options: e,
                tokenEndpoint: "https://discord.com/api/oauth2/token"
            }),
        async getUserInfo (o) {
            if (e.getUserInfo) return e.getUserInfo(o);
            let { data: r, error: i } = await R("https://discord.com/api/users/@me", {
                headers: {
                    authorization: `Bearer ${o.accessToken}`
                }
            });
            if (i) return null;
            if (r.avatar === null) {
                let n = r.discriminator === "0" ? Number(BigInt(r.id) >> BigInt(22)) % 6 : parseInt(r.discriminator) % 5;
                r.image_url = `https://cdn.discordapp.com/embed/avatars/${n}.png`;
            } else {
                let n = r.avatar.startsWith("a_") ? "gif" : "png";
                r.image_url = `https://cdn.discordapp.com/avatars/${r.id}/${r.avatar}.${n}`;
            }
            let t = await e.mapProfileToUser?.(r);
            return {
                user: {
                    id: r.id,
                    name: r.display_name || r.username || "",
                    email: r.email,
                    emailVerified: r.verified,
                    image: r.image_url,
                    ...t
                },
                data: r
            };
        }
    });
var Ai = (e)=>({
        id: "facebook",
        name: "Facebook",
        async createAuthorizationURL ({ state: o, scopes: r, redirectURI: i }) {
            let t = r || [
                "email",
                "public_profile"
            ];
            return e.scope && t.push(...e.scope), await D({
                id: "facebook",
                options: e,
                authorizationEndpoint: "https://www.facebook.com/v21.0/dialog/oauth",
                scopes: t,
                state: o,
                redirectURI: i
            });
        },
        validateAuthorizationCode: async ({ code: o, redirectURI: r })=>S({
                code: o,
                redirectURI: e.redirectURI || r,
                options: e,
                tokenEndpoint: "https://graph.facebook.com/oauth/access_token"
            }),
        async getUserInfo (o) {
            if (e.getUserInfo) return e.getUserInfo(o);
            let { data: r, error: i } = await R("https://graph.facebook.com/me?fields=id,name,email,picture", {
                auth: {
                    type: "Bearer",
                    token: o.accessToken
                }
            });
            if (i) return null;
            let t = await e.mapProfileToUser?.(r);
            return {
                user: {
                    id: r.id,
                    name: r.name,
                    email: r.email,
                    image: r.picture.data.url,
                    emailVerified: r.email_verified,
                    ...t
                },
                data: r
            };
        }
    });
var ci = (e)=>{
    let o = "https://github.com/login/oauth/access_token";
    return {
        id: "github",
        name: "GitHub",
        createAuthorizationURL ({ state: r, scopes: i, codeVerifier: t, redirectURI: n }) {
            let s = i || [
                "user:email"
            ];
            return e.scope && s.push(...e.scope), D({
                id: "github",
                options: e,
                authorizationEndpoint: "https://github.com/login/oauth/authorize",
                scopes: s,
                state: r,
                redirectURI: n
            });
        },
        validateAuthorizationCode: async ({ code: r, redirectURI: i })=>S({
                code: r,
                redirectURI: e.redirectURI || i,
                options: e,
                tokenEndpoint: o
            }),
        async getUserInfo (r) {
            if (e.getUserInfo) return e.getUserInfo(r);
            let { data: i, error: t } = await R("https://api.github.com/user", {
                headers: {
                    "User-Agent": "better-auth",
                    authorization: `Bearer ${r.accessToken}`
                }
            });
            if (t) return null;
            let n = !1, { data: s } = await R("https://api.github.com/user/emails", {
                headers: {
                    authorization: `Bearer ${r.accessToken}`,
                    "User-Agent": "better-auth"
                }
            });
            s && (i.email = (s.find((d)=>d.primary) ?? s[0])?.email, n = s.find((d)=>d.email === i.email)?.verified ?? !1);
            let a = await e.mapProfileToUser?.(i);
            return {
                user: {
                    id: i.id.toString(),
                    name: i.name || i.login,
                    email: i.email,
                    image: i.avatar_url,
                    emailVerified: n,
                    ...a
                },
                data: i
            };
        }
    };
};
var To = [
    "info",
    "success",
    "warn",
    "error",
    "debug"
];
function Or(e, o) {
    return To.indexOf(o) <= To.indexOf(e);
}
var pe = {
    reset: "\x1B[0m",
    bright: "\x1B[1m",
    dim: "\x1B[2m",
    underscore: "\x1B[4m",
    blink: "\x1B[5m",
    reverse: "\x1B[7m",
    hidden: "\x1B[8m",
    fg: {
        black: "\x1B[30m",
        red: "\x1B[31m",
        green: "\x1B[32m",
        yellow: "\x1B[33m",
        blue: "\x1B[34m",
        magenta: "\x1B[35m",
        cyan: "\x1B[36m",
        white: "\x1B[37m"
    },
    bg: {
        black: "\x1B[40m",
        red: "\x1B[41m",
        green: "\x1B[42m",
        yellow: "\x1B[43m",
        blue: "\x1B[44m",
        magenta: "\x1B[45m",
        cyan: "\x1B[46m",
        white: "\x1B[47m"
    }
}, Tr = {
    info: pe.fg.blue,
    success: pe.fg.green,
    warn: pe.fg.yellow,
    error: pe.fg.red,
    debug: pe.fg.magenta
}, Er = (e, o)=>{
    let r = new Date().toISOString();
    return `${pe.dim}${r}${pe.reset} ${Tr[e]}${e.toUpperCase()}${pe.reset} ${pe.bright}[Better Auth]:${pe.reset} ${o}`;
}, ui = (e)=>{
    let o = e?.disabled !== !0, r = e?.level ?? "error", i = (t, n, s = [])=>{
        if (!o || !Or(r, t)) return;
        let a = Er(t, n);
        if (!e || typeof e.log != "function") {
            t === "error" ? console.error(a, ...s) : t === "warn" ? console.warn(a, ...s) : console.log(a, ...s);
            return;
        }
        e.log(t === "success" ? "info" : t, a, ...s);
    };
    return Object.fromEntries(To.map((t)=>[
            t,
            (...[n, ...s])=>i(t, n, s)
        ]));
}, re = ui();
;
var li = (e)=>({
        id: "google",
        name: "Google",
        async createAuthorizationURL ({ state: o, scopes: r, codeVerifier: i, redirectURI: t }) {
            if (!e.clientId || !e.clientSecret) throw re.error("Client Id and Client Secret is required for Google. Make sure to provide them in the options."), new ae("CLIENT_ID_AND_SECRET_REQUIRED");
            if (!i) throw new ae("codeVerifier is required for Google");
            let n = r || [
                "email",
                "profile",
                "openid"
            ];
            e.scope && n.push(...e.scope);
            let s = await D({
                id: "google",
                options: e,
                authorizationEndpoint: "https://accounts.google.com/o/oauth2/auth",
                scopes: n,
                state: o,
                codeVerifier: i,
                redirectURI: t
            });
            return e.accessType && s.searchParams.set("access_type", e.accessType), e.prompt && s.searchParams.set("prompt", e.prompt), s;
        },
        validateAuthorizationCode: async ({ code: o, codeVerifier: r, redirectURI: i })=>S({
                code: o,
                codeVerifier: r,
                redirectURI: e.redirectURI || i,
                options: e,
                tokenEndpoint: "https://oauth2.googleapis.com/token"
            }),
        async verifyIdToken (o, r) {
            if (e.disableIdTokenSignIn) return !1;
            if (e.verifyIdToken) return e.verifyIdToken(o, r);
            let i = `https://www.googleapis.com/oauth2/v3/tokeninfo?id_token=${o}`, { data: t } = await R(i);
            return t ? t.aud === e.clientId && t.iss === "https://accounts.google.com" : !1;
        },
        async getUserInfo (o) {
            if (e.getUserInfo) return e.getUserInfo(o);
            if (!o.idToken) return null;
            let r = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$node$2f$esm$2f$util$2f$decode_jwt$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["decodeJwt"])(o.idToken), i = await e.mapProfileToUser?.(r);
            return {
                user: {
                    id: r.sub,
                    name: r.name,
                    email: r.email,
                    image: r.picture,
                    emailVerified: r.email_verified,
                    ...i
                },
                data: r
            };
        }
    });
;
var pi = (e)=>{
    let o = e.tenantId || "common", r = `https://login.microsoftonline.com/${o}/oauth2/v2.0/authorize`, i = `https://login.microsoftonline.com/${o}/oauth2/v2.0/token`;
    return {
        id: "microsoft",
        name: "Microsoft EntraID",
        createAuthorizationURL (t) {
            let n = t.scopes || [
                "openid",
                "profile",
                "email",
                "User.Read"
            ];
            return e.scope && n.push(...e.scope), D({
                id: "microsoft",
                options: e,
                authorizationEndpoint: r,
                state: t.state,
                codeVerifier: t.codeVerifier,
                scopes: n,
                redirectURI: t.redirectURI
            });
        },
        validateAuthorizationCode ({ code: t, codeVerifier: n, redirectURI: s }) {
            return S({
                code: t,
                codeVerifier: n,
                redirectURI: e.redirectURI || s,
                options: e,
                tokenEndpoint: i
            });
        },
        async getUserInfo (t) {
            if (e.getUserInfo) return e.getUserInfo(t);
            if (!t.idToken) return null;
            let n = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$node$2f$esm$2f$util$2f$decode_jwt$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["decodeJwt"])(t.idToken), s = e.profilePhotoSize || 48;
            await R(`https://graph.microsoft.com/v1.0/me/photos/${s}x${s}/$value`, {
                headers: {
                    Authorization: `Bearer ${t.accessToken}`
                },
                async onResponse (d) {
                    if (!(e.disableProfilePhoto || !d.response.ok)) try {
                        let c = await d.response.clone().arrayBuffer(), p = Buffer.from(c).toString("base64");
                        n.picture = `data:image/jpeg;base64, ${p}`;
                    } catch (A) {
                        re.error(A && typeof A == "object" && "name" in A ? A.name : "", A);
                    }
                }
            });
            let a = await e.mapProfileToUser?.(n);
            return {
                user: {
                    id: n.sub,
                    name: n.name,
                    email: n.email,
                    image: n.picture,
                    emailVerified: !0,
                    ...a
                },
                data: n
            };
        }
    };
};
var Ki = (e)=>({
        id: "spotify",
        name: "Spotify",
        createAuthorizationURL ({ state: o, scopes: r, codeVerifier: i, redirectURI: t }) {
            let n = r || [
                "user-read-email"
            ];
            return e.scope && n.push(...e.scope), D({
                id: "spotify",
                options: e,
                authorizationEndpoint: "https://accounts.spotify.com/authorize",
                scopes: n,
                state: o,
                codeVerifier: i,
                redirectURI: t
            });
        },
        validateAuthorizationCode: async ({ code: o, codeVerifier: r, redirectURI: i })=>S({
                code: o,
                codeVerifier: r,
                redirectURI: e.redirectURI || i,
                options: e,
                tokenEndpoint: "https://accounts.spotify.com/api/token"
            }),
        async getUserInfo (o) {
            if (e.getUserInfo) return e.getUserInfo(o);
            let { data: r, error: i } = await R("https://api.spotify.com/v1/me", {
                method: "GET",
                headers: {
                    Authorization: `Bearer ${o.accessToken}`
                }
            });
            if (i) return null;
            let t = await e.mapProfileToUser?.(r);
            return {
                user: {
                    id: r.id,
                    name: r.display_name,
                    email: r.email,
                    image: r.images[0]?.url,
                    emailVerified: !1,
                    ...t
                },
                data: r
            };
        }
    });
var ke = {
    isAction: !1
};
;
var ee = (e)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$random$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["createRandomStringGenerator"])("a-z", "A-Z", "0-9")(e || 32);
;
var mi = (e)=>({
        id: "twitch",
        name: "Twitch",
        createAuthorizationURL ({ state: o, scopes: r, redirectURI: i }) {
            let t = r || [
                "user:read:email",
                "openid"
            ];
            return e.scope && t.push(...e.scope), D({
                id: "twitch",
                redirectURI: i,
                options: e,
                authorizationEndpoint: "https://id.twitch.tv/oauth2/authorize",
                scopes: t,
                state: o,
                claims: e.claims || [
                    "email",
                    "email_verified",
                    "preferred_username",
                    "picture"
                ]
            });
        },
        validateAuthorizationCode: async ({ code: o, redirectURI: r })=>S({
                code: o,
                redirectURI: e.redirectURI || r,
                options: e,
                tokenEndpoint: "https://id.twitch.tv/oauth2/token"
            }),
        async getUserInfo (o) {
            if (e.getUserInfo) return e.getUserInfo(o);
            let r = o.idToken;
            if (!r) return re.error("No idToken found in token"), null;
            let i = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$node$2f$esm$2f$util$2f$decode_jwt$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["decodeJwt"])(r), t = await e.mapProfileToUser?.(i);
            return {
                user: {
                    id: i.sub,
                    name: i.preferred_username,
                    email: i.email,
                    image: i.picture,
                    emailVerified: !1,
                    ...t
                },
                data: i
            };
        }
    });
var gi = (e)=>({
        id: "twitter",
        name: "Twitter",
        createAuthorizationURL (o) {
            let r = o.scopes || [
                "users.read",
                "tweet.read",
                "offline.access"
            ];
            return e.scope && r.push(...e.scope), D({
                id: "twitter",
                options: e,
                authorizationEndpoint: "https://x.com/i/oauth2/authorize",
                scopes: r,
                state: o.state,
                codeVerifier: o.codeVerifier,
                redirectURI: o.redirectURI
            });
        },
        validateAuthorizationCode: async ({ code: o, codeVerifier: r, redirectURI: i })=>S({
                code: o,
                codeVerifier: r,
                authentication: "basic",
                redirectURI: e.redirectURI || i,
                options: e,
                tokenEndpoint: "https://api.x.com/2/oauth2/token"
            }),
        async getUserInfo (o) {
            if (e.getUserInfo) return e.getUserInfo(o);
            let { data: r, error: i } = await R("https://api.x.com/2/users/me?user.fields=profile_image_url", {
                method: "GET",
                headers: {
                    Authorization: `Bearer ${o.accessToken}`
                }
            });
            if (i) return null;
            let t = await e.mapProfileToUser?.(r);
            return {
                user: {
                    id: r.data.id,
                    name: r.data.name,
                    email: r.data.username || null,
                    image: r.data.profile_image_url,
                    emailVerified: r.data.verified || !1,
                    ...t
                },
                data: r
            };
        }
    });
var fi = (e)=>{
    let o = "https://api.dropboxapi.com/oauth2/token";
    return {
        id: "dropbox",
        name: "Dropbox",
        createAuthorizationURL: async ({ state: r, scopes: i, codeVerifier: t, redirectURI: n })=>{
            let s = i || [
                "account_info.read"
            ];
            return e.scope && s.push(...e.scope), await D({
                id: "dropbox",
                options: e,
                authorizationEndpoint: "https://www.dropbox.com/oauth2/authorize",
                scopes: s,
                state: r,
                redirectURI: n,
                codeVerifier: t
            });
        },
        validateAuthorizationCode: async ({ code: r, codeVerifier: i, redirectURI: t })=>await S({
                code: r,
                codeVerifier: i,
                redirectURI: e.redirectURI || t,
                options: e,
                tokenEndpoint: o
            }),
        async getUserInfo (r) {
            if (e.getUserInfo) return e.getUserInfo(r);
            let { data: i, error: t } = await R("https://api.dropboxapi.com/2/users/get_current_account", {
                method: "POST",
                headers: {
                    Authorization: `Bearer ${r.accessToken}`
                }
            });
            if (t) return null;
            let n = await e.mapProfileToUser?.(i);
            return {
                user: {
                    id: i.account_id,
                    name: i.name?.display_name,
                    email: i.email,
                    emailVerified: i.email_verified || !1,
                    image: i.profile_photo_url,
                    ...n
                },
                data: i
            };
        }
    };
};
var hi = (e)=>{
    let o = "https://www.linkedin.com/oauth/v2/authorization", r = "https://www.linkedin.com/oauth/v2/accessToken";
    return {
        id: "linkedin",
        name: "Linkedin",
        createAuthorizationURL: async ({ state: i, scopes: t, redirectURI: n })=>{
            let s = t || [
                "profile",
                "email",
                "openid"
            ];
            return e.scope && s.push(...e.scope), await D({
                id: "linkedin",
                options: e,
                authorizationEndpoint: o,
                scopes: s,
                state: i,
                redirectURI: n
            });
        },
        validateAuthorizationCode: async ({ code: i, redirectURI: t })=>await S({
                code: i,
                redirectURI: e.redirectURI || t,
                options: e,
                tokenEndpoint: r
            }),
        async getUserInfo (i) {
            let { data: t, error: n } = await R("https://api.linkedin.com/v2/userinfo", {
                method: "GET",
                headers: {
                    Authorization: `Bearer ${i.accessToken}`
                }
            });
            if (n) return null;
            let s = await e.mapProfileToUser?.(t);
            return {
                user: {
                    id: t.sub,
                    name: t.name,
                    email: t.email,
                    emailVerified: t.email_verified || !1,
                    image: t.picture,
                    ...s
                },
                data: t
            };
        }
    };
};
var Eo = (e = "")=>e.split("://").map((o)=>o.replace(/\/{2,}/g, "/")).join("://"), Ur = (e)=>{
    let o = e || "https://gitlab.com";
    return {
        authorizationEndpoint: Eo(`${o}/oauth/authorize`),
        tokenEndpoint: Eo(`${o}/oauth/token`),
        userinfoEndpoint: Eo(`${o}/api/v4/user`)
    };
}, yi = (e)=>{
    let { authorizationEndpoint: o, tokenEndpoint: r, userinfoEndpoint: i } = Ur(e.issuer), t = "gitlab";
    return {
        id: t,
        name: "Gitlab",
        createAuthorizationURL: async ({ state: s, scopes: a, codeVerifier: d, redirectURI: A })=>{
            let c = a || [
                "read_user"
            ];
            return e.scope && c.push(...e.scope), await D({
                id: t,
                options: e,
                authorizationEndpoint: o,
                scopes: c,
                state: s,
                redirectURI: A,
                codeVerifier: d
            });
        },
        validateAuthorizationCode: async ({ code: s, redirectURI: a, codeVerifier: d })=>S({
                code: s,
                redirectURI: e.redirectURI || a,
                options: e,
                codeVerifier: d,
                tokenEndpoint: r
            }),
        async getUserInfo (s) {
            if (e.getUserInfo) return e.getUserInfo(s);
            let { data: a, error: d } = await R(i, {
                headers: {
                    authorization: `Bearer ${s.accessToken}`
                }
            });
            if (d || a.state !== "active" || a.locked) return null;
            let A = await e.mapProfileToUser?.(a);
            return {
                user: {
                    id: a.id.toString(),
                    name: a.name ?? a.username,
                    email: a.email,
                    image: a.avatar_url,
                    emailVerified: !0,
                    ...A
                },
                data: a
            };
        }
    };
};
var wi = (e)=>({
        id: "reddit",
        name: "Reddit",
        createAuthorizationURL ({ state: o, scopes: r, redirectURI: i }) {
            let t = r || [
                "identity"
            ];
            return e.scope && t.push(...e.scope), D({
                id: "reddit",
                options: e,
                authorizationEndpoint: "https://www.reddit.com/api/v1/authorize",
                scopes: t,
                state: o,
                redirectURI: i,
                duration: e.duration
            });
        },
        validateAuthorizationCode: async ({ code: o, redirectURI: r })=>{
            let i = new URLSearchParams({
                grant_type: "authorization_code",
                code: o,
                redirect_uri: e.redirectURI || r
            }), t = {
                "content-type": "application/x-www-form-urlencoded",
                accept: "text/plain",
                "user-agent": "better-auth",
                Authorization: `Basic ${Buffer.from(`${e.clientId}:${e.clientSecret}`).toString("base64")}`
            }, { data: n, error: s } = await R("https://www.reddit.com/api/v1/access_token", {
                method: "POST",
                headers: t,
                body: i.toString()
            });
            if (s) throw s;
            return no(n);
        },
        async getUserInfo (o) {
            if (e.getUserInfo) return e.getUserInfo(o);
            let { data: r, error: i } = await R("https://oauth.reddit.com/api/v1/me", {
                headers: {
                    Authorization: `Bearer ${o.accessToken}`,
                    "User-Agent": "better-auth"
                }
            });
            if (i) return null;
            let t = await e.mapProfileToUser?.(r);
            return {
                user: {
                    id: r.id,
                    name: r.name,
                    email: r.oauth_client_id,
                    emailVerified: r.has_verified_email,
                    image: r.icon_img?.split("?")[0],
                    ...t
                },
                data: r
            };
        }
    });
;
var kr = {
    apple: ai,
    discord: di,
    facebook: Ai,
    github: ci,
    microsoft: pi,
    google: li,
    spotify: Ki,
    twitch: mi,
    twitter: gi,
    dropbox: fi,
    linkedin: hi,
    gitlab: yi,
    reddit: wi
}, Ro = Object.keys(kr), Ci = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].enum(Ro, {
    description: "OAuth2 provider to use"
});
;
;
;
;
function Io(e) {
    try {
        return JSON.parse(e);
    } catch  {
        return null;
    }
}
var f = {
    USER_NOT_FOUND: "User not found",
    FAILED_TO_CREATE_USER: "Failed to create user",
    FAILED_TO_CREATE_SESSION: "Failed to create session",
    FAILED_TO_UPDATE_USER: "Failed to update user",
    FAILED_TO_GET_SESSION: "Failed to get session",
    INVALID_PASSWORD: "Invalid password",
    INVALID_EMAIL: "Invalid email",
    INVALID_EMAIL_OR_PASSWORD: "Invalid email or password",
    SOCIAL_ACCOUNT_ALREADY_LINKED: "Social account already linked",
    PROVIDER_NOT_FOUND: "Provider not found",
    INVALID_TOKEN: "invalid token",
    ID_TOKEN_NOT_SUPPORTED: "id_token not supported",
    FAILED_TO_GET_USER_INFO: "Failed to get user info",
    USER_EMAIL_NOT_FOUND: "User email not found",
    EMAIL_NOT_VERIFIED: "Email not verified",
    PASSWORD_TOO_SHORT: "Password too short",
    PASSWORD_TOO_LONG: "Password too long",
    USER_ALREADY_EXISTS: "User already exists",
    EMAIL_CAN_NOT_BE_UPDATED: "Email can not be updated",
    CREDENTIAL_ACCOUNT_NOT_FOUND: "Credential account not found",
    SESSION_EXPIRED: "Session expired. Re-authenticate to perform this action."
};
;
;
;
var _o = ()=>u("/get-session", {
        method: "GET",
        query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].optional(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
            disableCookieCache: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].boolean({
                description: "Disable cookie cache and fetch session from database"
            }).or(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().transform((e)=>e === "true")).optional(),
            disableRefresh: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].boolean({
                description: "Disable session refresh. Useful for checking session status, without updating the session"
            }).optional()
        })),
        requireHeaders: !0,
        metadata: {
            openapi: {
                description: "Get the current session",
                responses: {
                    200: {
                        description: "Success",
                        content: {
                            "application/json": {
                                schema: {
                                    type: "object",
                                    properties: {
                                        session: {
                                            type: "object",
                                            properties: {
                                                token: {
                                                    type: "string"
                                                },
                                                userId: {
                                                    type: "string"
                                                },
                                                expiresAt: {
                                                    type: "string"
                                                }
                                            }
                                        },
                                        user: {
                                            type: "object",
                                            $ref: "#/components/schemas/User"
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }, async (e)=>{
        try {
            let o = await e.getSignedCookie(e.context.authCookies.sessionToken.name, e.context.secret);
            if (!o) return e.json(null);
            let r = e.getCookie(e.context.authCookies.sessionData.name), i = r ? Io(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$binary$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["binary"].decode(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$base64$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["base64"].decode(r))) : null;
            if (i && !await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hmac$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["createHMAC"])("SHA-256", "base64urlnopad").verify(e.context.secret, JSON.stringify(i.session), i.signature)) return G(e), e.json(null);
            let t = await e.getSignedCookie(e.context.authCookies.dontRememberToken.name, e.context.secret);
            if (i?.session && e.context.options.session?.cookieCache?.enabled && !e.query?.disableCookieCache) {
                let c = i.session;
                if (i.expiresAt < Date.now() || c.session.expiresAt < new Date) {
                    let l = e.context.authCookies.sessionData.name;
                    e.setCookie(l, "", {
                        maxAge: 0
                    });
                } else return e.json(c);
            }
            let n = await e.context.internalAdapter.findSession(o);
            if (e.context.session = n, !n || n.session.expiresAt < new Date) return G(e), n && await e.context.internalAdapter.deleteSession(n.session.token), e.json(null);
            if (t || e.query?.disableRefresh) return e.json(n);
            let s = e.context.sessionConfig.expiresIn, a = e.context.sessionConfig.updateAge;
            if (n.session.expiresAt.valueOf() - s * 1e3 + a * 1e3 <= Date.now()) {
                let c = await e.context.internalAdapter.updateSession(n.session.token, {
                    expiresAt: L(e.context.sessionConfig.expiresIn, "sec")
                });
                if (!c) return G(e), e.json(null, {
                    status: 401
                });
                let p = (c.expiresAt.valueOf() - Date.now()) / 1e3;
                return await b(e, {
                    session: c,
                    user: n.user
                }, !1, {
                    maxAge: p
                }), e.json({
                    session: c,
                    user: n.user
                });
            }
            return await Oo(e, n), e.json(n);
        } catch (o) {
            throw e.context.logger.error("INTERNAL_SERVER_ERROR", o), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("INTERNAL_SERVER_ERROR", {
                message: f.FAILED_TO_GET_SESSION
            });
        }
    }), v = async (e, o)=>{
    if (e.context.session) return e.context.session;
    let r = await _o()({
        ...e,
        _flag: "json",
        headers: e.headers,
        query: o
    }).catch((i)=>null);
    return e.context.session = r, r;
}, I = N(async (e)=>{
    let o = await v(e);
    if (!o?.session) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED");
    return {
        session: o
    };
}), Vd = N(async (e)=>{
    let o = await v(e);
    if (!o?.session) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED");
    if (e.context.sessionConfig.freshAge === 0) return {
        session: o
    };
    let r = e.context.sessionConfig.freshAge, i = o.session.updatedAt?.valueOf() || o.session.createdAt.valueOf();
    if (!(Date.now() - i < r * 1e3)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
        message: "Session is not fresh"
    });
    return {
        session: o
    };
}), bi = ()=>u("/list-sessions", {
        method: "GET",
        use: [
            I
        ],
        requireHeaders: !0,
        metadata: {
            openapi: {
                description: "List all active sessions for the user",
                responses: {
                    200: {
                        description: "Success",
                        content: {
                            "application/json": {
                                schema: {
                                    type: "array",
                                    items: {
                                        type: "object",
                                        properties: {
                                            token: {
                                                type: "string"
                                            },
                                            userId: {
                                                type: "string"
                                            },
                                            expiresAt: {
                                                type: "string"
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }, async (e)=>{
        let r = (await e.context.internalAdapter.listSessions(e.context.session.user.id)).filter((i)=>i.expiresAt > new Date);
        return e.json(r);
    }), Oi = u("/revoke-session", {
    method: "POST",
    body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        token: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "The token to revoke"
        })
    }),
    use: [
        I
    ],
    requireHeaders: !0,
    metadata: {
        openapi: {
            description: "Revoke a single session",
            requestBody: {
                content: {
                    "application/json": {
                        schema: {
                            type: "object",
                            properties: {
                                token: {
                                    type: "string"
                                }
                            },
                            required: [
                                "token"
                            ]
                        }
                    }
                }
            }
        }
    }
}, async (e)=>{
    let o = e.body.token, r = await e.context.internalAdapter.findSession(o);
    if (!r) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: "Session not found"
    });
    if (r.session.userId !== e.context.session.user.id) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED");
    try {
        await e.context.internalAdapter.deleteSession(o);
    } catch (i) {
        throw e.context.logger.error(i && typeof i == "object" && "name" in i ? i.name : "", i), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("INTERNAL_SERVER_ERROR");
    }
    return e.json({
        status: !0
    });
}), Ti = u("/revoke-sessions", {
    method: "POST",
    use: [
        I
    ],
    requireHeaders: !0,
    metadata: {
        openapi: {
            description: "Revoke all sessions for the user",
            responses: {
                200: {
                    description: "Success",
                    content: {
                        "application/json": {
                            schema: {
                                type: "object",
                                properties: {
                                    status: {
                                        type: "boolean"
                                    }
                                },
                                required: [
                                    "status"
                                ]
                            }
                        }
                    }
                }
            }
        }
    }
}, async (e)=>{
    try {
        await e.context.internalAdapter.deleteSessions(e.context.session.user.id);
    } catch (o) {
        throw e.context.logger.error(o && typeof o == "object" && "name" in o ? o.name : "", o), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("INTERNAL_SERVER_ERROR");
    }
    return e.json({
        status: !0
    });
}), Ei = u("/revoke-other-sessions", {
    method: "POST",
    requireHeaders: !0,
    use: [
        I
    ],
    metadata: {
        openapi: {
            description: "Revoke all other sessions for the user except the current one",
            responses: {
                200: {
                    description: "Success",
                    content: {
                        "application/json": {
                            schema: {
                                type: "object",
                                properties: {
                                    status: {
                                        type: "boolean"
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}, async (e)=>{
    let o = e.context.session;
    if (!o.user) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED");
    let t = (await e.context.internalAdapter.listSessions(o.user.id)).filter((n)=>n.expiresAt > new Date).filter((n)=>n.token !== e.context.session.session.token);
    return await Promise.all(t.map((n)=>e.context.internalAdapter.deleteSession(n.token))), e.json({
        status: !0
    });
});
;
;
async function Ri(e, o, r = 3600) {
    return await new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$node$2f$esm$2f$jwt$2f$sign$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["SignJWT"](e).setProtectedHeader({
        alg: "HS256"
    }).setIssuedAt().setExpirationTime(Math.floor(Date.now() / 1e3) + r).sign(new TextEncoder().encode(o));
}
async function Ke(e, o, r) {
    return await Ri({
        email: o.toLowerCase(),
        updateTo: r
    }, e);
}
async function vo(e, o) {
    if (!e.context.options.emailVerification?.sendVerificationEmail) throw e.context.logger.error("Verification email isn't enabled."), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: "Verification email isn't enabled"
    });
    let r = await Ke(e.context.secret, o.email), i = `${e.context.baseURL}/verify-email?token=${r}&callbackURL=${e.body.callbackURL || e.query?.currentURL || "/"}`;
    await e.context.options.emailVerification.sendVerificationEmail({
        user: o,
        url: i,
        token: r
    }, e.request);
}
var Ii = u("/send-verification-email", {
    method: "POST",
    query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        currentURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "The URL to use for email verification callback"
        }).optional()
    }).optional(),
    body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        email: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "The email to send the verification email to"
        }).email(),
        callbackURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "The URL to use for email verification callback"
        }).optional()
    }),
    metadata: {
        openapi: {
            description: "Send a verification email to the user",
            requestBody: {
                content: {
                    "application/json": {
                        schema: {
                            type: "object",
                            properties: {
                                email: {
                                    type: "string",
                                    description: "The email to send the verification email to"
                                },
                                callbackURL: {
                                    type: "string",
                                    description: "The URL to use for email verification callback"
                                }
                            },
                            required: [
                                "email"
                            ]
                        }
                    }
                }
            },
            responses: {
                200: {
                    description: "Success",
                    content: {
                        "application/json": {
                            schema: {
                                type: "object",
                                properties: {
                                    status: {
                                        type: "boolean"
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}, async (e)=>{
    if (!e.context.options.emailVerification?.sendVerificationEmail) throw e.context.logger.error("Verification email isn't enabled."), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: "Verification email isn't enabled"
    });
    let { email: o } = e.body, r = await e.context.internalAdapter.findUserByEmail(o);
    if (!r) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: f.USER_NOT_FOUND
    });
    return await vo(e, r.user), e.json({
        status: !0
    });
}), _i = u("/verify-email", {
    method: "GET",
    query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        token: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "The token to verify the email"
        }),
        callbackURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "The URL to redirect to after email verification"
        }).optional()
    }),
    metadata: {
        openapi: {
            description: "Verify the email of the user",
            responses: {
                200: {
                    description: "Success",
                    content: {
                        "application/json": {
                            schema: {
                                type: "object",
                                properties: {
                                    user: {
                                        type: "object"
                                    },
                                    status: {
                                        type: "boolean"
                                    }
                                },
                                required: [
                                    "user",
                                    "status"
                                ]
                            }
                        }
                    }
                }
            }
        }
    }
}, async (e)=>{
    function o(a) {
        throw e.query.callbackURL ? e.query.callbackURL.includes("?") ? e.redirect(`${e.query.callbackURL}&error=${a}`) : e.redirect(`${e.query.callbackURL}?error=${a}`) : new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
            message: a
        });
    }
    let { token: r } = e.query, i;
    try {
        i = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$node$2f$esm$2f$jwt$2f$verify$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["jwtVerify"])(r, new TextEncoder().encode(e.context.secret), {
            algorithms: [
                "HS256"
            ]
        });
    } catch (a) {
        return e.context.logger.error("Failed to verify email", a), o("invalid_token");
    }
    let n = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        email: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().email(),
        updateTo: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional()
    }).parse(i.payload), s = await e.context.internalAdapter.findUserByEmail(n.email);
    if (!s) return o("user_not_found");
    if (n.updateTo) {
        let a = await v(e);
        if (!a) {
            if (e.query.callbackURL) throw e.redirect(`${e.query.callbackURL}?error=unauthorized`);
            return o("unauthorized");
        }
        if (a.user.email !== n.email) {
            if (e.query.callbackURL) throw e.redirect(`${e.query.callbackURL}?error=unauthorized`);
            return o("unauthorized");
        }
        let d = await e.context.internalAdapter.updateUserByEmail(n.email, {
            email: n.updateTo,
            emailVerified: !1
        }), A = await Ke(e.context.secret, n.updateTo);
        if (await e.context.options.emailVerification?.sendVerificationEmail?.({
            user: d,
            url: `${e.context.baseURL}/verify-email?token=${A}`,
            token: A
        }, e.request), e.query.callbackURL) throw e.redirect(e.query.callbackURL);
        return e.json({
            status: !0
        });
    }
    if (await e.context.internalAdapter.updateUserByEmail(n.email, {
        emailVerified: !0
    }), e.context.options.emailVerification?.autoSignInAfterVerification) {
        let a = await v(e);
        if (!a || a.user.email !== n.email) {
            let d = await e.context.internalAdapter.createSession(s.user.id, e.request);
            if (!d) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("INTERNAL_SERVER_ERROR", {
                message: "Failed to create session"
            });
            await b(e, {
                session: d,
                user: s.user
            });
        }
    }
    if (e.query.callbackURL) throw e.redirect(e.query.callbackURL);
    return e.json({
        status: !0
    });
});
;
;
function Uo(e) {
    return e === "-" || e === "^" || e === "$" || e === "+" || e === "." || e === "(" || e === ")" || e === "|" || e === "[" || e === "]" || e === "{" || e === "}" || e === "*" || e === "?" || e === "\\" ? `\\${e}` : e;
}
function xr(e) {
    let o = "";
    for(let r = 0; r < e.length; r++)o += Uo(e[r]);
    return o;
}
function vi(e, o = !0) {
    if (Array.isArray(e)) return `(?:${e.map((c)=>`^${vi(c, o)}$`).join("|")})`;
    let r = "", i = "", t = ".";
    o === !0 ? (r = "/", i = "[/\\\\]", t = "[^/\\\\]") : o && (r = o, i = xr(r), i.length > 1 ? (i = `(?:${i})`, t = `((?!${i}).)`) : t = `[^${i}]`);
    let n = o ? `${i}+?` : "", s = o ? `${i}*?` : "", a = o ? e.split(r) : [
        e
    ], d = "";
    for(let A = 0; A < a.length; A++){
        let c = a[A], p = a[A + 1], l = "";
        if (!(!c && A > 0)) {
            if (o && (A === a.length - 1 ? l = s : p !== "**" ? l = n : l = ""), o && c === "**") {
                l && (d += A === 0 ? "" : l, d += `(?:${t}*?${l})*?`);
                continue;
            }
            for(let K = 0; K < c.length; K++){
                let y = c[K];
                y === "\\" ? K < c.length - 1 && (d += Uo(c[K + 1]), K++) : y === "?" ? d += t : y === "*" ? d += `${t}*?` : d += Uo(y);
            }
            d += l;
        }
    }
    return d;
}
function zr(e, o) {
    if (typeof o != "string") throw new TypeError(`Sample must be a string, but ${typeof o} given`);
    return e.test(o);
}
function So(e, o) {
    if (typeof e != "string" && !Array.isArray(e)) throw new TypeError(`The first argument must be a single pattern string or an array of patterns, but ${typeof e} given`);
    if ((typeof o == "string" || typeof o == "boolean") && (o = {
        separator: o
    }), arguments.length === 2 && !(typeof o > "u" || typeof o == "object" && o !== null && !Array.isArray(o))) throw new TypeError(`The second argument must be an options object or a string/boolean separator, but ${typeof o} given`);
    if (o = o || {}, o.separator === "\\") throw new Error("\\ is not a valid separator because it is used for escaping. Try setting the separator to `true` instead");
    let r = vi(e, o.separator), i = new RegExp(`^${r}$`, o.flags), t = zr.bind(null, i);
    return t.options = o, t.pattern = e, t.regexp = i, t;
}
var Fr = N(async (e)=>{
    if (e.request?.method !== "POST") return;
    let { body: o, query: r, context: i } = e, t = e.headers?.get("origin") || e.headers?.get("referer") || "", n = o?.callbackURL || r?.callbackURL, s = o?.redirectTo, a = r?.currentURL, d = o?.errorCallbackURL, A = o?.newUserCallbackURL, c = i.trustedOrigins, p = e.headers?.has("cookie"), l = (y, h)=>y.startsWith("/") ? !1 : h.includes("*") ? So(h)(ii(y)) : y.startsWith(h), K = (y, h)=>{
        if (!y) return;
        if (!c.some((x)=>l(y, x) || y?.startsWith("/") && h !== "origin" && !y.includes(":"))) throw e.context.logger.error(`Invalid ${h}: ${y}`), e.context.logger.info(`If it's a valid URL, please add ${y} to trustedOrigins in your auth config
`, `Current list of trustedOrigins: ${c}`), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
            message: `Invalid ${h}`
        });
    };
    p && !e.context.options.advanced?.disableCSRFCheck && K(t, "origin"), n && K(n, "callbackURL"), s && K(s, "redirectURL"), a && K(a, "currentURL"), d && K(d, "errorCallbackURL"), A && K(s, "newUserCallbackURL");
});
var Ui = u("/ok", {
    method: "GET",
    metadata: {
        ...ke,
        openapi: {
            description: "Check if the API is working",
            responses: {
                200: {
                    description: "Success",
                    content: {
                        "application/json": {
                            schema: {
                                type: "object",
                                properties: {
                                    ok: {
                                        type: "boolean"
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}, async (e)=>e.json({
        ok: !0
    }));
;
;
;
;
var pA = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
    id: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    providerId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    accountId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    userId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    accessToken: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().nullish(),
    refreshToken: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().nullish(),
    idToken: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().nullish(),
    accessTokenExpiresAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].date().nullish(),
    refreshTokenExpiresAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].date().nullish(),
    scope: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().nullish(),
    password: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().nullish(),
    createdAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].date().default(()=>new Date),
    updatedAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].date().default(()=>new Date)
}), KA = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
    id: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    email: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().transform((e)=>e.toLowerCase()),
    emailVerified: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].boolean().default(!1),
    name: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    image: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().nullish(),
    createdAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].date().default(()=>new Date),
    updatedAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].date().default(()=>new Date)
}), mA = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
    id: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    userId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    expiresAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].date(),
    createdAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].date().default(()=>new Date),
    updatedAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].date().default(()=>new Date),
    token: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    ipAddress: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().nullish(),
    userAgent: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().nullish()
}), gA = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
    id: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    value: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    createdAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].date().default(()=>new Date),
    updatedAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].date().default(()=>new Date),
    expiresAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].date(),
    identifier: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string()
});
function Vr(e, o) {
    let r = {
        ...o === "user" ? e.user?.additionalFields : {},
        ...o === "session" ? e.session?.additionalFields : {}
    };
    for (let i of e.plugins || [])i.schema && i.schema[o] && (r = {
        ...r,
        ...i.schema[o].fields
    });
    return r;
}
function qr(e, o) {
    let r = o.action || "create", i = o.fields, t = {};
    for(let n in i){
        if (n in e) {
            if (i[n].input === !1) {
                if (i[n].defaultValue) {
                    t[n] = i[n].defaultValue;
                    continue;
                }
                continue;
            }
            if (i[n].validator?.input && e[n] !== void 0) {
                t[n] = i[n].validator.input.parse(e[n]);
                continue;
            }
            if (i[n].transform?.input && e[n] !== void 0) {
                t[n] = i[n].transform?.input(e[n]);
                continue;
            }
            t[n] = e[n];
            continue;
        }
        if (i[n].defaultValue && r === "create") {
            t[n] = i[n].defaultValue;
            continue;
        }
        if (i[n].required && r === "create") throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: `${n} is required`
        });
    }
    return t;
}
function ao(e, o, r) {
    let i = Vr(e, "user");
    return qr(o || {}, {
        fields: i,
        action: r
    });
}
function me(e, o) {
    if (!o) return e;
    for(let r in o){
        let i = o[r]?.modelName;
        i && (e[r].modelName = i);
        for(let t in e[r].fields){
            let n = o[r]?.fields?.[t];
            n && (e[r].fields[t].fieldName = n);
        }
    }
    return e;
}
var Si = ()=>u("/sign-up/email", {
        method: "POST",
        query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
            currentURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional()
        }).optional(),
        body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].record(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(), __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].any()),
        metadata: {
            openapi: {
                description: "Sign up a user using email and password",
                requestBody: {
                    content: {
                        "application/json": {
                            schema: {
                                type: "object",
                                properties: {
                                    name: {
                                        type: "string",
                                        description: "The name of the user"
                                    },
                                    email: {
                                        type: "string",
                                        description: "The email of the user"
                                    },
                                    password: {
                                        type: "string",
                                        description: "The password of the user"
                                    },
                                    callbackURL: {
                                        type: "string",
                                        description: "The URL to use for email verification callback"
                                    }
                                },
                                required: [
                                    "name",
                                    "email",
                                    "password"
                                ]
                            }
                        }
                    }
                },
                responses: {
                    200: {
                        description: "Success",
                        content: {
                            "application/json": {
                                schema: {
                                    type: "object",
                                    properties: {
                                        id: {
                                            type: "string",
                                            description: "The id of the user"
                                        },
                                        email: {
                                            type: "string",
                                            description: "The email of the user"
                                        },
                                        name: {
                                            type: "string",
                                            description: "The name of the user"
                                        },
                                        image: {
                                            type: "string",
                                            description: "The image of the user"
                                        },
                                        emailVerified: {
                                            type: "boolean",
                                            description: "If the email is verified"
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }, async (e)=>{
        if (!e.context.options.emailAndPassword?.enabled) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: "Email and password sign up is not enabled"
        });
        let o = e.body, { name: r, email: i, password: t, image: n, callbackURL: s, ...a } = o;
        if (!__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().email().safeParse(i).success) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: f.INVALID_EMAIL
        });
        let A = e.context.password.config.minPasswordLength;
        if (t.length < A) throw e.context.logger.error("Password is too short"), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: f.PASSWORD_TOO_SHORT
        });
        let c = e.context.password.config.maxPasswordLength;
        if (t.length > c) throw e.context.logger.error("Password is too long"), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: f.PASSWORD_TOO_LONG
        });
        if ((await e.context.internalAdapter.findUserByEmail(i))?.user) throw e.context.logger.info(`Sign-up attempt for existing email: ${i}`), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNPROCESSABLE_ENTITY", {
            message: f.USER_ALREADY_EXISTS
        });
        let l = ao(e.context.options, a), K;
        try {
            if (K = await e.context.internalAdapter.createUser({
                email: i.toLowerCase(),
                name: r,
                image: n,
                ...l,
                emailVerified: !1
            }), !K) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                message: f.FAILED_TO_CREATE_USER
            });
        } catch (j) {
            throw ro && e.context.logger.error("Failed to create user", j), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNPROCESSABLE_ENTITY", {
                message: f.FAILED_TO_CREATE_USER,
                details: j
            });
        }
        if (!K) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNPROCESSABLE_ENTITY", {
            message: f.FAILED_TO_CREATE_USER
        });
        let y = await e.context.password.hash(t);
        if (await e.context.internalAdapter.linkAccount({
            userId: K.id,
            providerId: "credential",
            accountId: K.id,
            password: y
        }), e.context.options.emailVerification?.sendOnSignUp || e.context.options.emailAndPassword.requireEmailVerification) {
            let j = await Ke(e.context.secret, K.email), x = `${e.context.baseURL}/verify-email?token=${j}&callbackURL=${o.callbackURL || e.query?.currentURL || "/"}`;
            await e.context.options.emailVerification?.sendVerificationEmail?.({
                user: K,
                url: x,
                token: j
            }, e.request);
        }
        if (!e.context.options.emailAndPassword.autoSignIn || e.context.options.emailAndPassword.requireEmailVerification) return e.json({
            token: null
        });
        let h = await e.context.internalAdapter.createSession(K.id, e.request);
        if (!h) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: f.FAILED_TO_CREATE_SESSION
        });
        return await b(e, {
            session: h,
            user: K
        }), e.json({
            token: h.token
        });
    });
var Hr = (e = "Unknown")=>`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authentication Error</title>
    <style>
        :root {
            --bg-color: #f8f9fa;
            --text-color: #212529;
            --accent-color: #000000;
            --error-color: #dc3545;
            --border-color: #e9ecef;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            line-height: 1.5;
        }
        .error-container {
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            padding: 2.5rem;
            text-align: center;
            max-width: 90%;
            width: 400px;
        }
        h1 {
            color: var(--error-color);
            font-size: 1.75rem;
            margin-bottom: 1rem;
            font-weight: 600;
        }
        p {
            margin-bottom: 1.5rem;
            color: #495057;
        }
        .btn {
            background-color: var(--accent-color);
            color: #ffffff;
            text-decoration: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            transition: all 0.3s ease;
            display: inline-block;
            font-weight: 500;
            border: 2px solid var(--accent-color);
        }
        .btn:hover {
            background-color: #131721;
        }
        .error-code {
            font-size: 0.875rem;
            color: #6c757d;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border-color);
        }
        .icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <div class="error-container">
        <div class="icon">\u26A0\uFE0F</div>
        <h1>Better Auth Error</h1>
        <p>We encountered an issue while processing your request. Please try again or contact the application owner if the problem persists.</p>
        <a href="/" id="returnLink" class="btn">Return to Application</a>
        <div class="error-code">Error Code: <span id="errorCode">${e}</span></div>
    </div>
</body>
</html>`, ki = u("/error", {
    method: "GET",
    metadata: {
        ...ke,
        openapi: {
            description: "Displays an error page",
            responses: {
                200: {
                    description: "Success",
                    content: {
                        "text/html": {
                            schema: {
                                type: "string"
                            }
                        }
                    }
                }
            }
        }
    }
}, async (e)=>{
    let o = new URL(e.request?.url || "").searchParams.get("error") || "Unknown";
    return new Response(Hr(o), {
        headers: {
            "Content-Type": "text/html"
        }
    });
});
;
;
function ko(e, o) {
    let r = o.plugins?.reduce((a, d)=>({
            ...a,
            ...d.endpoints
        }), {}), i = o.plugins?.map((a)=>a.middlewares?.map((d)=>{
            let A = async (c)=>d.middleware({
                    ...c,
                    context: {
                        ...e,
                        ...c.context
                    }
                });
            return A.path = d.path, A.options = d.middleware.options, A.headers = d.middleware.headers, {
                path: d.path,
                middleware: A
            };
        })).filter((a)=>a !== void 0).flat() || [], n = {
        ...{
            signInSocial: Pi,
            callbackOAuth: Ni,
            getSession: _o(),
            signOut: Li,
            signUpEmail: Si(),
            signInEmail: Di,
            forgetPassword: ji,
            resetPassword: zi,
            verifyEmail: _i,
            sendVerificationEmail: Ii,
            changeEmail: qi,
            changePassword: Fi,
            setPassword: Mi,
            updateUser: Bi(),
            deleteUser: Vi,
            forgetPasswordCallback: xi,
            listSessions: bi(),
            revokeSession: Oi,
            revokeSessions: Ti,
            revokeOtherSessions: Ei,
            linkSocialAccount: $i,
            listUserAccounts: Hi,
            deleteUserCallback: Po
        },
        ...r,
        ok: Ui,
        error: ki
    }, s = {};
    for (let [a, d] of Object.entries(n))s[a] = async (A = {})=>{
        d.headers = new Headers;
        let c = {
            setHeader (g, w) {
                d.headers.set(g, w);
            },
            setCookie (g, w, U) {
                (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["setCookie"])(d.headers, g, w, U);
            },
            getCookie (g, w) {
                let C = A.headers?.get("cookie");
                return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getCookie"])(C || "", g, w);
            },
            getSignedCookie (g, w, U) {
                let C = A.headers;
                return C ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getSignedCookie"])(C, w, g, U) : null;
            },
            async setSignedCookie (g, w, U, C) {
                await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["setSignedCookie"])(d.headers, g, w, U, C);
            },
            redirect (g) {
                return d.headers.set("Location", g), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("FOUND");
            },
            responseHeader: d.headers
        }, p = await e, l = null, K = {
            ...c,
            ...A,
            path: d.path,
            context: {
                ...p,
                ...A.context,
                session: null,
                setNewSession: function(g) {
                    this.newSession = g, l = g;
                }
            }
        }, y = o.plugins || [], h = y.map((g)=>{
            if (g.hooks?.before) return g.hooks.before;
        }).filter((g)=>g !== void 0).flat(), j = y.map((g)=>{
            if (g.hooks?.after) return g.hooks.after;
        }).filter((g)=>g !== void 0).flat();
        o.hooks?.before && h.push({
            matcher: ()=>!0,
            handler: o.hooks.before
        }), o.hooks?.after && j.push({
            matcher: ()=>!0,
            handler: o.hooks.after
        });
        for (let g of h){
            if (!g.matcher(K)) continue;
            let w = await g.handler(K);
            if (w && "context" in w) {
                K = {
                    ...K,
                    ...w.context
                };
                continue;
            }
            if (w) return w;
        }
        let x;
        try {
            x = await d(K), l && (K.context.newSession = l);
        } catch (g) {
            if (l && (K.context.newSession = l), g instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]) {
                if (!j?.length) throw g.headers = d.headers, g;
                K.context.returned = g, K.context.returned.headers = d.headers;
                for (let w of j || [])if (w.matcher(K)) try {
                    let C = await w.handler(K);
                    C && "response" in C && (K.context.returned = C.response);
                } catch (C) {
                    if (C instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]) {
                        K.context.returned = C;
                        continue;
                    }
                    throw C;
                }
                if (K.context.returned instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]) throw K.context.returned.headers = d.headers, K.context.returned;
                return K.context.returned;
            }
            throw g;
        }
        K.context.returned = x, K.responseHeader = d.headers;
        for (let g of j)if (g.matcher(K)) try {
            let U = await g.handler(K);
            if (U) if ("responseHeader" in U) {
                let C = U.responseHeader;
                K.responseHeader = C;
            } else K.context.returned = U;
        } catch (U) {
            if (U instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]) {
                K.context.returned = U;
                continue;
            }
            throw U;
        }
        let z = K.context.returned;
        if (z instanceof Response && d.headers.forEach((g, w)=>{
            w === "set-cookie" ? z.headers.append(w, g) : z.headers.set(w, g);
        }), z instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]) throw z.headers = d.headers, z;
        return z;
    }, s[a].path = d.path, s[a].method = d.method, s[a].options = d.options, s[a].headers = d.headers;
    return {
        api: s,
        middlewares: i
    };
}
async function Ne(e, { userInfo: o, account: r, callbackURL: i }) {
    let t = await e.context.internalAdapter.findOAuthUser(o.email.toLowerCase(), r.accountId, r.providerId).catch((d)=>{
        throw re.error(`Better auth was unable to query your database.
Error: `, d), e.redirect(`${e.context.baseURL}/error?error=internal_server_error`);
    }), n = t?.user, s = !n;
    if (t) {
        let d = t.accounts.find((A)=>A.providerId === r.providerId);
        if (d) {
            let A = Object.fromEntries(Object.entries({
                accessToken: r.accessToken,
                idToken: r.idToken,
                refreshToken: r.refreshToken,
                accessTokenExpiresAt: r.accessTokenExpiresAt,
                refreshTokenExpiresAt: r.refreshTokenExpiresAt
            }).filter(([c, p])=>p !== void 0));
            Object.keys(A).length > 0 && await e.context.internalAdapter.updateAccount(d.id, A);
        } else {
            if (!e.context.options.account?.accountLinking?.trustedProviders?.includes(r.providerId) && !o.emailVerified || e.context.options.account?.accountLinking?.enabled === !1) return ro && re.warn(`User already exist but account isn't linked to ${r.providerId}. To read more about how account linking works in Better Auth see https://www.better-auth.com/docs/concepts/users-accounts#account-linking.`), {
                error: "account not linked",
                data: null
            };
            try {
                await e.context.internalAdapter.linkAccount({
                    providerId: r.providerId,
                    accountId: o.id.toString(),
                    userId: t.user.id,
                    accessToken: r.accessToken,
                    idToken: r.idToken,
                    refreshToken: r.refreshToken,
                    accessTokenExpiresAt: r.accessTokenExpiresAt,
                    refreshTokenExpiresAt: r.refreshTokenExpiresAt,
                    scope: r.scope
                });
            } catch (p) {
                return re.error("Unable to link account", p), {
                    error: "unable to link account",
                    data: null
                };
            }
        }
    } else try {
        if (n = await e.context.internalAdapter.createOAuthUser({
            ...o,
            email: o.email.toLowerCase(),
            id: void 0
        }, {
            accessToken: r.accessToken,
            idToken: r.idToken,
            refreshToken: r.refreshToken,
            accessTokenExpiresAt: r.accessTokenExpiresAt,
            refreshTokenExpiresAt: r.refreshTokenExpiresAt,
            scope: r.scope,
            providerId: r.providerId,
            accountId: o.id.toString()
        }).then((d)=>d?.user), !o.emailVerified && n && e.context.options.emailVerification?.sendOnSignUp) {
            let d = await Ke(e.context.secret, n.email), A = `${e.context.baseURL}/verify-email?token=${d}&callbackURL=${i}`;
            await e.context.options.emailVerification?.sendVerificationEmail?.({
                user: n,
                url: A,
                token: d
            }, e.request);
        }
    } catch (d) {
        return d instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"] ? {
            error: d.message,
            data: null,
            isRegister: !1
        } : {
            error: "unable to create user",
            data: null,
            isRegister: !1
        };
    }
    if (!n) return {
        error: "unable to create user",
        data: null,
        isRegister: !1
    };
    let a = await e.context.internalAdapter.createSession(n.id, e.request);
    return a ? {
        data: {
            session: a,
            user: n
        },
        error: null,
        isRegister: s
    } : {
        error: "unable to create session",
        data: null,
        isRegister: !1
    };
}
var Pi = u("/sign-in/social", {
    method: "POST",
    query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        currentURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional()
    }).optional(),
    body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        callbackURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "Callback URL to redirect to after the user has signed in"
        }).optional(),
        newUserCallbackURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional(),
        errorCallbackURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "Callback URL to redirect to if an error happens"
        }).optional(),
        provider: Ci,
        disableRedirect: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].boolean({
            description: "Disable automatic redirection to the provider. Useful for handling the redirection yourself"
        }).optional(),
        idToken: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].optional(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
            token: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                description: "ID token from the provider"
            }),
            nonce: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                description: "Nonce used to generate the token"
            }).optional(),
            accessToken: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                description: "Access token from the provider"
            }).optional(),
            refreshToken: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                description: "Refresh token from the provider"
            }).optional(),
            expiresAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].number({
                description: "Expiry date of the token"
            }).optional()
        }), {
            description: "ID token from the provider to sign in the user with id token"
        })
    }),
    metadata: {
        openapi: {
            description: "Sign in with a social provider",
            responses: {
                200: {
                    description: "Success",
                    content: {
                        "application/json": {
                            schema: {
                                type: "object",
                                properties: {
                                    session: {
                                        type: "string"
                                    },
                                    user: {
                                        type: "object"
                                    },
                                    url: {
                                        type: "string"
                                    },
                                    redirect: {
                                        type: "boolean"
                                    }
                                },
                                required: [
                                    "session",
                                    "user",
                                    "url",
                                    "redirect"
                                ]
                            }
                        }
                    }
                }
            }
        }
    }
}, async (e)=>{
    let o = e.context.socialProviders.find((n)=>n.id === e.body.provider);
    if (!o) throw e.context.logger.error("Provider not found. Make sure to add the provider in your auth config", {
        provider: e.body.provider
    }), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("NOT_FOUND", {
        message: f.PROVIDER_NOT_FOUND
    });
    if (e.body.idToken) {
        if (!o.verifyIdToken) throw e.context.logger.error("Provider does not support id token verification", {
            provider: e.body.provider
        }), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("NOT_FOUND", {
            message: f.ID_TOKEN_NOT_SUPPORTED
        });
        let { token: n, nonce: s } = e.body.idToken;
        if (!await o.verifyIdToken(n, s)) throw e.context.logger.error("Invalid id token", {
            provider: e.body.provider
        }), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
            message: f.INVALID_TOKEN
        });
        let d = await o.getUserInfo({
            idToken: n,
            accessToken: e.body.idToken.accessToken,
            refreshToken: e.body.idToken.refreshToken
        });
        if (!d || !d?.user) throw e.context.logger.error("Failed to get user info", {
            provider: e.body.provider
        }), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
            message: f.FAILED_TO_GET_USER_INFO
        });
        if (!d.user.email) throw e.context.logger.error("User email not found", {
            provider: e.body.provider
        }), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
            message: f.USER_EMAIL_NOT_FOUND
        });
        let A = await Ne(e, {
            userInfo: {
                email: d.user.email,
                id: d.user.id,
                name: d.user.name || "",
                image: d.user.image,
                emailVerified: d.user.emailVerified || !1
            },
            account: {
                providerId: o.id,
                accountId: d.user.id,
                accessToken: e.body.idToken.accessToken
            }
        });
        if (A.error) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
            message: A.error
        });
        return await b(e, A.data), e.json({
            token: A.data.session.token,
            url: void 0,
            redirect: !1
        });
    }
    let { codeVerifier: r, state: i } = await Se(e), t = await o.createAuthorizationURL({
        state: i,
        codeVerifier: r,
        redirectURI: `${e.context.baseURL}/callback/${o.id}`
    });
    return e.json({
        url: t.toString(),
        redirect: !e.body.disableRedirect
    });
}), Di = u("/sign-in/email", {
    method: "POST",
    body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        email: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "Email of the user"
        }),
        password: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "Password of the user"
        }),
        callbackURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "Callback URL to use as a redirect for email verification"
        }).optional(),
        rememberMe: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].boolean({
            description: "If this is false, the session will not be remembered. Default is `true`."
        }).default(!0).optional()
    }),
    metadata: {
        openapi: {
            description: "Sign in with email and password",
            responses: {
                200: {
                    description: "Success",
                    content: {
                        "application/json": {
                            schema: {
                                type: "object",
                                properties: {
                                    user: {
                                        type: "object"
                                    },
                                    url: {
                                        type: "string"
                                    },
                                    redirect: {
                                        type: "boolean"
                                    }
                                },
                                required: [
                                    "session",
                                    "user",
                                    "url",
                                    "redirect"
                                ]
                            }
                        }
                    }
                }
            }
        }
    }
}, async (e)=>{
    if (!e.context.options?.emailAndPassword?.enabled) throw e.context.logger.error("Email and password is not enabled. Make sure to enable it in the options on you `auth.ts` file. Check `https://better-auth.com/docs/authentication/email-password` for more!"), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: "Email and password is not enabled"
    });
    let { email: o, password: r } = e.body;
    if (!__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().email().safeParse(o).success) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: f.INVALID_EMAIL
    });
    let t = await e.context.internalAdapter.findUserByEmail(o, {
        includeAccounts: !0
    });
    if (!t) throw await e.context.password.hash(r), e.context.logger.error("User not found", {
        email: o
    }), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
        message: f.INVALID_EMAIL_OR_PASSWORD
    });
    let n = t.accounts.find((A)=>A.providerId === "credential");
    if (!n) throw e.context.logger.error("Credential account not found", {
        email: o
    }), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
        message: f.INVALID_EMAIL_OR_PASSWORD
    });
    let s = n?.password;
    if (!s) throw e.context.logger.error("Password not found", {
        email: o
    }), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
        message: f.INVALID_EMAIL_OR_PASSWORD
    });
    if (!await e.context.password.verify({
        hash: s,
        password: r
    })) throw e.context.logger.error("Invalid password"), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
        message: f.INVALID_EMAIL_OR_PASSWORD
    });
    if (e.context.options?.emailAndPassword?.requireEmailVerification && !t.user.emailVerified) {
        if (!e.context.options?.emailVerification?.sendVerificationEmail) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
            message: f.EMAIL_NOT_VERIFIED
        });
        let A = await Ke(e.context.secret, t.user.email), c = `${e.context.baseURL}/verify-email?token=${A}&callbackURL=${e.body.callbackURL || "/"}`;
        throw await e.context.options.emailVerification.sendVerificationEmail({
            user: t.user,
            url: c,
            token: A
        }, e.request), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
            message: f.EMAIL_NOT_VERIFIED
        });
    }
    let d = await e.context.internalAdapter.createSession(t.user.id, e.headers, e.body.rememberMe === !1);
    if (!d) throw e.context.logger.error("Failed to create session"), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
        message: f.FAILED_TO_CREATE_SESSION
    });
    return await b(e, {
        session: d,
        user: t.user
    }, e.body.rememberMe === !1), e.json({
        user: {
            id: t.user.id,
            email: t.user.email,
            name: t.user.name,
            image: t.user.image,
            emailVerified: t.user.emailVerified,
            createdAt: t.user.createdAt,
            updatedAt: t.user.updatedAt
        },
        redirect: !!e.body.callbackURL,
        url: e.body.callbackURL
    });
});
;
var Ao = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
    code: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional(),
    error: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional(),
    error_description: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional(),
    state: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional()
}), Ni = u("/callback/:id", {
    method: [
        "GET",
        "POST"
    ],
    body: Ao.optional(),
    query: Ao.optional(),
    metadata: ke
}, async (e)=>{
    let o;
    try {
        if (e.method === "GET") o = Ao.parse(e.query);
        else if (e.method === "POST") o = Ao.parse(e.body);
        else throw new Error("Unsupported method");
    } catch (g) {
        throw e.context.logger.error("INVALID_CALLBACK_REQUEST", g), e.redirect(`${e.context.baseURL}/error?error=invalid_callback_request`);
    }
    let { code: r, error: i, state: t, error_description: n } = o;
    if (!t) throw e.context.logger.error("State not found", i), e.redirect(`${e.context.baseURL}/error?error=state_not_found`);
    if (!r) throw e.context.logger.error("Code not found"), e.redirect(`${e.context.baseURL}/error?error=${i || "no_code"}&error_description=${n}`);
    let s = e.context.socialProviders.find((g)=>g.id === e.params.id);
    if (!s) throw e.context.logger.error("Oauth provider with id", e.params.id, "not found"), e.redirect(`${e.context.baseURL}/error?error=oauth_provider_not_found`);
    let { codeVerifier: a, callbackURL: d, link: A, errorURL: c, newUserURL: p } = await so(e), l;
    try {
        l = await s.validateAuthorizationCode({
            code: r,
            codeVerifier: a,
            redirectURI: `${e.context.baseURL}/callback/${s.id}`
        });
    } catch (g) {
        throw e.context.logger.error("", g), e.redirect(`${e.context.baseURL}/error?error=please_restart_the_process`);
    }
    let K = await s.getUserInfo(l).then((g)=>g?.user);
    function y(g) {
        let w = c || d || `${e.context.baseURL}/error`;
        throw w.includes("?") ? w = `${w}&error=${g}` : w = `${w}?error=${g}`, e.redirect(w);
    }
    if (!K) return e.context.logger.error("Unable to get user info"), y("unable_to_get_user_info");
    if (!K.email) return e.context.logger.error("Provider did not return email. This could be due to misconfiguration in the provider settings."), y("email_not_found");
    if (!d) throw e.context.logger.error("No callback URL found"), e.redirect(`${e.context.baseURL}/error?error=please_restart_the_process`);
    if (A) {
        if (A.email !== K.email.toLowerCase()) return y("email_doesn't_match");
        if (!await e.context.internalAdapter.createAccount({
            userId: A.userId,
            providerId: s.id,
            accountId: K.id
        })) return y("unable_to_link_account");
        let w;
        try {
            w = d.toString();
        } catch  {
            w = d;
        }
        throw e.redirect(w);
    }
    let h = await Ne(e, {
        userInfo: {
            ...K,
            email: K.email,
            name: K.name || K.email
        },
        account: {
            providerId: s.id,
            accountId: K.id,
            ...l,
            scope: l.scopes?.join(",")
        },
        callbackURL: d
    });
    if (h.error) return e.context.logger.error(h.error.split(" ").join("_")), y(h.error.split(" ").join("_"));
    let { session: j, user: x } = h.data;
    await b(e, {
        session: j,
        user: x
    });
    let z;
    try {
        z = (h.isRegister && p || d).toString();
    } catch  {
        z = h.isRegister && p || d;
    }
    throw e.redirect(z);
});
;
;
var Li = u("/sign-out", {
    method: "POST",
    requireHeaders: !0,
    metadata: {
        openapi: {
            description: "Sign out the current user",
            responses: {
                200: {
                    description: "Success",
                    content: {
                        "application/json": {
                            schema: {
                                type: "object",
                                properties: {
                                    success: {
                                        type: "boolean"
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}, async (e)=>{
    let o = await e.getSignedCookie(e.context.authCookies.sessionToken.name, e.context.secret);
    if (!o) throw G(e), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: f.FAILED_TO_GET_SESSION
    });
    return await e.context.internalAdapter.deleteSession(o), G(e), e.json({
        success: !0
    });
});
;
;
function Zi(e, o, r) {
    let i = o ? new URL(o, e.baseURL) : new URL(`${e.baseURL}/error`);
    return r && Object.entries(r).forEach(([t, n])=>i.searchParams.set(t, n)), i.href;
}
function Xr(e, o, r) {
    let i = new URL(o, e.baseURL);
    return r && Object.entries(r).forEach(([t, n])=>i.searchParams.set(t, n)), i.href;
}
var ji = u("/forget-password", {
    method: "POST",
    body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        email: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "The email address of the user to send a password reset email to"
        }).email(),
        redirectTo: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "The URL to redirect the user to reset their password. If the token isn't valid or expired, it'll be redirected with a query parameter `?error=INVALID_TOKEN`. If the token is valid, it'll be redirected with a query parameter `?token=VALID_TOKEN"
        }).optional()
    }),
    metadata: {
        openapi: {
            description: "Send a password reset email to the user",
            responses: {
                200: {
                    description: "Success",
                    content: {
                        "application/json": {
                            schema: {
                                type: "object",
                                properties: {
                                    status: {
                                        type: "boolean"
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}, async (e)=>{
    if (!e.context.options.emailAndPassword?.sendResetPassword) throw e.context.logger.error("Reset password isn't enabled.Please pass an emailAndPassword.sendResetPasswordToken function in your auth config!"), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: "Reset password isn't enabled"
    });
    let { email: o, redirectTo: r } = e.body, i = await e.context.internalAdapter.findUserByEmail(o, {
        includeAccounts: !0
    });
    if (!i) return e.context.logger.error("Reset Password: User not found", {
        email: o
    }), e.json({
        status: !1
    }, {
        body: {
            status: !0
        }
    });
    let t = 60 * 60 * 1, n = L(e.context.options.emailAndPassword.resetPasswordTokenExpiresIn || t, "sec"), s = ee(24);
    await e.context.internalAdapter.createVerificationValue({
        value: i.user.id.toString(),
        identifier: `reset-password:${s}`,
        expiresAt: n
    });
    let a = `${e.context.baseURL}/reset-password/${s}?callbackURL=${r}`;
    return await e.context.options.emailAndPassword.sendResetPassword({
        user: i.user,
        url: a,
        token: s
    }, e.request), e.json({
        status: !0
    });
}), xi = u("/reset-password/:token", {
    method: "GET",
    query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        callbackURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "The URL to redirect the user to reset their password"
        })
    }),
    metadata: {
        openapi: {
            description: "Redirects the user to the callback URL with the token",
            responses: {
                200: {
                    description: "Success",
                    content: {
                        "application/json": {
                            schema: {
                                type: "object",
                                properties: {
                                    token: {
                                        type: "string"
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}, async (e)=>{
    let { token: o } = e.params, { callbackURL: r } = e.query;
    if (!o || !r) throw e.redirect(Zi(e.context, r, {
        error: "INVALID_TOKEN"
    }));
    let i = await e.context.internalAdapter.findVerificationValue(`reset-password:${o}`);
    throw !i || i.expiresAt < new Date ? e.redirect(Zi(e.context, r, {
        error: "INVALID_TOKEN"
    })) : e.redirect(Xr(e.context, r, {
        token: o
    }));
}), zi = u("/reset-password", {
    query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].optional(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        token: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional(),
        currentURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional()
    })),
    method: "POST",
    body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        newPassword: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "The new password to set"
        }),
        token: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "The token to reset the password"
        }).optional()
    }),
    metadata: {
        openapi: {
            description: "Reset the password for a user",
            responses: {
                200: {
                    description: "Success",
                    content: {
                        "application/json": {
                            schema: {
                                type: "object",
                                properties: {
                                    status: {
                                        type: "boolean"
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}, async (e)=>{
    let o = e.body.token || e.query?.token || (e.query?.currentURL ? new URL(e.query.currentURL).searchParams.get("token") : "");
    if (!o) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: f.INVALID_TOKEN
    });
    let { newPassword: r } = e.body, i = e.context.password?.config.minPasswordLength, t = e.context.password?.config.maxPasswordLength;
    if (r.length < i) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: f.PASSWORD_TOO_SHORT
    });
    if (r.length > t) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: f.PASSWORD_TOO_LONG
    });
    let n = `reset-password:${o}`, s = await e.context.internalAdapter.findVerificationValue(n);
    if (!s || s.expiresAt < new Date) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: f.INVALID_TOKEN
    });
    await e.context.internalAdapter.deleteVerificationValue(s.id);
    let a = s.value, d = await e.context.password.hash(r);
    return (await e.context.internalAdapter.findAccounts(a)).find((p)=>p.providerId === "credential") ? (await e.context.internalAdapter.updatePassword(a, d), e.json({
        status: !0
    })) : (await e.context.internalAdapter.createAccount({
        userId: a,
        providerId: "credential",
        password: d,
        accountId: a
    }), e.json({
        status: !0
    }));
});
;
;
var Bi = ()=>u("/update-user", {
        method: "POST",
        body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].record(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(), __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].any()),
        use: [
            I
        ],
        metadata: {
            openapi: {
                description: "Update the current user",
                requestBody: {
                    content: {
                        "application/json": {
                            schema: {
                                type: "object",
                                properties: {
                                    name: {
                                        type: "string",
                                        description: "The name of the user"
                                    },
                                    image: {
                                        type: "string",
                                        description: "The image of the user"
                                    }
                                }
                            }
                        }
                    }
                },
                responses: {
                    200: {
                        description: "Success",
                        content: {
                            "application/json": {
                                schema: {
                                    type: "object",
                                    properties: {
                                        user: {
                                            type: "object"
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }, async (e)=>{
        let o = e.body;
        if (o.email) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: f.EMAIL_CAN_NOT_BE_UPDATED
        });
        let { name: r, image: i, ...t } = o, n = e.context.session;
        if (i === void 0 && r === void 0 && Object.keys(t).length === 0) return e.json({
            status: !0
        });
        let s = ao(e.context.options, t, "update"), a = await e.context.internalAdapter.updateUserByEmail(n.user.email, {
            name: r,
            image: i,
            ...s
        });
        return await b(e, {
            session: n.session,
            user: a
        }), e.json({
            status: !0
        });
    }), Fi = u("/change-password", {
    method: "POST",
    body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        newPassword: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "The new password to set"
        }),
        currentPassword: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "The current password"
        }),
        revokeOtherSessions: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].boolean({
            description: "Revoke all other sessions"
        }).optional()
    }),
    use: [
        I
    ],
    metadata: {
        openapi: {
            description: "Change the password of the user",
            responses: {
                200: {
                    description: "Success",
                    content: {
                        "application/json": {
                            schema: {
                                type: "object",
                                properties: {
                                    user: {
                                        description: "The user object",
                                        $ref: "#/components/schemas/User"
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}, async (e)=>{
    let { newPassword: o, currentPassword: r, revokeOtherSessions: i } = e.body, t = e.context.session, n = e.context.password.config.minPasswordLength;
    if (o.length < n) throw e.context.logger.error("Password is too short"), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: f.PASSWORD_TOO_SHORT
    });
    let s = e.context.password.config.maxPasswordLength;
    if (o.length > s) throw e.context.logger.error("Password is too long"), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: f.PASSWORD_TOO_LONG
    });
    let d = (await e.context.internalAdapter.findAccounts(t.user.id)).find((l)=>l.providerId === "credential" && l.password);
    if (!d || !d.password) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: f.CREDENTIAL_ACCOUNT_NOT_FOUND
    });
    let A = await e.context.password.hash(o);
    if (!await e.context.password.verify({
        hash: d.password,
        password: r
    })) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: f.INVALID_PASSWORD
    });
    await e.context.internalAdapter.updateAccount(d.id, {
        password: A
    });
    let p = null;
    if (i) {
        await e.context.internalAdapter.deleteSessions(t.user.id);
        let l = await e.context.internalAdapter.createSession(t.user.id, e.headers);
        if (!l) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("INTERNAL_SERVER_ERROR", {
            message: f.FAILED_TO_GET_SESSION
        });
        await b(e, {
            session: l,
            user: t.user
        }), p = l.token;
    }
    return e.json({
        token: p
    });
}), Mi = u("/set-password", {
    method: "POST",
    body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        newPassword: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string()
    }),
    metadata: {
        SERVER_ONLY: !0
    },
    use: [
        I
    ]
}, async (e)=>{
    let { newPassword: o } = e.body, r = e.context.session, i = e.context.password.config.minPasswordLength;
    if (o.length < i) throw e.context.logger.error("Password is too short"), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: f.PASSWORD_TOO_SHORT
    });
    let t = e.context.password.config.maxPasswordLength;
    if (o.length > t) throw e.context.logger.error("Password is too long"), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: f.PASSWORD_TOO_LONG
    });
    let s = (await e.context.internalAdapter.findAccounts(r.user.id)).find((d)=>d.providerId === "credential" && d.password), a = await e.context.password.hash(o);
    if (!s) return await e.context.internalAdapter.linkAccount({
        userId: r.user.id,
        providerId: "credential",
        accountId: r.user.id,
        password: a
    }), e.json({
        status: !0
    });
    throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: "user already has a password"
    });
}), Vi = u("/delete-user", {
    method: "POST",
    use: [
        I
    ],
    body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        callbackURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional(),
        password: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional(),
        token: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional()
    }),
    metadata: {
        openapi: {
            description: "Delete the user",
            responses: {
                200: {
                    description: "Success",
                    content: {
                        "application/json": {
                            schema: {
                                type: "object"
                            }
                        }
                    }
                }
            }
        }
    }
}, async (e)=>{
    if (!e.context.options.user?.deleteUser?.enabled) throw e.context.logger.error("Delete user is disabled. Enable it in the options", {
        session: e.context.session
    }), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("NOT_FOUND");
    let o = e.context.session;
    if (e.body.password) {
        let n = (await e.context.internalAdapter.findAccounts(o.user.id)).find((a)=>a.providerId === "credential" && a.password);
        if (!n || !n.password) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: f.CREDENTIAL_ACCOUNT_NOT_FOUND
        });
        if (!await e.context.password.verify({
            hash: n.password,
            password: e.body.password
        })) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: f.INVALID_PASSWORD
        });
    } else if (e.context.options.session?.freshAge) {
        let t = o.session.createdAt.getTime(), n = e.context.options.session.freshAge;
        if (Date.now() - t > n) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: f.SESSION_EXPIRED
        });
    }
    if (e.body.token) return await Po({
        ...e,
        query: {
            token: e.body.token
        }
    }), e.json({
        success: !0,
        message: "User deleted"
    });
    if (e.context.options.user.deleteUser?.sendDeleteAccountVerification) {
        let t = _(32, "0-9", "a-z");
        await e.context.internalAdapter.createVerificationValue({
            value: o.user.id,
            identifier: `delete-account-${t}`,
            expiresAt: new Date(Date.now() + 1e3 * 60 * 60 * 24)
        });
        let n = `${e.context.baseURL}/delete-user/callback?token=${t}&callbackURL=${e.body.callbackURL || "/"}`;
        return await e.context.options.user.deleteUser.sendDeleteAccountVerification({
            user: o.user,
            url: n,
            token: t
        }, e.request), e.json({
            success: !0,
            message: "Verification email sent"
        });
    }
    let r = e.context.options.user.deleteUser?.beforeDelete;
    r && await r(o.user, e.request), await e.context.internalAdapter.deleteUser(o.user.id), await e.context.internalAdapter.deleteSessions(o.user.id), await e.context.internalAdapter.deleteAccounts(o.user.id), G(e);
    let i = e.context.options.user.deleteUser?.afterDelete;
    return i && await i(o.user, e.request), e.json({
        success: !0,
        message: "User deleted"
    });
}), Po = u("/delete-user/callback", {
    method: "GET",
    query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        token: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
        callbackURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional()
    })
}, async (e)=>{
    if (!e.context.options.user?.deleteUser?.enabled) throw e.context.logger.error("Delete user is disabled. Enable it in the options"), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("NOT_FOUND");
    let o = await v(e);
    if (!o) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("NOT_FOUND", {
        message: f.FAILED_TO_GET_USER_INFO
    });
    let r = await e.context.internalAdapter.findVerificationValue(`delete-account-${e.query.token}`);
    if (!r || r.expiresAt < new Date) throw r && await e.context.internalAdapter.deleteVerificationValue(r.id), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("NOT_FOUND", {
        message: f.INVALID_TOKEN
    });
    if (r.value !== o.user.id) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("NOT_FOUND", {
        message: f.INVALID_TOKEN
    });
    let i = e.context.options.user.deleteUser?.beforeDelete;
    i && await i(o.user, e.request), await e.context.internalAdapter.deleteUser(o.user.id), await e.context.internalAdapter.deleteSessions(o.user.id), await e.context.internalAdapter.deleteAccounts(o.user.id), await e.context.internalAdapter.deleteVerificationValue(r.id), G(e);
    let t = e.context.options.user.deleteUser?.afterDelete;
    if (t && await t(o.user, e.request), e.query.callbackURL) throw e.redirect(e.query.callbackURL || "/");
    return e.json({
        success: !0,
        message: "User deleted"
    });
}), qi = u("/change-email", {
    method: "POST",
    query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        currentURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional()
    }).optional(),
    body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        newEmail: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "The new email to set"
        }).email(),
        callbackURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "The URL to redirect to after email verification"
        }).optional()
    }),
    use: [
        I
    ],
    metadata: {
        openapi: {
            responses: {
                200: {
                    description: "Success",
                    content: {
                        "application/json": {
                            schema: {
                                type: "object",
                                properties: {
                                    user: {
                                        type: "object"
                                    },
                                    status: {
                                        type: "boolean"
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}, async (e)=>{
    if (!e.context.options.user?.changeEmail?.enabled) throw e.context.logger.error("Change email is disabled."), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: "Change email is disabled"
    });
    if (e.body.newEmail === e.context.session.user.email) throw e.context.logger.error("Email is the same"), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: "Email is the same"
    });
    if (await e.context.internalAdapter.findUserByEmail(e.body.newEmail)) throw e.context.logger.error("Email already exists"), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: "Couldn't update your email"
    });
    if (e.context.session.user.emailVerified !== !0) {
        let t = await e.context.internalAdapter.updateUserByEmail(e.context.session.user.email, {
            email: e.body.newEmail
        });
        return e.json({
            status: !0
        });
    }
    if (!e.context.options.user.changeEmail.sendChangeEmailVerification) throw e.context.logger.error("Verification email isn't enabled."), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: "Verification email isn't enabled"
    });
    let r = await Ke(e.context.secret, e.context.session.user.email, e.body.newEmail), i = `${e.context.baseURL}/verify-email?token=${r}&callbackURL=${e.body.callbackURL || e.query?.currentURL || "/"}`;
    return await e.context.options.user.changeEmail.sendChangeEmailVerification({
        user: e.context.session.user,
        newEmail: e.body.newEmail,
        url: i,
        token: r
    }, e.request), e.json({
        status: !0
    });
});
;
;
var Hi = u("/list-accounts", {
    method: "GET",
    use: [
        I
    ],
    metadata: {
        openapi: {
            description: "List all accounts linked to the user",
            responses: {
                200: {
                    description: "Success",
                    content: {
                        "application/json": {
                            schema: {
                                type: "array",
                                items: {
                                    type: "object",
                                    properties: {
                                        id: {
                                            type: "string"
                                        },
                                        provider: {
                                            type: "string"
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}, async (e)=>{
    let o = e.context.session, r = await e.context.internalAdapter.findAccounts(o.user.id);
    return e.json(r.map((i)=>({
            id: i.id,
            provider: i.providerId
        })));
}), $i = u("/link-social", {
    method: "POST",
    requireHeaders: !0,
    query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        currentURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional()
    }).optional(),
    body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        callbackURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "The URL to redirect to after the user has signed in"
        }).optional(),
        provider: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].enum(Ro, {
            description: "The OAuth2 provider to use"
        })
    }),
    use: [
        I
    ],
    metadata: {
        openapi: {
            description: "Link a social account to the user",
            responses: {
                200: {
                    description: "Success",
                    content: {
                        "application/json": {
                            schema: {
                                type: "object",
                                properties: {
                                    url: {
                                        type: "string"
                                    },
                                    redirect: {
                                        type: "boolean"
                                    }
                                },
                                required: [
                                    "url",
                                    "redirect"
                                ]
                            }
                        }
                    }
                }
            }
        }
    }
}, async (e)=>{
    let o = e.context.session;
    if ((await e.context.internalAdapter.findAccounts(o.user.id)).find((a)=>a.providerId === e.body.provider)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: f.SOCIAL_ACCOUNT_ALREADY_LINKED
    });
    let t = e.context.socialProviders.find((a)=>a.id === e.body.provider);
    if (!t) throw e.context.logger.error("Provider not found. Make sure to add the provider in your auth config", {
        provider: e.body.provider
    }), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("NOT_FOUND", {
        message: f.PROVIDER_NOT_FOUND
    });
    let n = await Se(e, {
        userId: o.user.id,
        email: o.user.email
    }), s = await t.createAuthorizationURL({
        state: n.state,
        codeVerifier: n.codeVerifier,
        redirectURI: `${e.context.baseURL}/callback/${t.id}`
    });
    return e.json({
        url: s.toString(),
        redirect: !0
    });
});
var Qi = (e, o)=>{
    let r = {};
    for (let [i, t] of Object.entries(e))r[i] = (n)=>t({
            ...n,
            context: {
                ...o,
                ...n.context
            }
        }), r[i].path = t.path, r[i].method = t.method, r[i].options = t.options, r[i].headers = t.headers;
    return r;
};
function co(e) {
    let o = e;
    return {
        newRole (r) {
            return Yr(r);
        }
    };
}
function Yr(e) {
    return {
        statements: e,
        authorize (o, r) {
            for (let [i, t] of Object.entries(o)){
                let n = e[i];
                return n ? (r === "OR" ? t.some((a)=>n.includes(a)) : t.every((a)=>n.includes(a))) ? {
                    success: !0
                } : {
                    success: !1,
                    error: `Unauthorized to access resource "${i}"`
                } : {
                    success: !1,
                    error: `You are not allowed to access resource: ${i}`
                };
            }
            return {
                success: !1,
                error: "Not authorized"
            };
        }
    };
}
var en = {
    organization: [
        "update",
        "delete"
    ],
    member: [
        "create",
        "update",
        "delete"
    ],
    invitation: [
        "create",
        "cancel"
    ]
}, Do = co(en), on = Do.newRole({
    organization: [
        "update"
    ],
    invitation: [
        "create",
        "cancel"
    ],
    member: [
        "create",
        "update",
        "delete"
    ]
}), tn = Do.newRole({
    organization: [
        "update",
        "delete"
    ],
    member: [
        "create",
        "update",
        "delete"
    ],
    invitation: [
        "create",
        "cancel"
    ]
}), rn = Do.newRole({
    organization: [],
    member: [],
    invitation: []
}), Wi = {
    admin: on,
    owner: tn,
    member: rn
};
var nn = {
    proto: /"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,
    constructor: /"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,
    protoShort: /"__proto__"\s*:/,
    constructorShort: /"constructor"\s*:/
}, sn = /^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/, Ji = {
    true: !0,
    false: !1,
    null: null,
    undefined: void 0,
    nan: Number.NaN,
    infinity: Number.POSITIVE_INFINITY,
    "-infinity": Number.NEGATIVE_INFINITY
}, an = /^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d{1,7}))?(?:Z|([+-])(\d{2}):(\d{2}))$/;
function dn(e) {
    return e instanceof Date && !isNaN(e.getTime());
}
function An(e) {
    let o = an.exec(e);
    if (!o) return null;
    let [, r, i, t, n, s, a, d, A, c, p] = o, l = new Date(Date.UTC(parseInt(r, 10), parseInt(i, 10) - 1, parseInt(t, 10), parseInt(n, 10), parseInt(s, 10), parseInt(a, 10), d ? parseInt(d.padEnd(3, "0"), 10) : 0));
    if (A) {
        let K = (parseInt(c, 10) * 60 + parseInt(p, 10)) * (A === "+" ? -1 : 1);
        l.setUTCMinutes(l.getUTCMinutes() + K);
    }
    return dn(l) ? l : null;
}
function cn(e, o = {}) {
    let { strict: r = !1, warnings: i = !1, reviver: t, parseDates: n = !0 } = o;
    if (typeof e != "string") return e;
    let s = e.trim();
    if (s[0] === '"' && s.endsWith('"') && !s.slice(1, -1).includes('"')) return s.slice(1, -1);
    let a = s.toLowerCase();
    if (a.length <= 9 && a in Ji) return Ji[a];
    if (!sn.test(s)) {
        if (r) throw new SyntaxError("[better-json] Invalid JSON");
        return e;
    }
    if (Object.entries(nn).some(([A, c])=>{
        let p = c.test(s);
        return p && i && console.warn(`[better-json] Detected potential prototype pollution attempt using ${A} pattern`), p;
    }) && r) throw new Error("[better-json] Potential prototype pollution attempt detected");
    try {
        return JSON.parse(s, (c, p)=>{
            if (c === "__proto__" || c === "constructor" && p && typeof p == "object" && "prototype" in p) {
                i && console.warn(`[better-json] Dropping "${c}" key to prevent prototype pollution`);
                return;
            }
            if (n && typeof p == "string") {
                let l = An(p);
                if (l) return l;
            }
            return t ? t(c, p) : p;
        });
    } catch (A) {
        if (r) throw A;
        return e;
    }
}
function un(e, o = {
    strict: !0
}) {
    return cn(e, o);
}
var Xi = un;
var H = (e, o)=>{
    let r = e.adapter;
    return {
        findOrganizationBySlug: async (i)=>await r.findOne({
                model: "organization",
                where: [
                    {
                        field: "slug",
                        value: i
                    }
                ]
            }),
        createOrganization: async (i)=>{
            let t = await r.create({
                model: "organization",
                data: {
                    ...i.organization,
                    metadata: i.organization.metadata ? JSON.stringify(i.organization.metadata) : void 0
                }
            }), n = await r.create({
                model: "member",
                data: {
                    organizationId: t.id,
                    userId: i.user.id,
                    createdAt: new Date,
                    role: o?.creatorRole || "owner"
                }
            });
            return {
                ...t,
                metadata: t.metadata ? JSON.parse(t.metadata) : void 0,
                members: [
                    {
                        ...n,
                        user: {
                            id: i.user.id,
                            name: i.user.name,
                            email: i.user.email,
                            image: i.user.image
                        }
                    }
                ]
            };
        },
        findMemberByEmail: async (i)=>{
            let t = await r.findOne({
                model: "user",
                where: [
                    {
                        field: "email",
                        value: i.email
                    }
                ]
            });
            if (!t) return null;
            let n = await r.findOne({
                model: "member",
                where: [
                    {
                        field: "organizationId",
                        value: i.organizationId
                    },
                    {
                        field: "userId",
                        value: t.id
                    }
                ]
            });
            return n ? {
                ...n,
                user: {
                    id: t.id,
                    name: t.name,
                    email: t.email,
                    image: t.image
                }
            } : null;
        },
        findMemberByOrgId: async (i)=>{
            let [t, n] = await Promise.all([
                await r.findOne({
                    model: "member",
                    where: [
                        {
                            field: "userId",
                            value: i.userId
                        },
                        {
                            field: "organizationId",
                            value: i.organizationId
                        }
                    ]
                }),
                await r.findOne({
                    model: "user",
                    where: [
                        {
                            field: "id",
                            value: i.userId
                        }
                    ]
                })
            ]);
            return !n || !t ? null : {
                ...t,
                user: {
                    id: n.id,
                    name: n.name,
                    email: n.email,
                    image: n.image
                }
            };
        },
        findMemberById: async (i)=>{
            let t = await r.findOne({
                model: "member",
                where: [
                    {
                        field: "id",
                        value: i
                    }
                ]
            });
            if (!t) return null;
            let n = await r.findOne({
                model: "user",
                where: [
                    {
                        field: "id",
                        value: t.userId
                    }
                ]
            });
            return n ? {
                ...t,
                user: {
                    id: n.id,
                    name: n.name,
                    email: n.email,
                    image: n.image
                }
            } : null;
        },
        createMember: async (i)=>await r.create({
                model: "member",
                data: i
            }),
        updateMember: async (i, t)=>await r.update({
                model: "member",
                where: [
                    {
                        field: "id",
                        value: i
                    }
                ],
                update: {
                    role: t
                }
            }),
        deleteMember: async (i)=>await r.delete({
                model: "member",
                where: [
                    {
                        field: "id",
                        value: i
                    }
                ]
            }),
        updateOrganization: async (i, t)=>{
            let n = await r.update({
                model: "organization",
                where: [
                    {
                        field: "id",
                        value: i
                    }
                ],
                update: {
                    ...t,
                    metadata: typeof t.metadata == "object" ? JSON.stringify(t.metadata) : t.metadata
                }
            });
            return n ? {
                ...n,
                metadata: n.metadata ? Xi(n.metadata) : void 0
            } : null;
        },
        deleteOrganization: async (i)=>(await r.delete({
                model: "member",
                where: [
                    {
                        field: "organizationId",
                        value: i
                    }
                ]
            }), await r.delete({
                model: "invitation",
                where: [
                    {
                        field: "organizationId",
                        value: i
                    }
                ]
            }), await r.delete({
                model: "organization",
                where: [
                    {
                        field: "id",
                        value: i
                    }
                ]
            }), i),
        setActiveOrganization: async (i, t)=>await e.internalAdapter.updateSession(i, {
                activeOrganizationId: t
            }),
        findOrganizationById: async (i)=>await r.findOne({
                model: "organization",
                where: [
                    {
                        field: "id",
                        value: i
                    }
                ]
            }),
        findFullOrganization: async ({ organizationId: i, isSlug: t })=>{
            let n = await r.findOne({
                model: "organization",
                where: [
                    {
                        field: t ? "slug" : "id",
                        value: i
                    }
                ]
            });
            if (!n) return null;
            let [s, a] = await Promise.all([
                r.findMany({
                    model: "invitation",
                    where: [
                        {
                            field: "organizationId",
                            value: n.id
                        }
                    ]
                }),
                r.findMany({
                    model: "member",
                    where: [
                        {
                            field: "organizationId",
                            value: n.id
                        }
                    ]
                })
            ]);
            if (!n) return null;
            let d = a.map((l)=>l.userId), A = await r.findMany({
                model: "user",
                where: [
                    {
                        field: "id",
                        value: d,
                        operator: "in"
                    }
                ]
            }), c = new Map(A.map((l)=>[
                    l.id,
                    l
                ])), p = a.map((l)=>{
                let K = c.get(l.userId);
                if (!K) throw new ae("Unexpected error: User not found for member");
                return {
                    ...l,
                    user: {
                        id: K.id,
                        name: K.name,
                        email: K.email,
                        image: K.image
                    }
                };
            });
            return {
                ...n,
                invitations: s,
                members: p
            };
        },
        listOrganizations: async (i)=>{
            let t = await r.findMany({
                model: "member",
                where: [
                    {
                        field: "userId",
                        value: i
                    }
                ]
            });
            if (!t || t.length === 0) return [];
            let n = t.map((a)=>a.organizationId);
            return await r.findMany({
                model: "organization",
                where: [
                    {
                        field: "id",
                        value: n,
                        operator: "in"
                    }
                ]
            });
        },
        createInvitation: async ({ invitation: i, user: t })=>{
            let s = L(o?.invitationExpiresIn || 1728e5);
            return await r.create({
                model: "invitation",
                data: {
                    email: i.email,
                    role: i.role,
                    organizationId: i.organizationId,
                    status: "pending",
                    expiresAt: s,
                    inviterId: t.id
                }
            });
        },
        findInvitationById: async (i)=>await r.findOne({
                model: "invitation",
                where: [
                    {
                        field: "id",
                        value: i
                    }
                ]
            }),
        findPendingInvitation: async (i)=>(await r.findMany({
                model: "invitation",
                where: [
                    {
                        field: "email",
                        value: i.email
                    },
                    {
                        field: "organizationId",
                        value: i.organizationId
                    },
                    {
                        field: "status",
                        value: "pending"
                    }
                ]
            })).filter((n)=>new Date(n.expiresAt) > new Date),
        updateInvitation: async (i)=>await r.update({
                model: "invitation",
                where: [
                    {
                        field: "id",
                        value: i.invitationId
                    }
                ],
                update: {
                    status: i.status
                }
            })
    };
};
;
var Q = N(async (e)=>({})), J = N({
    use: [
        I
    ]
}, async (e)=>({
        session: e.context.session
    }));
;
;
var Yi = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(), ln = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].enum([
    "pending",
    "accepted",
    "rejected",
    "canceled"
]).default("pending"), ju = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
    id: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().default(ee),
    name: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    slug: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    logo: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().nullish(),
    metadata: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].record(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string()).or(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().transform((e)=>JSON.parse(e))).nullish(),
    createdAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].date()
}), xu = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
    id: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().default(ee),
    organizationId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    userId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    role: Yi,
    createdAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].date()
}), zu = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
    id: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().default(ee),
    organizationId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    email: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    role: Yi,
    status: ln,
    inviterId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    expiresAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].date()
});
;
var O = {
    YOU_ARE_NOT_ALLOWED_TO_CREATE_A_NEW_ORGANIZATION: "You are not allowed to create a new organization",
    YOU_HAVE_REACHED_THE_MAXIMUM_NUMBER_OF_ORGANIZATIONS: "You have reached the maximum number of organizations",
    ORGANIZATION_ALREADY_EXISTS: "Organization already exists",
    ORGANIZATION_NOT_FOUND: "Organization not found",
    USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION: "User is not a member of the organization",
    YOU_ARE_NOT_ALLOWED_TO_UPDATE_THIS_ORGANIZATION: "You are not allowed to update this organization",
    YOU_ARE_NOT_ALLOWED_TO_DELETE_THIS_ORGANIZATION: "You are not allowed to delete this organization",
    NO_ACTIVE_ORGANIZATION: "No active organization",
    USER_IS_ALREADY_A_MEMBER_OF_THIS_ORGANIZATION: "User is already a member of this organization",
    MEMBER_NOT_FOUND: "Member not found",
    ROLE_NOT_FOUND: "Role not found",
    YOU_CANNOT_LEAVE_THE_ORGANIZATION_AS_THE_ONLY_OWNER: "You cannot leave the organization as the only owner",
    YOU_ARE_NOT_ALLOWED_TO_DELETE_THIS_MEMBER: "You are not allowed to delete this member",
    YOU_ARE_NOT_ALLOWED_TO_INVITE_USERS_TO_THIS_ORGANIZATION: "You are not allowed to invite users to this organization",
    USER_IS_ALREADY_INVITED_TO_THIS_ORGANIZATION: "User is already invited to this organization",
    INVITATION_NOT_FOUND: "Invitation not found",
    YOU_ARE_NOT_THE_RECIPIENT_OF_THE_INVITATION: "You are not the recipient of the invitation",
    YOU_ARE_NOT_ALLOWED_TO_CANCEL_THIS_INVITATION: "You are not allowed to cancel this invitation",
    INVITER_IS_NO_LONGER_A_MEMBER_OF_THE_ORGANIZATION: "Inviter is no longer a member of the organization"
};
var et = (e)=>u("/organization/invite-member", {
        method: "POST",
        use: [
            Q,
            J
        ],
        body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
            email: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                description: "The email address of the user to invite"
            }),
            role: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                description: "The role to assign to the user"
            }),
            organizationId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                description: "The organization ID to invite the user to"
            }).optional(),
            resend: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].boolean({
                description: "Resend the invitation email, if the user is already invited"
            }).optional()
        }),
        metadata: {
            openapi: {
                description: "Invite a user to an organization",
                responses: {
                    200: {
                        description: "Success",
                        content: {
                            "application/json": {
                                schema: {
                                    type: "object",
                                    properties: {
                                        id: {
                                            type: "string"
                                        },
                                        email: {
                                            type: "string"
                                        },
                                        role: {
                                            type: "string"
                                        },
                                        organizationId: {
                                            type: "string"
                                        },
                                        inviterId: {
                                            type: "string"
                                        },
                                        status: {
                                            type: "string"
                                        },
                                        expiresAt: {
                                            type: "string"
                                        }
                                    },
                                    required: [
                                        "id",
                                        "email",
                                        "role",
                                        "organizationId",
                                        "inviterId",
                                        "status",
                                        "expiresAt"
                                    ]
                                }
                            }
                        }
                    }
                }
            }
        }
    }, async (o)=>{
        if (!o.context.orgOptions.sendInvitationEmail) throw o.context.logger.warn("Invitation email is not enabled. Pass `sendInvitationEmail` to the plugin options to enable it."), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: "Invitation email is not enabled"
        });
        let r = o.context.session, i = o.body.organizationId || r.session.activeOrganizationId;
        if (!i) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: O.ORGANIZATION_NOT_FOUND
        });
        let t = H(o.context, o.context.orgOptions), n = await t.findMemberByOrgId({
            userId: r.user.id,
            organizationId: i
        });
        if (!n) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: O.MEMBER_NOT_FOUND
        });
        let s = o.context.roles[n.role];
        if (!s) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: O.ROLE_NOT_FOUND
        });
        if (s.authorize({
            invitation: [
                "create"
            ]
        }).error) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
            message: O.YOU_ARE_NOT_ALLOWED_TO_INVITE_USERS_TO_THIS_ORGANIZATION
        });
        if (await t.findMemberByEmail({
            email: o.body.email,
            organizationId: i
        })) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: O.USER_IS_ALREADY_A_MEMBER_OF_THIS_ORGANIZATION
        });
        if ((await t.findPendingInvitation({
            email: o.body.email,
            organizationId: i
        })).length && !o.body.resend) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: O.USER_IS_ALREADY_INVITED_TO_THIS_ORGANIZATION
        });
        let c = await t.createInvitation({
            invitation: {
                role: o.body.role,
                email: o.body.email,
                organizationId: i
            },
            user: r.user
        }), p = await t.findOrganizationById(i);
        if (!p) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: O.ORGANIZATION_NOT_FOUND
        });
        return await o.context.orgOptions.sendInvitationEmail?.({
            id: c.id,
            role: c.role,
            email: c.email,
            organization: p,
            inviter: {
                ...n,
                user: r.user
            }
        }, o.request), o.json(c);
    }), ot = u("/organization/accept-invitation", {
    method: "POST",
    body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        invitationId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "The ID of the invitation to accept"
        })
    }),
    use: [
        Q,
        J
    ],
    metadata: {
        openapi: {
            description: "Accept an invitation to an organization",
            responses: {
                200: {
                    description: "Success",
                    content: {
                        "application/json": {
                            schema: {
                                type: "object",
                                properties: {
                                    invitation: {
                                        type: "object"
                                    },
                                    member: {
                                        type: "object"
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}, async (e)=>{
    let o = e.context.session, r = H(e.context, e.context.orgOptions), i = await r.findInvitationById(e.body.invitationId);
    if (!i || i.expiresAt < new Date || i.status !== "pending") throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: O.INVITATION_NOT_FOUND
    });
    if (i.email !== o.user.email) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
        message: O.YOU_ARE_NOT_THE_RECIPIENT_OF_THE_INVITATION
    });
    let t = await r.updateInvitation({
        invitationId: e.body.invitationId,
        status: "accepted"
    }), n = await r.createMember({
        organizationId: i.organizationId,
        userId: o.user.id,
        role: i.role,
        createdAt: new Date
    });
    return await r.setActiveOrganization(o.session.token, i.organizationId), t ? e.json({
        invitation: t,
        member: n
    }) : e.json(null, {
        status: 400,
        body: {
            message: O.INVITATION_NOT_FOUND
        }
    });
}), it = u("/organization/reject-invitation", {
    method: "POST",
    body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        invitationId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "The ID of the invitation to reject"
        })
    }),
    use: [
        Q,
        J
    ],
    metadata: {
        openapi: {
            description: "Reject an invitation to an organization",
            responses: {
                200: {
                    description: "Success",
                    content: {
                        "application/json": {
                            schema: {
                                type: "object",
                                properties: {
                                    invitation: {
                                        type: "object"
                                    },
                                    member: {
                                        type: "null"
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}, async (e)=>{
    let o = e.context.session, r = H(e.context, e.context.orgOptions), i = await r.findInvitationById(e.body.invitationId);
    if (!i || i.expiresAt < new Date || i.status !== "pending") throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: "Invitation not found!"
    });
    if (i.email !== o.user.email) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
        message: O.YOU_ARE_NOT_THE_RECIPIENT_OF_THE_INVITATION
    });
    let t = await r.updateInvitation({
        invitationId: e.body.invitationId,
        status: "rejected"
    });
    return e.json({
        invitation: t,
        member: null
    });
}), tt = u("/organization/cancel-invitation", {
    method: "POST",
    body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        invitationId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "The ID of the invitation to cancel"
        })
    }),
    use: [
        Q,
        J
    ],
    openapi: {
        description: "Cancel an invitation to an organization",
        responses: {
            200: {
                description: "Success",
                content: {
                    "application/json": {
                        schema: {
                            type: "object",
                            properties: {
                                invitation: {
                                    type: "object"
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}, async (e)=>{
    let o = e.context.session, r = H(e.context, e.context.orgOptions), i = await r.findInvitationById(e.body.invitationId);
    if (!i) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: O.INVITATION_NOT_FOUND
    });
    let t = await r.findMemberByOrgId({
        userId: o.user.id,
        organizationId: i.organizationId
    });
    if (!t) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: O.MEMBER_NOT_FOUND
    });
    if (e.context.roles[t.role].authorize({
        invitation: [
            "cancel"
        ]
    }).error) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
        message: O.YOU_ARE_NOT_ALLOWED_TO_CANCEL_THIS_INVITATION
    });
    let s = await r.updateInvitation({
        invitationId: e.body.invitationId,
        status: "canceled"
    });
    return e.json(s);
}), rt = u("/organization/get-invitation", {
    method: "GET",
    use: [
        Q
    ],
    requireHeaders: !0,
    query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        id: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "The ID of the invitation to get"
        })
    }),
    metadata: {
        openapi: {
            description: "Get an invitation by ID",
            responses: {
                200: {
                    description: "Success",
                    content: {
                        "application/json": {
                            schema: {
                                type: "object",
                                properties: {
                                    id: {
                                        type: "string"
                                    },
                                    email: {
                                        type: "string"
                                    },
                                    role: {
                                        type: "string"
                                    },
                                    organizationId: {
                                        type: "string"
                                    },
                                    inviterId: {
                                        type: "string"
                                    },
                                    status: {
                                        type: "string"
                                    },
                                    expiresAt: {
                                        type: "string"
                                    },
                                    organizationName: {
                                        type: "string"
                                    },
                                    organizationSlug: {
                                        type: "string"
                                    },
                                    inviterEmail: {
                                        type: "string"
                                    }
                                },
                                required: [
                                    "id",
                                    "email",
                                    "role",
                                    "organizationId",
                                    "inviterId",
                                    "status",
                                    "expiresAt",
                                    "organizationName",
                                    "organizationSlug",
                                    "inviterEmail"
                                ]
                            }
                        }
                    }
                }
            }
        }
    }
}, async (e)=>{
    let o = await v(e);
    if (!o) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
        message: "Not authenticated"
    });
    let r = H(e.context, e.context.orgOptions), i = await r.findInvitationById(e.query.id);
    if (!i || i.status !== "pending" || i.expiresAt < new Date) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: "Invitation not found!"
    });
    if (i.email !== o.user.email) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
        message: O.YOU_ARE_NOT_THE_RECIPIENT_OF_THE_INVITATION
    });
    let t = await r.findOrganizationById(i.organizationId);
    if (!t) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: O.ORGANIZATION_NOT_FOUND
    });
    let n = await r.findMemberByOrgId({
        userId: i.inviterId,
        organizationId: i.organizationId
    });
    if (!n) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: O.INVITER_IS_NO_LONGER_A_MEMBER_OF_THE_ORGANIZATION
    });
    return e.json({
        ...i,
        organizationName: t.name,
        organizationSlug: t.slug,
        inviterEmail: n.user.email
    });
});
;
;
var nt = ()=>u("/organization/add-member", {
        method: "POST",
        body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
            userId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
            role: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
            organizationId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional()
        }),
        use: [
            Q
        ],
        metadata: {
            SERVER_ONLY: !0
        }
    }, async (e)=>{
        let o = e.body.userId ? await v(e).catch((a)=>null) : null, r = e.body.organizationId || o?.session.activeOrganizationId;
        if (!r) return e.json(null, {
            status: 400,
            body: {
                message: O.NO_ACTIVE_ORGANIZATION
            }
        });
        let i = H(e.context, e.context.orgOptions), t = await e.context.internalAdapter.findUserById(e.body.userId);
        if (!t) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: f.USER_NOT_FOUND
        });
        if (await i.findMemberByEmail({
            email: t.email,
            organizationId: r
        })) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: O.USER_IS_ALREADY_A_MEMBER_OF_THIS_ORGANIZATION
        });
        let s = await i.createMember({
            id: ee(),
            organizationId: r,
            userId: t.id,
            role: e.body.role,
            createdAt: new Date
        });
        return e.json(s);
    }), st = u("/organization/remove-member", {
    method: "POST",
    body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        memberIdOrEmail: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "The ID or email of the member to remove"
        }),
        organizationId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "The ID of the organization to remove the member from. If not provided, the active organization will be used"
        }).optional()
    }),
    use: [
        Q,
        J
    ],
    metadata: {
        openapi: {
            description: "Remove a member from an organization",
            responses: {
                200: {
                    description: "Success",
                    content: {
                        "application/json": {
                            schema: {
                                type: "object",
                                properties: {
                                    member: {
                                        type: "object",
                                        properties: {
                                            id: {
                                                type: "string"
                                            },
                                            userId: {
                                                type: "string"
                                            },
                                            organizationId: {
                                                type: "string"
                                            },
                                            role: {
                                                type: "string"
                                            }
                                        },
                                        required: [
                                            "id",
                                            "userId",
                                            "organizationId",
                                            "role"
                                        ]
                                    }
                                },
                                required: [
                                    "member"
                                ]
                            }
                        }
                    }
                }
            }
        }
    }
}, async (e)=>{
    let o = e.context.session, r = e.body.organizationId || o.session.activeOrganizationId;
    if (!r) return e.json(null, {
        status: 400,
        body: {
            message: O.NO_ACTIVE_ORGANIZATION
        }
    });
    let i = H(e.context, e.context.orgOptions), t = await i.findMemberByOrgId({
        userId: o.user.id,
        organizationId: r
    });
    if (!t) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: O.MEMBER_NOT_FOUND
    });
    let n = e.context.roles[t.role];
    if (!n) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: O.ROLE_NOT_FOUND
    });
    let s = o.user.email === e.body.memberIdOrEmail || t.id === e.body.memberIdOrEmail;
    if (s && t.role === (e.context.orgOptions?.creatorRole || "owner")) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: O.YOU_CANNOT_LEAVE_THE_ORGANIZATION_AS_THE_ONLY_OWNER
    });
    if (!(s || n.authorize({
        member: [
            "delete"
        ]
    }).success)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
        message: O.YOU_ARE_NOT_ALLOWED_TO_DELETE_THIS_MEMBER
    });
    let A = null;
    if (e.body.memberIdOrEmail.includes("@") ? A = await i.findMemberByEmail({
        email: e.body.memberIdOrEmail,
        organizationId: r
    }) : A = await i.findMemberById(e.body.memberIdOrEmail), A?.organizationId !== r) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: O.MEMBER_NOT_FOUND
    });
    return await i.deleteMember(A.id), o.user.id === A.userId && o.session.activeOrganizationId === A.organizationId && await i.setActiveOrganization(o.session.token, null), e.json({
        member: A
    });
}), at = (e)=>u("/organization/update-member-role", {
        method: "POST",
        body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
            role: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
            memberId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
            organizationId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional()
        }),
        use: [
            Q,
            J
        ],
        metadata: {
            openapi: {
                description: "Update the role of a member in an organization",
                responses: {
                    200: {
                        description: "Success",
                        content: {
                            "application/json": {
                                schema: {
                                    type: "object",
                                    properties: {
                                        member: {
                                            type: "object",
                                            properties: {
                                                id: {
                                                    type: "string"
                                                },
                                                userId: {
                                                    type: "string"
                                                },
                                                organizationId: {
                                                    type: "string"
                                                },
                                                role: {
                                                    type: "string"
                                                }
                                            },
                                            required: [
                                                "id",
                                                "userId",
                                                "organizationId",
                                                "role"
                                            ]
                                        }
                                    },
                                    required: [
                                        "member"
                                    ]
                                }
                            }
                        }
                    }
                }
            }
        }
    }, async (o)=>{
        let r = o.context.session, i = o.body.organizationId || r.session.activeOrganizationId;
        if (!i) return o.json(null, {
            status: 400,
            body: {
                message: O.NO_ACTIVE_ORGANIZATION
            }
        });
        let t = H(o.context, o.context.orgOptions), n = await t.findMemberByOrgId({
            userId: r.user.id,
            organizationId: i
        });
        if (!n) return o.json(null, {
            status: 400,
            body: {
                message: O.MEMBER_NOT_FOUND
            }
        });
        let s = o.context.roles[n.role];
        if (!s) return o.json(null, {
            status: 400,
            body: {
                message: O.ROLE_NOT_FOUND
            }
        });
        if (s.authorize({
            member: [
                "update"
            ]
        }).error || o.body.role === "owner" && n.role !== "owner") return o.json(null, {
            body: {
                message: "You are not allowed to update this member"
            },
            status: 403
        });
        let d = await t.updateMember(o.body.memberId, o.body.role);
        return d ? o.json(d) : o.json(null, {
            status: 400,
            body: {
                message: O.MEMBER_NOT_FOUND
            }
        });
    }), dt = u("/organization/get-active-member", {
    method: "GET",
    use: [
        Q,
        J
    ],
    metadata: {
        openapi: {
            description: "Get the active member in the organization",
            responses: {
                200: {
                    description: "Success",
                    content: {
                        "application/json": {
                            schema: {
                                type: "object",
                                properties: {
                                    id: {
                                        type: "string"
                                    },
                                    userId: {
                                        type: "string"
                                    },
                                    organizationId: {
                                        type: "string"
                                    },
                                    role: {
                                        type: "string"
                                    }
                                },
                                required: [
                                    "id",
                                    "userId",
                                    "organizationId",
                                    "role"
                                ]
                            }
                        }
                    }
                }
            }
        }
    }
}, async (e)=>{
    let o = e.context.session, r = o.session.activeOrganizationId;
    if (!r) return e.json(null, {
        status: 400,
        body: {
            message: O.NO_ACTIVE_ORGANIZATION
        }
    });
    let t = await H(e.context, e.context.orgOptions).findMemberByOrgId({
        userId: o.user.id,
        organizationId: r
    });
    return t ? e.json(t) : e.json(null, {
        status: 400,
        body: {
            message: O.MEMBER_NOT_FOUND
        }
    });
});
;
;
var At = u("/organization/create", {
    method: "POST",
    body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        name: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "The name of the organization"
        }),
        slug: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "The slug of the organization"
        }),
        userId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "The user id of the organization creator. If not provided, the current user will be used. Should only be used by admins or when called by the server."
        }).optional(),
        logo: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "The logo of the organization"
        }).optional(),
        metadata: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].record(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(), __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].any(), {
            description: "The metadata of the organization"
        }).optional()
    }),
    use: [
        Q
    ],
    metadata: {
        openapi: {
            description: "Create an organization",
            responses: {
                200: {
                    description: "Success",
                    content: {
                        "application/json": {
                            schema: {
                                type: "object",
                                description: "The organization that was created",
                                $ref: "#/components/schemas/Organization"
                            }
                        }
                    }
                }
            }
        }
    }
}, async (e)=>{
    let o = await v(e);
    if (!o && (e.request || e.headers)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED");
    let r = o?.user || null;
    if (!r) {
        if (!e.body.userId) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED");
        r = await e.context.internalAdapter.findUserById(e.body.userId);
    }
    if (!r) return e.json(null, {
        status: 401
    });
    let i = e.context.orgOptions;
    if (!(typeof i?.allowUserToCreateOrganization == "function" ? await i.allowUserToCreateOrganization(r) : i?.allowUserToCreateOrganization === void 0 ? !0 : i.allowUserToCreateOrganization)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
        message: O.YOU_ARE_NOT_ALLOWED_TO_CREATE_A_NEW_ORGANIZATION
    });
    let n = H(e.context, i), s = await n.listOrganizations(r.id);
    if (typeof i.organizationLimit == "number" ? s.length >= i.organizationLimit : typeof i.organizationLimit == "function" ? await i.organizationLimit(r) : !1) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
        message: O.YOU_HAVE_REACHED_THE_MAXIMUM_NUMBER_OF_ORGANIZATIONS
    });
    if (await n.findOrganizationBySlug(e.body.slug)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: O.ORGANIZATION_ALREADY_EXISTS
    });
    let A = await n.createOrganization({
        organization: {
            id: ee(),
            slug: e.body.slug,
            name: e.body.name,
            logo: e.body.logo,
            createdAt: new Date,
            metadata: e.body.metadata
        },
        user: r
    });
    return e.context.session && await n.setActiveOrganization(e.context.session.session.token, A.id), e.json(A);
}), ct = u("/organization/update", {
    method: "POST",
    body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        data: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
            name: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                description: "The name of the organization"
            }).optional(),
            slug: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                description: "The slug of the organization"
            }).optional(),
            logo: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                description: "The logo of the organization"
            }).optional(),
            metadata: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].record(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(), __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].any(), {
                description: "The metadata of the organization"
            }).optional()
        }).partial(),
        organizationId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional()
    }),
    requireHeaders: !0,
    use: [
        Q
    ],
    metadata: {
        openapi: {
            description: "Update an organization",
            responses: {
                200: {
                    description: "Success",
                    content: {
                        "application/json": {
                            schema: {
                                type: "object",
                                description: "The updated organization",
                                $ref: "#/components/schemas/Organization"
                            }
                        }
                    }
                }
            }
        }
    }
}, async (e)=>{
    let o = await e.context.getSession(e);
    if (!o) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
        message: "User not found"
    });
    let r = e.body.organizationId || o.session.activeOrganizationId;
    if (!r) return e.json(null, {
        status: 400,
        body: {
            message: O.ORGANIZATION_NOT_FOUND
        }
    });
    let i = H(e.context, e.context.orgOptions), t = await i.findMemberByOrgId({
        userId: o.user.id,
        organizationId: r
    });
    if (!t) return e.json(null, {
        status: 400,
        body: {
            message: O.USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION
        }
    });
    let n = e.context.roles[t.role];
    if (!n) return e.json(null, {
        status: 400,
        body: {
            message: "Role not found!"
        }
    });
    if (n.authorize({
        organization: [
            "update"
        ]
    }).error) return e.json(null, {
        body: {
            message: O.YOU_ARE_NOT_ALLOWED_TO_UPDATE_THIS_ORGANIZATION
        },
        status: 403
    });
    let a = await i.updateOrganization(r, e.body.data);
    return e.json(a);
}), ut = u("/organization/delete", {
    method: "POST",
    body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        organizationId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "The organization id to delete"
        })
    }),
    requireHeaders: !0,
    use: [
        Q
    ],
    metadata: {
        openapi: {
            description: "Delete an organization",
            responses: {
                200: {
                    description: "Success",
                    content: {
                        "application/json": {
                            schema: {
                                type: "string",
                                description: "The organization id that was deleted"
                            }
                        }
                    }
                }
            }
        }
    }
}, async (e)=>{
    let o = await e.context.getSession(e);
    if (!o) return e.json(null, {
        status: 401
    });
    let r = e.body.organizationId;
    if (!r) return e.json(null, {
        status: 400,
        body: {
            message: O.ORGANIZATION_NOT_FOUND
        }
    });
    let i = H(e.context, e.context.orgOptions), t = await i.findMemberByOrgId({
        userId: o.user.id,
        organizationId: r
    });
    if (!t) return e.json(null, {
        status: 400,
        body: {
            message: O.USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION
        }
    });
    let n = e.context.roles[t.role];
    if (!n) return e.json(null, {
        status: 400,
        body: {
            message: "Role not found!"
        }
    });
    if (n.authorize({
        organization: [
            "delete"
        ]
    }).error) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
        message: O.YOU_ARE_NOT_ALLOWED_TO_DELETE_THIS_ORGANIZATION
    });
    return r === o.session.activeOrganizationId && await i.setActiveOrganization(o.session.token, null), await i.deleteOrganization(r), e.json(r);
}), lt = u("/organization/get-full-organization", {
    method: "GET",
    query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].optional(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        organizationId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "The organization id to get"
        }).optional(),
        organizationSlug: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "The organization slug to get"
        }).optional()
    })),
    requireHeaders: !0,
    use: [
        Q,
        J
    ],
    metadata: {
        openapi: {
            description: "Get the full organization",
            responses: {
                200: {
                    description: "Success",
                    content: {
                        "application/json": {
                            schema: {
                                type: "object",
                                description: "The organization",
                                $ref: "#/components/schemas/Organization"
                            }
                        }
                    }
                }
            }
        }
    }
}, async (e)=>{
    let o = e.context.session, r = e.query?.organizationSlug || e.query?.organizationId || o.session.activeOrganizationId;
    if (!r) return e.json(null, {
        status: 200
    });
    let t = await H(e.context, e.context.orgOptions).findFullOrganization({
        organizationId: r,
        isSlug: !!e.query?.organizationSlug
    });
    if (!t) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: O.ORGANIZATION_NOT_FOUND
    });
    return e.json(t);
}), pt = u("/organization/set-active", {
    method: "POST",
    body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        organizationId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "The organization id to set as active. It can be null to unset the active organization"
        }).nullable().optional(),
        organizationSlug: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
            description: "The organization slug to set as active. It can be null to unset the active organization if organizationId is not provided"
        }).optional()
    }),
    use: [
        J,
        Q
    ],
    metadata: {
        openapi: {
            description: "Set the active organization",
            responses: {
                200: {
                    description: "Success",
                    content: {
                        "application/json": {
                            schema: {
                                type: "object",
                                description: "The organization",
                                $ref: "#/components/schemas/Organization"
                            }
                        }
                    }
                }
            }
        }
    }
}, async (e)=>{
    let o = H(e.context, e.context.orgOptions), r = e.context.session, i = e.body.organizationSlug || e.body.organizationId;
    if (i === null) {
        if (!r.session.activeOrganizationId) return e.json(null);
        let d = await o.setActiveOrganization(r.session.token, null);
        return await b(e, {
            session: d,
            user: r.user
        }), e.json(null);
    }
    if (!i) {
        let a = r.session.activeOrganizationId;
        if (!a) return e.json(null);
        i = a;
    }
    let t = await o.findFullOrganization({
        organizationId: i,
        isSlug: !!e.body.organizationSlug
    });
    if (!t?.members.find((a)=>a.userId === r.user.id)) throw await o.setActiveOrganization(r.session.token, null), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
        message: O.USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION
    });
    if (!t) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: O.ORGANIZATION_NOT_FOUND
    });
    let s = await o.setActiveOrganization(r.session.token, t.id);
    return await b(e, {
        session: s,
        user: r.user
    }), e.json(t);
}), Kt = u("/organization/list", {
    method: "GET",
    use: [
        Q,
        J
    ],
    metadata: {
        openapi: {
            description: "List all organizations",
            responses: {
                200: {
                    description: "Success",
                    content: {
                        "application/json": {
                            schema: {
                                type: "array",
                                items: {
                                    $ref: "#/components/schemas/Organization"
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}, async (e)=>{
    let r = await H(e.context, e.context.orgOptions).listOrganizations(e.context.session.user.id);
    return e.json(r);
});
var pn = co({
    name: [
        "action"
    ]
}), Ul = pn.newRole({
    name: [
        "action"
    ]
}), Sl = (e)=>{
    let o = {
        createOrganization: At,
        updateOrganization: ct,
        deleteOrganization: ut,
        setActiveOrganization: pt,
        getFullOrganization: lt,
        listOrganizations: Kt,
        createInvitation: et(e),
        cancelInvitation: tt,
        acceptInvitation: ot,
        getInvitation: rt,
        rejectInvitation: it,
        addMember: nt(),
        removeMember: st,
        updateMemberRole: at(e),
        getActiveMember: dt
    }, r = {
        ...Wi,
        ...e?.roles
    };
    return {
        id: "organization",
        endpoints: {
            ...Qi(o, {
                orgOptions: e || {},
                roles: r,
                getSession: async (t)=>await v(t)
            }),
            hasPermission: u("/organization/has-permission", {
                method: "POST",
                requireHeaders: !0,
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
                    organizationId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional(),
                    permission: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].record(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(), __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].array(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string()))
                }),
                use: [
                    J
                ],
                metadata: {
                    openapi: {
                        description: "Check if the user has permission",
                        requestBody: {
                            content: {
                                "application/json": {
                                    schema: {
                                        type: "object",
                                        properties: {
                                            permission: {
                                                type: "object",
                                                description: "The permission to check"
                                            }
                                        },
                                        required: [
                                            "permission"
                                        ]
                                    }
                                }
                            }
                        },
                        responses: {
                            200: {
                                description: "Success",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                error: {
                                                    type: "string"
                                                },
                                                success: {
                                                    type: "boolean"
                                                }
                                            },
                                            required: [
                                                "success"
                                            ]
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (t)=>{
                let n = t.body.organizationId || t.context.session.session.activeOrganizationId;
                if (!n) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: O.NO_ACTIVE_ORGANIZATION
                });
                let a = await H(t.context).findMemberByOrgId({
                    userId: t.context.session.user.id,
                    organizationId: n
                });
                if (!a) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                    message: O.USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION
                });
                let A = r[a.role].authorize(t.body.permission);
                return A.error ? t.json({
                    error: A.error,
                    success: !1
                }, {
                    status: 403
                }) : t.json({
                    error: null,
                    success: !0
                });
            })
        },
        schema: {
            session: {
                fields: {
                    activeOrganizationId: {
                        type: "string",
                        required: !1,
                        fieldName: e?.schema?.session?.fields?.activeOrganizationId
                    }
                }
            },
            organization: {
                modelName: e?.schema?.organization?.modelName,
                fields: {
                    name: {
                        type: "string",
                        required: !0,
                        fieldName: e?.schema?.organization?.fields?.name
                    },
                    slug: {
                        type: "string",
                        unique: !0,
                        fieldName: e?.schema?.organization?.fields?.slug
                    },
                    logo: {
                        type: "string",
                        required: !1,
                        fieldName: e?.schema?.organization?.fields?.logo
                    },
                    createdAt: {
                        type: "date",
                        required: !0,
                        fieldName: e?.schema?.organization?.fields?.createdAt
                    },
                    metadata: {
                        type: "string",
                        required: !1,
                        fieldName: e?.schema?.organization?.fields?.metadata
                    }
                }
            },
            member: {
                modelName: e?.schema?.member?.modelName,
                fields: {
                    organizationId: {
                        type: "string",
                        required: !0,
                        references: {
                            model: "organization",
                            field: "id"
                        },
                        fieldName: e?.schema?.member?.fields?.organizationId
                    },
                    userId: {
                        type: "string",
                        required: !0,
                        fieldName: e?.schema?.member?.fields?.userId,
                        references: {
                            model: "user",
                            field: "id"
                        }
                    },
                    role: {
                        type: "string",
                        required: !0,
                        defaultValue: "member",
                        fieldName: e?.schema?.member?.fields?.role
                    },
                    createdAt: {
                        type: "date",
                        required: !0,
                        fieldName: e?.schema?.member?.fields?.createdAt
                    }
                }
            },
            invitation: {
                modelName: e?.schema?.invitation?.modelName,
                fields: {
                    organizationId: {
                        type: "string",
                        required: !0,
                        references: {
                            model: "organization",
                            field: "id"
                        },
                        fieldName: e?.schema?.invitation?.fields?.organizationId
                    },
                    email: {
                        type: "string",
                        required: !0,
                        fieldName: e?.schema?.invitation?.fields?.email
                    },
                    role: {
                        type: "string",
                        required: !1,
                        fieldName: e?.schema?.invitation?.fields?.role
                    },
                    status: {
                        type: "string",
                        required: !0,
                        defaultValue: "pending",
                        fieldName: e?.schema?.invitation?.fields?.status
                    },
                    expiresAt: {
                        type: "date",
                        required: !0,
                        fieldName: e?.schema?.invitation?.fields?.expiresAt
                    },
                    inviterId: {
                        type: "string",
                        references: {
                            model: "user",
                            field: "id"
                        },
                        fieldName: e?.schema?.invitation?.fields?.inviterId,
                        required: !0
                    }
                }
            }
        },
        $Infer: {
            Organization: {},
            Invitation: {},
            Member: {},
            ActiveOrganization: {}
        },
        $ERROR_CODES: O
    };
};
;
;
;
var uo = "two_factor";
var lo = "trust_device";
;
;
;
var ve = N({
    body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        trustDevice: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].boolean().optional()
    })
}, async (e)=>{
    let o = await v(e);
    if (!o) {
        let r = e.context.createAuthCookie(uo), i = await e.getSignedCookie(r.name, e.context.secret);
        if (!i) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
            message: "invalid two factor cookie"
        });
        let t = await e.context.internalAdapter.findUserById(i);
        if (!t) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
            message: "invalid two factor cookie"
        });
        let n = await e.context.internalAdapter.createSession(i, e.request);
        if (!n) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("INTERNAL_SERVER_ERROR", {
            message: "failed to create session"
        });
        return {
            valid: async ()=>{
                if (await b(e, {
                    session: n,
                    user: t
                }), e.body.trustDevice) {
                    let s = e.context.createAuthCookie(lo, {
                        maxAge: 2592e3
                    }), a = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hmac$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["createHMAC"])("SHA-256", "base64urlnopad").sign(e.context.secret, `${t.id}!${n.token}`);
                    await e.setSignedCookie(s.name, `${a}!${n.token}`, e.context.secret, s.attributes);
                }
                return e.json({
                    token: n.token
                });
            },
            invalid: async ()=>{
                throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                    message: "invalid two factor authentication"
                });
            },
            session: {
                session: n,
                user: t
            }
        };
    }
    return {
        valid: async ()=>e.json({
                token: o.session.token
            }),
        invalid: async ()=>{
            throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                message: "invalid two factor authentication"
            });
        },
        session: o
    };
});
;
var X = {
    OTP_NOT_ENABLED: "OTP not enabled",
    OTP_HAS_EXPIRED: "OTP has expired",
    TOTP_NOT_ENABLED: "TOTP not enabled",
    TWO_FACTOR_NOT_ENABLED: "Two factor isn't enabled",
    BACKUP_CODES_NOT_ENABLED: "Backup codes aren't enabled",
    INVALID_BACKUP_CODE: "Invalid backup code"
};
function mn(e) {
    return Array.from({
        length: e?.amount ?? 10
    }).fill(null).map(()=>_(e?.length ?? 10, "a-z", "0-9", "A-Z")).map((o)=>`${o.slice(0, 5)}-${o.slice(5)}`);
}
async function No(e, o) {
    let r = e, i = o?.customBackupCodesGenerate ? o.customBackupCodesGenerate() : mn(), t = await le({
        data: JSON.stringify(i),
        key: r
    });
    return {
        backupCodes: i,
        encryptedBackupCodes: t
    };
}
async function gn(e, o) {
    let r = await ft(e.backupCodes, o);
    return r ? {
        status: r.includes(e.code),
        updated: r.filter((i)=>i !== e.code)
    } : {
        status: !1,
        updated: null
    };
}
async function ft(e, o) {
    let r = Buffer.from(await he({
        key: o,
        data: e
    })).toString("utf-8"), i = JSON.parse(r), t = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].array(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string()).safeParse(i);
    return t.success ? t.data : null;
}
var ht = (e)=>{
    let o = "twoFactor";
    return {
        id: "backup_code",
        endpoints: {
            verifyBackupCode: u("/two-factor/verify-backup-code", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
                    code: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
                    disableSession: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].boolean().optional()
                }),
                use: [
                    ve
                ]
            }, async (r)=>{
                let i = r.context.session.user, t = await r.context.adapter.findOne({
                    model: o,
                    where: [
                        {
                            field: "userId",
                            value: i.id
                        }
                    ]
                });
                if (!t) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: X.BACKUP_CODES_NOT_ENABLED
                });
                let n = await gn({
                    backupCodes: t.backupCodes,
                    code: r.body.code
                }, r.context.secret);
                if (!n.status) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                    message: X.INVALID_BACKUP_CODE
                });
                let s = await le({
                    key: r.context.secret,
                    data: JSON.stringify(n.updated)
                });
                return await r.context.adapter.updateMany({
                    model: o,
                    update: {
                        backupCodes: s
                    },
                    where: [
                        {
                            field: "userId",
                            value: i.id
                        }
                    ]
                }), r.body.disableSession || await b(r, {
                    session: r.context.session.session,
                    user: i
                }), r.json({
                    user: i,
                    session: r.context.session
                });
            }),
            generateBackupCodes: u("/two-factor/generate-backup-codes", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
                    password: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string()
                }),
                use: [
                    I
                ]
            }, async (r)=>{
                let i = r.context.session.user;
                if (!i.twoFactorEnabled) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: X.TWO_FACTOR_NOT_ENABLED
                });
                await r.context.password.checkPassword(i.id, r);
                let t = await No(r.context.secret, e);
                return await r.context.adapter.update({
                    model: o,
                    update: {
                        backupCodes: t.encryptedBackupCodes
                    },
                    where: [
                        {
                            field: "userId",
                            value: r.context.session.user.id
                        }
                    ]
                }), r.json({
                    status: !0,
                    backupCodes: t.backupCodes
                });
            }),
            viewBackupCodes: u("/two-factor/view-backup-codes", {
                method: "GET",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
                    userId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string()
                }),
                metadata: {
                    SERVER_ONLY: !0
                }
            }, async (r)=>{
                let i = await r.context.adapter.findOne({
                    model: o,
                    where: [
                        {
                            field: "userId",
                            value: r.body.userId
                        }
                    ]
                });
                if (!i) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: "Backup codes aren't enabled"
                });
                let t = await ft(i.backupCodes, r.context.secret);
                if (!t) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: X.BACKUP_CODES_NOT_ENABLED
                });
                return r.json({
                    status: !0,
                    backupCodes: t
                });
            })
        }
    };
};
;
;
var wt = (e)=>{
    let o = {
        ...e,
        digits: e?.digits || 6,
        period: (e?.period || 3) * 60 * 1e3
    }, r = "twoFactor", i = u("/two-factor/send-otp", {
        method: "POST",
        use: [
            ve
        ],
        metadata: {
            openapi: {
                summary: "Send two factor OTP",
                description: "Send two factor OTP to the user",
                responses: {
                    200: {
                        description: "Successful response",
                        content: {
                            "application/json": {
                                schema: {
                                    type: "object",
                                    properties: {
                                        status: {
                                            type: "boolean"
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }, async (n)=>{
        if (!e || !e.sendOTP) throw n.context.logger.error("send otp isn't configured. Please configure the send otp function on otp options."), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: "otp isn't configured"
        });
        let s = n.context.session.user;
        if (!await n.context.adapter.findOne({
            model: r,
            where: [
                {
                    field: "userId",
                    value: s.id
                }
            ]
        })) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: X.OTP_NOT_ENABLED
        });
        let d = _(o.digits, "0-9");
        return await n.context.internalAdapter.createVerificationValue({
            value: d,
            identifier: `2fa-otp-${s.id}`,
            expiresAt: new Date(Date.now() + o.period)
        }), await e.sendOTP({
            user: s,
            otp: d
        }, n.request), n.json({
            status: !0
        });
    }), t = u("/two-factor/verify-otp", {
        method: "POST",
        body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
            code: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                description: "The otp code to verify"
            })
        }),
        use: [
            ve
        ],
        metadata: {
            openapi: {
                summary: "Verify two factor OTP",
                description: "Verify two factor OTP",
                responses: {
                    200: {
                        description: "Success",
                        content: {
                            "application/json": {
                                schema: {
                                    type: "object",
                                    properties: {
                                        status: {
                                            type: "boolean"
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }, async (n)=>{
        let s = n.context.session.user;
        if (!s.twoFactorEnabled) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: "two factor isn't enabled"
        });
        if (!await n.context.adapter.findOne({
            model: r,
            where: [
                {
                    field: "userId",
                    value: s.id
                }
            ]
        })) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: X.OTP_NOT_ENABLED
        });
        let d = await n.context.internalAdapter.findVerificationValue(`2fa-otp-${s.id}`);
        if (!d || d.expiresAt < new Date) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: X.OTP_HAS_EXPIRED
        });
        return d.value === n.body.code ? n.context.valid() : n.context.invalid();
    });
    return {
        id: "otp",
        endpoints: {
            sendTwoFactorOTP: i,
            verifyTwoFactorOTP: t
        }
    };
};
;
;
;
var Ct = (e)=>{
    let o = {
        ...e,
        digits: e?.digits || 6,
        period: e?.period || 30
    }, r = "twoFactor", i = u("/totp/generate", {
        method: "POST",
        use: [
            I
        ],
        metadata: {
            openapi: {
                summary: "Generate TOTP code",
                description: "Use this endpoint to generate a TOTP code",
                responses: {
                    200: {
                        description: "Successful response",
                        content: {
                            "application/json": {
                                schema: {
                                    type: "object",
                                    properties: {
                                        code: {
                                            type: "string"
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }, async (s)=>{
        if (e?.disable) throw s.context.logger.error("totp isn't configured. please pass totp option on two factor plugin to enable totp"), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: "totp isn't configured"
        });
        let a = s.context.session.user, d = await s.context.adapter.findOne({
            model: r,
            where: [
                {
                    field: "userId",
                    value: a.id
                }
            ]
        });
        if (!d) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: X.TOTP_NOT_ENABLED
        });
        return {
            code: await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$otp$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["createOTP"])(d.secret, {
                period: o.period,
                digits: o.digits
            }).totp()
        };
    }), t = u("/two-factor/get-totp-uri", {
        method: "POST",
        use: [
            I
        ],
        body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
            password: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                description: "User password"
            })
        }),
        metadata: {
            openapi: {
                summary: "Get TOTP URI",
                description: "Use this endpoint to get the TOTP URI",
                responses: {
                    200: {
                        description: "Successful response",
                        content: {
                            "application/json": {
                                schema: {
                                    type: "object",
                                    properties: {
                                        totpURI: {
                                            type: "string"
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }, async (s)=>{
        if (e?.disable) throw s.context.logger.error("totp isn't configured. please pass totp option on two factor plugin to enable totp"), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: "totp isn't configured"
        });
        let a = s.context.session.user, d = await s.context.adapter.findOne({
            model: r,
            where: [
                {
                    field: "userId",
                    value: a.id
                }
            ]
        });
        if (!d || !a.twoFactorEnabled) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: X.TOTP_NOT_ENABLED
        });
        let A = await he({
            key: s.context.secret,
            data: d.secret
        });
        return await s.context.password.checkPassword(a.id, s), {
            totpURI: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$otp$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["createOTP"])(A, {
                digits: o.digits,
                period: o.period
            }).url(e?.issuer || s.context.appName, a.email)
        };
    }), n = u("/two-factor/verify-totp", {
        method: "POST",
        body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
            code: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                description: "The otp code to verify"
            })
        }),
        use: [
            ve
        ],
        metadata: {
            openapi: {
                summary: "Verify two factor TOTP",
                description: "Verify two factor TOTP",
                responses: {
                    200: {
                        description: "Successful response",
                        content: {
                            "application/json": {
                                schema: {
                                    type: "object",
                                    properties: {
                                        status: {
                                            type: "boolean"
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }, async (s)=>{
        if (e?.disable) throw s.context.logger.error("totp isn't configured. please pass totp option on two factor plugin to enable totp"), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: "totp isn't configured"
        });
        let a = s.context.session.user, d = await s.context.adapter.findOne({
            model: r,
            where: [
                {
                    field: "userId",
                    value: a.id
                }
            ]
        });
        if (!d) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: X.TOTP_NOT_ENABLED
        });
        let A = await he({
            key: s.context.secret,
            data: d.secret
        });
        if (!await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$otp$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["createOTP"])(A, {
            period: o.period,
            digits: o.digits
        }).verify(s.body.code)) return s.context.invalid();
        if (!a.twoFactorEnabled) {
            let p = await s.context.internalAdapter.updateUser(a.id, {
                twoFactorEnabled: !0
            }), l = await s.context.internalAdapter.createSession(a.id, s.request, !1, s.context.session.session).catch((K)=>{
                throw K;
            });
            await s.context.internalAdapter.deleteSession(s.context.session.session.token), await b(s, {
                session: l,
                user: p
            });
        }
        return s.context.valid();
    });
    return {
        id: "totp",
        endpoints: {
            generateTOTP: i,
            getTOTPURI: t,
            verifyTOTP: n
        }
    };
};
;
async function jo(e, o) {
    let i = (await e.context.internalAdapter.findAccounts(o.userId))?.find((s)=>s.providerId === "credential"), t = i?.password;
    return !i || !t ? !1 : await e.context.password.verify({
        hash: t,
        password: o.password
    });
}
;
var bt = {
    user: {
        fields: {
            twoFactorEnabled: {
                type: "boolean",
                required: !1,
                defaultValue: !1,
                input: !1
            }
        }
    },
    twoFactor: {
        fields: {
            secret: {
                type: "string",
                required: !0,
                returned: !1
            },
            backupCodes: {
                type: "string",
                required: !0,
                returned: !1
            },
            userId: {
                type: "string",
                required: !0,
                returned: !1,
                references: {
                    model: "user",
                    field: "id"
                }
            }
        }
    }
};
;
;
var Tp = (e)=>({
        id: "two-factor",
        $InferServerPlugin: {},
        atomListeners: [
            {
                matcher: (o)=>o.startsWith("/two-factor/"),
                signal: "$sessionSignal"
            }
        ],
        pathMethods: {
            "/two-factor/disable": "POST",
            "/two-factor/enable": "POST",
            "/two-factor/send-otp": "POST",
            "/two-factor/generate-backup-codes": "POST"
        },
        fetchPlugins: [
            {
                id: "two-factor",
                name: "two-factor",
                hooks: {
                    async onSuccess (o) {
                        o.data?.twoFactorRedirect && e?.onTwoFactorRedirect && await e.onTwoFactorRedirect();
                    }
                }
            }
        ]
    });
var Vp = (e)=>{
    let o = {
        twoFactorTable: "twoFactor"
    }, r = Ct(e?.totpOptions), i = ht(e?.backupCodeOptions), t = wt(e?.otpOptions);
    return {
        id: "two-factor",
        endpoints: {
            ...r.endpoints,
            ...t.endpoints,
            ...i.endpoints,
            enableTwoFactor: u("/two-factor/enable", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
                    password: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "User password"
                    }).min(8)
                }),
                use: [
                    I
                ],
                metadata: {
                    openapi: {
                        summary: "Enable two factor authentication",
                        description: "Use this endpoint to enable two factor authentication. This will generate a TOTP URI and backup codes. Once the user verifies the TOTP URI, the two factor authentication will be enabled.",
                        responses: {
                            200: {
                                description: "Successful response",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                totpURI: {
                                                    type: "string",
                                                    description: "TOTP URI"
                                                },
                                                backupCodes: {
                                                    type: "array",
                                                    items: {
                                                        type: "string"
                                                    },
                                                    description: "Backup codes"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (n)=>{
                let s = n.context.session.user, { password: a } = n.body;
                if (!await jo(n, {
                    password: a,
                    userId: s.id
                })) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: f.INVALID_PASSWORD
                });
                let A = _(32), c = await le({
                    key: n.context.secret,
                    data: A
                }), p = await No(n.context.secret, e?.backupCodeOptions);
                if (e?.skipVerificationOnEnable) {
                    let K = await n.context.internalAdapter.updateUser(s.id, {
                        twoFactorEnabled: !0
                    }), y = await n.context.internalAdapter.createSession(K.id, n.request, !1, n.context.session.session);
                    await b(n, {
                        session: y,
                        user: s
                    }), await n.context.internalAdapter.deleteSession(n.context.session.session.token);
                }
                await n.context.adapter.deleteMany({
                    model: o.twoFactorTable,
                    where: [
                        {
                            field: "userId",
                            value: s.id
                        }
                    ]
                }), await n.context.adapter.create({
                    model: o.twoFactorTable,
                    data: {
                        secret: c,
                        backupCodes: p.encryptedBackupCodes,
                        userId: s.id
                    }
                });
                let l = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$otp$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["createOTP"])(A, {
                    digits: e?.totpOptions?.digits || 6,
                    period: e?.totpOptions?.period
                }).url(e?.issuer || n.context.appName, s.email);
                return n.json({
                    totpURI: l,
                    backupCodes: p.backupCodes
                });
            }),
            disableTwoFactor: u("/two-factor/disable", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
                    password: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "User password"
                    }).min(8)
                }),
                use: [
                    I
                ],
                metadata: {
                    openapi: {
                        summary: "Disable two factor authentication",
                        description: "Use this endpoint to disable two factor authentication.",
                        responses: {
                            200: {
                                description: "Successful response",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                status: {
                                                    type: "boolean"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (n)=>{
                let s = n.context.session.user, { password: a } = n.body;
                if (!await jo(n, {
                    password: a,
                    userId: s.id
                })) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: "Invalid password"
                });
                await n.context.internalAdapter.updateUser(s.id, {
                    twoFactorEnabled: !1
                }), await n.context.adapter.delete({
                    model: o.twoFactorTable,
                    where: [
                        {
                            field: "userId",
                            value: s.id
                        }
                    ]
                });
                let A = await n.context.internalAdapter.createSession(s.id, n.request, !1, n.context.session.session);
                return await b(n, {
                    session: A,
                    user: s
                }), await n.context.internalAdapter.deleteSession(n.context.session.session.token), n.json({
                    status: !0
                });
            })
        },
        options: e,
        hooks: {
            after: [
                {
                    matcher (n) {
                        return n.path === "/sign-in/email" || n.path === "/sign-in/username" || n.path === "/sign-in/phone-number";
                    },
                    handler: N(async (n)=>{
                        let s = n.context.newSession;
                        if (!s || !s?.user.twoFactorEnabled) return;
                        let a = n.context.createAuthCookie(lo), d = await n.getSignedCookie(a.name, n.context.secret);
                        if (d) {
                            let [c, p] = d.split("!"), l = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hmac$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["createHMAC"])("SHA-256", "base64urlnopad").sign(n.context.secret, `${s.user.id}!${p}`);
                            if (c === l) {
                                let K = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hmac$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["createHMAC"])("SHA-256", "base64urlnopad").sign(n.context.secret, `${s.user.id}!${p}`);
                                await n.setSignedCookie(a.name, `${K}!${s.session.token}`, n.context.secret, a.attributes);
                                return;
                            }
                        }
                        G(n), await n.context.internalAdapter.deleteSession(s.session.token);
                        let A = n.context.createAuthCookie(uo, {
                            maxAge: 60 * 10
                        });
                        return await n.setSignedCookie(A.name, s.user.id, n.context.secret, A.attributes), n.json({
                            twoFactorRedirect: !0
                        });
                    })
                }
            ]
        },
        schema: me(bt, e?.schema),
        rateLimit: [
            {
                pathMatcher (n) {
                    return n.startsWith("/two-factor/");
                },
                window: 10,
                max: 3
            }
        ]
    };
};
;
;
var Et = ()=>{
    let e = {
        INVALID_USERNAME_OR_PASSWORD: "invalid username or password",
        EMAIL_NOT_VERIFIED: "email not verified",
        UNEXPECTED_ERROR: "unexpected error",
        USERNAME_IS_ALREADY_TAKEN: "username is already taken. please try another."
    };
    return {
        id: "username",
        endpoints: {
            signInUsername: u("/sign-in/username", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
                    username: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "The username of the user"
                    }),
                    password: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "The password of the user"
                    }),
                    rememberMe: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].boolean({
                        description: "Remember the user session"
                    }).optional()
                }),
                metadata: {
                    openapi: {
                        summary: "Sign in with username",
                        description: "Sign in with username",
                        responses: {
                            200: {
                                description: "Success",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                user: {
                                                    $ref: "#/components/schemas/User"
                                                },
                                                session: {
                                                    $ref: "#/components/schemas/Session"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (o)=>{
                let r = await o.context.adapter.findOne({
                    model: "user",
                    where: [
                        {
                            field: "username",
                            value: o.body.username.toLowerCase()
                        }
                    ]
                });
                if (!r) throw await o.context.password.hash(o.body.password), o.context.logger.error("User not found", {
                    username: Et
                }), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                    message: e.INVALID_USERNAME_OR_PASSWORD
                });
                if (!r.emailVerified && o.context.options.emailAndPassword?.requireEmailVerification) throw await vo(o, r), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                    message: e.INVALID_USERNAME_OR_PASSWORD
                });
                let i = await o.context.adapter.findOne({
                    model: "account",
                    where: [
                        {
                            field: "userId",
                            value: r.id
                        },
                        {
                            field: "providerId",
                            value: "credential"
                        }
                    ]
                });
                if (!i) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                    message: e.INVALID_USERNAME_OR_PASSWORD
                });
                let t = i?.password;
                if (!t) throw o.context.logger.error("Password not found", {
                    username: Et
                }), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                    message: e.INVALID_USERNAME_OR_PASSWORD
                });
                if (!await o.context.password.verify({
                    hash: t,
                    password: o.body.password
                })) throw o.context.logger.error("Invalid password"), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                    message: e.INVALID_USERNAME_OR_PASSWORD
                });
                let s = await o.context.internalAdapter.createSession(r.id, o.request, o.body.rememberMe === !1);
                return s ? (await b(o, {
                    session: s,
                    user: r
                }, o.body.rememberMe === !1), o.json({
                    token: s.token
                })) : o.json(null, {
                    status: 500,
                    body: {
                        message: f.FAILED_TO_CREATE_SESSION,
                        status: 500
                    }
                });
            })
        },
        schema: {
            user: {
                fields: {
                    username: {
                        type: "string",
                        required: !1,
                        unique: !0,
                        returned: !0,
                        transform: {
                            input (o) {
                                return o?.toString().toLowerCase();
                            }
                        }
                    }
                }
            }
        },
        hooks: {
            before: [
                {
                    matcher (o) {
                        return o.path === "/sign-up/email";
                    },
                    async handler (o) {
                        let r = o.body.username;
                        if (r && await o.context.adapter.findOne({
                            model: "user",
                            where: [
                                {
                                    field: "username",
                                    value: r.toLowerCase()
                                }
                            ]
                        })) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNPROCESSABLE_ENTITY", {
                            message: e.USERNAME_IS_ALREADY_TAKEN
                        });
                    }
                }
            ]
        },
        $ERROR_CODES: X
    };
};
;
;
var nK = (e)=>({
        id: "bearer",
        hooks: {
            before: [
                {
                    matcher (o) {
                        return !!(o.request?.headers.get("authorization") || o.headers?.get("authorization"));
                    },
                    handler: async (o)=>{
                        let r = o.request?.headers.get("authorization")?.replace("Bearer ", "") || o.headers?.get("authorization")?.replace("Bearer ", "");
                        if (!r) return;
                        let i = "";
                        if (r.includes(".")) i = r.replace("=", "");
                        else {
                            if (e?.requireSignature) return;
                            i = (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["serializeSigned"])("", r, o.context.secret)).replace("=", "");
                        }
                        try {
                            let t = decodeURIComponent(i);
                            if (!await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hmac$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["createHMAC"])("SHA-256", "base64urlnopad").verify(o.context.secret, t.split(".")[0], t.split(".")[1])) return;
                        } catch  {
                            return;
                        }
                        return o.request && o.request.headers.append("cookie", `${o.context.authCookies.sessionToken.name}=${i}`), o.headers && o.headers.append("cookie", `${o.context.authCookies.sessionToken.name}=${i}`), {
                            context: o
                        };
                    }
                }
            ],
            after: [
                {
                    matcher (o) {
                        return !!o.responseHeader.get("set-cookie");
                    },
                    handler: N(async (o)=>{
                        let r = o.responseHeader.get("set-cookie");
                        if (!r) return;
                        let i = Oe(r), t = o.context.authCookies.sessionToken.name, n = i.get(t);
                        if (!n || !n.value || n["max-age"] === 0) return;
                        let s = n.value;
                        return o.responseHeader.set("set-auth-token", s), {
                            responseHeader: o.responseHeader
                        };
                    })
                }
            ]
        }
    });
;
;
var pK = (e)=>({
        id: "magic-link",
        endpoints: {
            signInMagicLink: u("/sign-in/magic-link", {
                method: "POST",
                requireHeaders: !0,
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
                    email: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "Email address to send the magic link"
                    }).email(),
                    callbackURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "URL to redirect after magic link verification"
                    }).optional()
                }),
                metadata: {
                    openapi: {
                        description: "Sign in with magic link",
                        responses: {
                            200: {
                                description: "Success",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                status: {
                                                    type: "boolean"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (o)=>{
                let { email: r } = o.body;
                if (e.disableSignUp && !await o.context.internalAdapter.findUserByEmail(r)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: f.USER_NOT_FOUND
                });
                let i = _(32, "a-z", "A-Z");
                await o.context.internalAdapter.createVerificationValue({
                    identifier: i,
                    value: r,
                    expiresAt: new Date(Date.now() + (e.expiresIn || 60 * 5) * 1e3)
                });
                let t = `${o.context.baseURL}/magic-link/verify?token=${i}&callbackURL=${o.body.callbackURL || "/"}`;
                return await e.sendMagicLink({
                    email: r,
                    url: t,
                    token: i
                }, o.request), o.json({
                    status: !0
                });
            }),
            magicLinkVerify: u("/magic-link/verify", {
                method: "GET",
                query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
                    token: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "Verification token"
                    }),
                    callbackURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "URL to redirect after magic link verification, if not provided will return session"
                    }).optional()
                }),
                requireHeaders: !0,
                metadata: {
                    openapi: {
                        description: "Verify magic link",
                        responses: {
                            200: {
                                description: "Success",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                session: {
                                                    $ref: "#/components/schemas/Session"
                                                },
                                                user: {
                                                    $ref: "#/components/schemas/User"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (o)=>{
                let { token: r, callbackURL: i } = o.query, t = i?.startsWith("http") ? i : i ? `${o.context.options.baseURL}${i}` : o.context.options.baseURL, n = await o.context.internalAdapter.findVerificationValue(r);
                if (!n) throw o.redirect(`${t}?error=INVALID_TOKEN`);
                if (n.expiresAt < new Date) throw await o.context.internalAdapter.deleteVerificationValue(n.id), o.redirect(`${t}?error=EXPIRED_TOKEN`);
                await o.context.internalAdapter.deleteVerificationValue(n.id);
                let s = n.value, a = await o.context.internalAdapter.findUserByEmail(s).then((A)=>A?.user);
                if (!a) {
                    if (e.disableSignUp) throw o.redirect(`${t}?error=failed_to_create_user`);
                    if (a = await o.context.internalAdapter.createUser({
                        email: s,
                        emailVerified: !0,
                        name: s
                    }), !a) throw o.redirect(`${t}?error=failed_to_create_user`);
                }
                a.emailVerified || await o.context.internalAdapter.updateUser(a.id, {
                    emailVerified: !0
                });
                let d = await o.context.internalAdapter.createSession(a.id, o.headers);
                if (!d) throw o.redirect(`${t}?error=failed_to_create_session`);
                if (await b(o, {
                    session: d,
                    user: a
                }), !i) return o.json({
                    token: d.token
                });
                throw o.redirect(i);
            })
        },
        rateLimit: [
            {
                pathMatcher (o) {
                    return o.startsWith("/sign-in/magic-link") || o.startsWith("/magic-link/verify");
                },
                window: e.rateLimit?.window || 60,
                max: e.rateLimit?.max || 5
            }
        ]
    });
;
;
function Cn(e) {
    return _(e, "0-9");
}
var TK = (e)=>{
    let o = {
        expiresIn: e?.expiresIn || 300,
        otpLength: e?.otpLength || 6,
        ...e,
        phoneNumber: "phoneNumber",
        phoneNumberVerified: "phoneNumberVerified",
        code: "code",
        createdAt: "createdAt"
    }, r = {
        INVALID_PHONE_NUMBER: "Invalid phone number",
        INVALID_PHONE_NUMBER_OR_PASSWORD: "Invalid phone number or password",
        UNEXPECTED_ERROR: "Unexpected error",
        OTP_NOT_FOUND: "OTP not found"
    };
    return {
        id: "phone-number",
        endpoints: {
            signInPhoneNumber: u("/sign-in/phone-number", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
                    phoneNumber: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "Phone number to sign in"
                    }),
                    password: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "Password to use for sign in"
                    }),
                    rememberMe: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].boolean({
                        description: "Remember the session"
                    }).optional()
                }),
                metadata: {
                    openapi: {
                        summary: "Sign in with phone number",
                        description: "Use this endpoint to sign in with phone number",
                        responses: {
                            200: {
                                description: "Success",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                user: {
                                                    $ref: "#/components/schemas/User"
                                                },
                                                session: {
                                                    $ref: "#/components/schemas/Session"
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            400: {
                                description: "Invalid phone number or password"
                            }
                        }
                    }
                }
            }, async (i)=>{
                let { password: t, phoneNumber: n } = i.body;
                if (o.phoneNumberValidator && !await o.phoneNumberValidator(i.body.phoneNumber)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: r.INVALID_PHONE_NUMBER
                });
                let s = await i.context.adapter.findOne({
                    model: "user",
                    where: [
                        {
                            field: "phoneNumber",
                            value: n
                        }
                    ]
                });
                if (!s) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                    message: r.INVALID_PHONE_NUMBER_OR_PASSWORD
                });
                let d = (await i.context.internalAdapter.findAccountByUserId(s.id)).find((l)=>l.providerId === "credential");
                if (!d) throw i.context.logger.error("Credential account not found", {
                    phoneNumber: n
                }), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                    message: r.INVALID_PHONE_NUMBER_OR_PASSWORD
                });
                let A = d?.password;
                if (!A) throw i.context.logger.error("Password not found", {
                    phoneNumber: n
                }), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                    message: r.UNEXPECTED_ERROR
                });
                if (!await i.context.password.verify({
                    hash: A,
                    password: t
                })) throw i.context.logger.error("Invalid password"), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                    message: r.INVALID_PHONE_NUMBER_OR_PASSWORD
                });
                let p = await i.context.internalAdapter.createSession(s.id, i.headers, i.body.rememberMe === !1);
                if (!p) throw i.context.logger.error("Failed to create session"), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                    message: f.FAILED_TO_CREATE_SESSION
                });
                return await b(i, {
                    session: p,
                    user: s
                }, i.body.rememberMe === !1), i.json({
                    token: p.token
                });
            }),
            sendPhoneNumberOTP: u("/phone-number/send-otp", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
                    phoneNumber: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "Phone number to send OTP"
                    })
                }),
                metadata: {
                    openapi: {
                        summary: "Send OTP to phone number",
                        description: "Use this endpoint to send OTP to phone number",
                        responses: {
                            200: {
                                description: "Success",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                message: {
                                                    type: "string"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (i)=>{
                if (!e?.sendOTP) throw i.context.logger.warn("sendOTP not implemented"), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("NOT_IMPLEMENTED", {
                    message: "sendOTP not implemented"
                });
                if (o.phoneNumberValidator && !await o.phoneNumberValidator(i.body.phoneNumber)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: r.INVALID_PHONE_NUMBER
                });
                let t = Cn(o.otpLength);
                return await i.context.internalAdapter.createVerificationValue({
                    value: t,
                    identifier: i.body.phoneNumber,
                    expiresAt: L(o.expiresIn, "sec")
                }), await e.sendOTP({
                    phoneNumber: i.body.phoneNumber,
                    code: t
                }, i.request), i.json({
                    code: t
                }, {
                    body: {
                        message: "Code sent"
                    }
                });
            }),
            verifyPhoneNumber: u("/phone-number/verify", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
                    phoneNumber: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "Phone number to verify"
                    }),
                    code: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "OTP code"
                    }),
                    disableSession: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].boolean({
                        description: "Disable session creation after verification"
                    }).optional(),
                    updatePhoneNumber: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].boolean({
                        description: "Check if there is a session and update the phone number"
                    }).optional()
                }),
                metadata: {
                    openapi: {
                        summary: "Verify phone number",
                        description: "Use this endpoint to verify phone number",
                        responses: {
                            200: {
                                description: "Success",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                user: {
                                                    $ref: "#/components/schemas/User"
                                                },
                                                session: {
                                                    $ref: "#/components/schemas/Session"
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            400: {
                                description: "Invalid OTP"
                            }
                        }
                    }
                }
            }, async (i)=>{
                let t = await i.context.internalAdapter.findVerificationValue(i.body.phoneNumber);
                if (!t || t.expiresAt < new Date) throw t && t.expiresAt < new Date ? (await i.context.internalAdapter.deleteVerificationValue(t.id), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: "OTP expired"
                })) : new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: r.OTP_NOT_FOUND
                });
                if (t.value !== i.body.code) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: "Invalid OTP"
                });
                if (await i.context.internalAdapter.deleteVerificationValue(t.id), i.body.updatePhoneNumber) {
                    let s = await v(i);
                    if (!s) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                        message: f.USER_NOT_FOUND
                    });
                    return await i.context.internalAdapter.updateUser(s.user.id, {
                        [o.phoneNumber]: i.body.phoneNumber,
                        [o.phoneNumberVerified]: !0
                    }), i.json({
                        token: s.session.token,
                        status: !0
                    });
                }
                let n = await i.context.adapter.findOne({
                    model: "user",
                    where: [
                        {
                            value: i.body.phoneNumber,
                            field: o.phoneNumber
                        }
                    ]
                });
                if (await e?.callbackOnVerification?.({
                    phoneNumber: i.body.phoneNumber,
                    user: n
                }, i.request), n) n = await i.context.internalAdapter.updateUser(n.id, {
                    [o.phoneNumberVerified]: !0
                });
                else if (e?.signUpOnVerification) {
                    if (n = await i.context.internalAdapter.createUser({
                        email: e.signUpOnVerification.getTempEmail(i.body.phoneNumber),
                        name: e.signUpOnVerification.getTempName ? e.signUpOnVerification.getTempName(i.body.phoneNumber) : i.body.phoneNumber,
                        [o.phoneNumber]: i.body.phoneNumber,
                        [o.phoneNumberVerified]: !0
                    }), !n) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("INTERNAL_SERVER_ERROR", {
                        message: f.FAILED_TO_CREATE_USER
                    });
                } else return i.json(null);
                if (!n) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("INTERNAL_SERVER_ERROR", {
                    message: f.FAILED_TO_UPDATE_USER
                });
                if (!i.body.disableSession) {
                    let s = await i.context.internalAdapter.createSession(n.id, i.request);
                    if (!s) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("INTERNAL_SERVER_ERROR", {
                        message: f.FAILED_TO_CREATE_SESSION
                    });
                    return await b(i, {
                        session: s,
                        user: n
                    }), i.json({
                        token: s.token,
                        status: !0
                    });
                }
                return i.json({
                    token: null,
                    status: !0
                });
            })
        },
        schema: me(bn, e?.schema),
        $ERROR_CODES: r
    };
}, bn = {
    user: {
        fields: {
            phoneNumber: {
                type: "string",
                required: !1,
                unique: !0,
                returned: !0
            },
            phoneNumberVerified: {
                type: "boolean",
                required: !1,
                returned: !0,
                input: !1
            }
        }
    }
};
var On = {
    user: {
        fields: {
            isAnonymous: {
                type: "boolean",
                required: !1
            }
        }
    }
}, UK = (e)=>{
    let o = {
        FAILED_TO_CREATE_USER: "Failed to create user",
        COULD_NOT_CREATE_SESSION: "Could not create session",
        ANONYMOUS_USERS_CANNOT_SIGN_IN_AGAIN_ANONYMOUSLY: "Anonymous users cannot sign in again anonymously"
    };
    return {
        id: "anonymous",
        endpoints: {
            signInAnonymous: u("/sign-in/anonymous", {
                method: "POST",
                metadata: {
                    openapi: {
                        description: "Sign in anonymously",
                        responses: {
                            200: {
                                description: "Sign in anonymously",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                user: {
                                                    $ref: "#/components/schemas/User"
                                                },
                                                session: {
                                                    $ref: "#/components/schemas/Session"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (r)=>{
                let { emailDomainName: i = Ue(r.context.baseURL) } = e || {}, t = r.context.generateId({
                    model: "user"
                }), n = `temp-${t}@${i}`, s = await r.context.internalAdapter.createUser({
                    id: t,
                    email: n,
                    emailVerified: !1,
                    isAnonymous: !0,
                    name: "Anonymous",
                    createdAt: new Date,
                    updatedAt: new Date
                });
                if (!s) return r.json(null, {
                    status: 500,
                    body: {
                        message: o.FAILED_TO_CREATE_USER,
                        status: 500
                    }
                });
                let a = await r.context.internalAdapter.createSession(s.id, r.request);
                return a ? (await b(r, {
                    session: a,
                    user: s
                }), r.json({
                    token: a.token
                })) : r.json(null, {
                    status: 400,
                    body: {
                        message: o.COULD_NOT_CREATE_SESSION
                    }
                });
            })
        },
        hooks: {
            after: [
                {
                    matcher (r) {
                        return !!r.responseHeader.get("set-cookie")?.includes(r.context.authCookies.sessionToken.name);
                    },
                    handler: N(async (r)=>{
                        let t = r.responseHeader.get("set-cookie"), n = r.context.authCookies.sessionToken.name;
                        if (!Oe(t || "").get(n)?.value.split(".")[0]) return;
                        let a = await v(r, {
                            disableRefresh: !0
                        });
                        if (!a || !a.user.isAnonymous) return;
                        if (r.path === "/sign-in/anonymous") throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                            message: o.ANONYMOUS_USERS_CANNOT_SIGN_IN_AGAIN_ANONYMOUSLY
                        });
                        let d = r.context.newSession;
                        d && (e?.onLinkAccount && await e?.onLinkAccount?.({
                            anonymousUser: a,
                            newUser: d
                        }), e?.disableDeleteAnonymousUser || await r.context.internalAdapter.deleteUser(a.user.id));
                    })
                }
            ]
        },
        schema: me(On, e?.schema),
        $ERROR_CODES: o
    };
};
;
;
var Rt = async (e)=>{
    let o = e.context.returned;
    return o ? o instanceof Response ? o.status !== 200 ? null : await o.clone().json() : o instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"] ? null : o : null;
};
var qK = (e)=>{
    let o = {
        defaultRole: "user",
        adminRole: "admin",
        ...e
    }, r = {
        FAILED_TO_CREATE_USER: "Failed to create user",
        USER_ALREADY_EXISTS: "User already exists",
        USER_NOT_FOUND: "User not found",
        YOU_CANNOT_BAN_YOURSELF: "You cannot ban yourself",
        ONLY_ADMINS_CAN_ACCESS_THIS_ENDPOINT: "Only admins can access this endpoint"
    }, i = N(async (t)=>{
        let n = await v(t);
        if (!n?.session) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED");
        let s = n.user;
        if (!s.role || (Array.isArray(o.adminRole) ? !o.adminRole.includes(s.role) : s.role !== o.adminRole)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
            message: "Only admins can access this endpoint"
        });
        return {
            session: {
                user: s,
                session: n.session
            }
        };
    });
    return {
        id: "admin",
        init (t) {
            return {
                options: {
                    databaseHooks: {
                        user: {
                            create: {
                                async before (n) {
                                    if (e?.defaultRole !== !1) return {
                                        data: {
                                            role: e?.defaultRole ?? "user",
                                            ...n
                                        }
                                    };
                                }
                            }
                        },
                        session: {
                            create: {
                                async before (n) {
                                    let s = await t.internalAdapter.findUserById(n.userId);
                                    if (s.banned) {
                                        if (s.banExpires && s.banExpires.getTime() < Date.now()) {
                                            await t.internalAdapter.updateUser(n.userId, {
                                                banned: !1,
                                                banReason: null,
                                                banExpires: null
                                            });
                                            return;
                                        }
                                        return !1;
                                    }
                                }
                            }
                        }
                    }
                }
            };
        },
        hooks: {
            after: [
                {
                    matcher (t) {
                        return t.path === "/list-sessions";
                    },
                    handler: N(async (t)=>{
                        let n = await Rt(t);
                        if (!n) return;
                        let s = n.filter((a)=>!a.impersonatedBy);
                        return t.json(s);
                    })
                }
            ]
        },
        endpoints: {
            setRole: u("/admin/set-role", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
                    userId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "The user id"
                    }),
                    role: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "The role to set. `admin` or `user` by default"
                    })
                }),
                use: [
                    i
                ],
                metadata: {
                    openapi: {
                        operationId: "setRole",
                        summary: "Set the role of a user",
                        description: "Set the role of a user",
                        responses: {
                            200: {
                                description: "User role updated",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                user: {
                                                    $ref: "#/components/schemas/User"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (t)=>{
                let n = await t.context.internalAdapter.updateUser(t.body.userId, {
                    role: t.body.role
                });
                return t.json({
                    user: n
                });
            }),
            createUser: u("/admin/create-user", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
                    email: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "The email of the user"
                    }),
                    password: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "The password of the user"
                    }),
                    name: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "The name of the user"
                    }),
                    role: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "The role of the user"
                    }),
                    data: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].optional(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].record(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].any(), {
                        description: "Extra fields for the user. Including custom additional fields."
                    }))
                }),
                use: [
                    i
                ],
                metadata: {
                    openapi: {
                        operationId: "createUser",
                        summary: "Create a new user",
                        description: "Create a new user",
                        responses: {
                            200: {
                                description: "User created",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                user: {
                                                    $ref: "#/components/schemas/User"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (t)=>{
                if (await t.context.internalAdapter.findUserByEmail(t.body.email)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: r.USER_ALREADY_EXISTS
                });
                let s = await t.context.internalAdapter.createUser({
                    email: t.body.email,
                    name: t.body.name,
                    role: t.body.role,
                    ...t.body.data
                });
                if (!s) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("INTERNAL_SERVER_ERROR", {
                    message: r.FAILED_TO_CREATE_USER
                });
                let a = await t.context.password.hash(t.body.password);
                return await t.context.internalAdapter.linkAccount({
                    accountId: s.id,
                    providerId: "credential",
                    password: a,
                    userId: s.id
                }), t.json({
                    user: s
                });
            }),
            listUsers: u("/admin/list-users", {
                method: "GET",
                use: [
                    i
                ],
                query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
                    searchValue: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "The value to search for"
                    }).optional(),
                    searchField: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].enum([
                        "email",
                        "name"
                    ], {
                        description: "The field to search in, defaults to email. Can be `email` or `name`"
                    }).optional(),
                    searchOperator: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].enum([
                        "contains",
                        "starts_with",
                        "ends_with"
                    ], {
                        description: "The operator to use for the search. Can be `contains`, `starts_with` or `ends_with`"
                    }).optional(),
                    limit: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "The number of users to return"
                    }).or(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].number()).optional(),
                    offset: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "The offset to start from"
                    }).or(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].number()).optional(),
                    sortBy: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "The field to sort by"
                    }).optional(),
                    sortDirection: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].enum([
                        "asc",
                        "desc"
                    ], {
                        description: "The direction to sort by"
                    }).optional(),
                    filterField: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "The field to filter by"
                    }).optional(),
                    filterValue: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "The value to filter by"
                    }).or(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].number()).or(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].boolean()).optional(),
                    filterOperator: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].enum([
                        "eq",
                        "ne",
                        "lt",
                        "lte",
                        "gt",
                        "gte"
                    ], {
                        description: "The operator to use for the filter"
                    }).optional()
                }),
                metadata: {
                    openapi: {
                        operationId: "listUsers",
                        summary: "List users",
                        description: "List users",
                        responses: {
                            200: {
                                description: "List of users",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                users: {
                                                    type: "array",
                                                    items: {
                                                        $ref: "#/components/schemas/User"
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (t)=>{
                let n = [];
                t.query?.searchValue && n.push({
                    field: t.query.searchField || "email",
                    operator: t.query.searchOperator || "contains",
                    value: t.query.searchValue
                }), t.query?.filterValue && n.push({
                    field: t.query.filterField || "email",
                    operator: t.query.filterOperator || "eq",
                    value: t.query.filterValue
                });
                try {
                    let s = await t.context.internalAdapter.listUsers(Number(t.query?.limit) || void 0, Number(t.query?.offset) || void 0, t.query?.sortBy ? {
                        field: t.query.sortBy,
                        direction: t.query.sortDirection || "asc"
                    } : void 0, n.length ? n : void 0);
                    return t.json({
                        users: s
                    });
                } catch (s) {
                    return console.log(s), t.json({
                        users: []
                    });
                }
            }),
            listUserSessions: u("/admin/list-user-sessions", {
                method: "POST",
                use: [
                    i
                ],
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
                    userId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "The user id"
                    })
                }),
                metadata: {
                    openapi: {
                        operationId: "listUserSessions",
                        summary: "List user sessions",
                        description: "List user sessions",
                        responses: {
                            200: {
                                description: "List of user sessions",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                sessions: {
                                                    type: "array",
                                                    items: {
                                                        $ref: "#/components/schemas/Session"
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (t)=>({
                    sessions: await t.context.internalAdapter.listSessions(t.body.userId)
                })),
            unbanUser: u("/admin/unban-user", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
                    userId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "The user id"
                    })
                }),
                use: [
                    i
                ],
                metadata: {
                    openapi: {
                        operationId: "unbanUser",
                        summary: "Unban a user",
                        description: "Unban a user",
                        responses: {
                            200: {
                                description: "User unbanned",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                user: {
                                                    $ref: "#/components/schemas/User"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (t)=>{
                let n = await t.context.internalAdapter.updateUser(t.body.userId, {
                    banned: !1
                });
                return t.json({
                    user: n
                });
            }),
            banUser: u("/admin/ban-user", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
                    userId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "The user id"
                    }),
                    banReason: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "The reason for the ban"
                    }).optional(),
                    banExpiresIn: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].number({
                        description: "The number of seconds until the ban expires"
                    }).optional()
                }),
                use: [
                    i
                ],
                metadata: {
                    openapi: {
                        operationId: "banUser",
                        summary: "Ban a user",
                        description: "Ban a user",
                        responses: {
                            200: {
                                description: "User banned",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                user: {
                                                    $ref: "#/components/schemas/User"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (t)=>{
                if (t.body.userId === t.context.session.user.id) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: r.YOU_CANNOT_BAN_YOURSELF
                });
                let n = await t.context.internalAdapter.updateUser(t.body.userId, {
                    banned: !0,
                    banReason: t.body.banReason || e?.defaultBanReason || "No reason",
                    banExpires: t.body.banExpiresIn ? L(t.body.banExpiresIn, "sec") : e?.defaultBanExpiresIn ? L(e.defaultBanExpiresIn, "sec") : void 0
                });
                return await t.context.internalAdapter.deleteSessions(t.body.userId), t.json({
                    user: n
                });
            }),
            impersonateUser: u("/admin/impersonate-user", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
                    userId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "The user id"
                    })
                }),
                use: [
                    i
                ],
                metadata: {
                    openapi: {
                        operationId: "impersonateUser",
                        summary: "Impersonate a user",
                        description: "Impersonate a user",
                        responses: {
                            200: {
                                description: "Impersonation session created",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                session: {
                                                    $ref: "#/components/schemas/Session"
                                                },
                                                user: {
                                                    $ref: "#/components/schemas/User"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (t)=>{
                let n = await t.context.internalAdapter.findUserById(t.body.userId);
                if (!n) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("NOT_FOUND", {
                    message: "User not found"
                });
                let s = await t.context.internalAdapter.createSession(n.id, void 0, !0, {
                    impersonatedBy: t.context.session.user.id,
                    expiresAt: e?.impersonationSessionDuration ? L(e.impersonationSessionDuration, "sec") : L(60 * 60, "sec")
                });
                if (!s) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("INTERNAL_SERVER_ERROR", {
                    message: r.FAILED_TO_CREATE_USER
                });
                let a = t.context.authCookies;
                return G(t), await t.setSignedCookie("admin_session", t.context.session.session.token, t.context.secret, a.sessionToken.options), await b(t, {
                    session: s,
                    user: n
                }, !0), t.json({
                    session: s,
                    user: n
                });
            }),
            stopImpersonating: u("/admin/stop-impersonating", {
                method: "POST"
            }, async (t)=>{
                let n = await v(t);
                if (!n) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED");
                if (!n.session.impersonatedBy) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: "You are not impersonating anyone"
                });
                let s = await t.context.internalAdapter.findUserById(n.session.impersonatedBy);
                if (!s) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("INTERNAL_SERVER_ERROR", {
                    message: "Failed to find user"
                });
                let a = await t.getSignedCookie("admin_session", t.context.secret);
                if (!a) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("INTERNAL_SERVER_ERROR", {
                    message: "Failed to find admin session"
                });
                let d = await t.context.internalAdapter.findSession(a);
                if (!d || d.session.userId !== s.id) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("INTERNAL_SERVER_ERROR", {
                    message: "Failed to find admin session"
                });
                return await b(t, d), t.json(d);
            }),
            revokeUserSession: u("/admin/revoke-user-session", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
                    sessionToken: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "The session token"
                    })
                }),
                use: [
                    i
                ],
                metadata: {
                    openapi: {
                        operationId: "revokeUserSession",
                        summary: "Revoke a user session",
                        description: "Revoke a user session",
                        responses: {
                            200: {
                                description: "Session revoked",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                success: {
                                                    type: "boolean"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (t)=>(await t.context.internalAdapter.deleteSession(t.body.sessionToken), t.json({
                    success: !0
                }))),
            revokeUserSessions: u("/admin/revoke-user-sessions", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
                    userId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "The user id"
                    })
                }),
                use: [
                    i
                ],
                metadata: {
                    openapi: {
                        operationId: "revokeUserSessions",
                        summary: "Revoke all user sessions",
                        description: "Revoke all user sessions",
                        responses: {
                            200: {
                                description: "Sessions revoked",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                success: {
                                                    type: "boolean"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (t)=>(await t.context.internalAdapter.deleteSessions(t.body.userId), t.json({
                    success: !0
                }))),
            removeUser: u("/admin/remove-user", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
                    userId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "The user id"
                    })
                }),
                use: [
                    i
                ],
                metadata: {
                    openapi: {
                        operationId: "removeUser",
                        summary: "Remove a user",
                        description: "Delete a user and all their sessions and accounts. Cannot be undone.",
                        responses: {
                            200: {
                                description: "User removed",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                success: {
                                                    type: "boolean"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (t)=>(await t.context.internalAdapter.deleteUser(t.body.userId), t.json({
                    success: !0
                })))
        },
        $ERROR_CODES: r,
        schema: me(En, o.schema)
    };
}, En = {
    user: {
        fields: {
            role: {
                type: "string",
                required: !1,
                input: !1
            },
            banned: {
                type: "boolean",
                defaultValue: !1,
                required: !1,
                input: !1
            },
            banReason: {
                type: "string",
                required: !1,
                input: !1
            },
            banExpires: {
                type: "date",
                required: !1,
                input: !1
            }
        }
    },
    session: {
        fields: {
            impersonatedBy: {
                type: "string",
                required: !1
            }
        }
    }
};
;
;
;
async function It(e, o) {
    if (e.idToken) {
        let i = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$node$2f$esm$2f$util$2f$decode_jwt$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["decodeJwt"])(e.idToken);
        if (i && i.sub && i.email) return {
            id: i.sub,
            emailVerified: i.email_verified,
            image: i.picture,
            ...i
        };
    }
    if (!o) return null;
    let r = await R(o, {
        method: "GET",
        headers: {
            Authorization: `Bearer ${e.accessToken}`
        }
    });
    return {
        id: r.data?.sub,
        emailVerified: r.data?.email_verified,
        email: r.data?.email,
        image: r.data?.picture,
        name: r.data?.name,
        ...r.data
    };
}
var om = (e)=>{
    let o = {
        INVALID_OAUTH_CONFIGURATION: "Invalid OAuth configuration"
    };
    return {
        id: "generic-oauth",
        init: (r)=>({
                context: {
                    socialProviders: e.config.map((t)=>{
                        let n = t.userInfoUrl;
                        return {
                            id: t.providerId,
                            name: t.providerId,
                            createAuthorizationURL (s) {
                                return D({
                                    id: t.providerId,
                                    options: {
                                        clientId: t.clientId,
                                        clientSecret: t.clientSecret,
                                        redirectURI: t.redirectURI
                                    },
                                    authorizationEndpoint: t.authorizationUrl,
                                    state: s.state,
                                    codeVerifier: t.pkce ? s.codeVerifier : void 0,
                                    scopes: t.scopes || [],
                                    redirectURI: `${r.baseURL}/oauth2/callback/${t.providerId}`
                                });
                            },
                            async validateAuthorizationCode (s) {
                                let a = t.tokenUrl;
                                if (t.discoveryUrl) {
                                    let d = await R(t.discoveryUrl, {
                                        method: "GET"
                                    });
                                    d.data && (a = d.data.token_endpoint, n = d.data.userinfo_endpoint);
                                }
                                if (!a) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                                    message: "Invalid OAuth configuration. Token URL not found."
                                });
                                return S({
                                    code: s.code,
                                    codeVerifier: s.codeVerifier,
                                    redirectURI: s.redirectURI,
                                    options: {
                                        clientId: t.clientId,
                                        clientSecret: t.clientSecret
                                    },
                                    tokenEndpoint: a
                                });
                            },
                            async getUserInfo (s) {
                                if (!n) return null;
                                let a = t.getUserInfo ? await t.getUserInfo(s) : await It(s, n);
                                return a ? {
                                    user: {
                                        id: a?.id,
                                        email: a?.email,
                                        emailVerified: a?.emailVerified,
                                        image: a?.image,
                                        name: a?.name,
                                        ...t.mapProfileToUser?.(a)
                                    },
                                    data: a
                                } : null;
                            }
                        };
                    }).concat(r.socialProviders)
                }
            }),
        endpoints: {
            signInWithOAuth2: u("/sign-in/oauth2", {
                method: "POST",
                query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
                    currentURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "Redirect to the current URL after sign in"
                    }).optional()
                }).optional(),
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
                    providerId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "The provider ID for the OAuth provider"
                    }),
                    callbackURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "The URL to redirect to after sign in"
                    }).optional(),
                    errorCallbackURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "The URL to redirect to if an error occurs"
                    }).optional(),
                    disableRedirect: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].boolean({
                        description: "Disable redirect"
                    }).optional()
                }),
                metadata: {
                    openapi: {
                        description: "Sign in with OAuth2",
                        responses: {
                            200: {
                                description: "Sign in with OAuth2",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                url: {
                                                    type: "string"
                                                },
                                                redirect: {
                                                    type: "boolean"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (r)=>{
                let { providerId: i } = r.body, t = e.config.find((U)=>U.providerId === i);
                if (!t) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: `No config found for provider ${i}`
                });
                let { discoveryUrl: n, authorizationUrl: s, tokenUrl: a, clientId: d, clientSecret: A, scopes: c, redirectURI: p, responseType: l, pkce: K, prompt: y, accessType: h } = t, j = s, x = a;
                if (n) {
                    let U = await R(n, {
                        onError (C) {
                            r.context.logger.error(C.error.message, C.error, {
                                discoveryUrl: n
                            });
                        }
                    });
                    U.data && (j = U.data.authorization_endpoint, x = U.data.token_endpoint);
                }
                if (!j || !x) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: o.INVALID_OAUTH_CONFIGURATION
                });
                let { state: z, codeVerifier: g } = await Se(r), w = await D({
                    id: i,
                    options: {
                        clientId: d,
                        clientSecret: A,
                        redirectURI: p
                    },
                    authorizationEndpoint: j,
                    state: z,
                    codeVerifier: K ? g : void 0,
                    scopes: c || [],
                    redirectURI: `${r.context.baseURL}/oauth2/callback/${i}`
                });
                return l && l !== "code" && w.searchParams.set("response_type", l), y && w.searchParams.set("prompt", y), h && w.searchParams.set("access_type", h), r.json({
                    url: w.toString(),
                    redirect: !r.body.disableRedirect
                });
            }),
            oAuth2Callback: u("/oauth2/callback/:providerId", {
                method: "GET",
                query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
                    code: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "The OAuth2 code"
                    }).optional(),
                    error: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "The error message, if any"
                    }).optional(),
                    state: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "The state parameter from the OAuth2 request"
                    }).optional()
                }),
                metadata: {
                    openapi: {
                        description: "OAuth2 callback",
                        responses: {
                            200: {
                                description: "OAuth2 callback",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                url: {
                                                    type: "string"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (r)=>{
                if (r.query.error || !r.query.code) throw r.redirect(`${r.context.options.baseURL}?error=${r.query.error || "oAuth_code_missing"}`);
                let i = e.config.find((g)=>g.providerId === r.params.providerId);
                if (!i) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: `No config found for provider ${r.params.providerId}`
                });
                let t, n = await so(r), { callbackURL: s, codeVerifier: a, errorURL: d } = n, A = r.query.code, c = i.tokenUrl, p = i.userInfoUrl;
                if (i.discoveryUrl) {
                    let g = await R(i.discoveryUrl, {
                        method: "GET"
                    });
                    g.data && (c = g.data.token_endpoint, p = g.data.userinfo_endpoint);
                }
                try {
                    if (!c) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                        message: "Invalid OAuth configuration."
                    });
                    t = await S({
                        code: A,
                        codeVerifier: a,
                        redirectURI: `${r.context.baseURL}/oauth2/callback/${i.providerId}`,
                        options: {
                            clientId: i.clientId,
                            clientSecret: i.clientSecret
                        },
                        tokenEndpoint: c
                    });
                } catch (g) {
                    throw r.context.logger.error(g && typeof g == "object" && "name" in g ? g.name : "", g), r.redirect(`${d}?error=oauth_code_verification_failed`);
                }
                if (!t) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: "Invalid OAuth configuration."
                });
                let l = i.getUserInfo ? await i.getUserInfo(t) : await It(t, p);
                if (!l?.email) throw r.context.logger.error("Unable to get user info", l), r.redirect(`${r.context.baseURL}/error?error=email_is_missing`);
                let K = i.mapProfileToUser ? await i.mapProfileToUser(l) : null, y = await Ne(r, {
                    userInfo: {
                        ...l,
                        ...K
                    },
                    account: {
                        providerId: i.providerId,
                        accountId: l.id,
                        ...t,
                        scope: t.scopes?.join(",")
                    }
                });
                function h(g) {
                    throw r.redirect(`${d || s || `${r.context.baseURL}/error`}?error=${g}`);
                }
                if (y.error) return h(y.error.split(" ").join("_"));
                let { session: j, user: x } = y.data;
                await b(r, {
                    session: j,
                    user: x
                });
                let z;
                try {
                    z = new URL(s).toString();
                } catch  {
                    z = s;
                }
                throw r.redirect(z);
            })
        },
        $ERROR_CODES: o
    };
};
;
var _t = {
    jwks: {
        fields: {
            publicKey: {
                type: "string",
                required: !0
            },
            privateKey: {
                type: "string",
                required: !0
            },
            createdAt: {
                type: "date",
                required: !0
            }
        }
    }
}, rm = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
    id: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    publicKey: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    privateKey: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    createdAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].date()
});
var xo = (e)=>({
        getAllKeys: async ()=>await e.findMany({
                model: "jwks"
            }),
        getLatestKey: async ()=>(await e.findMany({
                model: "jwks",
                sortBy: {
                    field: "createdAt",
                    direction: "desc"
                },
                limit: 1
            }))[0],
        createJwk: async (o)=>await e.create({
                model: "jwks",
                data: {
                    ...o,
                    createdAt: new Date
                }
            })
    });
;
var pm = (e)=>({
        id: "jwt",
        endpoints: {
            getJwks: u("/jwks", {
                method: "GET",
                metadata: {
                    openapi: {
                        description: "Get the JSON Web Key Set",
                        responses: {
                            200: {
                                description: "Success",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                keys: {
                                                    type: "array",
                                                    items: {
                                                        type: "object",
                                                        properties: {
                                                            kid: {
                                                                type: "string"
                                                            },
                                                            kty: {
                                                                type: "string"
                                                            },
                                                            use: {
                                                                type: "string"
                                                            },
                                                            alg: {
                                                                type: "string"
                                                            },
                                                            n: {
                                                                type: "string"
                                                            },
                                                            e: {
                                                                type: "string"
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (o)=>{
                let r = xo(o.context.adapter), i = await r.getAllKeys();
                if (i.length === 0) {
                    let { publicKey: t, privateKey: n } = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$node$2f$esm$2f$key$2f$generate_key_pair$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["generateKeyPair"])(e?.jwks?.keyPairConfig?.alg ?? "EdDSA", e?.jwks?.keyPairConfig ?? {
                        crv: "Ed25519",
                        extractable: !0
                    }), s = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$node$2f$esm$2f$key$2f$export$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["exportJWK"])(t), a = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$node$2f$esm$2f$key$2f$export$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["exportJWK"])(n), d = JSON.stringify(a), A = !e?.jwks?.disablePrivateKeyEncryption, c = {
                        id: o.context.generateId({
                            model: "jwks"
                        }),
                        publicKey: JSON.stringify(s),
                        privateKey: A ? JSON.stringify(await le({
                            key: o.context.options.secret,
                            data: d
                        })) : d,
                        createdAt: new Date
                    };
                    return await r.createJwk(c), o.json({
                        keys: [
                            {
                                ...s,
                                kid: c.id
                            }
                        ]
                    });
                }
                return o.json({
                    keys: i.map((t)=>({
                            ...JSON.parse(t.publicKey),
                            kid: t.id
                        }))
                });
            }),
            getToken: u("/token", {
                method: "GET",
                requireHeaders: !0,
                use: [
                    I
                ],
                metadata: {
                    openapi: {
                        description: "Get a JWT token",
                        responses: {
                            200: {
                                description: "Success",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                token: {
                                                    type: "string"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (o)=>{
                let r = xo(o.context.adapter), i = await r.getLatestKey(), t = !e?.jwks?.disablePrivateKeyEncryption;
                if (i === void 0) {
                    let { publicKey: A, privateKey: c } = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$node$2f$esm$2f$key$2f$generate_key_pair$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["generateKeyPair"])(e?.jwks?.keyPairConfig?.alg ?? "EdDSA", e?.jwks?.keyPairConfig ?? {
                        crv: "Ed25519",
                        extractable: !0
                    }), p = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$node$2f$esm$2f$key$2f$export$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["exportJWK"])(A), l = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$node$2f$esm$2f$key$2f$export$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["exportJWK"])(c), K = JSON.stringify(l), y = {
                        id: o.context.generateId({
                            model: "jwks"
                        }),
                        publicKey: JSON.stringify(p),
                        privateKey: t ? JSON.stringify(await le({
                            key: o.context.options.secret,
                            data: K
                        })) : K,
                        createdAt: new Date
                    };
                    i = await r.createJwk(y);
                }
                let n = t ? await he({
                    key: o.context.options.secret,
                    data: JSON.parse(i.privateKey)
                }) : i.privateKey, s = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$node$2f$esm$2f$key$2f$import$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["importJWK"])(JSON.parse(n)), a = e?.jwt?.definePayload ? await e?.jwt.definePayload(o.context.session) : o.context.session.user, d = await new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$node$2f$esm$2f$jwt$2f$sign$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["SignJWT"]({
                    ...a,
                    ...o.context.session.session.impersonatedBy ? {
                        impersonatedBy: o.context.session.session.impersonatedBy
                    } : {}
                }).setProtectedHeader({
                    alg: e?.jwks?.keyPairConfig?.alg ?? "EdDSA",
                    kid: i.id
                }).setIssuedAt().setIssuer(e?.jwt?.issuer ?? o.context.options.baseURL).setAudience(e?.jwt?.audience ?? o.context.options.baseURL).setExpirationTime(e?.jwt?.expirationTime ?? "15m").setSubject(o.context.session.user.id).sign(s);
                return o.json({
                    token: d
                });
            })
        },
        schema: me(_t, e?.schema)
    });
;
var hm = (e)=>{
    let o = {
        maximumSessions: 5,
        ...e
    }, r = (t)=>t.includes("_multi-"), i = {
        INVALID_SESSION_TOKEN: "Invalid session token"
    };
    return {
        id: "multi-session",
        endpoints: {
            listDeviceSessions: u("/multi-session/list-device-sessions", {
                method: "GET",
                requireHeaders: !0
            }, async (t)=>{
                let n = t.headers?.get("cookie");
                if (!n) return t.json([]);
                let s = Object.fromEntries(qe(n)), a = (await Promise.all(Object.entries(s).filter(([c])=>r(c)).map(async ([c])=>await t.getSignedCookie(c, t.context.secret)))).filter((c)=>c !== void 0);
                if (!a.length) return t.json([]);
                let A = (await t.context.internalAdapter.findSessions(a)).filter((c)=>c && c.session.expiresAt > new Date);
                return t.json(A);
            }),
            setActiveSession: u("/multi-session/set-active", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
                    sessionToken: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "The session token to set as active"
                    })
                }),
                requireHeaders: !0,
                use: [
                    I
                ],
                metadata: {
                    openapi: {
                        description: "Set the active session",
                        responses: {
                            200: {
                                description: "Success",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                session: {
                                                    $ref: "#/components/schemas/Session"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (t)=>{
                let n = t.body.sessionToken, s = `${t.context.authCookies.sessionToken.name}_multi-${n}`;
                if (!await t.getSignedCookie(s, t.context.secret)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                    message: i.INVALID_SESSION_TOKEN
                });
                let d = await t.context.internalAdapter.findSession(n);
                if (!d || d.session.expiresAt < new Date) throw t.setCookie(s, "", {
                    ...t.context.authCookies.sessionToken.options,
                    maxAge: 0
                }), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                    message: i.INVALID_SESSION_TOKEN
                });
                return await b(t, d), t.json(d);
            }),
            revokeDeviceSession: u("/multi-session/revoke", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
                    sessionToken: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "The session token to revoke"
                    })
                }),
                requireHeaders: !0,
                use: [
                    I
                ],
                metadata: {
                    openapi: {
                        description: "Revoke a device session",
                        responses: {
                            200: {
                                description: "Success",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                status: {
                                                    type: "boolean"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (t)=>{
                let n = t.body.sessionToken, s = `${t.context.authCookies.sessionToken.name}_multi-${n}`;
                if (!await t.getSignedCookie(s, t.context.secret)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                    message: i.INVALID_SESSION_TOKEN
                });
                if (await t.context.internalAdapter.deleteSession(n), t.setCookie(s, "", {
                    ...t.context.authCookies.sessionToken.options,
                    maxAge: 0
                }), !(t.context.session?.session.token === n)) return t.json({
                    status: !0
                });
                let A = t.headers?.get("cookie");
                if (A) {
                    let c = Object.fromEntries(qe(A)), p = (await Promise.all(Object.entries(c).filter(([K])=>r(K)).map(async ([K])=>await t.getSignedCookie(K, t.context.secret)))).filter((K)=>K !== void 0), l = t.context.internalAdapter;
                    if (p.length > 0) {
                        let y = (await l.findSessions(p)).filter((h)=>h && h.session.expiresAt > new Date);
                        if (y.length > 0) {
                            let h = y[0];
                            await b(t, h);
                        } else G(t);
                    } else G(t);
                } else G(t);
                return t.json({
                    status: !0
                });
            })
        },
        hooks: {
            after: [
                {
                    matcher: ()=>!0,
                    handler: N(async (t)=>{
                        let n = t.responseHeader.get("set-cookie");
                        if (!n) return;
                        let s = Oe(n), a = t.context.authCookies.sessionToken, d = s.get(a.name)?.value;
                        if (!d) return;
                        let A = qe(t.headers?.get("cookie") || ""), c = d.split(".")[0];
                        if (!c) return;
                        let p = `${a.name}_multi-${c}`;
                        s.get(p) || A.get(p) || Object.keys(Object.fromEntries(A)).filter(r).length + (n.includes("session_token") ? 1 : 0) > o.maximumSessions || await t.setSignedCookie(p, c, t.context.secret, a.options);
                    })
                },
                {
                    matcher: (t)=>t.path === "/sign-out",
                    handler: N(async (t)=>{
                        let n = t.headers?.get("cookie");
                        if (!n) return;
                        let s = Object.fromEntries(qe(n)), a = Object.keys(s).map((d)=>r(d) ? (t.setCookie(d, "", {
                                maxAge: 0
                            }), d.split("_multi-")[1]) : null).filter((d)=>d !== null);
                        await t.context.internalAdapter.deleteSessions(a);
                    })
                }
            ]
        },
        $ERROR_CODES: i
    };
};
;
var zo = [
    "email-verification",
    "sign-in",
    "forget-password"
], Em = (e)=>{
    let o = {
        expireIn: 300,
        otpLength: 6,
        ...e
    }, r = {
        OTP_EXPIRED: "otp expired",
        INVALID_OTP: "invalid otp",
        INVALID_EMAIL: "invalid email",
        USER_NOT_FOUND: "user not found"
    };
    return {
        id: "email-otp",
        endpoints: {
            sendVerificationOTP: u("/email-otp/send-verification-otp", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
                    email: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "Email address to send the OTP"
                    }),
                    type: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].enum(zo, {
                        description: "Type of the OTP"
                    })
                }),
                metadata: {
                    openapi: {
                        description: "Send verification OTP",
                        responses: {
                            200: {
                                description: "Success",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                success: {
                                                    type: "boolean"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (i)=>{
                if (!e?.sendVerificationOTP) throw i.context.logger.error("send email verification is not implemented"), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: "send email verification is not implemented"
                });
                let t = i.body.email;
                if (!/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(t)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: r.INVALID_EMAIL
                });
                let s = _(o.otpLength, "0-9");
                return await i.context.internalAdapter.createVerificationValue({
                    value: s,
                    identifier: `${i.body.type}-otp-${t}`,
                    expiresAt: L(o.expireIn, "sec")
                }).catch(async (a)=>{
                    await i.context.internalAdapter.deleteVerificationByIdentifier(`${i.body.type}-otp-${t}`), await i.context.internalAdapter.createVerificationValue({
                        value: s,
                        identifier: `${i.body.type}-otp-${t}`,
                        expiresAt: L(o.expireIn, "sec")
                    });
                }), await e.sendVerificationOTP({
                    email: t,
                    otp: s,
                    type: i.body.type
                }, i.request), i.json({
                    success: !0
                });
            }),
            createVerificationOTP: u("/email-otp/create-verification-otp", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
                    email: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "Email address to send the OTP"
                    }),
                    type: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].enum(zo, {
                        description: "Type of the OTP"
                    })
                }),
                metadata: {
                    SERVER_ONLY: !0,
                    openapi: {
                        description: "Create verification OTP",
                        responses: {
                            200: {
                                description: "Success",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "string"
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (i)=>{
                let t = i.body.email, n = _(o.otpLength, "0-9");
                return await i.context.internalAdapter.createVerificationValue({
                    value: n,
                    identifier: `${i.body.type}-otp-${t}`,
                    expiresAt: L(o.expireIn, "sec")
                }), n;
            }),
            getVerificationOTP: u("/email-otp/get-verification-otp", {
                method: "GET",
                query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
                    email: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "Email address to get the OTP"
                    }),
                    type: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].enum(zo)
                }),
                metadata: {
                    SERVER_ONLY: !0,
                    openapi: {
                        description: "Get verification OTP",
                        responses: {
                            200: {
                                description: "Success",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                otp: {
                                                    type: "string"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (i)=>{
                let t = i.query.email, n = await i.context.internalAdapter.findVerificationValue(`${i.query.type}-otp-${t}`);
                return !n || n.expiresAt < new Date ? i.json({
                    otp: null
                }) : i.json({
                    otp: n.value
                });
            }),
            verifyEmailOTP: u("/email-otp/verify-email", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
                    email: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "Email address to verify"
                    }),
                    otp: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "OTP to verify"
                    })
                }),
                metadata: {
                    openapi: {
                        description: "Verify email OTP",
                        responses: {
                            200: {
                                description: "Success",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                user: {
                                                    $ref: "#/components/schemas/User"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (i)=>{
                let t = i.body.email;
                if (!/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(t)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: r.INVALID_EMAIL
                });
                let s = await i.context.internalAdapter.findVerificationValue(`email-verification-otp-${t}`);
                if (!s) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: r.INVALID_OTP
                });
                if (s.expiresAt < new Date) throw await i.context.internalAdapter.deleteVerificationValue(s.id), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: r.OTP_EXPIRED
                });
                let a = i.body.otp;
                if (s.value !== a) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: r.INVALID_OTP
                });
                await i.context.internalAdapter.deleteVerificationValue(s.id);
                let d = await i.context.internalAdapter.findUserByEmail(t);
                if (!d) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: r.USER_NOT_FOUND
                });
                let A = await i.context.internalAdapter.updateUser(d.user.id, {
                    email: t,
                    emailVerified: !0
                });
                if (i.context.options.emailVerification?.autoSignInAfterVerification) {
                    let c = await i.context.internalAdapter.createSession(A.id, i.request);
                    return await b(i, {
                        session: c,
                        user: A
                    }), i.json({
                        token: c.token,
                        status: !0
                    });
                }
                return i.json({
                    status: !0,
                    token: null
                });
            }),
            signInEmailOTP: u("/sign-in/email-otp", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
                    email: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "Email address to sign in"
                    }),
                    otp: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "OTP sent to the email"
                    })
                }),
                metadata: {
                    openapi: {
                        description: "Sign in with email OTP",
                        responses: {
                            200: {
                                description: "Success",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                user: {
                                                    $ref: "#/components/schemas/User"
                                                },
                                                session: {
                                                    $ref: "#/components/schemas/Session"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (i)=>{
                let t = i.body.email, n = await i.context.internalAdapter.findVerificationValue(`sign-in-otp-${t}`);
                if (!n) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: r.INVALID_OTP
                });
                if (n.expiresAt < new Date) throw await i.context.internalAdapter.deleteVerificationValue(n.id), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: r.OTP_EXPIRED
                });
                let s = i.body.otp;
                if (n.value !== s) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: r.INVALID_OTP
                });
                await i.context.internalAdapter.deleteVerificationValue(n.id);
                let a = await i.context.internalAdapter.findUserByEmail(t);
                if (!a) {
                    if (o.disableSignUp) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                        message: r.USER_NOT_FOUND
                    });
                    let A = await i.context.internalAdapter.createUser({
                        email: t,
                        emailVerified: !0,
                        name: t
                    }), c = await i.context.internalAdapter.createSession(A.id, i.request);
                    return await b(i, {
                        session: c,
                        user: A
                    }), i.json({
                        token: c.token
                    });
                }
                a.user.emailVerified || await i.context.internalAdapter.updateUser(a.user.id, {
                    emailVerified: !0
                });
                let d = await i.context.internalAdapter.createSession(a.user.id, i.request);
                return await b(i, {
                    session: d,
                    user: a.user
                }), i.json({
                    token: d.token
                });
            }),
            forgetPasswordEmailOTP: u("/forget-password/email-otp", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
                    email: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "Email address to send the OTP"
                    })
                }),
                metadata: {
                    openapi: {
                        description: "Forget password with email OTP",
                        responses: {
                            200: {
                                description: "Success",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                success: {
                                                    type: "boolean"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (i)=>{
                let t = i.body.email;
                if (!await i.context.internalAdapter.findUserByEmail(t)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: r.USER_NOT_FOUND
                });
                let s = _(o.otpLength, "0-9");
                return await i.context.internalAdapter.createVerificationValue({
                    value: s,
                    identifier: `forget-password-otp-${t}`,
                    expiresAt: L(o.expireIn, "sec")
                }), await e.sendVerificationOTP({
                    email: t,
                    otp: s,
                    type: "forget-password"
                }, i.request), i.json({
                    success: !0
                });
            }),
            resetPasswordEmailOTP: u("/email-otp/reset-password", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
                    email: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "Email address to reset the password"
                    }),
                    otp: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "OTP sent to the email"
                    }),
                    password: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "New password"
                    })
                }),
                metadata: {
                    openapi: {
                        description: "Reset password with email OTP",
                        responses: {
                            200: {
                                description: "Success",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                success: {
                                                    type: "boolean"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (i)=>{
                let t = i.body.email, n = await i.context.internalAdapter.findUserByEmail(t);
                if (!n) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: r.USER_NOT_FOUND
                });
                let s = await i.context.internalAdapter.findVerificationValue(`forget-password-otp-${t}`);
                if (!s) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: r.INVALID_OTP
                });
                if (s.expiresAt < new Date) throw await i.context.internalAdapter.deleteVerificationValue(s.id), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: r.OTP_EXPIRED
                });
                let a = i.body.otp;
                if (s.value !== a) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: r.INVALID_OTP
                });
                await i.context.internalAdapter.deleteVerificationValue(s.id);
                let d = await i.context.password.hash(i.body.password);
                return await i.context.internalAdapter.updatePassword(n.user.id, d), i.json({
                    success: !0
                });
            })
        },
        hooks: {
            after: [
                {
                    matcher (i) {
                        return !!(i.path?.startsWith("/sign-up") && o.sendVerificationOnSignUp);
                    },
                    async handler (i) {
                        let t = i.context.returned;
                        if (t instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]) return;
                        let n = t && "email" in t ? t.email : t instanceof Response && t.status === 200 ? i.body.email : null;
                        if (n) {
                            let s = _(o.otpLength, "0-9");
                            await i.context.internalAdapter.createVerificationValue({
                                value: s,
                                identifier: `email-verification-otp-${n}`,
                                expiresAt: L(o.expireIn, "sec")
                            }), await e.sendVerificationOTP({
                                email: n,
                                otp: s,
                                type: "email-verification"
                            }, i.request);
                        }
                    }
                }
            ]
        },
        $ERROR_CODES: r
    };
};
;
function Ut(e) {
    return e === "true" || e === !0;
}
var Pm = (e)=>({
        id: "one-tap",
        endpoints: {
            oneTapCallback: u("/one-tap/callback", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
                    idToken: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "Google ID token, which the client obtains from the One Tap API"
                    })
                }),
                metadata: {
                    openapi: {
                        summary: "One tap callback",
                        description: "Use this endpoint to authenticate with Google One Tap",
                        responses: {
                            200: {
                                description: "Successful response",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "object",
                                            properties: {
                                                session: {
                                                    $ref: "#/components/schemas/Session"
                                                },
                                                user: {
                                                    $ref: "#/components/schemas/User"
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            400: {
                                description: "Invalid token"
                            }
                        }
                    }
                }
            }, async (o)=>{
                let { idToken: r } = o.body, { data: i, error: t } = await R("https://oauth2.googleapis.com/tokeninfo?id_token=" + r);
                if (t) return o.json({
                    error: "Invalid token"
                });
                let n = await o.context.internalAdapter.findUserByEmail(i.email);
                if (!n) {
                    if (e?.disableSignup) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_GATEWAY", {
                        message: "User not found"
                    });
                    let a = await o.context.internalAdapter.createOAuthUser({
                        email: i.email,
                        emailVerified: Ut(i.email_verified),
                        name: i.name,
                        image: i.picture
                    }, {
                        providerId: "google",
                        accountId: i.sub
                    });
                    if (!a) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("INTERNAL_SERVER_ERROR", {
                        message: "Could not create user"
                    });
                    let d = await o.context.internalAdapter.createSession(a?.user.id, o.request);
                    return await b(o, {
                        user: a.user,
                        session: d
                    }), o.json({
                        session: d,
                        user: a
                    });
                }
                let s = await o.context.internalAdapter.createSession(n.user.id, o.request);
                return await b(o, {
                    user: n.user,
                    session: s
                }), o.json({
                    token: s.token
                });
            })
        }
    });
;
function vn() {
    let e = fe.VERCEL_URL, o = fe.NETLIFY_URL, r = fe.RENDER_URL, i = fe.AWS_LAMBDA_FUNCTION_NAME, t = fe.GOOGLE_CLOUD_FUNCTION_NAME, n = fe.AZURE_FUNCTION_NAME;
    return e || o || r || i || t || n;
}
var Bm = (e)=>({
        id: "oauth-proxy",
        endpoints: {
            oAuthProxy: u("/oauth-proxy-callback", {
                method: "GET",
                query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
                    callbackURL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "The URL to redirect to after the proxy"
                    }),
                    cookies: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string({
                        description: "The cookies to set after the proxy"
                    })
                }),
                metadata: {
                    openapi: {
                        description: "OAuth Proxy Callback",
                        parameters: [
                            {
                                in: "query",
                                name: "callbackURL",
                                required: !0,
                                description: "The URL to redirect to after the proxy"
                            },
                            {
                                in: "query",
                                name: "cookies",
                                required: !0,
                                description: "The cookies to set after the proxy"
                            }
                        ],
                        responses: {
                            302: {
                                description: "Redirect",
                                headers: {
                                    Location: {
                                        description: "The URL to redirect to",
                                        schema: {
                                            type: "string"
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }, async (o)=>{
                let r = o.query.cookies, i = await he({
                    key: o.context.secret,
                    data: r
                });
                throw o.setHeader("set-cookie", i), o.redirect(o.query.callbackURL);
            })
        },
        hooks: {
            after: [
                {
                    matcher (o) {
                        return o.path?.startsWith("/callback");
                    },
                    handler: N(async (o)=>{
                        let r = o.context.returned, i = r instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"] ? r.headers : null, t = i?.get("location");
                        if (t?.includes("/oauth-proxy-callback?callbackURL")) {
                            if (!t.startsWith("http")) return;
                            let n = new URL(t);
                            if (n.origin === Ue(o.context.baseURL)) {
                                let c = n.searchParams.get("callbackURL");
                                if (!c) return;
                                o.setHeader("location", c);
                                return;
                            }
                            let a = i?.get("set-cookie");
                            if (!a) return;
                            let d = await le({
                                key: o.context.secret,
                                data: a
                            }), A = `${t}&cookies=${encodeURIComponent(d)}`;
                            o.setHeader("location", A);
                        }
                    })
                }
            ],
            before: [
                {
                    matcher (o) {
                        return o.path?.startsWith("/sign-in/social");
                    },
                    async handler (o) {
                        let r = new URL(e?.currentURL || o.request?.url || vn() || o.context.baseURL);
                        return o.body.callbackURL = `${r.origin}${o.context.options.basePath || "/api/auth"}/oauth-proxy-callback?callbackURL=${encodeURIComponent(o.body.callbackURL || o.context.baseURL)}`, {
                            context: o
                        };
                    }
                }
            ]
        }
    });
;
var qm = (e, o)=>({
        id: "custom-session",
        endpoints: {
            getSession: u("/get-session", {
                method: "GET",
                metadata: {
                    CUSTOM_SESSION: !0
                },
                query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].optional(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
                    disableCookieCache: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].boolean({
                        description: "Disable cookie cache and fetch session from database"
                    }).or(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().transform((r)=>r === "true")).optional(),
                    disableRefresh: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].boolean({
                        description: "Disable session refresh. Useful for checking session status, without updating the session"
                    }).optional()
                }))
            }, async (r)=>{
                let i = await v(r);
                if (!i) return r.json(null);
                let t = await e(i);
                return r.json(t);
            })
        }
    });
;
var Fe = (e)=>{
    let o = e.plugins?.reduce((d, A)=>{
        let c = A.schema;
        if (!c) return d;
        for (let [p, l] of Object.entries(c))d[p] = {
            fields: {
                ...d[p]?.fields,
                ...l.fields
            },
            modelName: l.modelName || p
        };
        return d;
    }, {}), r = e.rateLimit?.storage === "database", i = {
        rateLimit: {
            modelName: e.rateLimit?.modelName || "rateLimit",
            fields: {
                key: {
                    type: "string",
                    fieldName: e.rateLimit?.fields?.key || "key"
                },
                count: {
                    type: "number",
                    fieldName: e.rateLimit?.fields?.count || "count"
                },
                lastRequest: {
                    type: "number",
                    fieldName: e.rateLimit?.fields?.lastRequest || "lastRequest"
                }
            }
        }
    }, { user: t, session: n, account: s, ...a } = o || {};
    return {
        user: {
            modelName: e.user?.modelName || "user",
            fields: {
                name: {
                    type: "string",
                    required: !0,
                    fieldName: e.user?.fields?.name || "name"
                },
                email: {
                    type: "string",
                    unique: !0,
                    required: !0,
                    fieldName: e.user?.fields?.email || "email"
                },
                emailVerified: {
                    type: "boolean",
                    defaultValue: ()=>!1,
                    required: !0,
                    fieldName: e.user?.fields?.emailVerified || "emailVerified"
                },
                image: {
                    type: "string",
                    required: !1,
                    fieldName: e.user?.fields?.image || "image"
                },
                createdAt: {
                    type: "date",
                    defaultValue: ()=>new Date,
                    required: !0,
                    fieldName: e.user?.fields?.createdAt || "createdAt"
                },
                updatedAt: {
                    type: "date",
                    defaultValue: ()=>new Date,
                    required: !0,
                    fieldName: e.user?.fields?.updatedAt || "updatedAt"
                },
                ...t?.fields,
                ...e.user?.additionalFields
            },
            order: 1
        },
        session: {
            modelName: e.session?.modelName || "session",
            fields: {
                expiresAt: {
                    type: "date",
                    required: !0,
                    fieldName: e.session?.fields?.expiresAt || "expiresAt"
                },
                token: {
                    type: "string",
                    required: !0,
                    fieldName: e.session?.fields?.token || "token",
                    unique: !0
                },
                createdAt: {
                    type: "date",
                    required: !0,
                    fieldName: e.session?.fields?.createdAt || "createdAt"
                },
                updatedAt: {
                    type: "date",
                    required: !0,
                    fieldName: e.session?.fields?.updatedAt || "updatedAt"
                },
                ipAddress: {
                    type: "string",
                    required: !1,
                    fieldName: e.session?.fields?.ipAddress || "ipAddress"
                },
                userAgent: {
                    type: "string",
                    required: !1,
                    fieldName: e.session?.fields?.userAgent || "userAgent"
                },
                userId: {
                    type: "string",
                    fieldName: e.session?.fields?.userId || "userId",
                    references: {
                        model: e.user?.modelName || "user",
                        field: "id",
                        onDelete: "cascade"
                    },
                    required: !0
                },
                ...n?.fields,
                ...e.session?.additionalFields
            },
            order: 2
        },
        account: {
            modelName: e.account?.modelName || "account",
            fields: {
                accountId: {
                    type: "string",
                    required: !0,
                    fieldName: e.account?.fields?.accountId || "accountId"
                },
                providerId: {
                    type: "string",
                    required: !0,
                    fieldName: e.account?.fields?.providerId || "providerId"
                },
                userId: {
                    type: "string",
                    references: {
                        model: e.user?.modelName || "user",
                        field: "id",
                        onDelete: "cascade"
                    },
                    required: !0,
                    fieldName: e.account?.fields?.userId || "userId"
                },
                accessToken: {
                    type: "string",
                    required: !1,
                    fieldName: e.account?.fields?.accessToken || "accessToken"
                },
                refreshToken: {
                    type: "string",
                    required: !1,
                    fieldName: e.account?.fields?.refreshToken || "refreshToken"
                },
                idToken: {
                    type: "string",
                    required: !1,
                    fieldName: e.account?.fields?.idToken || "idToken"
                },
                accessTokenExpiresAt: {
                    type: "date",
                    required: !1,
                    fieldName: e.account?.fields?.accessTokenExpiresAt || "accessTokenExpiresAt"
                },
                refreshTokenExpiresAt: {
                    type: "date",
                    required: !1,
                    fieldName: e.account?.fields?.accessTokenExpiresAt || "refreshTokenExpiresAt"
                },
                scope: {
                    type: "string",
                    required: !1,
                    fieldName: e.account?.fields?.scope || "scope"
                },
                password: {
                    type: "string",
                    required: !1,
                    fieldName: e.account?.fields?.password || "password"
                },
                createdAt: {
                    type: "date",
                    required: !0,
                    fieldName: e.account?.fields?.createdAt || "createdAt"
                },
                updatedAt: {
                    type: "date",
                    required: !0,
                    fieldName: e.account?.fields?.updatedAt || "updatedAt"
                },
                ...s?.fields
            },
            order: 3
        },
        verification: {
            modelName: e.verification?.modelName || "verification",
            fields: {
                identifier: {
                    type: "string",
                    required: !0,
                    fieldName: e.verification?.fields?.identifier || "identifier"
                },
                value: {
                    type: "string",
                    required: !0,
                    fieldName: e.verification?.fields?.value || "value"
                },
                expiresAt: {
                    type: "date",
                    required: !0,
                    fieldName: e.verification?.fields?.expiresAt || "expiresAt"
                },
                createdAt: {
                    type: "date",
                    required: !1,
                    defaultValue: ()=>new Date,
                    fieldName: e.verification?.fields?.createdAt || "createdAt"
                },
                updatedAt: {
                    type: "date",
                    required: !1,
                    defaultValue: ()=>new Date,
                    fieldName: e.verification?.fields?.updatedAt || "updatedAt"
                }
            },
            order: 4
        },
        ...a,
        ...r ? i : {}
    };
};
;
;
;
var eo = {};
function Nt(e) {
    switch(e.constructor.name){
        case "ZodString":
            return "string";
        case "ZodNumber":
            return "number";
        case "ZodBoolean":
            return "boolean";
        case "ZodObject":
            return "object";
        case "ZodArray":
            return "array";
        default:
            return "string";
    }
}
function ho(e) {
    let o = [];
    return e.metadata?.openapi?.parameters ? (o.push(...e.metadata.openapi.parameters), o) : (e.query instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["ZodObject"] && Object.entries(e.query.shape).forEach(([r, i])=>{
        i instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["ZodSchema"] && o.push({
            name: r,
            in: "query",
            schema: {
                type: Nt(i),
                ..."minLength" in i && i.minLength ? {
                    minLength: i.minLength
                } : {},
                description: i.description
            }
        });
    }), o);
}
function kt(e) {
    if (e.metadata?.openapi?.requestBody) return e.metadata.openapi.requestBody;
    if (e.body && (e.body instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["ZodObject"] || e.body instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["ZodOptional"])) {
        let o = e.body.shape;
        if (!o) return;
        let r = {}, i = [];
        return Object.entries(o).forEach(([t, n])=>{
            n instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["ZodSchema"] && (r[t] = {
                type: Nt(n),
                description: n.description
            }, n instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["ZodOptional"] || i.push(t));
        }), {
            required: e.body instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["ZodOptional"] ? !1 : !!e.body,
            content: {
                "application/json": {
                    schema: {
                        type: "object",
                        properties: r,
                        required: i
                    }
                }
            }
        };
    }
}
function yo(e) {
    return {
        400: {
            content: {
                "application/json": {
                    schema: {
                        type: "object",
                        properties: {
                            message: {
                                type: "string"
                            }
                        },
                        required: [
                            "message"
                        ]
                    }
                }
            },
            description: "Bad Request. Usually due to missing parameters, or invalid parameters."
        },
        401: {
            content: {
                "application/json": {
                    schema: {
                        type: "object",
                        properties: {
                            message: {
                                type: "string"
                            }
                        },
                        required: [
                            "message"
                        ]
                    }
                }
            },
            description: "Unauthorized. Due to missing or invalid authentication."
        },
        403: {
            content: {
                "application/json": {
                    schema: {
                        type: "object",
                        properties: {
                            message: {
                                type: "string"
                            }
                        }
                    }
                }
            },
            description: "Forbidden. You do not have permission to access this resource or to perform this action."
        },
        404: {
            content: {
                "application/json": {
                    schema: {
                        type: "object",
                        properties: {
                            message: {
                                type: "string"
                            }
                        }
                    }
                }
            },
            description: "Not Found. The requested resource was not found."
        },
        429: {
            content: {
                "application/json": {
                    schema: {
                        type: "object",
                        properties: {
                            message: {
                                type: "string"
                            }
                        }
                    }
                }
            },
            description: "Too Many Requests. You have exceeded the rate limit. Try again later."
        },
        500: {
            content: {
                "application/json": {
                    schema: {
                        type: "object",
                        properties: {
                            message: {
                                type: "string"
                            }
                        }
                    }
                }
            },
            description: "Internal Server Error. This is a problem with the server that you cannot fix."
        },
        ...e
    };
}
async function Mo(e, o) {
    let r = ko(e, {
        ...o,
        plugins: []
    }), i = Fe(o), n = {
        schemas: {
            ...Object.entries(i).reduce((a, [d, A])=>{
                let c = d.charAt(0).toUpperCase() + d.slice(1);
                return a[c] = {
                    type: "object",
                    properties: Object.entries(A.fields).reduce((p, [l, K])=>(p[l] = {
                            type: K.type
                        }, p), {})
                }, a;
            }, {})
        }
    };
    Object.entries(r.api).forEach(([a, d])=>{
        let A = d.options;
        if (!A.metadata?.SERVER_ONLY && (A.method === "GET" && (eo[d.path] = {
            get: {
                tags: [
                    "Default",
                    ...A.metadata?.openapi?.tags || []
                ],
                description: A.metadata?.openapi?.description,
                operationId: A.metadata?.openapi?.operationId,
                security: [
                    {
                        bearerAuth: []
                    }
                ],
                parameters: ho(A),
                responses: yo(A.metadata?.openapi?.responses)
            }
        }), A.method === "POST")) {
            let c = kt(A);
            eo[d.path] = {
                post: {
                    tags: [
                        "Default",
                        ...A.metadata?.openapi?.tags || []
                    ],
                    description: A.metadata?.openapi?.description,
                    operationId: A.metadata?.openapi?.operationId,
                    security: [
                        {
                            bearerAuth: []
                        }
                    ],
                    parameters: ho(A),
                    ...c ? {
                        requestBody: c
                    } : {
                        requestBody: {
                            content: {
                                "application/json": {
                                    schema: {
                                        type: "object",
                                        properties: {}
                                    }
                                }
                            }
                        }
                    },
                    responses: yo(A.metadata?.openapi?.responses)
                }
            };
        }
    });
    for (let a of o.plugins || []){
        if (a.id === "open-api") continue;
        let d = ko(e, {
            ...o,
            plugins: [
                a
            ]
        }), A = Object.keys(d.api).map((c)=>r.api[c] === void 0 ? d.api[c] : null).filter((c)=>c !== null);
        Object.entries(A).forEach(([c, p])=>{
            let l = p.options;
            l.metadata?.SERVER_ONLY || (l.method === "GET" && (eo[p.path] = {
                get: {
                    tags: l.metadata?.openapi?.tags || [
                        a.id.charAt(0).toUpperCase() + a.id.slice(1)
                    ],
                    description: l.metadata?.openapi?.description,
                    operationId: l.metadata?.openapi?.operationId,
                    security: [
                        {
                            bearerAuth: []
                        }
                    ],
                    parameters: ho(l),
                    responses: yo(l.metadata?.openapi?.responses)
                }
            }), l.method === "POST" && (eo[p.path] = {
                post: {
                    tags: l.metadata?.openapi?.tags || [
                        a.id.charAt(0).toUpperCase() + a.id.slice(1)
                    ],
                    description: l.metadata?.openapi?.description,
                    operationId: l.metadata?.openapi?.operationId,
                    security: [
                        {
                            bearerAuth: []
                        }
                    ],
                    parameters: ho(l),
                    requestBody: kt(l),
                    responses: yo(l.metadata?.openapi?.responses)
                }
            }));
        });
    }
    return {
        openapi: "3.1.1",
        info: {
            title: "Better Auth",
            description: "API Reference for your Better Auth Instance"
        },
        components: n,
        security: [
            {
                apiKeyCookie: []
            }
        ],
        servers: [
            {
                url: e.baseURL
            }
        ],
        tags: [
            {
                name: "Default",
                description: "Default endpoints that are included with Better Auth by default. These endpoints are not part of any plugin."
            }
        ],
        paths: eo
    };
}
var Lt = `<svg width="75" height="75" viewBox="0 0 75 75" fill="none" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect width="75" height="75" fill="url(#pattern0_21_12)"/>
<defs>
<pattern id="pattern0_21_12" patternContentUnits="objectBoundingBox" width="1" height="1">
<use xlink:href="#image0_21_12" transform="scale(0.00094697)"/>
</pattern>
<image id="image0_21_12" width="1056" height="1056" xlink:href="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAASABIAAD/4QBARXhpZgAATU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAEIKADAAQAAAABAAAEIAAAAAD/7QA4UGhvdG9zaG9wIDMuMAA4QklNBAQAAAAAAAA4QklNBCUAAAAAABDUHYzZjwCyBOmACZjs+EJ+/+ICKElDQ19QUk9GSUxFAAEBAAACGGFwcGwEAAAAbW50clJHQiBYWVogB+YAAQABAAAAAAAAYWNzcEFQUEwAAAAAQVBQTAAAAAAAAAAAAAAAAAAAAAAAAPbWAAEAAAAA0y1hcHBs7P2jjjiFR8NttL1PetoYLwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKZGVzYwAAAPwAAAAwY3BydAAAASwAAABQd3RwdAAAAXwAAAAUclhZWgAAAZAAAAAUZ1hZWgAAAaQAAAAUYlhZWgAAAbgAAAAUclRSQwAAAcwAAAAgY2hhZAAAAewAAAAsYlRSQwAAAcwAAAAgZ1RSQwAAAcwAAAAgbWx1YwAAAAAAAAABAAAADGVuVVMAAAAUAAAAHABEAGkAcwBwAGwAYQB5ACAAUAAzbWx1YwAAAAAAAAABAAAADGVuVVMAAAA0AAAAHABDAG8AcAB5AHIAaQBnAGgAdAAgAEEAcABwAGwAZQAgAEkAbgBjAC4ALAAgADIAMAAyADJYWVogAAAAAAAA9tUAAQAAAADTLFhZWiAAAAAAAACD3wAAPb////+7WFlaIAAAAAAAAEq/AACxNwAACrlYWVogAAAAAAAAKDgAABELAADIuXBhcmEAAAAAAAMAAAACZmYAAPKnAAANWQAAE9AAAApbc2YzMgAAAAAAAQxCAAAF3v//8yYAAAeTAAD9kP//+6L///2jAAAD3AAAwG7/wAARCAQgBCADASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9sAQwACAgICAgIDAgIDBAMDAwQFBAQEBAUHBQUFBQUHCAcHBwcHBwgICAgICAgICgoKCgoKCwsLCwsNDQ0NDQ0NDQ0N/9sAQwECAgIDAwMGAwMGDQkHCQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0N/90ABABC/9oADAMBAAIRAxEAPwD9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//Q/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0f38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9L9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//T/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1P38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9X9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//W/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1/38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9D9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//R/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9P9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//U/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1f38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9b9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//X/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0P38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9H9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//S/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0/38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9T9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//V/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Ln/gq38a/in8Dvgp4T8R/CfxFdeG9SvvFMdlcXFoELyW5srqQxnzEcY3op4Gciv1Gr8Z/+C2X/JvXgj/sc4v/AE33lAH4z/8ADwv9tD/oq2tf9823/wAZo/4eF/tof9FW1r/vm2/+M18Z0UAfZn/Dwv8AbQ/6KtrX/fNt/wDGaP8Ah4X+2h/0VbWv++bb/wCM18Z0UAfZn/Dwv9tD/oq2tf8AfNt/8Zo/4eF/tof9FW1r/vm2/wDjNfGdFAH2Z/w8L/bQ/wCira1/3zbf/GaP+Hhf7aH/AEVbWv8Avm2/+M18Z0UAfZn/AA8L/bQ/6KtrX/fNt/8AGaP+Hhf7aH/RVta/75tv/jNfGdFAH2Z/w8L/AG0P+ira1/3zbf8Axmj/AIeF/tof9FW1r/vm2/8AjNfGdFAH63/sVftq/tTfEb9qb4deCfG3xF1TVtD1bVGgvbKdYBHPGIJW2ttiVsblB4I6V/UbX8Z//BPT/k9D4U/9hpv/AEmmr+zCgAooooAKKKKACiiigAooooAKKKKACiiigD+M/wD4eF/tof8ARVta/wC+bb/4zR/w8L/bQ/6KtrX/AHzbf/Ga+M6KAPsz/h4X+2h/0VbWv++bb/4zR/w8L/bQ/wCira1/3zbf/Ga+M6KAPsz/AIeF/tof9FW1r/vm2/8AjNH/AA8L/bQ/6KtrX/fNt/8AGa+M6KAPsz/h4X+2h/0VbWv++bb/AOM0f8PC/wBtD/oq2tf9823/AMZr4zooA+zP+Hhf7aH/AEVbWv8Avm2/+M0f8PC/20P+ira1/wB823/xmvjOigD7M/4eF/tof9FW1r/vm2/+M0f8PC/20P8Aoq2tf9823/xmvjOigD7M/wCHhf7aH/RVta/75tv/AIzR/wAPC/20P+ira1/3zbf/ABmvjOigD7M/4eF/tof9FW1r/vm2/wDjNH/Dwv8AbQ/6KtrX/fNt/wDGa+M6KAPsz/h4X+2h/wBFW1r/AL5tv/jNH/Dwv9tD/oq2tf8AfNt/8Zr4zooA+zP+Hhf7aH/RVta/75tv/jNH/Dwv9tD/AKKtrX/fNt/8Zr4zooA+zP8Ah4X+2h/0VbWv++bb/wCM0f8ADwv9tD/oq2tf9823/wAZr4zooA+zP+Hhf7aH/RVta/75tv8A4zR/w8L/AG0P+ira1/3zbf8AxmvjOigD7M/4eF/tof8ARVta/wC+bb/4zR/w8L/bQ/6KtrX/AHzbf/Ga+M6KAP6tv+CUnxr+Kfxx+CnizxH8WPEV14k1Kx8UyWVvcXYQPHbiytZBGPLRBje7HkZya/Uavxn/AOCJv/JvXjf/ALHOX/032dfsxQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAf//X/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooA+zP+Cen/J6Hwp/7DTf+k01f2YV/Gf8A8E9P+T0PhT/2Gm/9Jpq/swoAKKKKACiiigAooooAKKKKACiiigAooooA/gDooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9D9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigD7M/4J6f8nofCn/sNN/6TTV/ZhX8Z/wDwT0/5PQ+FP/Yab/0mmr+zCgAooooAKKKKACiiigAooooAKKKKACiiigD+AOiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/0f38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+M/wDwWy/5N68Ef9jnF/6b7ygD+ZuiiigAooooAKKKKACiiigAooooAKKKKAPsz/gnp/yeh8Kf+w03/pNNX9mFfxn/APBPT/k9D4U/9hpv/Saav7MKACiiigAooooAKKKKACiiigAooooAKKKKAP4A6KKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP6ZP+CJv/JvXjf/ALHOX/032dfsxX4z/wDBE3/k3rxv/wBjnL/6b7Ov2YoAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/S/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooA+zP+Cen/J6Hwp/7DTf+k01f2YV/Gf8A8E9P+T0PhT/2Gm/9Jpq/swoAKKKKACiiigAooooAKKKKACiiigAooooA/gDooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9P9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigD7M/4J6f8nofCn/sNN/6TTV/ZhX8Z/wDwT0/5PQ+FP/Yab/0mmr+zCgAooooAKKKKACiiigAooooAKKKKACiiigD+AOiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/1P38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+M/wDwWy/5N68Ef9jnF/6b7ygD+ZuiiigAooooAKKKKACiiigAooooAKKKKAPsz/gnp/yeh8Kf+w03/pNNX9mFfwq/BT4r638Dvin4d+LHhy0tb7UvDd0bu3t70ObeRzG0eJBGyPjDnowOa/Ub/h9l+0L/ANCR4M/79ah/8m0Af0yUV/M3/wAPsv2hf+hI8Gf9+tQ/+TaP+H2X7Qv/AEJHgz/v1qH/AMm0Af0yUV/M3/w+y/aF/wChI8Gf9+tQ/wDk2j/h9l+0L/0JHgz/AL9ah/8AJtAH9MlFfzN/8Psv2hf+hI8Gf9+tQ/8Ak2j/AIfZftC/9CR4M/79ah/8m0Af0yUV/M3/AMPsv2hf+hI8Gf8AfrUP/k2j/h9l+0L/ANCR4M/79ah/8m0Af0yUV/M3/wAPsv2hf+hI8Gf9+tQ/+TaP+H2X7Qv/AEJHgz/v1qH/AMm0Af0yUV/M3/w+y/aF/wChI8Gf9+tQ/wDk2j/h9l+0L/0JHgz/AL9ah/8AJtAH4z0V/TJ/w5N/Z6/6Hfxn/wB/dP8A/kKj/hyb+z1/0O/jP/v7p/8A8hUAfzN0V/TJ/wAOTf2ev+h38Z/9/dP/APkKj/hyb+z1/wBDv4z/AO/un/8AyFQB/M3RX9Mn/Dk39nr/AKHfxn/390//AOQqP+HJv7PX/Q7+M/8Av7p//wAhUAfzN0V/TJ/w5N/Z6/6Hfxn/AN/dP/8AkKj/AIcm/s9f9Dv4z/7+6f8A/IVAH8zdFf0yf8OTf2ev+h38Z/8Af3T/AP5Co/4cm/s9f9Dv4z/7+6f/APIVAH8zdFf0yf8ADk39nr/od/Gf/f3T/wD5Co/4cm/s9f8AQ7+M/wDv7p//AMhUAfzN0V/TJ/w5N/Z6/wCh38Z/9/dP/wDkKvwV/ag+FGifA74++M/hP4cu7q+03w3fi0t7i9KG4kQxRyZkMaomcueigYoA8FooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/AOxzl/8ATfZ1+zFfjP8A8ETf+TevG/8A2Ocv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//9X9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/v8ooooAKKKKACiiigAooooAKKKKACiiigAr+M//goX/wAnofFb/sNL/wCk0Nf2YV/Gf/wUL/5PQ+K3/YaX/wBJoaAPjOiiigAooooAKKKKACiiigAooooAKKKKAP6ZP+CJv/JvXjf/ALHOX/032dfsxX4z/wDBE3/k3rxv/wBjnL/6b7Ov2YoAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/W/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP7/KKKKACiiigAooooAKKKKACiiigAooooAK/jP/4KF/8AJ6HxW/7DS/8ApNDX9mFfxn/8FC/+T0Pit/2Gl/8ASaGgD4zooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/1/38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+M/wDwWy/5N68Ef9jnF/6b7ygD+ZuiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+/yiiigAooooAKKKKACiiigAooooAKKKKACv4z/+Chf/ACeh8Vv+w0v/AKTQ1/ZhX8Z//BQv/k9D4rf9hpf/AEmhoA+M6KKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9D9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/v8ooooAKKKKACiiigAooooAKKKKACiiigAr+M//goX/wAnofFb/sNL/wCk0Nf2YV/Gf/wUL/5PQ+K3/YaX/wBJoaAPjOiiigAooooAKKKKACiiigAooooAKKKKAP6ZP+CJv/JvXjf/ALHOX/032dfsxX4z/wDBE3/k3rxv/wBjnL/6b7Ov2YoAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/R/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP7/KKKKACiiigAooooAKKKKACiiigAooooAK/jP/4KF/8AJ6HxW/7DS/8ApNDX9mFfxn/8FC/+T0Pit/2Gl/8ASaGgD4zooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/0v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+M/wDwWy/5N68Ef9jnF/6b7ygD+ZuiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+/yiiigAooooAKKKKACiiigAooooAKKKKACv4z/+Chf/ACeh8Vv+w0v/AKTQ1/ZhX8Z//BQv/k9D4rf9hpf/AEmhoA+M6KKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9P9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigD1L4KfCjW/jj8U/Dvwn8OXdrY6l4kujaW9xelxbxuI2kzIY1d8YQ9FJzX6jf8OTf2hf8Aod/Bn/f3UP8A5Cr4z/4J6f8AJ6Hwp/7DTf8ApNNX9mFAH8zf/Dk39oX/AKHfwZ/391D/AOQqP+HJv7Qv/Q7+DP8Av7qH/wAhV/TJRQB/M3/w5N/aF/6HfwZ/391D/wCQqP8Ahyb+0L/0O/gz/v7qH/yFX9MlFAH8zf8Aw5N/aF/6HfwZ/wB/dQ/+QqP+HJv7Qv8A0O/gz/v7qH/yFX9MlFAH8zf/AA5N/aF/6HfwZ/391D/5Co/4cm/tC/8AQ7+DP+/uof8AyFX9MlFAH8zf/Dk39oX/AKHfwZ/391D/AOQqP+HJv7Qv/Q7+DP8Av7qH/wAhV/TJRQB/M3/w5N/aF/6HfwZ/391D/wCQqP8Ahyb+0L/0O/gz/v7qH/yFX9MlFAH4z/8AD7L9nr/oSPGf/frT/wD5No/4fZfs9f8AQkeM/wDv1p//AMm1/M3RQB/TJ/w+y/Z6/wChI8Z/9+tP/wDk2j/h9l+z1/0JHjP/AL9af/8AJtfzN0UAf0yf8Psv2ev+hI8Z/wDfrT//AJNo/wCH2X7PX/QkeM/+/Wn/APybX8zdFAH9Mn/D7L9nr/oSPGf/AH60/wD+TaP+H2X7PX/QkeM/+/Wn/wDybX8zdFAH9Mn/AA+y/Z6/6Ejxn/360/8A+TaP+H2X7PX/AEJHjP8A79af/wDJtfzN0UAf0yf8Psv2ev8AoSPGf/frT/8A5No/4fZfs9f9CR4z/wC/Wn//ACbX8zdFAH9Mn/D7L9nr/oSPGf8A360//wCTa/BX9qD4r6J8cfj74z+LHhy0urHTfEl+Lu3t70ILiNBFHHiQRs6Zyh6MRivBaKACiiigAooooAKKKKACiiigAooooAKKKKAP6ZP+CJv/ACb143/7HOX/ANN9nX7MV+M//BE3/k3rxv8A9jnL/wCm+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD//U/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooA+zP+Cen/J6Hwp/7DTf+k01f2YV/Gf8A8E9P+T0PhT/2Gm/9Jpq/swoAKKKKACiiigAooooAKKKKACiiigAooooA/gDooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9X9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigD7M/4J6f8nofCn/sNN/6TTV/ZhX8Z/wDwT0/5PQ+FP/Yab/0mmr+zCgAooooAKKKKACiiigAooooAKKKKACiiigD+AOiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/1v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+M/wDwWy/5N68Ef9jnF/6b7ygD+ZuiiigAooooAKKKKACiiigAooooAKKKKAPsz/gnp/yeh8Kf+w03/pNNX9mFfxn/APBPT/k9D4U/9hpv/Saav7MKACiiigAooooAKKKKACiiigAooooAKKKKAP4A6KKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP6ZP+CJv/JvXjf/ALHOX/032dfsxX4z/wDBE3/k3rxv/wBjnL/6b7Ov2YoAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/X/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooA+zP+Cen/J6Hwp/7DTf+k01f2YV/Gf8A8E9P+T0PhT/2Gm/9Jpq/swoAKKKKACiiigAooooAKKKKACiiigAooooA/gDooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9D9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigD7M/4J6f8nofCn/sNN/6TTV/ZhX8Z/wDwT0/5PQ+FP/Yab/0mmr+zCgAooooAKKKKACiiigAooooAKKKKACiiigD+AOiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/0f38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+XP/BVv4KfFP44/BTwn4c+E/h268SalY+KY724t7QoHjtxZXUZkPmOgxvdRwc5NAH8pNFfZn/DvT9tD/olOtf99W3/AMeo/wCHen7aH/RKda/76tv/AI9QB8Z0V9mf8O9P20P+iU61/wB9W3/x6j/h3p+2h/0SnWv++rb/AOPUAfGdFfZn/DvT9tD/AKJTrX/fVt/8eo/4d6ftof8ARKda/wC+rb/49QB8Z0V9mf8ADvT9tD/olOtf99W3/wAeo/4d6ftof9Ep1r/vq2/+PUAfGdFfZn/DvT9tD/olOtf99W3/AMeo/wCHen7aH/RKda/76tv/AI9QB8Z0V9mf8O9P20P+iU61/wB9W3/x6j/h3p+2h/0SnWv++rb/AOPUAH/BPT/k9D4U/wDYab/0mmr+zCv5cv2Kv2Kv2pvhz+1N8OvG3jb4dappOh6TqjT3t7O0BjgjMEq7m2ys2NzAcA9a/qNoAKKKKACiiigAooooAKKKKACiiigAooooA/gDor7M/wCHen7aH/RKda/76tv/AI9R/wAO9P20P+iU61/31bf/AB6gD4zor7M/4d6ftof9Ep1r/vq2/wDj1H/DvT9tD/olOtf99W3/AMeoA+M6K+zP+Hen7aH/AESnWv8Avq2/+PUf8O9P20P+iU61/wB9W3/x6gD4zor7M/4d6ftof9Ep1r/vq2/+PUf8O9P20P8AolOtf99W3/x6gD4zor7M/wCHen7aH/RKda/76tv/AI9R/wAO9P20P+iU61/31bf/AB6gD4zor7M/4d6ftof9Ep1r/vq2/wDj1H/DvT9tD/olOtf99W3/AMeoA+M6K+zP+Hen7aH/AESnWv8Avq2/+PUf8O9P20P+iU61/wB9W3/x6gD4zor7M/4d6ftof9Ep1r/vq2/+PUf8O9P20P8AolOtf99W3/x6gD4zor7M/wCHen7aH/RKda/76tv/AI9R/wAO9P20P+iU61/31bf/AB6gD4zor7M/4d6ftof9Ep1r/vq2/wDj1H/DvT9tD/olOtf99W3/AMeoA+M6K+zP+Hen7aH/AESnWv8Avq2/+PUf8O9P20P+iU61/wB9W3/x6gD4zor7M/4d6ftof9Ep1r/vq2/+PUf8O9P20P8AolOtf99W3/x6gD4zor7M/wCHen7aH/RKda/76tv/AI9R/wAO9P20P+iU61/31bf/AB6gD9mP+CJv/JvXjf8A7HOX/wBN9nX7MV+XP/BKT4KfFP4HfBTxZ4c+LHh268N6lfeKZL23t7soXktzZWsYkHlu4xvRhyc5FfqNQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAf/9L9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//T/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1P38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9X9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//W/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1/38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9D9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//R/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9P9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//U/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1f38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9b9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//X/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0P38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9H9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//S/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0/38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9T9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//V/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9f9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//Q/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/2Q=="/>
</defs>
</svg>
`;
var kn = (e)=>`<!doctype html>
<html>
  <head>
    <title>Scalar API Reference</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1" />
  </head>
  <body>
    <script
      id="api-reference"
      type="application/json">
    ${JSON.stringify(e)}
    </script>
	 <script>
      var configuration = {
	  	favicon: "data:image/svg+xml;utf8,${encodeURIComponent(Lt)}",
	   	theme: "saturn",
        metaData: {
			title: "Better Auth API",
			description: "API Reference for your Better Auth Instance",
		}
      }

      document.getElementById('api-reference').dataset.configuration =
        JSON.stringify(configuration)
    </script>
	  <script src="https://cdn.jsdelivr.net/npm/@scalar/api-reference"></script>
  </body>
</html>`, lf = (e)=>{
    let o = e?.path ?? "/reference";
    return {
        id: "open-api",
        endpoints: {
            generateOpenAPISchema: u("/open-api/generate-schema", {
                method: "GET"
            }, async (r)=>{
                let i = await Mo(r.context, r.context.options);
                return r.json(i);
            }),
            openAPIReference: u(o, {
                method: "GET",
                metadata: {
                    isAction: !1
                }
            }, async (r)=>{
                if (e?.disableDefaultReference) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("NOT_FOUND");
                let i = await Mo(r.context, r.context.options);
                return new Response(kn(i), {
                    headers: {
                        "Content-Type": "text/html"
                    }
                });
            })
        }
    };
};
;
;
var jt = {
    oauthApplication: {
        modelName: "oauthApplication",
        fields: {
            name: {
                type: "string"
            },
            icon: {
                type: "string",
                required: !1
            },
            metadata: {
                type: "string",
                required: !1
            },
            clientId: {
                type: "string",
                unique: !0
            },
            clientSecret: {
                type: "string"
            },
            redirectURLs: {
                type: "string"
            },
            type: {
                type: "string"
            },
            disabled: {
                type: "boolean",
                required: !1,
                defaultValue: !1
            },
            userId: {
                type: "string",
                required: !1
            },
            createdAt: {
                type: "date"
            },
            updatedAt: {
                type: "date"
            }
        }
    },
    oauthAccessToken: {
        modelName: "oauthAccessToken",
        fields: {
            accessToken: {
                type: "string",
                unique: !0
            },
            refreshToken: {
                type: "string",
                unique: !0
            },
            accessTokenExpiresAt: {
                type: "date"
            },
            refreshTokenExpiresAt: {
                type: "date"
            },
            clientId: {
                type: "string"
            },
            userId: {
                type: "string",
                required: !1
            },
            scopes: {
                type: "string"
            },
            createdAt: {
                type: "date"
            },
            updatedAt: {
                type: "date"
            }
        }
    },
    oauthConsent: {
        modelName: "oauthConsent",
        fields: {
            clientId: {
                type: "string"
            },
            userId: {
                type: "string"
            },
            scopes: {
                type: "string"
            },
            createdAt: {
                type: "date"
            },
            updatedAt: {
                type: "date"
            },
            consentGiven: {
                type: "boolean"
            }
        }
    }
};
;
function oo(e, o, r) {
    return `${e.includes("?") ? "&" : "?"}error=${o}&error_description=${r}`;
}
async function qo(e, o) {
    let r = {
        codeExpiresIn: 600,
        defaultScope: "openid",
        ...o,
        scopes: [
            "openid",
            "profile",
            "email",
            "offline_access",
            ...o?.scopes || []
        ]
    };
    if (!e.request) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
        error_description: "request not found",
        error: "invalid_request"
    });
    let i = await v(e);
    if (!i) {
        await e.setSignedCookie("oidc_login_prompt", JSON.stringify(e.query), e.context.secret, {
            maxAge: 600
        });
        let h = e.request.url?.split("?")[1];
        throw e.redirect(`${o.loginPage}?${h}`);
    }
    let t = e.query;
    if (!t.client_id) throw e.redirect(`${e.context.baseURL}/error?error=invalid_client`);
    if (!t.response_type) throw e.redirect(oo(`${e.context.baseURL}/error`, "invalid_request", "response_type is required"));
    let n = await e.context.adapter.findOne({
        model: "oauthApplication",
        where: [
            {
                field: "clientId",
                value: e.query.client_id
            }
        ]
    }).then((h)=>h ? {
            ...h,
            redirectURLs: h.redirectURLs.split(","),
            metadata: h.metadata ? JSON.parse(h.metadata) : {}
        } : null);
    if (!n) throw e.redirect(`${e.context.baseURL}/error?error=invalid_client`);
    let s = n.redirectURLs.find((h)=>h === e.query.redirect_uri);
    if (!s || !t.redirect_uri) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
        message: "Invalid redirect URI"
    });
    if (n.disabled) throw e.redirect(`${e.context.baseURL}/error?error=client_disabled`);
    if (t.response_type !== "code") throw e.redirect(`${e.context.baseURL}/error?error=unsupported_response_type`);
    let a = t.scope?.split(" ").filter((h)=>h) || r.defaultScope.split(" "), d = a.filter((h)=>!r.scopes.includes(h) || h === "offline_access" && t.prompt !== "consent");
    if (d.length) throw e.redirect(oo(t.redirect_uri, "invalid_scope", `The following scopes are invalid: ${d.join(", ")}`));
    if ((!t.code_challenge || !t.code_challenge_method) && o.requirePKCE) throw e.redirect(oo(t.redirect_uri, "invalid_request", "pkce is required"));
    if (![
        "s256",
        o.allowPlainCodeChallengeMethod ? "plain" : "s256"
    ].includes(t.code_challenge_method?.toLowerCase() || "")) throw e.redirect(oo(t.redirect_uri, "invalid_request", "invalid code_challenge method"));
    let A = _(32, "a-z", "A-Z", "0-9"), c = r.codeExpiresIn * 1e3, p = new Date(Date.now() + c);
    try {
        await e.context.internalAdapter.createVerificationValue({
            value: JSON.stringify({
                clientId: n.clientId,
                redirectURI: t.redirect_uri,
                scope: a,
                userId: i.user.id,
                authTime: i.session.createdAt.getTime(),
                requireConsent: t.prompt === "consent",
                state: t.prompt === "consent" ? t.state : null,
                codeChallenge: t.code_challenge,
                codeChallengeMethod: t.code_challenge_method
            }),
            identifier: A,
            expiresAt: p
        });
    } catch  {
        throw e.redirect(oo(t.redirect_uri, "server_error", "An error occurred while processing the request"));
    }
    let l = new URL(s);
    if (l.searchParams.set("code", A), l.searchParams.set("state", e.query.state), t.prompt !== "consent" || await e.context.adapter.findOne({
        model: "oauthConsent",
        where: [
            {
                field: "clientId",
                value: n.clientId
            },
            {
                field: "userId",
                value: i.user.id
            }
        ]
    }).then((h)=>!!h?.consentGiven)) throw e.redirect(l.toString());
    if (o?.consentPage) {
        await e.setSignedCookie("oidc_consent_prompt", A, e.context.secret, {
            maxAge: 600
        });
        let h = `${o.consentPage}?client_id=${n.clientId}&scope=${a.join(" ")}`;
        throw e.redirect(h);
    }
    let y = o?.getConsentHTML;
    if (!y) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("INTERNAL_SERVER_ERROR", {
        message: "No consent page provided"
    });
    return new Response(y({
        scopes: a,
        clientMetadata: n.metadata,
        clientIcon: n?.icon,
        clientId: n.clientId,
        clientName: n.name,
        code: A
    }), {
        headers: {
            "content-type": "text/html"
        }
    });
}
;
var Nn = (e, o)=>{
    let r = e.context.options.baseURL, i = e.context.baseURL;
    return {
        issuer: r,
        authorization_endpoint: `${i}/oauth2/authorize`,
        token_endpoint: `${i}/oauth2/token`,
        userInfo_endpoint: `${i}/oauth2/userinfo`,
        jwks_uri: `${i}/jwks`,
        registration_endpoint: `${i}/oauth2/register`,
        scopes_supported: [
            "openid",
            "profile",
            "email",
            "offline_access"
        ],
        response_types_supported: [
            "code"
        ],
        response_modes_supported: [
            "query"
        ],
        grant_types_supported: [
            "authorization_code"
        ],
        acr_values_supported: [
            "urn:mace:incommon:iap:silver",
            "urn:mace:incommon:iap:bronze"
        ],
        subject_types_supported: [
            "public"
        ],
        id_token_signing_alg_values_supported: [
            "RS256",
            "none"
        ],
        token_endpoint_auth_methods_supported: [
            "client_secret_basic",
            "client_secret_post"
        ],
        claims_supported: [
            "sub",
            "iss",
            "aud",
            "exp",
            "nbf",
            "iat",
            "jti",
            "email",
            "email_verified",
            "name"
        ],
        ...o?.metadata
    };
}, Uf = (e)=>{
    let o = {
        oauthClient: "oauthApplication",
        oauthAccessToken: "oauthAccessToken",
        oauthConsent: "oauthConsent"
    }, r = {
        codeExpiresIn: 600,
        defaultScope: "openid",
        accessTokenExpiresIn: 3600,
        refreshTokenExpiresIn: 604800,
        ...e,
        scopes: [
            "openid",
            "profile",
            "email",
            "offline_access",
            ...e?.scopes || []
        ]
    };
    return {
        id: "oidc",
        hooks: {
            after: [
                {
                    matcher () {
                        return !0;
                    },
                    handler: async (i)=>{
                        let t = await i.getSignedCookie("oidc_login_prompt", i.context.secret), n = i.context.authCookies.sessionToken.name, s = Oe(i.responseHeader.get("set-cookie") || ""), a = s.has(n);
                        if (!t || !a) return;
                        i.setCookie("oidc_login_prompt", "", {
                            maxAge: 0
                        });
                        let A = s.get(n)?.value?.split(".")[0];
                        if (!A) return;
                        let c = await i.context.internalAdapter.findSession(A);
                        return c ? (i.query = JSON.parse(t), i.query.prompt = "consent", i.context.session = c, await qo(i, r)) : void 0;
                    }
                }
            ]
        },
        endpoints: {
            getOpenIdConfig: u("/.well-known/openid-configuration", {
                method: "GET"
            }, async (i)=>Nn(i, e)),
            oAuth2authorize: u("/oauth2/authorize", {
                method: "GET",
                query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].record(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(), __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].any())
            }, async (i)=>qo(i, r)),
            oAuthConsent: u("/oauth2/consent", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
                    accept: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].boolean()
                }),
                use: [
                    I
                ]
            }, async (i)=>{
                let t = await i.getSignedCookie("oidc_consent_prompt", i.context.secret);
                if (!t) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                    error_description: "No consent prompt found",
                    error: "invalid_grant"
                });
                let n = await i.context.internalAdapter.findVerificationValue(t);
                if (!n) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                    error_description: "Invalid code",
                    error: "invalid_grant"
                });
                if (n.expiresAt < new Date) throw await i.context.internalAdapter.deleteVerificationValue(n.id), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                    error_description: "Code expired",
                    error: "invalid_grant"
                });
                let s = JSON.parse(n.value);
                if (!s.requireConsent || !s.state) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                    error_description: "Consent not required",
                    error: "invalid_grant"
                });
                if (!i.body.accept) return await i.context.internalAdapter.deleteVerificationValue(n.id), i.json({
                    redirectURI: `${s.redirectURI}?error=access_denied&error_description=User denied access`
                });
                let a = _(32, "a-z", "A-Z", "0-9"), d = r.codeExpiresIn * 1e3, A = new Date(Date.now() + d);
                await i.context.internalAdapter.updateVerificationValue(n.id, {
                    value: JSON.stringify({
                        ...s,
                        requireConsent: !1
                    }),
                    identifier: a,
                    expiresAt: A
                }), await i.context.adapter.create({
                    model: o.oauthConsent,
                    data: {
                        clientId: s.clientId,
                        userId: s.userId,
                        scopes: s.scope.join(" "),
                        consentGiven: !0,
                        createdAt: new Date,
                        updatedAt: new Date
                    }
                });
                let c = new URL(s.redirectURI);
                return c.searchParams.set("code", a), c.searchParams.set("state", s.state), i.json({
                    redirectURI: c.toString()
                });
            }),
            oAuth2token: u("/oauth2/token", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].any(),
                metadata: {
                    isAction: !1
                }
            }, async (i)=>{
                let { body: t } = i;
                if (!t) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    error_description: "request body not found",
                    error: "invalid_request"
                });
                if (t instanceof FormData && (t = Object.fromEntries(t.entries())), !(t instanceof Object)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    error_description: "request body is not an object",
                    error: "invalid_request"
                });
                let { client_id: n, client_secret: s, grant_type: a, code: d, redirect_uri: A, refresh_token: c, code_verifier: p } = t;
                if (a === "refresh_token") {
                    if (!c) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                        error_description: "refresh_token is required",
                        error: "invalid_request"
                    });
                    let P = await i.context.adapter.findOne({
                        model: o.oauthAccessToken,
                        where: [
                            {
                                field: "refreshToken",
                                value: c.toString()
                            }
                        ]
                    });
                    if (!P) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                        error_description: "invalid refresh token",
                        error: "invalid_grant"
                    });
                    if (P.clientId !== n?.toString()) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                        error_description: "invalid client_id",
                        error: "invalid_client"
                    });
                    if (P.refreshTokenExpiresAt < new Date) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                        error_description: "refresh token expired",
                        error: "invalid_grant"
                    });
                    let Z = _(32, "a-z", "A-Z"), te = _(32, "a-z", "A-Z"), se = new Date(Date.now() + r.accessTokenExpiresIn * 1e3), Ho = new Date(Date.now() + r.refreshTokenExpiresIn * 1e3);
                    return await i.context.adapter.create({
                        model: o.oauthAccessToken,
                        data: {
                            accessToken: Z,
                            refreshToken: te,
                            accessTokenExpiresAt: se,
                            refreshTokenExpiresAt: Ho,
                            clientId: n.toString(),
                            userId: P.userId,
                            scopes: P.scopes,
                            createdAt: new Date,
                            updatedAt: new Date
                        }
                    }), i.json({
                        access_token: Z,
                        token_type: "bearer",
                        expires_in: r.accessTokenExpiresIn,
                        refresh_token: te,
                        scope: P.scopes
                    });
                }
                if (!d) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    error_description: "code is required",
                    error: "invalid_request"
                });
                if (e.requirePKCE && !p) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    error_description: "code verifier is missing",
                    error: "invalid_request"
                });
                let l = await i.context.internalAdapter.findVerificationValue(d.toString());
                if (!l) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                    error_description: "invalid code",
                    error: "invalid_grant"
                });
                if (l.expiresAt < new Date) throw await i.context.internalAdapter.deleteVerificationValue(l.id), new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                    error_description: "code expired",
                    error: "invalid_grant"
                });
                if (await i.context.internalAdapter.deleteVerificationValue(l.id), !n || !s) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                    error_description: "client_id and client_secret are required",
                    error: "invalid_client"
                });
                if (!a) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    error_description: "grant_type is required",
                    error: "invalid_request"
                });
                if (a !== "authorization_code") throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    error_description: "grant_type must be 'authorization_code'",
                    error: "unsupported_grant_type"
                });
                if (!A) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    error_description: "redirect_uri is required",
                    error: "invalid_request"
                });
                let K = await i.context.adapter.findOne({
                    model: o.oauthClient,
                    where: [
                        {
                            field: "clientId",
                            value: n.toString()
                        }
                    ]
                }).then((P)=>P ? {
                        ...P,
                        redirectURLs: P.redirectURLs.split(","),
                        metadata: P.metadata ? JSON.parse(P.metadata) : {}
                    } : null);
                if (!K) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                    error_description: "invalid client_id",
                    error: "invalid_client"
                });
                if (K.disabled) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                    error_description: "client is disabled",
                    error: "invalid_client"
                });
                if (!(K.clientSecret === s.toString())) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                    error_description: "invalid client_secret",
                    error: "invalid_client"
                });
                let h = JSON.parse(l.value);
                if (h.clientId !== n.toString()) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                    error_description: "invalid client_id",
                    error: "invalid_client"
                });
                if (h.redirectURI !== A.toString()) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                    error_description: "invalid redirect_uri",
                    error: "invalid_client"
                });
                if (h.codeChallenge && !p) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    error_description: "code verifier is missing",
                    error: "invalid_request"
                });
                if ((h.codeChallengeMethod === "plain" ? p : await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hash$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["createHash"])("SHA-256", "base64urlnopad").digest(p)) !== h.codeChallenge) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                    error_description: "code verification failed",
                    error: "invalid_request"
                });
                let x = h.scope;
                await i.context.internalAdapter.deleteVerificationValue(d.toString());
                let z = _(32, "a-z", "A-Z"), g = _(32, "A-Z", "a-z"), w = new Date(Date.now() + r.accessTokenExpiresIn * 1e3), U = new Date(Date.now() + r.refreshTokenExpiresIn * 1e3);
                await i.context.adapter.create({
                    model: o.oauthAccessToken,
                    data: {
                        accessToken: z,
                        refreshToken: g,
                        accessTokenExpiresAt: w,
                        refreshTokenExpiresAt: U,
                        clientId: n.toString(),
                        userId: h.userId,
                        scopes: x.join(" "),
                        createdAt: new Date,
                        updatedAt: new Date
                    }
                });
                let C = await i.context.internalAdapter.findUserById(h.userId);
                if (!C) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                    error_description: "user not found",
                    error: "invalid_grant"
                });
                let Te = {
                    alg: "HS256",
                    key: await crypto.subtle.generateKey({
                        name: "HMAC",
                        hash: "SHA-256"
                    }, !0, [
                        "sign",
                        "verify"
                    ])
                }, wo = {
                    given_name: C.name.split(" ")[0],
                    family_name: C.name.split(" ")[1],
                    name: C.name,
                    profile: C.image,
                    updated_at: C.updatedAt.toISOString()
                }, io = {
                    email: C.email,
                    email_verified: C.emailVerified
                }, Me = {
                    ...x.includes("profile") ? wo : {},
                    ...x.includes("email") ? io : {}
                }, Co = await new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$jose$2f$dist$2f$node$2f$esm$2f$jwt$2f$sign$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["SignJWT"]({
                    sub: C.id,
                    aud: n.toString(),
                    iat: Date.now(),
                    auth_time: i.context.session?.session.createdAt.getTime(),
                    nonce: t.nonce,
                    acr: "urn:mace:incommon:iap:silver",
                    ...Me
                }).setProtectedHeader({
                    alg: Te.alg
                }).setIssuedAt().setExpirationTime(Math.floor(Date.now() / 1e3) + r.accessTokenExpiresIn).sign(Te.key);
                return i.json({
                    access_token: z,
                    token_type: "Bearer",
                    expires_in: r.accessTokenExpiresIn,
                    refresh_token: x.includes("offline_access") ? g : void 0,
                    scope: x.join(" "),
                    id_token: x.includes("openid") ? Co : void 0
                }, {
                    headers: {
                        "Cache-Control": "no-store",
                        Pragma: "no-cache"
                    }
                });
            }),
            oAuth2userInfo: u("/oauth2/userinfo", {
                method: "GET",
                metadata: {
                    isAction: !1
                }
            }, async (i)=>{
                if (!i.request) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                    error_description: "request not found",
                    error: "invalid_request"
                });
                let t = i.request.headers.get("authorization");
                if (!t) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                    error_description: "authorization header not found",
                    error: "invalid_request"
                });
                let n = t.replace("Bearer ", ""), s = await i.context.adapter.findOne({
                    model: o.oauthAccessToken,
                    where: [
                        {
                            field: "accessToken",
                            value: n
                        }
                    ]
                });
                if (!s) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                    error_description: "invalid access token",
                    error: "invalid_token"
                });
                if (s.accessTokenExpiresAt < new Date) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                    error_description: "The Access Token expired",
                    error: "invalid_token"
                });
                let a = await i.context.internalAdapter.findUserById(s.userId);
                if (!a) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                    error_description: "user not found",
                    error: "invalid_token"
                });
                let d = s.scopes.split(" "), A = {
                    email: d.includes("email") ? a.email : void 0,
                    name: d.includes("profile") ? a.name : void 0,
                    picture: d.includes("profile") ? a.image : void 0,
                    given_name: d.includes("profile") ? a.name.split(" ")[0] : void 0,
                    family_name: d.includes("profile") ? a.name.split(" ")[1] : void 0,
                    email_verified: d.includes("email") ? a.emailVerified : void 0
                };
                return i.json(A);
            }),
            registerOAuthApplication: u("/oauth2/register", {
                method: "POST",
                body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
                    name: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
                    icon: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional(),
                    metadata: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].record(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].any()).optional(),
                    redirectURLs: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].array(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string())
                })
            }, async (i)=>{
                let t = i.body, n = await v(i);
                if (!n && !e.allowDynamicClientRegistration) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                    message: "Unauthorized"
                });
                let s = e.generateClientId?.() || _(32, "a-z", "A-Z"), a = e.generateClientSecret?.() || _(32, "a-z", "A-Z"), d = await i.context.adapter.create({
                    model: o.oauthClient,
                    data: {
                        name: t.name,
                        icon: t.icon,
                        metadata: t.metadata ? JSON.stringify(t.metadata) : null,
                        clientId: s,
                        clientSecret: a,
                        redirectURLs: t.redirectURLs.join(","),
                        type: "web",
                        authenticationScheme: "client_secret",
                        disabled: !1,
                        userId: n?.session.userId,
                        createdAt: new Date,
                        updatedAt: new Date
                    }
                });
                return i.json({
                    ...d,
                    redirectURLs: d.redirectURLs.split(","),
                    metadata: d.metadata ? JSON.parse(d.metadata) : null
                });
            }),
            getOAuthClient: u("/oauth2/client/:id", {
                method: "GET",
                use: [
                    I
                ]
            }, async (i)=>{
                let t = await i.context.adapter.findOne({
                    model: o.oauthClient,
                    where: [
                        {
                            field: "clientId",
                            value: i.params.id
                        }
                    ]
                });
                if (!t) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["APIError"]("NOT_FOUND", {
                    error_description: "client not found",
                    error: "not_found"
                });
                return i.json({
                    clientId: t.clientId,
                    name: t.name,
                    icon: t.icon
                });
            })
        },
        schema: jt
    };
};
;
}}),

};

//# sourceMappingURL=node_modules_better-auth_dist_152092._.js.map